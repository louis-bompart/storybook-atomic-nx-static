{"file":"atomic-result-printable-uri.entry.cjs.js","mappings":"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","names":["FocusTargetController","Schema","NumberValue","getAttributesFromLinkSlot","buildInteractiveResult","h","parseXML","Arrow","LinkWithItemAnalytics","InitializeBindings","ResultContext"],"sources":["src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.pcss?tag=atomic-result-printable-uri","src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.tsx"],"sourcesContent":["atomic-result-printable-uri {\n  max-width: 100%;\n  word-break: break-word;\n\n  a,\n  button {\n    color: var(--atomic-primary);\n\n    &:hover,\n    &:focus-visible {\n      text-decoration: underline;\n      color: var(--atomic-primary);\n    }\n\n    &:focus {\n      outline: none;\n    }\n\n    &:visited {\n      color: var(--atomic-visited);\n    }\n  }\n\n  ul {\n    display: flex;\n    flex-wrap: wrap;\n  }\n\n  li {\n    display: inline-flex;\n    align-items: center;\n    max-width: 100%;\n\n    a {\n      display: inline-block;\n      vertical-align: middle;\n      max-width: 100%;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    white-space: nowrap;\n    &:last-child {\n      white-space: normal;\n\n      &::after {\n        content: none;\n      }\n    }\n\n    .result-printable-uri-separator {\n      display: inline-block;\n      margin: 0 0.5rem;\n      vertical-align: middle;\n      width: 0.75rem;\n      height: 0.75rem;\n      color: var(--atomic-neutral-dark);\n    }\n  }\n}\n","import {Schema, NumberValue} from '@coveo/bueno';\nimport {\n  buildInteractiveResult,\n  InteractiveResult,\n  Result,\n} from '@coveo/headless';\nimport {Component, Element, h, Prop, State, VNode} from '@stencil/core';\nimport Arrow from '../../../../images/arrow-right.svg';\nimport {FocusTargetController} from '../../../../utils/accessibility-utils';\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\nimport {parseXML} from '../../../../utils/utils';\nimport {getAttributesFromLinkSlot} from '../../../common/item-link/attributes-slot';\nimport {LinkWithItemAnalytics} from '../../../common/item-link/item-link';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\nimport {ResultContext} from '../result-template-decorators';\n\n/**\n * The `atomic-result-printable-uri` component displays the URI, or path, to access a result.\n *\n * @slot attributes - Lets you pass [attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes) down to anchor elements, overriding other attributes.\n * To be used exclusively in anchor elements, such as: `<a slot=\"attributes\" target=\"_blank\" download></a>`.\n */\n@Component({\n  tag: 'atomic-result-printable-uri',\n  styleUrl: 'atomic-result-printable-uri.pcss',\n  shadow: false,\n})\nexport class AtomicResultPrintableUri {\n  @InitializeBindings() public bindings!: Bindings;\n  @ResultContext() private result!: Result;\n  @Element() public host!: HTMLElement;\n\n  @State() listExpanded = false;\n  @State() error!: Error;\n\n  /**\n   * The maximum number of Uri parts to display. This has to be over the minimum of `3` in order to be effective. Putting `Infinity` will disable the ellipsis.\n   */\n  @Prop({reflect: true}) maxNumberOfParts = 5;\n\n  private expandedPartFocus?: FocusTargetController;\n\n  private interactiveResult!: InteractiveResult;\n  private linkAttributes?: Attr[];\n\n  private get focusTarget() {\n    if (!this.expandedPartFocus) {\n      this.expandedPartFocus = new FocusTargetController(this);\n    }\n    return this.expandedPartFocus;\n  }\n\n  public connectedCallback() {\n    try {\n      new Schema({\n        maxNumberOfParts: new NumberValue({min: 3}),\n      }).validate({maxNumberOfParts: this.maxNumberOfParts});\n    } catch (error) {\n      this.error = error as Error;\n    }\n    const slotName = 'attributes';\n    this.linkAttributes = getAttributesFromLinkSlot(this.host, slotName);\n  }\n\n  public initialize() {\n    this.interactiveResult = buildInteractiveResult(this.bindings.engine, {\n      options: {result: this.result},\n    });\n  }\n\n  private getIndexOfEllipsis(parentsCount: number) {\n    const valuesToHide = Math.max(2, parentsCount - this.maxNumberOfParts);\n    const valuesToShowBeforeEllipsis = parentsCount - valuesToHide - 1;\n    return valuesToShowBeforeEllipsis;\n  }\n\n  private renderEllipsis() {\n    return (\n      <li>\n        <button\n          aria-label={this.bindings.i18n.t('collapsed-uri-parts')}\n          onClick={(e) => {\n            e.stopPropagation();\n            this.focusTarget.focusOnNextTarget();\n            this.listExpanded = true;\n          }}\n        >\n          ...\n        </button>\n        {this.renderSeparator()}\n      </li>\n    );\n  }\n\n  private get allParents() {\n    const parentsXml = parseXML(`${this.result.raw.parents}`);\n    const parents = Array.from(parentsXml.getElementsByTagName('parent'));\n    const ellipsisIndex = this.getIndexOfEllipsis(parents.length);\n    return parents.map((parent, i) => {\n      const name = parent.getAttribute('name');\n      const uri = parent.getAttribute('uri')!;\n      return (\n        <li>\n          {this.renderLink(name, uri, i === ellipsisIndex)}\n          {i === parents.length - 1 ? null : this.renderSeparator()}\n        </li>\n      );\n    });\n  }\n\n  private renderSeparator() {\n    return (\n      <atomic-icon\n        class=\"result-printable-uri-separator\"\n        icon={Arrow}\n        role=\"separator\"\n      ></atomic-icon>\n    );\n  }\n\n  private renderParents() {\n    const parents = this.allParents;\n    if (this.listExpanded || parents.length <= this.maxNumberOfParts) {\n      return parents;\n    }\n\n    return [\n      parents.slice(0, this.getIndexOfEllipsis(parents.length)),\n      this.renderEllipsis(),\n      parents.slice(-1),\n    ];\n  }\n\n  private renderLink(\n    content: VNode | string | null,\n    uri: string,\n    shouldSetTarget: boolean\n  ) {\n    return (\n      <LinkWithItemAnalytics\n        href={uri}\n        title={typeof content === 'string' ? content : undefined}\n        onSelect={() => this.interactiveResult.select()}\n        onBeginDelayedSelect={() => this.interactiveResult.beginDelayedSelect()}\n        onCancelPendingSelect={() =>\n          this.interactiveResult.cancelPendingSelect()\n        }\n        attributes={this.linkAttributes}\n        ref={\n          shouldSetTarget\n            ? (el?: HTMLAnchorElement) => this.focusTarget.setTarget(el)\n            : undefined\n        }\n      >\n        {content}\n      </LinkWithItemAnalytics>\n    );\n  }\n\n  public render() {\n    const parents = this.renderParents();\n    if (parents.length) {\n      return (\n        <ul aria-label={this.bindings.i18n.t('printable-uri')}>{parents}</ul>\n      );\n    }\n\n    return this.renderLink(\n      <atomic-result-text field=\"printableUri\"></atomic-result-text>,\n      this.result.clickUri,\n      false\n    );\n  }\n}\n"],"version":3}