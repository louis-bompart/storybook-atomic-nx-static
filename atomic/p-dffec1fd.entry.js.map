{"version":3,"names":["FacetDateInput","connectedCallback","this","start","filterState","range","parseDate","toDate","undefined","end","apply","startRef","validity","valid","endRef","applyInput","emit","filter","setRange","buildDateRange","setHours","formattedDateValue","date","format","render","label","bindings","i18n","t","startLabel","endLabel","startAria","endAria","applyAria","inputClasses","labelClasses","placeholder","pattern","h","key","class","onSubmit","e","preventDefault","part","htmlFor","facetId","id","type","ref","required","min","max","value","_a","onInput","target","_b","Button","style","ariaLabel","text"],"sources":["src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["import {buildDateRange} from '@coveo/headless';\r\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\r\nimport {parseDate} from '../../../../utils/date-utils';\r\nimport {Button} from '../../button';\r\nimport {AnyBindings} from '../../interface/bindings';\r\nimport {DateFilter, DateFilterState} from '../../types';\r\n\r\n/**\r\n * Internal component made to be integrated in a TimeframeFacet.\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-facet-date-input',\r\n  shadow: false,\r\n})\r\nexport class FacetDateInput {\r\n  @State() private start?: Date;\r\n  @State() private end?: Date;\r\n  private startRef!: HTMLInputElement;\r\n  private endRef!: HTMLInputElement;\r\n\r\n  @Prop() public bindings!: AnyBindings;\r\n  @Prop() public filter!: DateFilter;\r\n  @Prop() public filterState!: DateFilterState;\r\n  @Prop() public label!: string;\r\n  @Prop() public min?: string;\r\n  @Prop() public max?: string;\r\n\r\n  @Event({\r\n    eventName: 'atomic/dateInputApply',\r\n  })\r\n  private applyInput!: EventEmitter;\r\n\r\n  public connectedCallback() {\r\n    this.start = this.filterState.range\r\n      ? parseDate(this.filterState.range.start).toDate()\r\n      : undefined;\r\n    this.end = this.filterState.range\r\n      ? parseDate(this.filterState.range.end).toDate()\r\n      : undefined;\r\n  }\r\n\r\n  private apply() {\r\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\r\n      return;\r\n    }\r\n\r\n    this.applyInput.emit();\r\n    this.filter.setRange(\r\n      buildDateRange({\r\n        start: this.start!,\r\n        end: this.end!.setHours(23, 59, 59, 999),\r\n      })\r\n    );\r\n  }\r\n\r\n  private formattedDateValue(date?: string | Date) {\r\n    if (!date) {\r\n      return '';\r\n    }\r\n    return parseDate(date).format('YYYY-MM-DD');\r\n  }\r\n\r\n  render() {\r\n    const label = this.bindings.i18n.t(this.label);\r\n    const startLabel = this.bindings.i18n.t('start');\r\n    const endLabel = this.bindings.i18n.t('end');\r\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\r\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\r\n    const apply = this.bindings.i18n.t('apply');\r\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\r\n\r\n    const inputClasses = 'input-primary p-2.5';\r\n    const labelClasses = 'text-neutral-dark self-center';\r\n\r\n    const placeholder = 'yyyy-mm-dd';\r\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\r\n    const pattern =\r\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\r\n\r\n    return (\r\n      <form\r\n        class=\"grid gap-2 grid-cols-min-1fr mt-4 px-2\"\r\n        onSubmit={(e) => {\r\n          e.preventDefault();\r\n          this.apply();\r\n          return false;\r\n        }}\r\n      >\r\n        <label\r\n          part=\"input-label\"\r\n          class={labelClasses}\r\n          htmlFor={`${this.filterState.facetId}_start`}\r\n        >\r\n          {startLabel}:\r\n        </label>\r\n        <input\r\n          id={`${this.filterState.facetId}_start`}\r\n          part=\"input-start\"\r\n          type=\"date\"\r\n          ref={(ref) => (this.startRef = ref!)}\r\n          class={inputClasses}\r\n          aria-label={startAria}\r\n          placeholder={placeholder}\r\n          pattern={pattern}\r\n          required\r\n          // API/Index minimum supported date\r\n          min={this.min || this.formattedDateValue('1401-01-01')}\r\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\r\n          value={this.formattedDateValue(this.filterState.range?.start)}\r\n          onInput={(e) =>\r\n            (this.start = parseDate(\r\n              (e.target as HTMLInputElement).value\r\n            ).toDate())\r\n          }\r\n        />\r\n        <label\r\n          part=\"input-label\"\r\n          class={labelClasses}\r\n          htmlFor={`${this.filterState.facetId}_end`}\r\n        >\r\n          {endLabel}:\r\n        </label>\r\n        <input\r\n          id={`${this.filterState.facetId}_end`}\r\n          part=\"input-end\"\r\n          type=\"date\"\r\n          ref={(ref) => (this.endRef = ref!)}\r\n          class={inputClasses}\r\n          aria-label={endAria}\r\n          placeholder={placeholder}\r\n          pattern={pattern}\r\n          required\r\n          min={this.min || this.formattedDateValue(this.start)}\r\n          max={this.max}\r\n          value={this.formattedDateValue(this.filterState.range?.end)}\r\n          onInput={(e) =>\r\n            (this.end = parseDate(\r\n              (e.target as HTMLInputElement).value\r\n            ).toDate())\r\n          }\r\n        />\r\n        <Button\r\n          style=\"outline-primary\"\r\n          type=\"submit\"\r\n          part=\"input-apply-button\"\r\n          class=\"p-2.5 col-span-2 truncate\"\r\n          ariaLabel={applyAria}\r\n          text={apply}\r\n        ></Button>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}