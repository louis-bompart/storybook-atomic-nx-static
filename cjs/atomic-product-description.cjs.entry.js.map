{"file":"atomic-product-description.entry.cjs.js","mappings":";;;;;;;;;;;;;;;;;;AAAA,MAAM,2BAA2B,GAAG,u+tCAAu+tC,CAAC;AAC5guC,uCAAe,2BAA2B;;;;;;;;;;;;MCqB7B,wBAAwB;IA0BnC;;QAhBiB,eAAU,GAAG,KAAK,CAAC;QACnB,gBAAW,GAAG,KAAK,CAAC;;;;QAQtB,kBAAa,GAAmC,GAAG,CAAC;;;;QAKpD,UAAK,GAAsC,cAAc,CAAC;0BAd3C,KAAK;2BACJ,KAAK;6BAQ2B,GAAG;qBAKR,cAAc;QAGtE,IAAI,CAAC,cAAc,GAAG,IAAI,cAAc,CAAC;YACvC,IACE,IAAI,CAAC,eAAe;gBACpB,IAAI,CAAC,eAAe,CAAC,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY,EACrE;gBACA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;aACzB;iBAAM;gBACL,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;aAC1B;SACF,CAAC,CAAC;QACH,IAAI,CAAC,aAAa,EAAE,CAAC;KACtB;IAEO,aAAa;QACnB,IAAIA,gBAAM,CAAC;YACT,aAAa,EAAE,IAAIC,qBAAW,CAAC;gBAC7B,WAAW,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;aAC1C,CAAC;YACF,KAAK,EAAE,IAAIA,qBAAW,CAAC,EAAC,WAAW,EAAE,CAAC,cAAc,EAAE,gBAAgB,CAAC,EAAC,CAAC;SAC1E,CAAC,CAAC,QAAQ,CAAC;YACV,aAAa,EAAE,IAAI,CAAC,aAAa;YACjC,KAAK,EAAE,IAAI,CAAC,KAAK;SAClB,CAAC,CAAC;KACJ;IAED,gBAAgB;QACd,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,CACnD,2BAA2B,CACV,CAAC;QACpB,IAAI,IAAI,CAAC,eAAe,EAAE;YACxB,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;SACnD;KACF;IAEO,cAAc;QACpB,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;KACpC;IAEO,iBAAiB;QACvB,MAAM,YAAY,GAA8C;YAC9D,IAAI,EAAE,iBAAiB;YACvB,CAAC,EAAE,cAAc;YACjB,CAAC,EAAE,cAAc;YACjB,CAAC,EAAE,cAAc;YACjB,CAAC,EAAE,cAAc;SAClB,CAAC;QACF,OAAO,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,cAAc,CAAC;KAC3D;IAED,oBAAoB;QAClB,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE,CAAC;KAClC;IAEO,wBAAwB;;QAC9B,MAAM,kBAAkB,GAAG,MAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,mCAAI,EAAE,CAAC;QAE1D,IAAI,kBAAkB,KAAK,IAAI,EAAE;YAC/B,QACEC,kCACE,KAAK,EAAE,4BAA4B,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,iBAAiB,EAAE,GAAG,EAAE,EAAE,EACrF,KAAK,EAAEC,+BAAoB,CACzB,IAAI,CAAC,KAAK,EACV,kBAAkB,EAClB,IAAI,CAAC,QAAQ,CAAC,IAAI,CACnB,GACqB,EACxB;SACH;KACF;IAEO,oBAAoB;QAC1B,QACED,QAACE,aAAM,IACL,KAAK,EAAC,cAAc,EACpB,IAAI,EAAC,cAAc,EACnB,KAAK,EAAE,oBAAoB,IAAI,CAAC,UAAU,GAAG,QAAQ,GAAG,EAAE,EAAE,EAC5D,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,EACxC,OAAO,EAAE,MAAM,IAAI,CAAC,cAAc,EAAE,IAEpCF,yBACE,IAAI,EAAEG,aAAQ,EACd,KAAK,EAAC,yBAAyB,GAClB,EAAC,GAAG,EAClB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAC3B,EACT;KACH;IAEM,MAAM;QACX,QACEH,kEAAK,KAAK,EAAC,2BAA2B,IACnC,IAAI,CAAC,wBAAwB,EAAE,EAC/B,IAAI,CAAC,WAAW;YACf,IAAI,CAAC,aAAa,KAAK,MAAM;YAC7B,IAAI,CAAC,oBAAoB,EAAE,CACzB,EACN;KACH;;;AAzH4B;IAA5BI,sCAAkB,EAAE;0DAAoC;AAC/B;IAAzBC,wCAAc,EAAE;yDAA2B;;;;;","names":["Schema","StringValue","h","getFieldValueCaption","Button","PlusIcon","InitializeBindings","ProductContext"],"sources":["src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.pcss?tag=atomic-product-description","src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n","import {Schema, StringValue} from '@coveo/bueno';\nimport {Product} from '@coveo/headless/commerce';\nimport {Component, State, h, Element, Prop} from '@stencil/core';\nimport PlusIcon from '../../../../images/plus.svg';\nimport {getFieldValueCaption} from '../../../../utils/field-utils';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {Button} from '../../../common/button';\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport {ProductContext} from '../product-template-decorators';\n\n/**\n * @internal\n * The `atomic-product-description` component renders the description of a product.\n */\n@Component({\n  tag: 'atomic-product-description',\n  styleUrl: 'atomic-product-description.pcss',\n  shadow: false,\n})\nexport class AtomicProductDescription\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n  @ProductContext() private product!: Product;\n\n  @Element() hostElement!: HTMLElement;\n\n  public error!: Error;\n\n  @State() private isExpanded = false;\n  @State() private isTruncated = false;\n\n  private descriptionText!: HTMLDivElement;\n  private resizeObserver: ResizeObserver;\n\n  /**\n   * The number of lines after which the product description should be truncated. A value of \"none\" will disable truncation.\n   */\n  @Prop() public truncateAfter: 'none' | '1' | '2' | '3' | '4' = '2';\n\n  /**\n   * The name of the description field to use.\n   */\n  @Prop() public field: 'ec_description' | 'ec_shortdesc' = 'ec_shortdesc';\n\n  constructor() {\n    this.resizeObserver = new ResizeObserver(() => {\n      if (\n        this.descriptionText &&\n        this.descriptionText.scrollHeight > this.descriptionText.clientHeight\n      ) {\n        this.isTruncated = true;\n      } else {\n        this.isTruncated = false;\n      }\n    });\n    this.validateProps();\n  }\n\n  private validateProps() {\n    new Schema({\n      truncateAfter: new StringValue({\n        constrainTo: ['none', '1', '2', '3', '4'],\n      }),\n      field: new StringValue({constrainTo: ['ec_shortdesc', 'ec_description']}),\n    }).validate({\n      truncateAfter: this.truncateAfter,\n      field: this.field,\n    });\n  }\n\n  componentDidLoad() {\n    this.descriptionText = this.hostElement.querySelector(\n      '.product-description-text'\n    ) as HTMLDivElement;\n    if (this.descriptionText) {\n      this.resizeObserver.observe(this.descriptionText);\n    }\n  }\n\n  private onToggleExpand() {\n    this.isExpanded = !this.isExpanded;\n  }\n\n  private getLineClampClass() {\n    const lineClampMap: Record<typeof this.truncateAfter, string> = {\n      none: 'line-clamp-none',\n      1: 'line-clamp-1',\n      2: 'line-clamp-2',\n      3: 'line-clamp-3',\n      4: 'line-clamp-4',\n    };\n    return lineClampMap[this.truncateAfter] || 'line-clamp-2';\n  }\n\n  disconnectedCallback() {\n    this.resizeObserver.disconnect();\n  }\n\n  private renderProductDescription() {\n    const productDescription = this.product[this.field] ?? '';\n\n    if (productDescription !== null) {\n      return (\n        <atomic-commerce-text\n          class={`product-description-text ${!this.isExpanded ? this.getLineClampClass() : ''}`}\n          value={getFieldValueCaption(\n            this.field,\n            productDescription,\n            this.bindings.i18n\n          )}\n        ></atomic-commerce-text>\n      );\n    }\n  }\n\n  private renderShowMoreButton() {\n    return (\n      <Button\n        style=\"text-primary\"\n        part=\"label-button\"\n        class={`my-2 p-1 text-xs ${this.isExpanded ? 'hidden' : ''}`}\n        title={this.bindings.i18n.t('show-more')}\n        onClick={() => this.onToggleExpand()}\n      >\n        <atomic-icon\n          icon={PlusIcon}\n          class=\"w-2 ml-1 align-baseline\"\n        ></atomic-icon>{' '}\n        {this.bindings.i18n.t('show-more')}\n      </Button>\n    );\n  }\n\n  public render() {\n    return (\n      <div class=\"flex flex-col items-start\">\n        {this.renderProductDescription()}\n        {this.isTruncated &&\n          this.truncateAfter !== 'none' &&\n          this.renderShowMoreButton()}\n      </div>\n    );\n  }\n}\n"],"version":3}