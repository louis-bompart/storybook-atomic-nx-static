{"version":3,"names":["StorageItems","SafeStorage","constructor","clear","this","tryAccessLocalStorageOrWarn","localStorage","getItem","key","getParsedJSON","fallback","item","tryJSONOrWarn","JSON","parse","index","length","tryOrElse","removeItem","setItem","value","setJSON","obj","stringified","stringify","tryTo","orElse","console","warn","e"],"sources":["src/utils/local-storage-utils.tsx"],"sourcesContent":["import {StandaloneSearchBoxAnalytics} from '@coveo/headless';\r\n\r\nexport enum StorageItems {\r\n  RECENT_QUERIES = 'coveo-recent-queries',\r\n  STANDALONE_SEARCH_BOX_DATA = 'coveo-standalone-search-box-data',\r\n  GENERATED_ANSWER_DATA = 'coveo-generated-answer-data',\r\n}\r\n\r\nexport interface StandaloneSearchBoxData {\r\n  value: string;\r\n  enableQuerySyntax?: boolean;\r\n  analytics: StandaloneSearchBoxAnalytics;\r\n}\r\n\r\nexport interface GeneratedAnswerData {\r\n  isVisible: boolean;\r\n}\r\n\r\nexport class SafeStorage implements Storage {\r\n  constructor() {}\r\n  public clear() {\r\n    return this.tryAccessLocalStorageOrWarn(\r\n      () => localStorage.clear(),\r\n      () => {}\r\n    );\r\n  }\r\n\r\n  public getItem(key: StorageItems) {\r\n    return this.tryAccessLocalStorageOrWarn(\r\n      () => localStorage.getItem(key),\r\n      () => null\r\n    );\r\n  }\r\n\r\n  public getParsedJSON<T>(key: StorageItems, fallback: T) {\r\n    const item = this.getItem(key);\r\n    if (!item) {\r\n      return fallback;\r\n    }\r\n    return this.tryJSONOrWarn(\r\n      key,\r\n      () => JSON.parse(item) as T,\r\n      () => fallback\r\n    );\r\n  }\r\n\r\n  public key(index: number) {\r\n    return this.tryAccessLocalStorageOrWarn(\r\n      () => localStorage.key(index),\r\n      () => null\r\n    );\r\n  }\r\n\r\n  public get length() {\r\n    return this.tryOrElse(\r\n      () => localStorage.length,\r\n      () => 0\r\n    );\r\n  }\r\n\r\n  public removeItem(key: StorageItems) {\r\n    return this.tryAccessLocalStorageOrWarn(\r\n      () => localStorage.removeItem(key),\r\n      () => {}\r\n    );\r\n  }\r\n\r\n  public setItem(key: StorageItems, value: string) {\r\n    return this.tryAccessLocalStorageOrWarn(\r\n      () => localStorage.setItem(key, value),\r\n      () => {}\r\n    );\r\n  }\r\n\r\n  public setJSON(key: StorageItems, obj: unknown) {\r\n    const stringified = this.tryJSONOrWarn(\r\n      key,\r\n      () => JSON.stringify(obj),\r\n      () => JSON.stringify({})\r\n    );\r\n    return this.setItem(key, stringified);\r\n  }\r\n\r\n  private tryAccessLocalStorageOrWarn<OnSuccess, OnFailure>(\r\n    tryTo: () => OnSuccess,\r\n    orElse: () => OnFailure\r\n  ) {\r\n    return this.tryOrElse(tryTo, () => {\r\n      console.warn(\r\n        'Error while trying to read or modify local storage. This can be caused by browser specific settings.'\r\n      );\r\n      return orElse();\r\n    });\r\n  }\r\n\r\n  private tryJSONOrWarn<OnSuccess, OnFailure>(\r\n    key: StorageItems,\r\n    tryTo: () => OnSuccess,\r\n    orElse: () => OnFailure\r\n  ) {\r\n    return this.tryOrElse(tryTo, () => {\r\n      console.warn(\r\n        `Error while trying to do JSON manipulation with local storage entry. ${key}`\r\n      );\r\n      return orElse();\r\n    });\r\n  }\r\n\r\n  private tryOrElse<OnSuccess, OnFailure>(\r\n    tryTo: () => OnSuccess,\r\n    orElse: () => OnFailure\r\n  ) {\r\n    try {\r\n      return tryTo();\r\n    } catch (e) {\r\n      console.warn(e as Error);\r\n      return orElse();\r\n    }\r\n  }\r\n}\r\n"],"mappings":"IAEYA,GAAZ,SAAYA,GACVA,EAAA,yCACAA,EAAA,iEACAA,EAAA,sDACD,EAJD,CAAYA,MAAY,K,MAgBXC,EACX,WAAAC,GAAA,CACO,KAAAC,GACL,OAAOC,KAAKC,6BACV,IAAMC,aAAaH,UACnB,Q,CAIG,OAAAI,CAAQC,GACb,OAAOJ,KAAKC,6BACV,IAAMC,aAAaC,QAAQC,KAC3B,IAAM,M,CAIH,aAAAC,CAAiBD,EAAmBE,GACzC,MAAMC,EAAOP,KAAKG,QAAQC,GAC1B,IAAKG,EAAM,CACT,OAAOD,C,CAET,OAAON,KAAKQ,cACVJ,GACA,IAAMK,KAAKC,MAAMH,KACjB,IAAMD,G,CAIH,GAAAF,CAAIO,GACT,OAAOX,KAAKC,6BACV,IAAMC,aAAaE,IAAIO,KACvB,IAAM,M,CAIV,UAAWC,GACT,OAAOZ,KAAKa,WACV,IAAMX,aAAaU,SACnB,IAAM,G,CAIH,UAAAE,CAAWV,GAChB,OAAOJ,KAAKC,6BACV,IAAMC,aAAaY,WAAWV,KAC9B,Q,CAIG,OAAAW,CAAQX,EAAmBY,GAChC,OAAOhB,KAAKC,6BACV,IAAMC,aAAaa,QAAQX,EAAKY,KAChC,Q,CAIG,OAAAC,CAAQb,EAAmBc,GAChC,MAAMC,EAAcnB,KAAKQ,cACvBJ,GACA,IAAMK,KAAKW,UAAUF,KACrB,IAAMT,KAAKW,UAAU,MAEvB,OAAOpB,KAAKe,QAAQX,EAAKe,E,CAGnB,2BAAAlB,CACNoB,EACAC,GAEA,OAAOtB,KAAKa,UAAUQ,GAAO,KAC3BE,QAAQC,KACN,wGAEF,OAAOF,GAAQ,G,CAIX,aAAAd,CACNJ,EACAiB,EACAC,GAEA,OAAOtB,KAAKa,UAAUQ,GAAO,KAC3BE,QAAQC,KACN,wEAAwEpB,KAE1E,OAAOkB,GAAQ,G,CAIX,SAAAT,CACNQ,EACAC,GAEA,IACE,OAAOD,G,CACP,MAAOI,GACPF,QAAQC,KAAKC,GACb,OAAOH,G"}