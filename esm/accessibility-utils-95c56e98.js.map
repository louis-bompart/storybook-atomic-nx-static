{"file":"accessibility-utils-95c56e98.js","mappings":"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","names":[],"sources":["src/utils/accessibility-utils.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport {AnyBindings} from '../components/common/interface/bindings';\r\nimport {buildCustomEvent} from './event-utils';\r\nimport {InitializableComponent} from './initialization-utils';\r\nimport {defer} from './utils';\r\n\r\nexport const findAriaLiveEventName = 'atomic/accessibility/findAriaLive';\r\n\r\nexport interface FindAriaLiveEventArgs {\r\n  element?: HTMLAtomicAriaLiveElement;\r\n}\r\n\r\nexport function AriaLiveRegion(regionName: string, assertive = false) {\r\n  function getAriaLiveElement() {\r\n    const event = buildCustomEvent<FindAriaLiveEventArgs>(\r\n      findAriaLiveEventName,\r\n      {}\r\n    );\r\n    document.dispatchEvent(event);\r\n    const {element} = event.detail;\r\n    return element;\r\n  }\r\n\r\n  function dispatchMessage(message: string) {\r\n    getAriaLiveElement()?.updateMessage(regionName, message, assertive);\r\n  }\r\n\r\n  function registerRegion() {\r\n    getAriaLiveElement()?.registerRegion(regionName, assertive);\r\n  }\r\n\r\n  return (\r\n    component: InitializableComponent<AnyBindings>,\r\n    setterName: string\r\n  ) => {\r\n    const {componentWillRender} = component;\r\n    Object.defineProperty(component, setterName, {\r\n      set: (message: string) => dispatchMessage(message),\r\n    });\r\n\r\n    component.componentWillRender = function () {\r\n      componentWillRender && componentWillRender.call(this);\r\n      registerRegion();\r\n    };\r\n  };\r\n}\r\n\r\nexport class FocusTargetController {\r\n  private bindings: AnyBindings;\r\n  private lastSearchId?: string;\r\n  private element?: HTMLElement;\r\n  private onFocusCallback?: Function;\r\n  private doFocusAfterSearch = false;\r\n  private doFocusOnNextTarget = false;\r\n\r\n  constructor(private component: InitializableComponent<AnyBindings>) {\r\n    this.bindings = component.bindings;\r\n    this.handleComponentRenderLoop();\r\n  }\r\n\r\n  public setTarget(el: HTMLElement | undefined) {\r\n    if (!el) {\r\n      return;\r\n    }\r\n    this.element = el;\r\n    if (this.doFocusOnNextTarget) {\r\n      this.doFocusOnNextTarget = false;\r\n      this.focus();\r\n    }\r\n  }\r\n\r\n  public async focus() {\r\n    await defer();\r\n    this.element?.focus();\r\n    this.onFocusCallback?.();\r\n  }\r\n\r\n  public focusAfterSearch() {\r\n    this.lastSearchId = this.bindings.store.getUniqueIDFromEngine(\r\n      this.bindings.engine\r\n    );\r\n    this.doFocusAfterSearch = true;\r\n    return new Promise((resolve) => (this.onFocusCallback = resolve));\r\n  }\r\n\r\n  public focusOnNextTarget() {\r\n    this.doFocusOnNextTarget = true;\r\n    return new Promise((resolve) => (this.onFocusCallback = resolve));\r\n  }\r\n\r\n  public disableForCurrentSearch() {\r\n    if (\r\n      this.bindings.store.getUniqueIDFromEngine(this.bindings.engine) !==\r\n      this.lastSearchId\r\n    ) {\r\n      this.doFocusAfterSearch = false;\r\n    }\r\n  }\r\n\r\n  private handleComponentRenderLoop() {\r\n    const originalComponentDidRender = this.component.componentDidRender;\r\n\r\n    this.component.componentDidRender = () => {\r\n      originalComponentDidRender &&\r\n        originalComponentDidRender.call(this.component);\r\n      if (!this.bindings) {\r\n        return;\r\n      }\r\n      if (\r\n        this.doFocusAfterSearch &&\r\n        this.bindings.store.getUniqueIDFromEngine(this.bindings.engine) !==\r\n          this.lastSearchId\r\n      ) {\r\n        this.doFocusAfterSearch = false;\r\n        if (this.element) {\r\n          const el = this.element;\r\n          // The focus seems to be flaky without deferring, especially on iOS.\r\n          defer().then(() => {\r\n            el.focus();\r\n            this.onFocusCallback?.();\r\n          });\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction isFocusable(element: Element) {\r\n  // Source: https://stackoverflow.com/a/30753870\r\n  if (element.getAttribute('tabindex') === '-1') {\r\n    return false;\r\n  }\r\n  if (element.hasAttribute('tabindex')) {\r\n    return true;\r\n  }\r\n  if (element.getAttribute('contentEditable') === 'true') {\r\n    return true;\r\n  }\r\n  switch (element.tagName) {\r\n    case 'A':\r\n    case 'AREA':\r\n      return element.hasAttribute('href');\r\n    case 'INPUT':\r\n    case 'SELECT':\r\n    case 'TEXTAREA':\r\n    case 'BUTTON':\r\n      return !element.hasAttribute('disabled');\r\n    case 'IFRAME':\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nexport function* getFocusableDescendants(\r\n  element: Element\r\n): Generator<HTMLElement> {\r\n  if (isFocusable(element)) {\r\n    yield element as HTMLElement;\r\n  }\r\n  let children = Array.from(element.children);\r\n  if (element instanceof HTMLSlotElement) {\r\n    children = element.assignedElements();\r\n  } else if (element.shadowRoot) {\r\n    children.push(...Array.from(element.shadowRoot.children));\r\n  }\r\n  for (const child of children) {\r\n    yield* getFocusableDescendants(child);\r\n  }\r\n}\r\n\r\nexport function getFirstFocusableDescendant(\r\n  element: Element\r\n): HTMLElement | null {\r\n  return getFocusableDescendants(element).next().value ?? null;\r\n}\r\n"],"version":3}