{"file":"item-decorators-79369ad9.js","mappings":"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","names":[],"sources":["src/components/common/item-list/item-decorators.tsx"],"sourcesContent":["import {ComponentInterface, getElement} from '@stencil/core';\nimport {buildCustomEvent} from '../../../utils/event-utils';\nimport {closest} from '../../../utils/utils';\nimport {AnyItem} from '../interface/item';\nimport {\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n} from '../layout/display-options';\nimport {ItemTemplateProvider} from './item-template-provider';\n\nexport class MissingParentError extends Error {\n  constructor(elementName: string, parentName: string) {\n    super(\n      `The \"${elementName}\" element must be the child of an \"${parentName}\" element.`\n    );\n  }\n}\n\nexport function ItemContext(\n  opts: {parentName: string; folded: boolean} = {\n    parentName: 'atomic-result',\n    folded: false,\n  }\n) {\n  return (component: ComponentInterface, itemVariable: string) => {\n    const {connectedCallback, componentWillRender, render} = component;\n    component.connectedCallback = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        itemContextEventName,\n        (item: Record<string, unknown>) => {\n          this[itemVariable] = extractFolded(item, opts.folded);\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        this.error = new MissingParentError(\n          element.nodeName.toLowerCase(),\n          opts.parentName\n        );\n        return;\n      }\n      return connectedCallback && connectedCallback.call(this);\n    };\n\n    component.componentWillRender = function () {\n      if (this.error) {\n        return;\n      }\n\n      return componentWillRender && componentWillRender.call(this);\n    };\n\n    component.render = function () {\n      if (this.error) {\n        const element = getElement(this);\n        element.remove();\n        console.error(\n          'Result component is in error and has been removed from the DOM',\n          this.error,\n          this,\n          element\n        );\n        return;\n      }\n      return render && render.call(this);\n    };\n  };\n}\n\nexport function InteractiveItemContext() {\n  return (component: ComponentInterface, interactiveItemVariable: string) => {\n    const {connectedCallback} = component;\n    component.connectedCallback = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        interactiveItemContextEventName,\n        (item: AnyItem) => {\n          this[interactiveItemVariable] = item;\n        }\n      );\n      element.dispatchEvent(event);\n      return connectedCallback && connectedCallback.call(this);\n    };\n  };\n}\n\ntype ItemContextEventHandler<T> = (item: T) => void;\nexport type ItemContextEvent<T> = CustomEvent<ItemContextEventHandler<T>>;\nconst itemContextEventName = 'atomic/resolveResult';\nexport type InteractiveItemContextEvent = CustomEvent<\n  (interactiveItem: unknown) => void\n>;\nconst interactiveItemContextEventName = 'atomic/resolveInteractiveResult';\n\nexport function itemContext<T>(element: Element, parentName: string) {\n  return new Promise<T>((resolve, reject) => {\n    const event = buildCustomEvent<ItemContextEventHandler<T>>(\n      itemContextEventName,\n      (item: T) => {\n        return resolve(item);\n      }\n    );\n    element.dispatchEvent(event);\n\n    if (!closest(element, parentName)) {\n      reject(\n        new MissingParentError(element.nodeName.toLowerCase(), parentName)\n      );\n    }\n  });\n}\n\nfunction extractFolded(item: Record<string, unknown>, returnFolded: boolean) {\n  if (returnFolded) {\n    if ('children' in item) {\n      return item;\n    } else {\n      return {children: [], result: item};\n    }\n  }\n\n  if ('children' in item && 'result' in item) {\n    return item.result;\n  }\n  return item;\n}\n\ntype ChildTemplatesContextEventHandler = (\n  itemTemplateProvider?: ItemTemplateProvider\n) => void;\nexport type ChildTemplatesContextEvent =\n  CustomEvent<ChildTemplatesContextEventHandler>;\nconst childTemplatesContextEventName = 'atomic/resolveChildTemplates';\n\ninterface AtomicItemChildren {\n  itemTemplateProvider?: ItemTemplateProvider;\n}\n\nexport function ChildTemplatesContext() {\n  return (component: ComponentInterface, itemTemplateProviderProp: string) => {\n    const {componentWillRender} = component;\n    component.componentWillRender = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        childTemplatesContextEventName,\n        (itemTemplateProvider?: ItemTemplateProvider) => {\n          const component = this as AtomicItemChildren;\n          if (component.itemTemplateProvider) {\n            return;\n          }\n\n          this[itemTemplateProviderProp] = itemTemplateProvider;\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        this[itemTemplateProviderProp] = null;\n        return;\n      }\n      return componentWillRender && componentWillRender.call(this);\n    };\n  };\n}\n\nexport type DisplayConfig = {\n  density: ItemDisplayDensity;\n  imageSize: ItemDisplayImageSize;\n};\n\ntype ItemDisplayConfigContextEventHandler = (config: DisplayConfig) => void;\nexport type ItemDisplayConfigContextEvent =\n  CustomEvent<ItemDisplayConfigContextEventHandler>;\nconst itemDisplayConfigContextEventName = 'atomic/resolveResultDisplayConfig';\n\nexport function ItemDisplayConfigContext() {\n  return (component: ComponentInterface, itemVariable: string) => {\n    const {componentWillRender} = component;\n    component.componentWillRender = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        itemDisplayConfigContextEventName,\n        (config: DisplayConfig) => {\n          this[itemVariable] = config;\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        return;\n      }\n      return componentWillRender && componentWillRender.call(this);\n    };\n  };\n}\n"],"version":3}