{"version":3,"names":["FacetDateInput","connectedCallback","this","start","filterState","range","parseDate","toDate","undefined","end","apply","startRef","validity","valid","endRef","applyInput","emit","filter","setRange","buildDateRange","setHours","formattedDateValue","date","format","render","label","bindings","i18n","t","startLabel","endLabel","startAria","endAria","applyAria","inputClasses","labelClasses","placeholder","pattern","h","key","class","onSubmit","e","preventDefault","part","htmlFor","facetId","id","type","ref","required","min","max","value","_a","onInput","target","_b","Button","style","ariaLabel","text"],"sources":["src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["import {buildDateRange} from '@coveo/headless';\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\nimport {parseDate} from '../../../../utils/date-utils';\nimport {Button} from '../../button';\nimport {AnyBindings} from '../../interface/bindings';\nimport {DateFilter, DateFilterState} from '../../types';\n\n/**\n * Internal component made to be integrated in a TimeframeFacet.\n * @internal\n */\n@Component({\n  tag: 'atomic-facet-date-input',\n  shadow: false,\n})\nexport class FacetDateInput {\n  @State() private start?: Date;\n  @State() private end?: Date;\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @Prop() public bindings!: AnyBindings;\n  @Prop() public filter!: DateFilter;\n  @Prop() public filterState!: DateFilterState;\n  @Prop() public label!: string;\n  @Prop() public min?: string;\n  @Prop() public max?: string;\n\n  @Event({\n    eventName: 'atomic/dateInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    this.start = this.filterState.range\n      ? parseDate(this.filterState.range.start).toDate()\n      : undefined;\n    this.end = this.filterState.range\n      ? parseDate(this.filterState.range.end).toDate()\n      : undefined;\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit();\n    this.filter.setRange(\n      buildDateRange({\n        start: this.start!,\n        end: this.end!.setHours(23, 59, 59, 999),\n      })\n    );\n  }\n\n  private formattedDateValue(date?: string | Date) {\n    if (!date) {\n      return '';\n    }\n    return parseDate(date).format('YYYY-MM-DD');\n  }\n\n  render() {\n    const label = this.bindings.i18n.t(this.label);\n    const startLabel = this.bindings.i18n.t('start');\n    const endLabel = this.bindings.i18n.t('end');\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\n\n    const inputClasses = 'input-primary p-2.5';\n    const labelClasses = 'text-neutral-dark self-center';\n\n    const placeholder = 'yyyy-mm-dd';\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\n    const pattern =\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\n\n    return (\n      <form\n        class=\"grid gap-2 grid-cols-min-1fr mt-4 px-2\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.filterState.facetId}_start`}\n        >\n          {startLabel}:\n        </label>\n        <input\n          id={`${this.filterState.facetId}_start`}\n          part=\"input-start\"\n          type=\"date\"\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={startAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          // API/Index minimum supported date\n          min={this.min || this.formattedDateValue('1401-01-01')}\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\n          value={this.formattedDateValue(this.filterState.range?.start)}\n          onInput={(e) =>\n            (this.start = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.filterState.facetId}_end`}\n        >\n          {endLabel}:\n        </label>\n        <input\n          id={`${this.filterState.facetId}_end`}\n          part=\"input-end\"\n          type=\"date\"\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={endAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          min={this.min || this.formattedDateValue(this.start)}\n          max={this.max}\n          value={this.formattedDateValue(this.filterState.range?.end)}\n          onInput={(e) =>\n            (this.end = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"p-2.5 col-span-2 truncate\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n"],"mappings":"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"}