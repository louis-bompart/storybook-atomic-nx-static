{"version":3,"names":["ResultChildrenCommon","constructor","props","this","foldedResult","collection","getResult","numberOfChildren","children","length","hasChildren","getFoldedResultListState","results","find","r","result","uniqueId","renderPlaceholder","h","ResultsPlaceholder","numberOfPlaceholders","density","getDisplayConfig","display","imageSize","getImageSize","renderNoResult","part","class","getBindings","i18n","t","getNoResultText","renderCollapseButton","moreResultsAvailable","Button","style","onClick","getShowInitialChildren","getFoldedResultList","logShowMoreFoldedResults","logShowLessFoldedResults","toggleShowInitialChildren","renderChildrenWrapper","content","name","renderChildren","map","child","i","renderChild","renderCollection","isLoadingMoreResults","_a","trim","childrenToRender","getInitialChildren","Host","renderFoldedResult","componentWillRender","setInitialChildren","render","getInheritTemplates","getResultTemplateRegistered","getTemplateHasError"],"sources":["src/components/common/result-children/result-children-common.tsx"],"sourcesContent":["import {\n  FoldedResult,\n  FoldedResultList,\n  FoldedResultListState,\n} from '@coveo/headless';\nimport {Host, VNode, h} from '@stencil/core';\nimport {ResultsPlaceholder} from '../atomic-result-placeholder/placeholders';\nimport {Button} from '../button';\nimport {AnyBindings} from '../interface/bindings';\nimport {DisplayConfig} from '../item-list/item-decorators';\nimport {ItemDisplayImageSize} from '../layout/display-options';\n\ninterface ResultChildrenProps {\n  getHost: () => HTMLElement;\n  getBindings: () => AnyBindings;\n  getFoldedResultListState: () => FoldedResultListState;\n  getResult: () => FoldedResult;\n  getShowInitialChildren: () => boolean;\n  getFoldedResultList: () => FoldedResultList;\n  getInitialChildren: () => FoldedResult[];\n  getInheritTemplates: () => boolean;\n  getResultTemplateRegistered: () => boolean;\n  getTemplateHasError: () => boolean;\n  getNoResultText: () => string;\n  getDisplayConfig: () => DisplayConfig;\n  getImageSize: () => ItemDisplayImageSize | undefined;\n  renderChild: (child: FoldedResult, isLast: boolean) => VNode;\n  setInitialChildren: (initialChildren: FoldedResult[]) => void;\n  toggleShowInitialChildren: () => void;\n}\n\nexport class ResultChildrenCommon {\n  constructor(private props: ResultChildrenProps) {}\n\n  private get foldedResult(): FoldedResult {\n    return this.collection || this.props.getResult();\n  }\n\n  private get numberOfChildren() {\n    return this.foldedResult.children.length;\n  }\n\n  private get hasChildren() {\n    return !!this.numberOfChildren;\n  }\n\n  private get collection() {\n    return this.props.getFoldedResultListState().results.find((r) => {\n      return r.result.uniqueId === this.props.getResult().result.uniqueId;\n    });\n  }\n\n  private renderPlaceholder() {\n    return (\n      <ResultsPlaceholder\n        numberOfPlaceholders={this.numberOfChildren || 2}\n        density={this.props.getDisplayConfig().density}\n        display={'list'}\n        imageSize={\n          this.props.getImageSize() || this.props.getDisplayConfig().imageSize\n        }\n      />\n    );\n  }\n\n  private renderNoResult() {\n    return (\n      <p part=\"no-result-root\" class=\"no-result-root my-3\">\n        {this.props.getBindings().i18n.t(this.props.getNoResultText())}\n      </p>\n    );\n  }\n\n  private renderCollapseButton() {\n    const collection = this.collection!;\n    if (!!collection.children.length && !collection.moreResultsAvailable) {\n      return (\n        <Button\n          part=\"show-hide-button\"\n          class=\"show-hide-button\"\n          style=\"text-primary\"\n          onClick={() => {\n            if (this.props.getShowInitialChildren()) {\n              this.props\n                .getFoldedResultList()\n                .logShowMoreFoldedResults(this.foldedResult.result);\n            } else {\n              this.props.getFoldedResultList().logShowLessFoldedResults();\n            }\n            this.props.toggleShowInitialChildren();\n          }}\n        >\n          {this.props\n            .getBindings()\n            .i18n.t(\n              this.props.getShowInitialChildren()\n                ? 'load-all-results'\n                : 'collapse-results'\n            )}\n        </Button>\n      );\n    }\n    return;\n  }\n\n  private renderChildrenWrapper(content: VNode | VNode[]) {\n    return (\n      <div part=\"children-root\">\n        {this.hasChildren && <slot name=\"before-children\"></slot>}\n        {content}\n        {this.hasChildren && <slot name=\"after-children\"></slot>}\n      </div>\n    );\n  }\n\n  private renderChildren(children: FoldedResult[]): VNode | VNode[] {\n    return this.renderChildrenWrapper(\n      children.map((child, i) =>\n        this.props.renderChild(child, i === children.length - 1)\n      )\n    );\n  }\n\n  private renderCollection() {\n    const collection = this.collection!;\n\n    if (collection.isLoadingMoreResults) {\n      return this.renderChildrenWrapper(this.renderPlaceholder());\n    }\n\n    if (!collection.moreResultsAvailable && !this.hasChildren) {\n      return this.props.getNoResultText()?.trim().length\n        ? this.renderNoResult()\n        : null;\n    }\n\n    if (!this.hasChildren) {\n      return;\n    }\n\n    const childrenToRender = this.props.getShowInitialChildren()\n      ? this.props.getInitialChildren()\n      : collection.children;\n\n    return (\n      <Host>\n        {this.renderCollapseButton()}\n        {this.renderChildren(childrenToRender)}\n      </Host>\n    );\n  }\n\n  private renderFoldedResult() {\n    if (!this.hasChildren) {\n      return;\n    }\n\n    return this.renderChildren(this.foldedResult.children);\n  }\n\n  public componentWillRender() {\n    const collection = this.collection;\n    if (this.props.getInitialChildren() || !collection) {\n      return;\n    }\n\n    this.props.setInitialChildren(collection.children);\n  }\n\n  public render() {\n    if (\n      !this.props.getInheritTemplates() &&\n      !this.props.getResultTemplateRegistered()\n    ) {\n      return;\n    }\n\n    if (!this.props.getInheritTemplates() && this.props.getTemplateHasError()) {\n      return <slot></slot>;\n    }\n\n    return this.collection\n      ? this.renderCollection()\n      : this.renderFoldedResult();\n  }\n}\n"],"mappings":"yHA+BaA,EACX,WAAAC,CAAoBC,GAAAC,KAAAD,O,CAEpB,gBAAYE,GACV,OAAOD,KAAKE,YAAcF,KAAKD,MAAMI,W,CAGvC,oBAAYC,GACV,OAAOJ,KAAKC,aAAaI,SAASC,M,CAGpC,eAAYC,GACV,QAASP,KAAKI,gB,CAGhB,cAAYF,GACV,OAAOF,KAAKD,MAAMS,2BAA2BC,QAAQC,MAAMC,GAClDA,EAAEC,OAAOC,WAAab,KAAKD,MAAMI,YAAYS,OAAOC,U,CAIvD,iBAAAC,GACN,OACEC,EAACC,EAAkB,CACjBC,qBAAsBjB,KAAKI,kBAAoB,EAC/Cc,QAASlB,KAAKD,MAAMoB,mBAAmBD,QACvCE,QAAS,OACTC,UACErB,KAAKD,MAAMuB,gBAAkBtB,KAAKD,MAAMoB,mBAAmBE,W,CAM3D,cAAAE,GACN,OACER,EAAA,KAAGS,KAAK,iBAAiBC,MAAM,uBAC5BzB,KAAKD,MAAM2B,cAAcC,KAAKC,EAAE5B,KAAKD,MAAM8B,mB,CAK1C,oBAAAC,GACN,MAAM5B,EAAaF,KAAKE,WACxB,KAAMA,EAAWG,SAASC,SAAWJ,EAAW6B,qBAAsB,CACpE,OACEhB,EAACiB,EAAM,CACLR,KAAK,mBACLC,MAAM,mBACNQ,MAAM,eACNC,QAAS,KACP,GAAIlC,KAAKD,MAAMoC,yBAA0B,CACvCnC,KAAKD,MACFqC,sBACAC,yBAAyBrC,KAAKC,aAAaW,O,KACzC,CACLZ,KAAKD,MAAMqC,sBAAsBE,0B,CAEnCtC,KAAKD,MAAMwC,2BAA2B,GAGvCvC,KAAKD,MACH2B,cACAC,KAAKC,EACJ5B,KAAKD,MAAMoC,yBACP,mBACA,oB,CAKd,M,CAGM,qBAAAK,CAAsBC,GAC5B,OACE1B,EAAA,OAAKS,KAAK,iBACPxB,KAAKO,aAAeQ,EAAA,QAAM2B,KAAK,oBAC/BD,EACAzC,KAAKO,aAAeQ,EAAA,QAAM2B,KAAK,mB,CAK9B,cAAAC,CAAetC,GACrB,OAAOL,KAAKwC,sBACVnC,EAASuC,KAAI,CAACC,EAAOC,IACnB9C,KAAKD,MAAMgD,YAAYF,EAAOC,IAAMzC,EAASC,OAAS,K,CAKpD,gBAAA0C,G,MACN,MAAM9C,EAAaF,KAAKE,WAExB,GAAIA,EAAW+C,qBAAsB,CACnC,OAAOjD,KAAKwC,sBAAsBxC,KAAKc,oB,CAGzC,IAAKZ,EAAW6B,uBAAyB/B,KAAKO,YAAa,CACzD,QAAO2C,EAAAlD,KAAKD,MAAM8B,qBAAiB,MAAAqB,SAAA,SAAAA,EAAEC,OAAO7C,QACxCN,KAAKuB,iBACL,I,CAGN,IAAKvB,KAAKO,YAAa,CACrB,M,CAGF,MAAM6C,EAAmBpD,KAAKD,MAAMoC,yBAChCnC,KAAKD,MAAMsD,qBACXnD,EAAWG,SAEf,OACEU,EAACuC,EAAI,KACFtD,KAAK8B,uBACL9B,KAAK2C,eAAeS,G,CAKnB,kBAAAG,GACN,IAAKvD,KAAKO,YAAa,CACrB,M,CAGF,OAAOP,KAAK2C,eAAe3C,KAAKC,aAAaI,S,CAGxC,mBAAAmD,GACL,MAAMtD,EAAaF,KAAKE,WACxB,GAAIF,KAAKD,MAAMsD,uBAAyBnD,EAAY,CAClD,M,CAGFF,KAAKD,MAAM0D,mBAAmBvD,EAAWG,S,CAGpC,MAAAqD,GACL,IACG1D,KAAKD,MAAM4D,wBACX3D,KAAKD,MAAM6D,8BACZ,CACA,M,CAGF,IAAK5D,KAAKD,MAAM4D,uBAAyB3D,KAAKD,MAAM8D,sBAAuB,CACzE,OAAO9C,EAAA,Y,CAGT,OAAOf,KAAKE,WACRF,KAAKgD,mBACLhD,KAAKuD,oB"}