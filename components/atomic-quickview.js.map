{"file":"atomic-quickview.js","mappings":"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","names":["AtomicQuickview","buildQuickview"],"sources":["src/components/search/result-template-components/atomic-quickview/atomic-quickview.pcss?tag=atomic-quickview&encapsulation=shadow","src/components/search/result-template-components/atomic-quickview/atomic-quickview.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\r\n","import {Schema, StringValue} from '@coveo/bueno';\r\nimport {\r\n  Result,\r\n  buildQuickview,\r\n  Quickview,\r\n  QuickviewState,\r\n} from '@coveo/headless';\r\nimport {Component, h, Listen, Prop, State} from '@stencil/core';\r\nimport QuickviewIcon from '../../../../images/quickview.svg';\r\nimport {\r\n  AriaLiveRegion,\r\n  FocusTargetController,\r\n} from '../../../../utils/accessibility-utils';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {Button} from '../../../common/button';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {ResultContext} from '../result-template-decorators';\r\n\r\n/**\r\n * The `atomic-quickview` component renders a button which the end user can click to open a modal box containing a preview\r\n * about a result.\r\n *\r\n * The `atomic-quickview` is not meant to replace the `atomic-result-link` to access an item in a result template; it has certain limitations (e.g., custom styles and embedded\r\n * images/links may not work as expected in an `atomic-quickview`).\r\n *\r\n * @part button - The button that opens the quickview modal on click.\r\n * @part icon - The icon for the quickview button.\r\n */\r\n@Component({\r\n  tag: 'atomic-quickview',\r\n  styleUrl: 'atomic-quickview.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicQuickview implements InitializableComponent {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ResultContext() private result!: Result;\r\n  private buttonFocusTarget?: FocusTargetController;\r\n\r\n  @State() public error!: Error;\r\n\r\n  public quickview!: Quickview;\r\n\r\n  @BindStateToController('quickview')\r\n  @State()\r\n  public quickviewState!: QuickviewState;\r\n\r\n  /**\r\n   * The `sandbox` attribute to apply to the quickview iframe.\r\n   *\r\n   * The quickview is loaded inside an iframe with a [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox) attribute for security reasons.\r\n   *\r\n   * This attribute exists primarily to protect against potential XSS attacks that could originate from the document being displayed.\r\n   *\r\n   * By default, the sandbox attributes are: `allow-popups allow-top-navigation allow-same-origin`.\r\n   *\r\n   * `allow-same-origin` is not optional, and must always be included in the list of allowed capabilities for the component to function properly.\r\n   */\r\n  @Prop() public sandbox =\r\n    'allow-popups allow-top-navigation allow-same-origin';\r\n\r\n  @AriaLiveRegion('quickview')\r\n  protected quickviewAriaMessage!: string;\r\n\r\n  @Listen('atomic/quickview/next', {target: 'body'})\r\n  public onNextQuickview(evt: Event) {\r\n    evt.stopImmediatePropagation();\r\n    this.quickview.next();\r\n  }\r\n\r\n  @Listen('atomic/quickview/previous', {target: 'body'})\r\n  public onPreviousQuickview(evt: Event) {\r\n    evt.stopImmediatePropagation();\r\n    this.quickview.previous();\r\n  }\r\n\r\n  private quickviewModalRef?: HTMLAtomicQuickviewModalElement;\r\n\r\n  public get focusTarget() {\r\n    if (!this.buttonFocusTarget) {\r\n      this.buttonFocusTarget = new FocusTargetController(this);\r\n    }\r\n    return this.buttonFocusTarget;\r\n  }\r\n\r\n  public initialize() {\r\n    this.quickview = buildQuickview(this.bindings.engine, {\r\n      options: {result: this.result},\r\n    });\r\n    new Schema({\r\n      sandbox: new StringValue({\r\n        required: true,\r\n        regex: /allow-same-origin/,\r\n      }),\r\n    }).validate({sandbox: this.sandbox});\r\n  }\r\n\r\n  private addQuickviewModalIfNeeded() {\r\n    if (this.quickviewModalRef) {\r\n      return;\r\n    }\r\n\r\n    const quickviewModal = this.bindings.interfaceElement.querySelector(\r\n      'atomic-quickview-modal'\r\n    );\r\n    if (quickviewModal) {\r\n      this.quickviewModalRef = quickviewModal;\r\n      return;\r\n    }\r\n    this.quickviewModalRef = document.createElement('atomic-quickview-modal');\r\n    this.quickviewModalRef.setAttribute('sandbox', this.sandbox);\r\n    this.bindings.interfaceElement.appendChild(this.quickviewModalRef);\r\n  }\r\n\r\n  private updateModalContent() {\r\n    if (this.quickviewModalRef && this.quickview.state.content) {\r\n      this.quickviewModalRef.content = this.quickview.state.content;\r\n      this.quickviewModalRef.result = this.result;\r\n      this.quickviewModalRef.total = this.quickviewState.totalResults;\r\n      this.quickviewModalRef.current = this.quickviewState.currentResult;\r\n      this.quickviewModalRef.modalCloseCallback = () =>\r\n        this.focusTarget.focus();\r\n\r\n      this.quickviewAriaMessage = this.quickviewState.isLoading\r\n        ? this.bindings.i18n.t('quickview-loading')\r\n        : this.bindings.i18n.t('quickview-loaded', {\r\n            first: this.quickviewState.currentResult,\r\n            last: this.quickviewState.totalResults,\r\n            title: this.result.title,\r\n          });\r\n    }\r\n  }\r\n\r\n  private onClick(event?: MouseEvent) {\r\n    event?.stopPropagation();\r\n    this.quickview.fetchResultContent();\r\n  }\r\n\r\n  public render() {\r\n    this.addQuickviewModalIfNeeded();\r\n    this.updateModalContent();\r\n    if (this.quickviewState.resultHasPreview) {\r\n      return (\r\n        <Button\r\n          part=\"button\"\r\n          title={this.bindings.i18n.t('quickview')}\r\n          style=\"outline-primary\"\r\n          class=\"p-2\"\r\n          onClick={(event) => this.onClick(event)}\r\n          ref={this.focusTarget.setTarget}\r\n        >\r\n          <atomic-icon\r\n            part=\"icon\"\r\n            class=\"w-5 flex justify-center\"\r\n            icon={QuickviewIcon}\r\n          ></atomic-icon>\r\n        </Button>\r\n      );\r\n    }\r\n  }\r\n}\r\n"],"version":3}