{"file":"atomic-commerce-facets.js","mappings":";;;;;;;;AAAA,MAAM,uBAAuB,GAAG,u+tCAAu+tC,CAAC;AACxguC,mCAAe,uBAAuB;;;;;;;;;;;;MC6BzBA,sBAAoB;;;;;;;;;;;;QAYD,wBAAmB,GAAG,CAAC,CAAC;mCAAF,CAAC;;;;IAQ9C,UAAU;QACf,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,MAAM,UAAU,GACd,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,KAAK,iBAAiB;cACrDC,EAAmB;cACnBC,EAAW,CAAC;QAClB,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC;KACzE;IAEO,aAAa;QACnB,IAAI,MAAM,CAAC;YACT,kBAAkB,EAAE,IAAI,WAAW,CAAC,EAAC,GAAG,EAAE,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAC,CAAC;SAC/D,CAAC,CAAC,QAAQ,CAAC;YACV,kBAAkB,EAAE,IAAI,CAAC,mBAAmB;SAC7C,CAAC,CAAC;KACJ;IAEO,mBAAmB,CAAC,KAAa;QACvC,IAAI,IAAI,CAAC,mBAAmB,KAAK,CAAC,CAAC,EAAE;YACnC,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC,mBAAmB;cAC3B,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,mBAAmB;cACpC,IAAI,CAAC;KACV;IAEM,MAAM;QACX,QACE,EAAC,IAAI,uDACF,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,KAAK;YAC3C,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;gBACnC,OAAO;aACR;YACD,MAAM,KAAK,GAAG,EAAC,WAAW,EAAE,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,EAAC,CAAC;YAE7D,QAAQ,KAAK,CAAC,KAAK,CAAC,IAAI;gBACtB,KAAK,SAAS;oBACZ,QACE,gCACM,KAAK,EACT,KAAK,EAAE,KAAqB,GACL,EACzB;gBACJ,KAAK,gBAAgB;oBACnB,QACE,wCACM,KAAK,EACT,KAAK,EAAE,KAAqB,GACG,EACjC;gBACJ,KAAK,WAAW;oBACd,QACE,0CACM,KAAK,EACT,KAAK,EAAE,KAAkB,GACQ,EACnC;gBACJ,KAAK,cAAc;oBACjB,QACE,yCACM,KAAK,EACT,KAAK,EAAE,KAAsB,GACG,EAClC;gBACJ,SAAS;oBACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAC9B,yBAAyB,KAAK,CAAC,KAAK,CAAC,IAAI,GAAG,CAC7C,CAAC;oBACF,OAAO;iBACR;aACF;SACF,CAAC,CACG,EACP;KACH;;;;;;;;AA7F4B;IAA5B,kBAAkB,EAAE;wDAA4B;AAe1C;IAFN,qBAAqB,CAAC,gBAAgB,CAAC;mEAEW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":["AtomicCommerceFacets","buildProductListing","buildSearch"],"sources":["src/components/commerce/facets/atomic-commerce-facets/atomic-commerce-facets.pcss?tag=atomic-commerce-facets&encapsulation=shadow","src/components/commerce/facets/atomic-commerce-facets/atomic-commerce-facets.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\r\n","import {NumberValue, Schema} from '@coveo/bueno';\r\nimport {\r\n  RegularFacet,\r\n  CategoryFacet,\r\n  DateFacet,\r\n  NumericFacet,\r\n  FacetGeneratorState,\r\n  buildProductListing,\r\n  buildSearch,\r\n  FacetGenerator,\r\n} from '@coveo/headless/commerce';\r\nimport {Component, h, Element, Host, State, Prop} from '@stencil/core';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\r\n\r\n/**\r\n * The `atomic-commerce-facets` component automatically renders commerce facets based on the Commerce API response.\r\n * Unlike regular facets, which require explicit definition and request in the query, the `atomic-commerce-facets` component dynamically generates facets.\r\n *\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-commerce-facets',\r\n  styleUrl: 'atomic-commerce-facets.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicCommerceFacets implements InitializableComponent<Bindings> {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  public facetGenerator!: FacetGenerator;\r\n  @Element() host!: HTMLElement;\r\n\r\n  /**\r\n   * The maximum number of facets to expand.\r\n   * Remaining facets are automatically collapsed.\r\n   *\r\n   * Using the value `0` collapses all facets.\r\n   * Using the value `-1` disables the feature and keeps all facets expanded.\r\n   */\r\n  @Prop({reflect: true}) public collapseFacetsAfter = 4;\r\n\r\n  @BindStateToController('facetGenerator')\r\n  @State()\r\n  public facetGeneratorState!: FacetGeneratorState[];\r\n\r\n  @State() public error!: Error;\r\n\r\n  public initialize() {\r\n    this.validateProps();\r\n    const controller =\r\n      this.bindings.interfaceElement.type === 'product-listing'\r\n        ? buildProductListing\r\n        : buildSearch;\r\n    this.facetGenerator = controller(this.bindings.engine).facetGenerator();\r\n  }\r\n\r\n  private validateProps() {\r\n    new Schema({\r\n      collapseFacetAfter: new NumberValue({min: -1, required: true}),\r\n    }).validate({\r\n      collapseFacetAfter: this.collapseFacetsAfter,\r\n    });\r\n  }\r\n\r\n  private shouldCollapseFacet(index: number): boolean {\r\n    if (this.collapseFacetsAfter === -1) {\r\n      return false;\r\n    }\r\n    return this.collapseFacetsAfter\r\n      ? index + 1 > this.collapseFacetsAfter\r\n      : true;\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <Host>\r\n        {this.facetGenerator.facets.map((facet, index) => {\r\n          if (facet.state.values.length === 0) {\r\n            return;\r\n          }\r\n          const props = {isCollapsed: this.shouldCollapseFacet(index)};\r\n\r\n          switch (facet.state.type) {\r\n            case 'regular':\r\n              return (\r\n                <atomic-commerce-facet\r\n                  {...props}\r\n                  facet={facet as RegularFacet}\r\n                ></atomic-commerce-facet>\r\n              );\r\n            case 'numericalRange':\r\n              return (\r\n                <atomic-commerce-numeric-facet\r\n                  {...props}\r\n                  facet={facet as NumericFacet}\r\n                ></atomic-commerce-numeric-facet>\r\n              );\r\n            case 'dateRange':\r\n              return (\r\n                <atomic-commerce-timeframe-facet\r\n                  {...props}\r\n                  facet={facet as DateFacet}\r\n                ></atomic-commerce-timeframe-facet>\r\n              );\r\n            case 'hierarchical':\r\n              return (\r\n                <atomic-commerce-category-facet\r\n                  {...props}\r\n                  facet={facet as CategoryFacet}\r\n                ></atomic-commerce-category-facet>\r\n              );\r\n            default: {\r\n              this.bindings.engine.logger.warn(\r\n                `Unexpected facet type ${facet.state.type}.`\r\n              );\r\n              return;\r\n            }\r\n          }\r\n        })}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}