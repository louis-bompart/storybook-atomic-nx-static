{"version":3,"names":["resultComponentClass","ItemListCommon","constructor","props","this","store","setLoadingFlag","loadingFlag","registerResultList","updateBreakpointsOnce","once","updateBreakpoints","host","getResultId","uniqueIdOnResult","searchResponseId","density","imageSize","setNewResultRef","element","resultIndex","firstResultEl","indexOfResultToFocus","children","length","_a","shadowRoot","undefined","elementToFocus","_b","getFirstFocusableDescendant","nextNewItemTarget","setTarget","focusOnNextNewResult","getCurrentNumberOfItems","focusOnNextTarget","focusOnFirstResultAfterNextSearch","defer","Promise","resolve","getIsLoading","unsub","engineSubscribe","async","focus"],"sources":["src/components/common/item-list/item-list-common.tsx"],"sourcesContent":["import {\n  FocusTargetController,\n  getFirstFocusableDescendant,\n} from '../../../utils/accessibility-utils';\nimport {updateBreakpoints} from '../../../utils/replace-breakpoint';\nimport {defer, once} from '../../../utils/utils';\nimport {AnyItem} from '../interface/item';\nimport {AtomicCommonStore, AtomicCommonStoreData} from '../interface/store';\nimport {\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n} from '../layout/display-options';\n\nexport const resultComponentClass = 'result-component';\n\nexport type ItemRenderingFunction<SpecificResult extends AnyItem = AnyItem> =\n  | ((result: SpecificResult, root: HTMLElement) => string)\n  | undefined;\n\nexport interface ItemListCommonProps {\n  store: AtomicCommonStore<AtomicCommonStoreData>;\n  loadingFlag: string;\n  host: HTMLElement;\n  nextNewItemTarget: FocusTargetController;\n  getCurrentNumberOfItems: () => number;\n  getIsLoading: () => boolean;\n  engineSubscribe: (cb: () => void) => () => void;\n}\n\nexport class ItemListCommon {\n  private indexOfResultToFocus?: number;\n  private firstResultEl?: HTMLElement;\n  private updateBreakpointsOnce: () => void;\n\n  constructor(private props: ItemListCommonProps) {\n    this.props.store.setLoadingFlag(this.props.loadingFlag);\n    this.props.store.registerResultList(this);\n    this.updateBreakpointsOnce = once(() => updateBreakpoints(this.props.host));\n  }\n\n  public updateBreakpoints() {\n    this.updateBreakpointsOnce();\n  }\n\n  public getResultId(\n    uniqueIdOnResult: string,\n    searchResponseId: string,\n    density: ItemDisplayDensity,\n    imageSize: ItemDisplayImageSize\n  ) {\n    return `${uniqueIdOnResult}${searchResponseId}${density}${imageSize}`;\n  }\n\n  public setNewResultRef(element: HTMLElement, resultIndex: number) {\n    if (resultIndex === 0) {\n      this.firstResultEl = element;\n    }\n    if (resultIndex !== this.indexOfResultToFocus) {\n      return;\n    }\n\n    if (!element.children.length && !element.shadowRoot?.children.length) {\n      return;\n    }\n\n    this.indexOfResultToFocus = undefined;\n    const elementToFocus = getFirstFocusableDescendant(element) ?? element;\n    this.props.nextNewItemTarget.setTarget(elementToFocus);\n  }\n\n  public focusOnNextNewResult() {\n    this.indexOfResultToFocus = this.props.getCurrentNumberOfItems();\n    this.props.nextNewItemTarget.focusOnNextTarget();\n  }\n\n  public async focusOnFirstResultAfterNextSearch() {\n    await defer();\n    return new Promise<void>((resolve) => {\n      if (this.props.getIsLoading()) {\n        this.firstResultEl = undefined;\n      }\n\n      const unsub = this.props.engineSubscribe(async () => {\n        await defer();\n        if (!this.props.getIsLoading() && this.firstResultEl) {\n          const elementToFocus =\n            getFirstFocusableDescendant(this.firstResultEl) ??\n            this.firstResultEl;\n          this.props.nextNewItemTarget.setTarget(elementToFocus);\n          this.props.nextNewItemTarget.focus();\n          this.firstResultEl = undefined;\n          unsub();\n          resolve();\n        }\n      });\n    });\n  }\n}\n"],"mappings":"yHAaaA,EAAuB,mB,MAgBvBC,EAKX,WAAAC,CAAoBC,GAAAC,KAAAD,QAClBC,KAAKD,MAAME,MAAMC,eAAeF,KAAKD,MAAMI,aAC3CH,KAAKD,MAAME,MAAMG,mBAAmBJ,MACpCA,KAAKK,sBAAwBC,GAAK,IAAMC,EAAkBP,KAAKD,MAAMS,O,CAGhE,iBAAAD,GACLP,KAAKK,uB,CAGA,WAAAI,CACLC,EACAC,EACAC,EACAC,GAEA,MAAO,GAAGH,IAAmBC,IAAmBC,IAAUC,G,CAGrD,eAAAC,CAAgBC,EAAsBC,G,QAC3C,GAAIA,IAAgB,EAAG,CACrBhB,KAAKiB,cAAgBF,C,CAEvB,GAAIC,IAAgBhB,KAAKkB,qBAAsB,CAC7C,M,CAGF,IAAKH,EAAQI,SAASC,WAAWC,EAAAN,EAAQO,cAAU,MAAAD,SAAA,SAAAA,EAAEF,SAASC,QAAQ,CACpE,M,CAGFpB,KAAKkB,qBAAuBK,UAC5B,MAAMC,GAAiBC,EAAAC,EAA4BX,MAAQ,MAAAU,SAAA,EAAAA,EAAIV,EAC/Df,KAAKD,MAAM4B,kBAAkBC,UAAUJ,E,CAGlC,oBAAAK,GACL7B,KAAKkB,qBAAuBlB,KAAKD,MAAM+B,0BACvC9B,KAAKD,MAAM4B,kBAAkBI,mB,CAGxB,uCAAMC,SACLC,IACN,OAAO,IAAIC,SAAeC,IACxB,GAAInC,KAAKD,MAAMqC,eAAgB,CAC7BpC,KAAKiB,cAAgBM,S,CAGvB,MAAMc,EAAQrC,KAAKD,MAAMuC,iBAAgBC,U,YACjCN,IACN,IAAKjC,KAAKD,MAAMqC,gBAAkBpC,KAAKiB,cAAe,CACpD,MAAMO,GACJH,EAAAK,EAA4B1B,KAAKiB,kBAAc,MAAAI,SAAA,EAAAA,EAC/CrB,KAAKiB,cACPjB,KAAKD,MAAM4B,kBAAkBC,UAAUJ,GACvCxB,KAAKD,MAAM4B,kBAAkBa,QAC7BxC,KAAKiB,cAAgBM,UACrBc,IACAF,G,IAEF,G"}