{"file":"timeframe-facet-common-e4e94562.js","mappings":"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","names":["randomID","shouldDisplayInputForFacetRange","initializePopover","getFieldValueCaption","parseDate","h","FacetValueLink","FacetValueLabelHighlight","FacetValuesGroup","FacetHeader","Hidden","FacetPlaceholder","FacetContainer"],"sources":["src/components/common/facets/timeframe-facet-common.tsx"],"sourcesContent":["import {h, VNode} from '@stencil/core';\r\nimport {FocusTargetController} from '../../../utils/accessibility-utils';\r\nimport {parseDate} from '../../../utils/date-utils';\r\nimport {getFieldValueCaption} from '../../../utils/field-utils';\r\nimport {randomID} from '../../../utils/utils';\r\nimport {initializePopover} from '../../search/facets/atomic-popover/popover-type';\r\nimport {Hidden} from '../hidden';\r\nimport {AnyBindings} from '../interface/bindings';\r\nimport {\r\n  DateFacet,\r\n  DateFacetValue,\r\n  DateFilter,\r\n  DateRangeOptions,\r\n  DateRangeRequest,\r\n  FacetConditionsManager,\r\n  RangeFacetSortCriterion,\r\n  RelativeDate,\r\n  RelativeDatePeriod,\r\n  RelativeDateUnit,\r\n  SearchStatusState,\r\n} from '../types';\r\nimport {shouldDisplayInputForFacetRange} from './facet-common';\r\nimport {FacetInfo} from './facet-common-store';\r\nimport {FacetContainer} from './facet-container/facet-container';\r\nimport {FacetHeader} from './facet-header/facet-header';\r\nimport {FacetPlaceholder} from './facet-placeholder/facet-placeholder';\r\nimport {FacetValueLabelHighlight} from './facet-value-label-highlight/facet-value-label-highlight';\r\nimport {FacetValueLink} from './facet-value-link/facet-value-link';\r\nimport {FacetValuesGroup} from './facet-values-group/facet-values-group';\r\n\r\nexport interface Timeframe {\r\n  period: RelativeDatePeriod;\r\n  unit?: RelativeDateUnit;\r\n  amount?: number;\r\n  label?: string;\r\n}\r\n\r\ninterface TimeframeFacetCommonOptions {\r\n  facetId?: string;\r\n  host: HTMLElement;\r\n  bindings: AnyBindings;\r\n  label: string;\r\n  field: string;\r\n  headingLevel: number;\r\n  dependsOn: Record<string, string>;\r\n  withDatePicker: boolean;\r\n  setFacetId(id: string): string;\r\n  getSearchStatusState(): SearchStatusState;\r\n  buildDependenciesManager(): FacetConditionsManager;\r\n  deserializeRelativeDate(date: string): RelativeDate;\r\n  buildDateRange(config: DateRangeOptions): DateRangeRequest;\r\n  initializeFacetForDatePicker(): DateFacet;\r\n  initializeFacetForDateRange(values: DateRangeRequest[]): DateFacet;\r\n  initializeFilter(): DateFilter;\r\n  min?: string;\r\n  max?: string;\r\n  sortCriteria: RangeFacetSortCriterion;\r\n}\r\n\r\ninterface TimeframeFacetCommonRenderProps {\r\n  hasError: boolean;\r\n  firstSearchExecuted: boolean;\r\n  isCollapsed: boolean;\r\n  headerFocus: FocusTargetController;\r\n  onToggleCollapse: () => boolean;\r\n}\r\n\r\nexport class TimeframeFacetCommon {\r\n  private facetId?: string;\r\n  private facetForDatePicker?: DateFacet;\r\n  private facetForDateRange?: DateFacet;\r\n  private filter?: DateFilter;\r\n  private manualTimeframes: Timeframe[] = [];\r\n  private dependenciesManager?: FacetConditionsManager;\r\n\r\n  constructor(private props: TimeframeFacetCommonOptions) {\r\n    this.facetId = this.determineFacetId;\r\n    this.props.setFacetId(this.facetId);\r\n\r\n    this.manualTimeframes = this.getManualTimeframes();\r\n\r\n    // Initialize two facets: One that is actually used to display values for end users, which only exists\r\n    // if we need to display something to the end user (ie: timeframes > 0)\r\n\r\n    // A second facet is initialized only to verify the results count. It is never used to display results to end user.\r\n    // It serves as a way to determine if the input should be rendered or not, independent of the ranges configured in the component\r\n    if (this.manualTimeframes.length > 0) {\r\n      this.facetForDateRange = this.props.initializeFacetForDateRange(\r\n        this.currentValues\r\n      );\r\n    }\r\n\r\n    if (this.props.withDatePicker) {\r\n      this.facetForDatePicker = this.props.initializeFacetForDatePicker();\r\n      this.filter = this.props.initializeFilter();\r\n    }\r\n\r\n    if (this.facetForDateRange || this.filter) {\r\n      this.dependenciesManager = this.props.buildDependenciesManager();\r\n    }\r\n    this.registerFacetToStore();\r\n  }\r\n\r\n  private get determineFacetId() {\r\n    if (this.props.facetId) {\r\n      return this.props.facetId;\r\n    }\r\n\r\n    if (this.props.bindings.store.get('dateFacets')[this.props.field]) {\r\n      return randomID(`${this.props.field}_`);\r\n    }\r\n\r\n    return this.props.field;\r\n  }\r\n\r\n  private get enabled() {\r\n    return (\r\n      this.facetForDateRange?.state.enabled ??\r\n      this.filter?.state.enabled ??\r\n      true\r\n    );\r\n  }\r\n\r\n  private get valuesToRender() {\r\n    return (\r\n      this.facetForDateRange?.state.values.filter(\r\n        (value) => value.numberOfResults || value.state !== 'idle'\r\n      ) || []\r\n    );\r\n  }\r\n\r\n  private get shouldRenderValues() {\r\n    return !this.hasInputRange && !!this.valuesToRender.length;\r\n  }\r\n\r\n  private get shouldRenderFacet() {\r\n    return this.shouldRenderInput || this.shouldRenderValues;\r\n  }\r\n\r\n  private get shouldRenderInput() {\r\n    return shouldDisplayInputForFacetRange({\r\n      hasInput: this.props.withDatePicker,\r\n      hasInputRange: this.hasInputRange,\r\n      searchStatusState: this.props.getSearchStatusState(),\r\n      facetValues: this.facetForDatePicker?.state?.values || [],\r\n    });\r\n  }\r\n\r\n  private get hasValues() {\r\n    if (this.facetForDatePicker?.state.values.length) {\r\n      return true;\r\n    }\r\n\r\n    return !!this.valuesToRender.length;\r\n  }\r\n\r\n  private get numberOfSelectedValues() {\r\n    if (this.filter?.state?.range) {\r\n      return 1;\r\n    }\r\n\r\n    return (\r\n      this.facetForDateRange?.state.values.filter(\r\n        ({state}) => state === 'selected'\r\n      ).length || 0\r\n    );\r\n  }\r\n\r\n  private get hasInputRange() {\r\n    return !!this.filter?.state.range;\r\n  }\r\n\r\n  public get currentValues(): DateRangeRequest[] {\r\n    return this.manualTimeframes.map(({period, amount, unit}) =>\r\n      period === 'past'\r\n        ? this.props.buildDateRange({\r\n            start: {period, unit, amount},\r\n            end: {period: 'now'},\r\n          })\r\n        : this.props.buildDateRange({\r\n            start: {period: 'now'},\r\n            end: {period, unit, amount},\r\n          })\r\n    );\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    if (this.props.host.isConnected) {\r\n      return;\r\n    }\r\n    this.dependenciesManager?.stopWatching();\r\n  }\r\n\r\n  private get isHidden() {\r\n    return !this.shouldRenderFacet || !this.enabled;\r\n  }\r\n\r\n  private registerFacetToStore() {\r\n    const facetInfo: FacetInfo = {\r\n      label: () => this.props.bindings.i18n.t(this.props.label),\r\n      facetId: this.facetId!,\r\n      element: this.props.host,\r\n      isHidden: () => this.isHidden,\r\n    };\r\n\r\n    this.props.bindings.store.registerFacet('dateFacets', {\r\n      ...facetInfo,\r\n      format: (value) => this.formatFacetValue(value),\r\n    });\r\n\r\n    initializePopover(this.props.host, {\r\n      ...facetInfo,\r\n      hasValues: () => this.hasValues,\r\n      numberOfActiveValues: () => this.numberOfSelectedValues,\r\n    });\r\n\r\n    if (this.filter) {\r\n      this.props.bindings.store.state.dateFacets[this.filter.state.facetId] =\r\n        this.props.bindings.store.state.dateFacets[this.facetId!];\r\n    }\r\n  }\r\n\r\n  private getManualTimeframes(): Timeframe[] {\r\n    return Array.from(this.props.host.querySelectorAll('atomic-timeframe')).map(\r\n      ({label, amount, unit, period}) => ({\r\n        label,\r\n        amount,\r\n        unit,\r\n        period,\r\n      })\r\n    );\r\n  }\r\n\r\n  private formatFacetValue(facetValue: DateFacetValue) {\r\n    try {\r\n      const startDate = this.props.deserializeRelativeDate(facetValue.start);\r\n      const relativeDate =\r\n        startDate.period === 'past'\r\n          ? startDate\r\n          : this.props.deserializeRelativeDate(facetValue.end);\r\n      const timeframe = this.getManualTimeframes().find(\r\n        (timeframe) =>\r\n          timeframe.period === relativeDate.period &&\r\n          timeframe.unit === relativeDate.unit &&\r\n          timeframe.amount === relativeDate.amount\r\n      );\r\n\r\n      if (timeframe?.label) {\r\n        return getFieldValueCaption(\r\n          this.props.field,\r\n          timeframe.label,\r\n          this.props.bindings.i18n\r\n        );\r\n      }\r\n      return this.props.bindings.i18n.t(\r\n        `${relativeDate.period}-${relativeDate.unit}`,\r\n        {\r\n          count: relativeDate.amount,\r\n        }\r\n      );\r\n    } catch (error) {\r\n      return this.props.bindings.i18n.t('to', {\r\n        start: parseDate(facetValue.start).format('YYYY-MM-DD'),\r\n        end: parseDate(facetValue.end).format('YYYY-MM-DD'),\r\n      });\r\n    }\r\n  }\r\n  private renderValues() {\r\n    return this.renderValuesContainer(\r\n      this.valuesToRender.map((value) => this.renderValue(value))\r\n    );\r\n  }\r\n  private renderValue(facetValue: DateFacetValue) {\r\n    const displayValue = this.formatFacetValue(facetValue);\r\n    const isSelected = facetValue.state === 'selected';\r\n    const isExcluded = facetValue.state === 'excluded';\r\n    return (\r\n      <FacetValueLink\r\n        displayValue={displayValue}\r\n        isSelected={isSelected}\r\n        numberOfResults={facetValue.numberOfResults}\r\n        i18n={this.props.bindings.i18n}\r\n        onClick={() => this.facetForDateRange!.toggleSingleSelect(facetValue)}\r\n      >\r\n        <FacetValueLabelHighlight\r\n          displayValue={displayValue}\r\n          isSelected={isSelected}\r\n          isExcluded={isExcluded}\r\n        ></FacetValueLabelHighlight>\r\n      </FacetValueLink>\r\n    );\r\n  }\r\n\r\n  private renderValuesContainer(children: VNode[]) {\r\n    return (\r\n      <FacetValuesGroup\r\n        i18n={this.props.bindings.i18n}\r\n        label={this.props.label}\r\n      >\r\n        <ul class=\"mt-3\" part=\"values\">\r\n          {children}\r\n        </ul>\r\n      </FacetValuesGroup>\r\n    );\r\n  }\r\n\r\n  private renderHeader(\r\n    isCollapsed: boolean,\r\n    headerFocus: FocusTargetController,\r\n    onToggleCollapse: () => void\r\n  ) {\r\n    return (\r\n      <FacetHeader\r\n        i18n={this.props.bindings.i18n}\r\n        label={this.props.label}\r\n        onClearFilters={() => {\r\n          headerFocus.focusAfterSearch();\r\n          if (this.filter?.state.range) {\r\n            this.filter?.clear();\r\n            return;\r\n          }\r\n          this.facetForDateRange?.deselectAll();\r\n        }}\r\n        numberOfActiveValues={this.numberOfSelectedValues}\r\n        isCollapsed={isCollapsed}\r\n        headingLevel={this.props.headingLevel}\r\n        onToggleCollapse={onToggleCollapse}\r\n        headerRef={(el) => headerFocus.setTarget(el)}\r\n      ></FacetHeader>\r\n    );\r\n  }\r\n\r\n  private renderDateInput() {\r\n    return (\r\n      <atomic-facet-date-input\r\n        min={this.props.min}\r\n        max={this.props.max}\r\n        bindings={this.props.bindings}\r\n        label={this.props.label}\r\n        filter={this.filter!}\r\n        filterState={this.filter!.state!}\r\n      ></atomic-facet-date-input>\r\n    );\r\n  }\r\n\r\n  public render({\r\n    hasError,\r\n    firstSearchExecuted,\r\n    isCollapsed,\r\n    headerFocus,\r\n    onToggleCollapse,\r\n  }: TimeframeFacetCommonRenderProps) {\r\n    if (hasError || !this.enabled) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    if (!firstSearchExecuted) {\r\n      return (\r\n        <FacetPlaceholder\r\n          numberOfValues={this.currentValues.length}\r\n          isCollapsed={isCollapsed}\r\n        ></FacetPlaceholder>\r\n      );\r\n    }\r\n\r\n    if (!this.shouldRenderFacet) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    return (\r\n      <FacetContainer>\r\n        {this.renderHeader(isCollapsed, headerFocus, onToggleCollapse)}\r\n        {!isCollapsed && [\r\n          this.shouldRenderValues && this.renderValues(),\r\n          this.shouldRenderInput && this.renderDateInput(),\r\n        ]}\r\n      </FacetContainer>\r\n    );\r\n  }\r\n}\r\n"],"version":3}