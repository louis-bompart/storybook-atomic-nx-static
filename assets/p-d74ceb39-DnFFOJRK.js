import{d as p,v as h}from"./atomic-breadbox.new.stories-D5_t4T0B.js";import{k as I}from"./p-f5723aee-D-iZ1npx.js";const A=(t,e,n)=>{const s=t.get(e);s?s.includes(n)||s.push(n):t.set(e,[n])},L=(t,e)=>{let n;return(...s)=>{n&&clearTimeout(n),n=setTimeout(()=>{n=0,t(...s)},e)}},b=t=>!("isConnected"in t)||t.isConnected,m=L(t=>{for(let e of t.keys())t.set(e,t.get(e).filter(b))},2e3),v=()=>{if(typeof p!="function")return{};const t=new Map;return{dispose:()=>t.clear(),get:e=>{const n=p();n&&A(t,e,n)},set:e=>{const n=t.get(e);n&&t.set(e,n.filter(h)),m(t)},reset:()=>{t.forEach(e=>e.forEach(h)),m(t)}}},f=t=>typeof t=="function"?t():t,x=(t,e=(n,s)=>n!==s)=>{const n=f(t);let s=new Map(Object.entries(n??{}));const i={dispose:[],get:[],set:[],reset:[]},g=()=>{var o;s=new Map(Object.entries((o=f(t))!==null&&o!==void 0?o:{})),i.reset.forEach(r=>r())},E=()=>{i.dispose.forEach(o=>o()),g()},u=o=>(i.get.forEach(r=>r(o)),s.get(o)),d=(o,r)=>{const c=s.get(o);e(r,c,o)&&(s.set(o,r),i.set.forEach(a=>a(o,r,c)))},F=typeof Proxy>"u"?{}:new Proxy(n,{get(o,r){return u(r)},ownKeys(o){return Array.from(s.keys())},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},has(o,r){return s.has(r)},set(o,r,c){return d(r,c),!0}}),l=(o,r)=>(i[o].push(r),()=>{O(i[o],r)});return{state:F,get:u,set:d,on:l,onChange:(o,r)=>{const c=l("set",(y,w)=>{y===o&&r(w)}),a=l("reset",()=>r(f(t)[o]));return()=>{c(),a()}},use:(...o)=>{const r=o.reduce((c,a)=>(a.set&&c.push(l("set",a.set)),a.get&&c.push(l("get",a.get)),a.reset&&c.push(l("reset",a.reset)),a.dispose&&c.push(l("dispose",a.dispose)),c),[]);return()=>r.forEach(c=>c())},dispose:E,reset:g,forceUpdate:o=>{const r=s.get(o);i.set.forEach(c=>c(o,r,r))}}},O=(t,e)=>{const n=t.indexOf(e);n>=0&&(t[n]=t[t.length-1],t.length--)},P=(t,e)=>{const n=x(t,e);return n.use(v()),n},T="is-refine-modal";function j(t){const e=P(t),n=(s,i)=>{e.state[s][i]&&(e.state.facetElements=e.state.facetElements.filter(g=>g.getAttribute("facet-id")!==i))};return{...e,registerFacet(s,i){i.element.getAttribute(T)===null&&(n(s,i.facetId),e.state.facetElements.push(i.element),e.state[s][i.facetId]=i)},getIconAssetsPath(){return e.get("iconAssetsPath")},setLoadingFlag(s){const i=e.get("loadingFlags");e.set("loadingFlags",i.concat(s))},unsetLoadingFlag(s){const i=e.get("loadingFlags");e.set("loadingFlags",i.filter(g=>g!==s))},hasLoadingFlag(s){return e.get("loadingFlags").indexOf(s)!==-1},registerResultList(s){e.set("resultList",s)},addFieldsToInclude(s){e.set("fieldsToInclude",[...e.get("fieldsToInclude"),...s])},waitUntilAppLoaded(s){e.get("loadingFlags").length?e.onChange("loadingFlags",i=>{i.length||s()}):s()},isAppLoaded(){return!e.get("loadingFlags").length},getUniqueIDFromEngine(s){throw new Error("getUniqueIDFromEngine not implemented at the common store level.")},getFacetElements(){return e.get("facetElements").filter(s=>I(s))}}}export{j as d,T as f};
