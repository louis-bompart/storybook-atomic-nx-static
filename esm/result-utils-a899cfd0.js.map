{"file":"result-utils-a899cfd0.js","mappings":"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","names":["buildInteractiveResult","ResultTemplatesHelpers"],"sources":["src/utils/result-utils.ts"],"sourcesContent":["import {\r\n  buildInteractiveResult,\r\n  SearchEngine,\r\n  Result,\r\n  ResultTemplatesHelpers,\r\n} from '@coveo/headless';\r\nimport {Bindings} from '../components/search/atomic-search-interface/atomic-search-interface';\r\n\r\n/**\r\n * Binds the logging of document\r\n * @returns An unbind function for the events\r\n * @param engine A headless search engine instance.\r\n * @param result The result object\r\n * @param resultElement Parent result element\r\n * @param selector Optional. Css selector that selects all links to the document. Default: \"a\" tags with the clickUri as \"href\" parameter.\r\n */\r\nexport function bindLogDocumentOpenOnResult(\r\n  engine: SearchEngine,\r\n  result: Result,\r\n  resultElement: Element | ShadowRoot,\r\n  selector?: string\r\n) {\r\n  const interactiveResult = buildInteractiveResult(engine, {\r\n    options: {result},\r\n  });\r\n\r\n  const eventsMap: Record<string, EventListenerOrEventListenerObject> = {\r\n    contextmenu: () => interactiveResult.select(),\r\n    click: () => interactiveResult.select(),\r\n    mouseup: () => interactiveResult.select(),\r\n    mousedown: () => interactiveResult.select(),\r\n    touchstart: () => interactiveResult.beginDelayedSelect(),\r\n    touchend: () => interactiveResult.cancelPendingSelect(),\r\n  };\r\n  const elements = resultElement.querySelectorAll(selector || 'a');\r\n\r\n  elements.forEach((element) => {\r\n    Object.keys(eventsMap).forEach((key) =>\r\n      element.addEventListener(key, eventsMap[key])\r\n    );\r\n  });\r\n\r\n  return () => {\r\n    elements.forEach((element) => {\r\n      Object.keys(eventsMap).forEach((key) =>\r\n        element.removeEventListener(key, eventsMap[key])\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function buildStringTemplateFromResult(\r\n  template: string,\r\n  result: Result,\r\n  bindings: Bindings\r\n) {\r\n  return template.replace(/\\${(.*?)}/g, (value: string) => {\r\n    const key = value.substring(2, value.length - 1);\r\n    let newValue = readFromObject(result, key);\r\n    if (!newValue) {\r\n      newValue = readFromObject(window, key);\r\n    }\r\n\r\n    if (!newValue) {\r\n      bindings.engine.logger.warn(\r\n        `${key} used in the href template is undefined for this result: ${result.uniqueId}`\r\n      );\r\n      return '';\r\n    }\r\n\r\n    return newValue;\r\n  });\r\n}\r\n\r\nexport function getStringValueFromResultOrNull(result: Result, field: string) {\r\n  const value = ResultTemplatesHelpers.getResultProperty(result, field);\r\n\r\n  if (typeof value !== 'string' || value.trim() === '') {\r\n    return null;\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\n// eslint-disable-next-line  @typescript-eslint/no-explicit-any\r\nfunction readFromObject(object: any, key: string): string {\r\n  const firstPeriodIndex = key.indexOf('.');\r\n  if (object && firstPeriodIndex !== -1) {\r\n    const newKey = key.substring(firstPeriodIndex + 1);\r\n    key = key.substring(0, firstPeriodIndex);\r\n    return readFromObject(object[key], newKey);\r\n  }\r\n  return object ? object[key] : undefined;\r\n}\r\n"],"version":3}