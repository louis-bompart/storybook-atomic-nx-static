{"version":3,"names":["atomicResultChildrenCss","AtomicResultChildrenStyle0","childTemplateComponent","componentTag","AtomicResultChildren","this","resultTemplateRegistered","templateHasError","showInitialChildren","inheritTemplates","noResultText","resolveChildTemplates","event","preventDefault","detail","itemTemplateProvider","initialize","resultChildrenCommon","ResultChildrenCommon","getHost","host","getBindings","bindings","getResult","result","getShowInitialChildren","getFoldedResultList","foldedResultList","getInitialChildren","initialChildren","getInheritTemplates","getResultTemplateRegistered","getTemplateHasError","getNoResultText","getDisplayConfig","displayConfig","getImageSize","imageSize","getFoldedResultListState","foldedResultListState","renderChild","bind","setInitialChildren","toggleShowInitialChildren","childrenTemplates","Array","from","querySelectorAll","filter","template","elementHasAncestorTag","length","error","Error","ItemTemplateProvider","includeDefaultTemplate","templateElements","setResultTemplateRegistered","value","setTemplateHasError","child","isLast","content","_a","getTemplateContent","key","uniqueId","children","map","h","interactiveResult","buildInteractiveResult","engine","options","extractUnfoldedItem","store","density","classes","trim","componentWillRender","render","__decorate","InitializeBindings","ChildTemplatesContext","FoldedItemListContext","ResultContext","folded","ItemDisplayConfigContext","FoldedItemListStateContext"],"sources":["src/components/search/result-lists/atomic-result-children/atomic-result-children.pcss?tag=atomic-result-children&encapsulation=shadow","src/components/search/result-lists/atomic-result-children/atomic-result-children.tsx"],"sourcesContent":["@import '../../../../components/common/result-children/result-children.pcss';\r\n","import {\r\n  buildInteractiveResult,\r\n  FoldedResult,\r\n  FoldedResultList,\r\n  FoldedResultListState,\r\n} from '@coveo/headless';\r\nimport {Component, Element, State, h, Listen, Prop} from '@stencil/core';\r\nimport {\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {elementHasAncestorTag} from '../../../../utils/utils';\r\nimport {extractUnfoldedItem} from '../../../common/interface/item';\r\nimport {\r\n  ChildTemplatesContext,\r\n  ChildTemplatesContextEvent,\r\n  DisplayConfig,\r\n  ItemDisplayConfigContext,\r\n} from '../../../common/item-list/item-decorators';\r\nimport {\r\n  FoldedItemListContext,\r\n  FoldedItemListStateContext,\r\n} from '../../../common/item-list/item-list-decorators';\r\nimport {ItemTemplateProvider} from '../../../common/item-list/item-template-provider';\r\nimport {ItemDisplayImageSize} from '../../../common/layout/display-options';\r\nimport {ResultChildrenCommon} from '../../../common/result-children/result-children-common';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {ResultContext} from '../../result-template-components/result-template-decorators';\r\n\r\nconst childTemplateComponent = 'atomic-result-children-template';\r\nconst componentTag = 'atomic-result-children';\r\n\r\n/**\r\n * The `atomic-result-children` component is responsible for displaying child results by applying one or more child result templates.\r\n * Includes two slots, \"before-children\" and \"after-children\", which allow for rendering content before and after the list of children,\r\n * only when children exist.\r\n * @part children-root - The wrapper for the message when there are child results\r\n * @part no-result-root - The wrapper for the message when there are no results.\r\n * @part show-hide-button - The button that allows to collapse or show all child results.\r\n * @slot before-children - Slot that allows rendering content before the list of children, only when children exist.\r\n * @slot after-children - Slot that allows rendering content after the list of children, only when children exist.\r\n */\r\n@Component({\r\n  tag: 'atomic-result-children',\r\n  styleUrl: 'atomic-result-children.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicResultChildren implements InitializableComponent {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ChildTemplatesContext()\r\n  public itemTemplateProvider?: ItemTemplateProvider;\r\n  @FoldedItemListContext()\r\n  private foldedResultList!: FoldedResultList;\r\n  @ResultContext({folded: true})\r\n  private result!: FoldedResult;\r\n  @ItemDisplayConfigContext()\r\n  private displayConfig!: DisplayConfig;\r\n  private initialChildren!: FoldedResult[];\r\n\r\n  @Element() public host!: HTMLDivElement;\r\n  @State() public error!: Error;\r\n  @State() private resultTemplateRegistered = false;\r\n  @State() private templateHasError = false;\r\n  @FoldedItemListStateContext()\r\n  @State()\r\n  private foldedResultListState!: FoldedResultListState;\r\n  @State()\r\n  private showInitialChildren = false;\r\n\r\n  /**\r\n   * Whether to inherit templates defined in a parent atomic-result-children. Only works for the second level of child nesting.\r\n   */\r\n  @Prop() inheritTemplates = false;\r\n  /**\r\n   * The expected size of the image displayed in the children results.\r\n   */\r\n  @Prop({reflect: true}) imageSize?: ItemDisplayImageSize;\r\n  /**\r\n   * The non-localized copy for an empty result state. An empty string will result in the component being hidden.\r\n   */\r\n  @Prop() public noResultText = 'no-documents-related';\r\n\r\n  private resultChildrenCommon!: ResultChildrenCommon;\r\n\r\n  @Listen('atomic/resolveChildTemplates')\r\n  public resolveChildTemplates(event: ChildTemplatesContextEvent) {\r\n    event.preventDefault();\r\n    event.detail(this.itemTemplateProvider);\r\n  }\r\n\r\n  public initialize() {\r\n    this.resultChildrenCommon = new ResultChildrenCommon({\r\n      getHost: () => this.host,\r\n      getBindings: () => this.bindings,\r\n      getResult: () => this.result,\r\n      getShowInitialChildren: () => this.showInitialChildren,\r\n      getFoldedResultList: () => this.foldedResultList,\r\n      getInitialChildren: () => this.initialChildren,\r\n      getInheritTemplates: () => this.inheritTemplates,\r\n      getResultTemplateRegistered: () => this.resultTemplateRegistered,\r\n      getTemplateHasError: () => this.templateHasError,\r\n      getNoResultText: () => this.noResultText,\r\n      getDisplayConfig: () => this.displayConfig,\r\n      getImageSize: () => this.imageSize,\r\n      getFoldedResultListState: () => this.foldedResultListState,\r\n      renderChild: this.renderChild.bind(this),\r\n      setInitialChildren: (initialChildren: FoldedResult[]) =>\r\n        (this.initialChildren = initialChildren),\r\n      toggleShowInitialChildren: () =>\r\n        (this.showInitialChildren = !this.showInitialChildren),\r\n    });\r\n\r\n    if (this.inheritTemplates) {\r\n      return;\r\n    }\r\n\r\n    const childrenTemplates = Array.from(\r\n      this.host.querySelectorAll(childTemplateComponent)\r\n    ).filter(\r\n      (template) => !elementHasAncestorTag(template, childTemplateComponent)\r\n    );\r\n\r\n    if (!childrenTemplates.length) {\r\n      this.error = new Error(\r\n        `The \"${componentTag}\" component requires at least one \"${childTemplateComponent}\" component.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    this.itemTemplateProvider = new ItemTemplateProvider({\r\n      includeDefaultTemplate: false,\r\n      templateElements: childrenTemplates,\r\n      getResultTemplateRegistered: () => this.resultTemplateRegistered,\r\n      getTemplateHasError: () => this.templateHasError,\r\n      setResultTemplateRegistered: (value: boolean) => {\r\n        this.resultTemplateRegistered = value;\r\n      },\r\n      setTemplateHasError: (value: boolean) => {\r\n        this.templateHasError = value;\r\n      },\r\n      bindings: this.bindings,\r\n    });\r\n  }\r\n\r\n  private renderChild(child: FoldedResult, isLast: boolean) {\r\n    const content = this.itemTemplateProvider?.getTemplateContent(child.result);\r\n\r\n    if (!content) {\r\n      return;\r\n    }\r\n\r\n    const key =\r\n      child.result.uniqueId +\r\n      child.children.map((child) => child.result.uniqueId);\r\n    return (\r\n      <atomic-result\r\n        key={key}\r\n        content={content}\r\n        result={child}\r\n        interactiveResult={buildInteractiveResult(this.bindings.engine, {\r\n          options: {result: extractUnfoldedItem(child)},\r\n        })}\r\n        store={this.bindings.store}\r\n        density={this.displayConfig.density}\r\n        imageSize={this.imageSize || this.displayConfig.imageSize}\r\n        classes={`child-result ${isLast ? 'last-child' : ''}`.trim()}\r\n      ></atomic-result>\r\n    );\r\n  }\r\n\r\n  public componentWillRender() {\r\n    this.resultChildrenCommon.componentWillRender();\r\n  }\r\n\r\n  public render() {\r\n    return this.resultChildrenCommon.render();\r\n  }\r\n}\r\n"],"mappings":"0gBAAA,MAAMA,EAA0B,8suCAChC,MAAAC,EAAeD,E,2WC4Bf,MAAME,EAAyB,kCAC/B,MAAMC,EAAe,yB,MAiBRC,EAAoB,M,yBAcdC,KAAAC,yBAA2B,MAC3BD,KAAAE,iBAAmB,MAK5BF,KAAAG,oBAAsB,MAKtBH,KAAAI,iBAAmB,MAQZJ,KAAAK,aAAe,uB,mDAnBc,M,sBACR,M,8DAKN,M,sBAKH,M,2CAQG,sB,CAKvB,qBAAAC,CAAsBC,GAC3BA,EAAMC,iBACND,EAAME,OAAOT,KAAKU,qB,CAGb,UAAAC,GACLX,KAAKY,qBAAuB,IAAIC,EAAqB,CACnDC,QAAS,IAAMd,KAAKe,KACpBC,YAAa,IAAMhB,KAAKiB,SACxBC,UAAW,IAAMlB,KAAKmB,OACtBC,uBAAwB,IAAMpB,KAAKG,oBACnCkB,oBAAqB,IAAMrB,KAAKsB,iBAChCC,mBAAoB,IAAMvB,KAAKwB,gBAC/BC,oBAAqB,IAAMzB,KAAKI,iBAChCsB,4BAA6B,IAAM1B,KAAKC,yBACxC0B,oBAAqB,IAAM3B,KAAKE,iBAChC0B,gBAAiB,IAAM5B,KAAKK,aAC5BwB,iBAAkB,IAAM7B,KAAK8B,cAC7BC,aAAc,IAAM/B,KAAKgC,UACzBC,yBAA0B,IAAMjC,KAAKkC,sBACrCC,YAAanC,KAAKmC,YAAYC,KAAKpC,MACnCqC,mBAAqBb,GAClBxB,KAAKwB,gBAAkBA,EAC1Bc,0BAA2B,IACxBtC,KAAKG,qBAAuBH,KAAKG,sBAGtC,GAAIH,KAAKI,iBAAkB,CACzB,M,CAGF,MAAMmC,EAAoBC,MAAMC,KAC9BzC,KAAKe,KAAK2B,iBAAiB7C,IAC3B8C,QACCC,IAAcC,EAAsBD,EAAU/C,KAGjD,IAAK0C,EAAkBO,OAAQ,CAC7B9C,KAAK+C,MAAQ,IAAIC,MACf,QAAQlD,uCAAkDD,iBAE5D,M,CAGFG,KAAKU,qBAAuB,IAAIuC,EAAqB,CACnDC,uBAAwB,MACxBC,iBAAkBZ,EAClBb,4BAA6B,IAAM1B,KAAKC,yBACxC0B,oBAAqB,IAAM3B,KAAKE,iBAChCkD,4BAA8BC,IAC5BrD,KAAKC,yBAA2BoD,CAAK,EAEvCC,oBAAsBD,IACpBrD,KAAKE,iBAAmBmD,CAAK,EAE/BpC,SAAUjB,KAAKiB,U,CAIX,WAAAkB,CAAYoB,EAAqBC,G,MACvC,MAAMC,GAAUC,EAAA1D,KAAKU,wBAAoB,MAAAgD,SAAA,SAAAA,EAAEC,mBAAmBJ,EAAMpC,QAEpE,IAAKsC,EAAS,CACZ,M,CAGF,MAAMG,EACJL,EAAMpC,OAAO0C,SACbN,EAAMO,SAASC,KAAKR,GAAUA,EAAMpC,OAAO0C,WAC7C,OACEG,EAAA,iBACEJ,IAAKA,EACLH,QAASA,EACTtC,OAAQoC,EACRU,kBAAmBC,EAAuBlE,KAAKiB,SAASkD,OAAQ,CAC9DC,QAAS,CAACjD,OAAQkD,EAAoBd,MAExCe,MAAOtE,KAAKiB,SAASqD,MACrBC,QAASvE,KAAK8B,cAAcyC,QAC5BvC,UAAWhC,KAAKgC,WAAahC,KAAK8B,cAAcE,UAChDwC,QAAS,gBAAgBhB,EAAS,aAAe,KAAKiB,Q,CAKrD,mBAAAC,GACL1E,KAAKY,qBAAqB8D,qB,CAGrB,MAAAC,GACL,OAAO3E,KAAKY,qBAAqB+D,Q,6BA/HNC,EAAA,CAA5BC,K,+BAEMD,EAAA,CADNE,K,2CAGOF,EAAA,CADPG,K,uCAGOH,EAAA,CADPI,EAAc,CAACC,OAAQ,Q,6BAGhBL,EAAA,CADPM,K,oCAUON,EAAA,CAFPO,K"}