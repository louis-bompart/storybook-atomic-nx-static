{"version":3,"names":["atomicIpxButtonCss","AtomicIpxButtonStyle0","numberOrPixelValuePattern","RegExp","AtomicIPXButton","this","closeIcon","CloseIcon","openIcon","SearchIcon","isModalOpen","recommendationsLoaded","getRecommendations","recsEngine","_a","bindings","interfaceElement","querySelector","engine","dispatch","loadRecommendationActions","onClick","close","open","render","renderIPXButton","h","Button","style","part","class","icon","getIcon","label","displayedIcon","hiddenIcon","Fragment","key","ipxModal","host","classList","add","setAttribute","remove","initialDiv","document","createElement","innerHTML","iconElement","iconWidth","getIconWidth","iconHeight","getIconHeight","cleanupSVGStyles","removeAttribute","width","getAttribute","test","height","__decorate","InitializeBindings"],"sources":["src/components/ipx/atomic-ipx-button/atomic-ipx-button.pcss?tag=atomic-ipx-button&encapsulation=shadow","src/components/ipx/atomic-ipx-button/atomic-ipx-button.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n\n/**\n * @prop --atomic-ipx-button-height: height of the IPX button.\n */\n:host {\n  &::part(ipx-button) {\n    @apply btn-primary fixed bottom-1 right-12 block px-3 whitespace-nowrap;\n    height: var(--atomic-ipx-button-height, 2.75rem);\n    background-color: var(--atomic-primary);\n  }\n\n  &::part(button-icon) {\n    @apply p-0 inline-block mr-2 w-4 h-4 align-middle relative;\n    font-size: 100%;\n  }\n\n  &::part(button-text) {\n    @apply overflow-hidden;\n  }\n\n  &::part(ipx-close-icon),\n  &::part(ipx-open-icon) {\n    @apply absolute left-0;\n    transition: transform 500ms;\n  }\n}\n","import {loadRecommendationActions} from '@coveo/headless/recommendation';\nimport {Component, Element, Fragment, h, Prop, State} from '@stencil/core';\nimport CloseIcon from '../../../images/close.svg';\nimport SearchIcon from '../../../images/search.svg';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {Button} from '../../common/button';\nimport {Bindings} from '../../search/atomic-search-interface/atomic-search-interface';\n\nconst numberOrPixelValuePattern = new RegExp(/^(?=.*(?:\\d+|px)$).*$/);\n\n/**\n * @internal\n */\n@Component({\n  tag: 'atomic-ipx-button',\n  styleUrl: './atomic-ipx-button.pcss',\n  shadow: true,\n})\nexport class AtomicIPXButton implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n\n  @State() public error!: Error;\n\n  @Element() public host!: HTMLElement;\n\n  /**\n   * The label that will be shown to the user.\n   */\n  @Prop({reflect: true}) public label?: string;\n\n  /**\n   * The close icon of the button.\n   */\n  @Prop({reflect: true}) public closeIcon = CloseIcon;\n\n  /**\n   * The open icon of the button.\n   */\n  @Prop({reflect: true}) public openIcon = SearchIcon;\n\n  /**\n   * Whether the IPX modal is open.\n   */\n  @Prop({mutable: true, reflect: true}) public isModalOpen = false;\n\n  private recommendationsLoaded = false;\n\n  private async getRecommendations() {\n    const recsEngine = this.bindings.interfaceElement.querySelector(\n      'atomic-recs-interface'\n    )?.engine;\n    if (recsEngine) {\n      this.recommendationsLoaded = true;\n      recsEngine.dispatch(\n        loadRecommendationActions(recsEngine).getRecommendations()\n      );\n    }\n  }\n\n  private async onClick() {\n    if (!this.recommendationsLoaded) {\n      this.getRecommendations();\n    }\n    this.isModalOpen ? this.close() : this.open();\n    this.render();\n  }\n\n  private renderIPXButton() {\n    return (\n      <Button\n        style=\"primary\"\n        part=\"ipx-button\"\n        class=\"my-2\"\n        onClick={() => this.onClick()}\n      >\n        <span part=\"button-icon\">\n          <atomic-icon\n            part=\"ipx-close-icon\"\n            icon={this.getIcon(this.closeIcon)}\n          ></atomic-icon>\n          <atomic-icon\n            part=\"ipx-open-icon\"\n            icon={this.getIcon(this.openIcon)}\n          ></atomic-icon>\n        </span>\n        <span part=\"button-text\">{this.label}</span>\n      </Button>\n    );\n  }\n\n  public render() {\n    const [displayedIcon, hiddenIcon] = this.isModalOpen\n      ? ['ipx-close-icon', 'ipx-open-icon']\n      : ['ipx-open-icon', 'ipx-close-icon'];\n    if (this.isModalOpen && !this.recommendationsLoaded) {\n      this.getRecommendations();\n    }\n\n    return (\n      <Fragment>\n        {\n          <style>\n            {`\n              [part=${displayedIcon}] {\n                transform: translateY(0rem);\n              }\n\n              [part=${hiddenIcon}] {\n                transform: translateY(3rem);\n              }\n                \n              .btn-open {\n                [part=${displayedIcon}] {\n                  transform: translateY(3rem);\n                }\n              \n                [part=${hiddenIcon}] {\n                  transform: translateY(0rem);\n                }\n              }`}\n          </style>\n        }\n        <div class=\"flex flex-col items-center\" part=\"container\">\n          {this.renderIPXButton()}\n        </div>\n      </Fragment>\n    );\n  }\n\n  private get ipxModal() {\n    return this.bindings.interfaceElement.querySelector('atomic-ipx-modal')!;\n  }\n\n  private open() {\n    this.isModalOpen = true;\n    this.host.classList.add('btn-open');\n    this.ipxModal.setAttribute('is-open', 'true');\n  }\n\n  private close() {\n    this.isModalOpen = false;\n    this.host.classList.remove('btn-open');\n    this.ipxModal.setAttribute('is-open', 'false');\n  }\n\n  private getIcon(icon: string) {\n    const initialDiv = document.createElement('div')!;\n    initialDiv.innerHTML = icon;\n    const iconElement = initialDiv.querySelector('svg');\n    if (!iconElement) {\n      return initialDiv.innerHTML;\n    }\n    // here, we grab the icon width and height to set a viewbox (which keeps the svg looking normal), then remove styles from the icon to let the icon stretch into the space it is given.\n    const iconWidth = this.getIconWidth(iconElement);\n    const iconHeight = this.getIconHeight(iconElement);\n    this.cleanupSVGStyles(iconElement);\n    if (iconWidth && iconHeight) {\n      iconElement.setAttribute('viewBox', `0 0 ${iconWidth} ${iconHeight}`);\n    }\n    return initialDiv.innerHTML;\n  }\n\n  private cleanupSVGStyles(iconElement: SVGSVGElement) {\n    iconElement.removeAttribute('style');\n    iconElement.removeAttribute('width');\n    iconElement.removeAttribute('height');\n  }\n\n  private getIconWidth(icon: SVGSVGElement) {\n    const width = icon.getAttribute('width') ?? '';\n    if (numberOrPixelValuePattern.test(width)) {\n      return width;\n    }\n    return null;\n  }\n\n  private getIconHeight(icon: SVGSVGElement) {\n    const height = icon.getAttribute('height') ?? '';\n    if (numberOrPixelValuePattern.test(height)) {\n      return height;\n    }\n    return null;\n  }\n}\n"],"mappings":"gWAAA,MAAMA,EAAqB,y8xCAC3B,MAAAC,EAAeD,E,2WCUf,MAAME,EAA4B,IAAIC,OAAO,yB,MAUhCC,EAAe,M,yBAeIC,KAAAC,UAAYC,EAKZF,KAAAG,SAAWC,EAKIJ,KAAAK,YAAc,MAEnDL,KAAAM,sBAAwB,M,yDAZUJ,E,cAKDE,E,iBAKkB,K,CAInD,wBAAMG,G,MACZ,MAAMC,GAAaC,EAAAT,KAAKU,SAASC,iBAAiBC,cAChD,4BACD,MAAAH,SAAA,SAAAA,EAAEI,OACH,GAAIL,EAAY,CACdR,KAAKM,sBAAwB,KAC7BE,EAAWM,SACTC,EAA0BP,GAAYD,qB,EAKpC,aAAMS,GACZ,IAAKhB,KAAKM,sBAAuB,CAC/BN,KAAKO,oB,CAEPP,KAAKK,YAAcL,KAAKiB,QAAUjB,KAAKkB,OACvClB,KAAKmB,Q,CAGC,eAAAC,GACN,OACEC,EAACC,EAAM,CACLC,MAAM,UACNC,KAAK,aACLC,MAAM,OACNT,QAAS,IAAMhB,KAAKgB,WAEpBK,EAAA,QAAMG,KAAK,eACTH,EAAA,eACEG,KAAK,iBACLE,KAAM1B,KAAK2B,QAAQ3B,KAAKC,aAE1BoB,EAAA,eACEG,KAAK,gBACLE,KAAM1B,KAAK2B,QAAQ3B,KAAKG,aAG5BkB,EAAA,QAAMG,KAAK,eAAexB,KAAK4B,O,CAK9B,MAAAT,GACL,MAAOU,EAAeC,GAAc9B,KAAKK,YACrC,CAAC,iBAAkB,iBACnB,CAAC,gBAAiB,kBACtB,GAAIL,KAAKK,cAAgBL,KAAKM,sBAAuB,CACnDN,KAAKO,oB,CAGP,OACEc,EAACU,EAAQ,CAAAC,IAAA,4CAELX,EAAA,SAAAW,IAAA,4CACG,yBACSH,8FAIAC,2IAKED,kHAIAC,4FAMhBT,EAAA,OAAAW,IAAA,2CAAKP,MAAM,6BAA6BD,KAAK,aAC1CxB,KAAKoB,mB,CAMd,YAAYa,GACV,OAAOjC,KAAKU,SAASC,iBAAiBC,cAAc,mB,CAG9C,IAAAM,GACNlB,KAAKK,YAAc,KACnBL,KAAKkC,KAAKC,UAAUC,IAAI,YACxBpC,KAAKiC,SAASI,aAAa,UAAW,O,CAGhC,KAAApB,GACNjB,KAAKK,YAAc,MACnBL,KAAKkC,KAAKC,UAAUG,OAAO,YAC3BtC,KAAKiC,SAASI,aAAa,UAAW,Q,CAGhC,OAAAV,CAAQD,GACd,MAAMa,EAAaC,SAASC,cAAc,OAC1CF,EAAWG,UAAYhB,EACvB,MAAMiB,EAAcJ,EAAW3B,cAAc,OAC7C,IAAK+B,EAAa,CAChB,OAAOJ,EAAWG,S,CAGpB,MAAME,EAAY5C,KAAK6C,aAAaF,GACpC,MAAMG,EAAa9C,KAAK+C,cAAcJ,GACtC3C,KAAKgD,iBAAiBL,GACtB,GAAIC,GAAaE,EAAY,CAC3BH,EAAYN,aAAa,UAAW,OAAOO,KAAaE,I,CAE1D,OAAOP,EAAWG,S,CAGZ,gBAAAM,CAAiBL,GACvBA,EAAYM,gBAAgB,SAC5BN,EAAYM,gBAAgB,SAC5BN,EAAYM,gBAAgB,S,CAGtB,YAAAJ,CAAanB,G,MACnB,MAAMwB,GAAQzC,EAAAiB,EAAKyB,aAAa,YAAQ,MAAA1C,SAAA,EAAAA,EAAI,GAC5C,GAAIZ,EAA0BuD,KAAKF,GAAQ,CACzC,OAAOA,C,CAET,OAAO,I,CAGD,aAAAH,CAAcrB,G,MACpB,MAAM2B,GAAS5C,EAAAiB,EAAKyB,aAAa,aAAS,MAAA1C,SAAA,EAAAA,EAAI,GAC9C,GAAIZ,EAA0BuD,KAAKC,GAAS,CAC1C,OAAOA,C,CAET,OAAO,I,6BAlKoBC,EAAA,CAA5BC,K"}