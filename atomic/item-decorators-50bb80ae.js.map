{"file":"item-decorators-50bb80ae.js","mappings":"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","names":[],"sources":["src/components/common/item-list/item-decorators.tsx"],"sourcesContent":["import {ComponentInterface, getElement} from '@stencil/core';\r\nimport {buildCustomEvent} from '../../../utils/event-utils';\r\nimport {closest} from '../../../utils/utils';\r\nimport {AnyItem} from '../interface/item';\r\nimport {\r\n  ItemDisplayDensity,\r\n  ItemDisplayImageSize,\r\n} from '../layout/display-options';\r\nimport {ItemTemplateProvider} from './item-template-provider';\r\n\r\nexport class MissingParentError extends Error {\r\n  constructor(elementName: string, parentName: string) {\r\n    super(\r\n      `The \"${elementName}\" element must be the child of an \"${parentName}\" element.`\r\n    );\r\n  }\r\n}\r\n\r\nexport function ItemContext(\r\n  opts: {parentName: string; folded: boolean} = {\r\n    parentName: 'atomic-result',\r\n    folded: false,\r\n  }\r\n) {\r\n  return (component: ComponentInterface, itemVariable: string) => {\r\n    const {connectedCallback, componentWillRender, render} = component;\r\n    component.connectedCallback = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        itemContextEventName,\r\n        (item: Record<string, unknown>) => {\r\n          this[itemVariable] = extractFolded(item, opts.folded);\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        this.error = new MissingParentError(\r\n          element.nodeName.toLowerCase(),\r\n          opts.parentName\r\n        );\r\n        return;\r\n      }\r\n      return connectedCallback && connectedCallback.call(this);\r\n    };\r\n\r\n    component.componentWillRender = function () {\r\n      if (this.error) {\r\n        return;\r\n      }\r\n\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n\r\n    component.render = function () {\r\n      if (this.error) {\r\n        const element = getElement(this);\r\n        element.remove();\r\n        console.error(\r\n          'Result component is in error and has been removed from the DOM',\r\n          this.error,\r\n          this,\r\n          element\r\n        );\r\n        return;\r\n      }\r\n      return render && render.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nexport function InteractiveItemContext() {\r\n  return (component: ComponentInterface, interactiveItemVariable: string) => {\r\n    const {connectedCallback} = component;\r\n    component.connectedCallback = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        interactiveItemContextEventName,\r\n        (item: AnyItem) => {\r\n          this[interactiveItemVariable] = item;\r\n        }\r\n      );\r\n      element.dispatchEvent(event);\r\n      return connectedCallback && connectedCallback.call(this);\r\n    };\r\n  };\r\n}\r\n\r\ntype ItemContextEventHandler<T> = (item: T) => void;\r\nexport type ItemContextEvent<T> = CustomEvent<ItemContextEventHandler<T>>;\r\nconst itemContextEventName = 'atomic/resolveResult';\r\nexport type InteractiveItemContextEvent = CustomEvent<\r\n  (interactiveItem: unknown) => void\r\n>;\r\nconst interactiveItemContextEventName = 'atomic/resolveInteractiveResult';\r\n\r\nexport function itemContext<T>(element: Element, parentName: string) {\r\n  return new Promise<T>((resolve, reject) => {\r\n    const event = buildCustomEvent<ItemContextEventHandler<T>>(\r\n      itemContextEventName,\r\n      (item: T) => {\r\n        return resolve(item);\r\n      }\r\n    );\r\n    element.dispatchEvent(event);\r\n\r\n    if (!closest(element, parentName)) {\r\n      reject(\r\n        new MissingParentError(element.nodeName.toLowerCase(), parentName)\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\nfunction extractFolded(item: Record<string, unknown>, returnFolded: boolean) {\r\n  if (returnFolded) {\r\n    if ('children' in item) {\r\n      return item;\r\n    } else {\r\n      return {children: [], result: item};\r\n    }\r\n  }\r\n\r\n  if ('children' in item && 'result' in item) {\r\n    return item.result;\r\n  }\r\n  return item;\r\n}\r\n\r\ntype ChildTemplatesContextEventHandler = (\r\n  itemTemplateProvider?: ItemTemplateProvider\r\n) => void;\r\nexport type ChildTemplatesContextEvent =\r\n  CustomEvent<ChildTemplatesContextEventHandler>;\r\nconst childTemplatesContextEventName = 'atomic/resolveChildTemplates';\r\n\r\ninterface AtomicItemChildren {\r\n  itemTemplateProvider?: ItemTemplateProvider;\r\n}\r\n\r\nexport function ChildTemplatesContext() {\r\n  return (component: ComponentInterface, itemTemplateProviderProp: string) => {\r\n    const {componentWillRender} = component;\r\n    component.componentWillRender = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        childTemplatesContextEventName,\r\n        (itemTemplateProvider?: ItemTemplateProvider) => {\r\n          const component = this as AtomicItemChildren;\r\n          if (component.itemTemplateProvider) {\r\n            return;\r\n          }\r\n\r\n          this[itemTemplateProviderProp] = itemTemplateProvider;\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        this[itemTemplateProviderProp] = null;\r\n        return;\r\n      }\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nexport type DisplayConfig = {\r\n  density: ItemDisplayDensity;\r\n  imageSize: ItemDisplayImageSize;\r\n};\r\n\r\ntype ItemDisplayConfigContextEventHandler = (config: DisplayConfig) => void;\r\nexport type ItemDisplayConfigContextEvent =\r\n  CustomEvent<ItemDisplayConfigContextEventHandler>;\r\nconst itemDisplayConfigContextEventName = 'atomic/resolveResultDisplayConfig';\r\n\r\nexport function ItemDisplayConfigContext() {\r\n  return (component: ComponentInterface, itemVariable: string) => {\r\n    const {componentWillRender} = component;\r\n    component.componentWillRender = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        itemDisplayConfigContextEventName,\r\n        (config: DisplayConfig) => {\r\n          this[itemVariable] = config;\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        return;\r\n      }\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n  };\r\n}\r\n"],"version":3}