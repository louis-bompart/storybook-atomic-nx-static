{"file":"atomic-refine-toggle.js","mappings":";;;;;;;;;;;;AAAA,MAAM,qBAAqB,GAAG,u+tCAAu+tC,CAAC;AACtguC,iCAAe,qBAAqB;;;;;;;;;;;;MCwBvBA,oBAAkB;;;;;;;;;;;QAkBC,wBAAmB,GAAG,CAAC,CAAC;;;mCAAF,CAAC;;IAE9C,UAAU;QACf,IAAI,CAAC,YAAY,GAAGC,EAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;KAC7D;IAEO,SAAS;QACf,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,OAAO;SACR;QAED,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;QAC9D,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC9D,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC;QAC1C,IAAI,CAAC,QAAQ,CAAC,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC;KAC9D;IAEO,WAAW;QACjB,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;KAChD;IAEM,MAAM;QACX,IAAI,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE;YACnC,OAAO;SACR;QAED,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,mBAAmB,EAAE;YAC/C,QACE,WACE,IAAI,EAAC,aAAa,uBAElB,KAAK,EAAC,gDAAgD,GACjD,EACP;SACH;QAED,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,UAAU,EAAE;YACtC,OAAO;SACR;QAED,QACE,EAAC,MAAM,IACL,KAAK,EAAC,iBAAiB,EACvB,KAAK,EAAC,YAAY,EAClB,OAAO,EAAE,MAAM,IAAI,CAAC,WAAW,EAAE,EACjC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,iBAAiB,CAAC,EAC7C,GAAG,EAAE,CAAC,MAAM;gBACV,IAAI,CAAC,MAAM,EAAE;oBACX,OAAO;iBACR;gBACD,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC;gBACxB,IAAI,CAAC,SAAS,EAAE,CAAC;aAClB,EACD,IAAI,EAAC,QAAQ,GACL,EACV;KACH;;;;;;;;AApE4B;IAA5B,kBAAkB,EAAE;sDAA4B;AAIzC;IAFP,qBAAqB,CAAC,cAAc,CAAC;+DAEQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":["AtomicRefineToggle","buildSearchStatus"],"sources":["src/components/search/atomic-refine-toggle/atomic-refine-toggle.pcss?tag=atomic-refine-toggle&encapsulation=shadow","src/components/search/atomic-refine-toggle/atomic-refine-toggle.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\r\n","import {\r\n  buildSearchStatus,\r\n  SearchStatusState,\r\n  SearchStatus,\r\n} from '@coveo/headless';\r\nimport {Component, h, Prop, State, Element} from '@stencil/core';\r\nimport {\r\n  InitializeBindings,\r\n  InitializableComponent,\r\n  BindStateToController,\r\n} from '../../../utils/initialization-utils';\r\nimport {Button} from '../../common/button';\r\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\r\n\r\n/**\r\n * The `atomic-refine-toggle` component displays a button that opens a modal containing the facets and the sort components.\r\n *\r\n * When this component is added to the `atomic-search-interface`, an `atomic-refine-modal` component is automatically created.\r\n * @part button - The refine toggle button.\r\n */\r\n@Component({\r\n  tag: 'atomic-refine-toggle',\r\n  styleUrl: 'atomic-refine-toggle.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicRefineToggle implements InitializableComponent {\r\n  @Element() public host!: HTMLElement;\r\n  public searchStatus!: SearchStatus;\r\n  private modalRef?: HTMLAtomicRefineModalElement;\r\n  private buttonRef?: HTMLButtonElement;\r\n\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @State() public error!: Error;\r\n  @BindStateToController('searchStatus')\r\n  @State()\r\n  private searchStatusState!: SearchStatusState;\r\n\r\n  /**\r\n   * The number of expanded facets inside the refine modal.\r\n   * Remaining facets are automatically collapsed.\r\n   *\r\n   * Using the value `0` collapses all facets.\r\n   */\r\n  @Prop({reflect: true}) public collapseFacetsAfter = 0;\r\n\r\n  public initialize() {\r\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\r\n  }\r\n\r\n  private loadModal() {\r\n    if (this.modalRef) {\r\n      return;\r\n    }\r\n\r\n    this.modalRef = document.createElement('atomic-refine-modal');\r\n    this.host.insertAdjacentElement('beforebegin', this.modalRef);\r\n    this.modalRef.openButton = this.buttonRef;\r\n    this.modalRef.collapseFacetsAfter = this.collapseFacetsAfter;\r\n  }\r\n\r\n  private enableModal() {\r\n    this.modalRef && (this.modalRef.isOpen = true);\r\n  }\r\n\r\n  public render() {\r\n    if (this.searchStatusState.hasError) {\r\n      return;\r\n    }\r\n\r\n    if (!this.searchStatusState.firstSearchExecuted) {\r\n      return (\r\n        <div\r\n          part=\"placeholder\"\r\n          aria-hidden\r\n          class=\"rounded w-28 h-8 my-2 bg-neutral animate-pulse\"\r\n        ></div>\r\n      );\r\n    }\r\n\r\n    if (!this.searchStatusState.hasResults) {\r\n      return;\r\n    }\r\n\r\n    return (\r\n      <Button\r\n        style=\"outline-primary\"\r\n        class=\"p-3 w-full\"\r\n        onClick={() => this.enableModal()}\r\n        text={this.bindings.i18n.t('sort-and-filter')}\r\n        ref={(button) => {\r\n          if (!button) {\r\n            return;\r\n          }\r\n          this.buttonRef = button;\r\n          this.loadModal();\r\n        }}\r\n        part=\"button\"\r\n      ></Button>\r\n    );\r\n  }\r\n}\r\n"],"version":3}