{"file":"atomic-popover.entry.cjs.js","mappings":"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","names":["buildSearchStatus","popoverClass","createPopper","preventOverflow","h","Button","ArrowBottomIcon","Hidden","Host","InitializeBindings","BindStateToController"],"sources":["src/components/search/facets/atomic-popover/atomic-popover.pcss?tag=atomic-popover&encapsulation=shadow","src/components/search/facets/atomic-popover/atomic-popover.tsx"],"sourcesContent":["@import '../../../common/facets/facet-common.pcss';\r\n","import {\r\n  buildSearchStatus,\r\n  SearchStatus,\r\n  SearchStatusState,\r\n  FacetState,\r\n} from '@coveo/headless';\r\nimport {\r\n  createPopperLite as createPopper,\r\n  preventOverflow,\r\n  Instance as PopperInstance,\r\n} from '@popperjs/core';\r\nimport {Component, h, Listen, State, Element, Host} from '@stencil/core';\r\nimport ArrowBottomIcon from '../../../../images/arrow-bottom-rounded.svg';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {Button} from '../../../common/button';\r\nimport {Hidden} from '../../../common/hidden';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {PopoverChildFacet, popoverClass} from './popover-type';\r\n\r\n/**\r\n * The `atomic-popover` component displays any facet as a popover menu.\r\n *\r\n * @slot default - The required slotted facet.\r\n * @part backdrop - The transparent backdrop hiding the content behind popover menu.\r\n * @part popover-button - The button to click to display or hide the popover menu.\r\n * @part value-label - The associated facet label.\r\n * @part value-count - Number of selected values for the facet\r\n * @part arrow-icon - The arrow icon on the button to display or hide the popover menu.\r\n * @part placeholder - The placeholder displayed when the facet is loading.\r\n * @part facet - The wrapper that contains the slotted 'facet'.\r\n */\r\n@Component({\r\n  tag: 'atomic-popover',\r\n  styleUrl: 'atomic-popover.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicPopover implements InitializableComponent {\r\n  @Element() private host!: HTMLElement;\r\n  private buttonRef!: HTMLElement;\r\n  private popupRef!: HTMLElement;\r\n  private popperInstance?: PopperInstance;\r\n  @InitializeBindings()\r\n  public bindings!: Bindings;\r\n  private searchStatus!: SearchStatus;\r\n\r\n  @BindStateToController('searchStatus')\r\n  @State()\r\n  public searchStatusState!: SearchStatusState;\r\n  @BindStateToController('facet')\r\n  @State()\r\n  public facetState!: FacetState;\r\n  @State()\r\n  public error!: Error;\r\n  @State() private isOpen = false;\r\n  @State() private childFacet?: PopoverChildFacet;\r\n\r\n  public initialize() {\r\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\r\n\r\n    if (this.host.children.length === 0) {\r\n      this.error = new Error(\r\n        'One child is required inside a set of popover tags.'\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    if (this.host.children.length > 1) {\r\n      this.error = new Error(\r\n        'Cannot have more than one child inside a set of popover tags.'\r\n      );\r\n    }\r\n  }\r\n\r\n  @Listen('atomic/initializePopover')\r\n  public initializePopover(event: CustomEvent<PopoverChildFacet>) {\r\n    if (this.childFacet || !event.detail) {\r\n      return;\r\n    }\r\n\r\n    this.childFacet = event.detail;\r\n    this.childFacet.element.classList.add(popoverClass);\r\n  }\r\n\r\n  @Listen('keydown')\r\n  public handleKeyDown(e: KeyboardEvent) {\r\n    if (e.key === 'Escape' && this.isOpen) {\r\n      this.togglePopover();\r\n    }\r\n  }\r\n\r\n  private get popoverId() {\r\n    return `${this.childFacet?.facetId}-popover`;\r\n  }\r\n\r\n  private get label() {\r\n    return this.childFacet!.label();\r\n  }\r\n\r\n  private togglePopover() {\r\n    this.isOpen = !this.isOpen;\r\n  }\r\n\r\n  public componentDidRender() {\r\n    if (this.popperInstance || !this.buttonRef || !this.popupRef) {\r\n      return;\r\n    }\r\n\r\n    this.popperInstance = createPopper(this.buttonRef, this.popupRef, {\r\n      placement: 'bottom-start',\r\n      modifiers: [preventOverflow],\r\n    });\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    this.popperInstance?.forceUpdate();\r\n  }\r\n\r\n  private renderDropdownButton() {\r\n    const label = this.label;\r\n    const hasActiveValues = !!this.childFacet!.numberOfActiveValues();\r\n    const count = this.childFacet!.numberOfActiveValues().toLocaleString();\r\n    const ariaLabel = this.bindings.i18n.t('popover', {label});\r\n\r\n    return (\r\n      <Button\r\n        ref={(el) => (this.buttonRef = el!)}\r\n        style=\"square-neutral\"\r\n        onClick={() => this.togglePopover()}\r\n        part=\"popover-button\"\r\n        ariaExpanded={`${this.isOpen}`}\r\n        ariaLabel={ariaLabel}\r\n        ariaControls={this.popoverId}\r\n        class={`rounded flex box-border h-full items-center min-w-[6rem] max-w-[15rem] p-2.5 group hover:border-primary-light focus-visible:border-primary-light ${\r\n          this.isOpen\r\n            ? 'border-primary ring ring-ring-primary text-primary z-[9999]'\r\n            : ''\r\n        }`}\r\n      >\r\n        <span\r\n          title={label}\r\n          part=\"value-label\"\r\n          class={`truncate mr-1.5 ${\r\n            this.isOpen\r\n              ? ''\r\n              : 'group-hover:text-primary-light group-focus:text-primary'\r\n          }`}\r\n        >\r\n          {label}\r\n        </span>\r\n        <span\r\n          part=\"value-count\"\r\n          class={`truncate mr-1.5 text-sm group-hover:text-primary-light group-focus:text-primary ${\r\n            hasActiveValues ? '' : 'hidden'\r\n          } ${this.isOpen ? 'text-primary' : 'text-neutral-dark'}`}\r\n        >\r\n          {this.bindings.i18n.t('between-parentheses', {\r\n            text: count,\r\n          })}\r\n        </span>\r\n        <atomic-icon\r\n          part=\"arrow-icon\"\r\n          class={`w-2 ml-auto group-hover:text-primary-light group-focus:text-primary ${\r\n            this.isOpen ? 'rotate-180' : ''\r\n          } `}\r\n          icon={ArrowBottomIcon}\r\n        ></atomic-icon>\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  private renderBackdrop() {\r\n    return (\r\n      <div\r\n        part=\"backdrop\"\r\n        class=\"fixed left-0 top-0 right-0 bottom-0 z-[9998] bg-transparent cursor-pointer\"\r\n        onClick={() => this.togglePopover()}\r\n      ></div>\r\n    );\r\n  }\r\n\r\n  private renderPopover() {\r\n    return (\r\n      <div class={`relative ${this.isOpen ? 'z-[9999]' : ''}`}>\r\n        {this.renderDropdownButton()}\r\n        <div\r\n          id={this.popoverId}\r\n          ref={(el) => (this.popupRef = el!)}\r\n          part=\"facet\"\r\n          class={`absolute pt-0.5 ${this.isOpen ? 'block' : 'hidden'}`}\r\n        >\r\n          <slot></slot>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    if (this.searchStatus.state.hasError) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    if (!this.searchStatus.state.firstSearchExecuted) {\r\n      return (\r\n        <div\r\n          part=\"placeholder\"\r\n          aria-hidden\r\n          class=\"h-8 w-32 bg-neutral animate-pulse rounded\"\r\n        ></div>\r\n      );\r\n    }\r\n\r\n    if (!this.searchStatus.state.hasResults || !this.childFacet?.hasValues()) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        <atomic-focus-trap\r\n          source={this.buttonRef}\r\n          container={this.popupRef}\r\n          active={this.isOpen}\r\n          shouldHideSelf={false}\r\n        >\r\n          {this.renderPopover()}\r\n        </atomic-focus-trap>\r\n        {this.isOpen && this.renderBackdrop()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}