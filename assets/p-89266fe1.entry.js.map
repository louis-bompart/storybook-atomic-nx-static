{"version":3,"names":["atomicProductDescriptionCss","AtomicProductDescriptionStyle0","AtomicProductDescription","constructor","hostRef","this","isExpanded","isTruncated","truncateAfter","field","resizeObserver","ResizeObserver","descriptionText","scrollHeight","clientHeight","validateProps","Schema","StringValue","constrainTo","validate","componentDidLoad","hostElement","querySelector","observe","onToggleExpand","getLineClampClass","lineClampMap","none","disconnectedCallback","disconnect","renderProductDescription","productDescription","_a","product","h","class","value","getFieldValueCaption","bindings","i18n","renderShowMoreButton","Button","style","part","title","t","onClick","icon","PlusIcon","render","key","__decorate","InitializeBindings","ProductContext"],"sources":["src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.pcss?tag=atomic-product-description","src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\r\n","import {Schema, StringValue} from '@coveo/bueno';\r\nimport {Product} from '@coveo/headless/commerce';\r\nimport {Component, State, h, Element, Prop} from '@stencil/core';\r\nimport PlusIcon from '../../../../images/plus.svg';\r\nimport {getFieldValueCaption} from '../../../../utils/field-utils';\r\nimport {\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {Button} from '../../../common/button';\r\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\r\nimport {ProductContext} from '../product-template-decorators';\r\n\r\n/**\r\n * @internal\r\n * The `atomic-product-description` component renders the description of a product.\r\n */\r\n@Component({\r\n  tag: 'atomic-product-description',\r\n  styleUrl: 'atomic-product-description.pcss',\r\n  shadow: false,\r\n})\r\nexport class AtomicProductDescription\r\n  implements InitializableComponent<CommerceBindings>\r\n{\r\n  @InitializeBindings() public bindings!: CommerceBindings;\r\n  @ProductContext() private product!: Product;\r\n\r\n  @Element() hostElement!: HTMLElement;\r\n\r\n  public error!: Error;\r\n\r\n  @State() private isExpanded = false;\r\n  @State() private isTruncated = false;\r\n\r\n  private descriptionText!: HTMLDivElement;\r\n  private resizeObserver: ResizeObserver;\r\n\r\n  /**\r\n   * The number of lines after which the product description should be truncated. A value of \"none\" will disable truncation.\r\n   */\r\n  @Prop() public truncateAfter: 'none' | '1' | '2' | '3' | '4' = '2';\r\n\r\n  /**\r\n   * The name of the description field to use.\r\n   */\r\n  @Prop() public field: 'ec_description' | 'ec_shortdesc' = 'ec_shortdesc';\r\n\r\n  constructor() {\r\n    this.resizeObserver = new ResizeObserver(() => {\r\n      if (\r\n        this.descriptionText &&\r\n        this.descriptionText.scrollHeight > this.descriptionText.clientHeight\r\n      ) {\r\n        this.isTruncated = true;\r\n      } else {\r\n        this.isTruncated = false;\r\n      }\r\n    });\r\n    this.validateProps();\r\n  }\r\n\r\n  private validateProps() {\r\n    new Schema({\r\n      truncateAfter: new StringValue({\r\n        constrainTo: ['none', '1', '2', '3', '4'],\r\n      }),\r\n      field: new StringValue({constrainTo: ['ec_shortdesc', 'ec_description']}),\r\n    }).validate({\r\n      truncateAfter: this.truncateAfter,\r\n      field: this.field,\r\n    });\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.descriptionText = this.hostElement.querySelector(\r\n      '.product-description-text'\r\n    ) as HTMLDivElement;\r\n    if (this.descriptionText) {\r\n      this.resizeObserver.observe(this.descriptionText);\r\n    }\r\n  }\r\n\r\n  private onToggleExpand() {\r\n    this.isExpanded = !this.isExpanded;\r\n  }\r\n\r\n  private getLineClampClass() {\r\n    const lineClampMap: Record<typeof this.truncateAfter, string> = {\r\n      none: 'line-clamp-none',\r\n      1: 'line-clamp-1',\r\n      2: 'line-clamp-2',\r\n      3: 'line-clamp-3',\r\n      4: 'line-clamp-4',\r\n    };\r\n    return lineClampMap[this.truncateAfter] || 'line-clamp-2';\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.resizeObserver.disconnect();\r\n  }\r\n\r\n  private renderProductDescription() {\r\n    const productDescription = this.product[this.field] ?? '';\r\n\r\n    if (productDescription !== null) {\r\n      return (\r\n        <atomic-commerce-text\r\n          class={`product-description-text ${!this.isExpanded ? this.getLineClampClass() : ''}`}\r\n          value={getFieldValueCaption(\r\n            this.field,\r\n            productDescription,\r\n            this.bindings.i18n\r\n          )}\r\n        ></atomic-commerce-text>\r\n      );\r\n    }\r\n  }\r\n\r\n  private renderShowMoreButton() {\r\n    return (\r\n      <Button\r\n        style=\"text-primary\"\r\n        part=\"label-button\"\r\n        class={`my-2 p-1 text-xs ${this.isExpanded ? 'hidden' : ''}`}\r\n        title={this.bindings.i18n.t('show-more')}\r\n        onClick={() => this.onToggleExpand()}\r\n      >\r\n        <atomic-icon\r\n          icon={PlusIcon}\r\n          class=\"w-2 ml-1 align-baseline\"\r\n        ></atomic-icon>{' '}\r\n        {this.bindings.i18n.t('show-more')}\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div class=\"flex flex-col items-start\">\r\n        {this.renderProductDescription()}\r\n        {this.isTruncated &&\r\n          this.truncateAfter !== 'none' &&\r\n          this.renderShowMoreButton()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"4ZAAA,MAAMA,EAA8B,w+tCACpC,MAAAC,EAAeD,E,iXCqBFE,EAAwB,MA0BnC,WAAAC,CAAAC,G,UAhBiBC,KAAAC,WAAa,MACbD,KAAAE,YAAc,MAQhBF,KAAAG,cAAgD,IAKhDH,KAAAI,MAA2C,e,gBAd5B,M,iBACC,M,mBAQgC,I,WAKL,eAGxDJ,KAAKK,eAAiB,IAAIC,gBAAe,KACvC,GACEN,KAAKO,iBACLP,KAAKO,gBAAgBC,aAAeR,KAAKO,gBAAgBE,aACzD,CACAT,KAAKE,YAAc,I,KACd,CACLF,KAAKE,YAAc,K,KAGvBF,KAAKU,e,CAGC,aAAAA,GACN,IAAIC,EAAO,CACTR,cAAe,IAAIS,EAAY,CAC7BC,YAAa,CAAC,OAAQ,IAAK,IAAK,IAAK,OAEvCT,MAAO,IAAIQ,EAAY,CAACC,YAAa,CAAC,eAAgB,sBACrDC,SAAS,CACVX,cAAeH,KAAKG,cACpBC,MAAOJ,KAAKI,O,CAIhB,gBAAAW,GACEf,KAAKO,gBAAkBP,KAAKgB,YAAYC,cACtC,6BAEF,GAAIjB,KAAKO,gBAAiB,CACxBP,KAAKK,eAAea,QAAQlB,KAAKO,gB,EAI7B,cAAAY,GACNnB,KAAKC,YAAcD,KAAKC,U,CAGlB,iBAAAmB,GACN,MAAMC,EAA0D,CAC9DC,KAAM,kBACN,EAAG,eACH,EAAG,eACH,EAAG,eACH,EAAG,gBAEL,OAAOD,EAAarB,KAAKG,gBAAkB,c,CAG7C,oBAAAoB,GACEvB,KAAKK,eAAemB,Y,CAGd,wBAAAC,G,MACN,MAAMC,GAAqBC,EAAA3B,KAAK4B,QAAQ5B,KAAKI,UAAM,MAAAuB,SAAA,EAAAA,EAAI,GAEvD,GAAID,IAAuB,KAAM,CAC/B,OACEG,EAAA,wBACEC,MAAO,6BAA6B9B,KAAKC,WAAaD,KAAKoB,oBAAsB,KACjFW,MAAOC,EACLhC,KAAKI,MACLsB,EACA1B,KAAKiC,SAASC,O,EAOhB,oBAAAC,GACN,OACEN,EAACO,EAAM,CACLC,MAAM,eACNC,KAAK,eACLR,MAAO,oBAAoB9B,KAAKC,WAAa,SAAW,KACxDsC,MAAOvC,KAAKiC,SAASC,KAAKM,EAAE,aAC5BC,QAAS,IAAMzC,KAAKmB,kBAEpBU,EAAA,eACEa,KAAMC,EACNb,MAAM,4BACQ,IACf9B,KAAKiC,SAASC,KAAKM,EAAE,a,CAKrB,MAAAI,GACL,OACEf,EAAA,OAAAgB,IAAA,2CAAKf,MAAM,6BACR9B,KAAKyB,2BACLzB,KAAKE,aACJF,KAAKG,gBAAkB,QACvBH,KAAKmC,uB,oCAtHgBW,EAAA,CAA5BC,K,+BACyBD,EAAA,CAAzBE,K"}