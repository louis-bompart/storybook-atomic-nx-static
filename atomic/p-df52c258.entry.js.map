{"version":3,"names":["atomicProductDescriptionCss","AtomicProductDescriptionStyle0","AtomicProductDescription","constructor","hostRef","this","isExpanded","isTruncated","truncateAfter","field","resizeObserver","ResizeObserver","descriptionText","scrollHeight","clientHeight","validateProps","Schema","StringValue","constrainTo","validate","componentDidLoad","hostElement","querySelector","observe","onToggleExpand","getLineClampClass","lineClampMap","none","disconnectedCallback","disconnect","renderProductDescription","productDescription","_a","product","h","class","value","getFieldValueCaption","bindings","i18n","renderShowMoreButton","Button","style","part","title","t","onClick","icon","PlusIcon","render","key","__decorate","InitializeBindings","ProductContext"],"sources":["src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.pcss?tag=atomic-product-description","src/components/commerce/product-template-components/atomic-product-description/atomic-product-description.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n","import {Schema, StringValue} from '@coveo/bueno';\nimport {Product} from '@coveo/headless/commerce';\nimport {Component, State, h, Element, Prop} from '@stencil/core';\nimport PlusIcon from '../../../../images/plus.svg';\nimport {getFieldValueCaption} from '../../../../utils/field-utils';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {Button} from '../../../common/button';\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport {ProductContext} from '../product-template-decorators';\n\n/**\n * @internal\n * The `atomic-product-description` component renders the description of a product.\n */\n@Component({\n  tag: 'atomic-product-description',\n  styleUrl: 'atomic-product-description.pcss',\n  shadow: false,\n})\nexport class AtomicProductDescription\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n  @ProductContext() private product!: Product;\n\n  @Element() hostElement!: HTMLElement;\n\n  public error!: Error;\n\n  @State() private isExpanded = false;\n  @State() private isTruncated = false;\n\n  private descriptionText!: HTMLDivElement;\n  private resizeObserver: ResizeObserver;\n\n  /**\n   * The number of lines after which the product description should be truncated. A value of \"none\" will disable truncation.\n   */\n  @Prop() public truncateAfter: 'none' | '1' | '2' | '3' | '4' = '2';\n\n  /**\n   * The name of the description field to use.\n   */\n  @Prop() public field: 'ec_description' | 'ec_shortdesc' = 'ec_shortdesc';\n\n  constructor() {\n    this.resizeObserver = new ResizeObserver(() => {\n      if (\n        this.descriptionText &&\n        this.descriptionText.scrollHeight > this.descriptionText.clientHeight\n      ) {\n        this.isTruncated = true;\n      } else {\n        this.isTruncated = false;\n      }\n    });\n    this.validateProps();\n  }\n\n  private validateProps() {\n    new Schema({\n      truncateAfter: new StringValue({\n        constrainTo: ['none', '1', '2', '3', '4'],\n      }),\n      field: new StringValue({constrainTo: ['ec_shortdesc', 'ec_description']}),\n    }).validate({\n      truncateAfter: this.truncateAfter,\n      field: this.field,\n    });\n  }\n\n  componentDidLoad() {\n    this.descriptionText = this.hostElement.querySelector(\n      '.product-description-text'\n    ) as HTMLDivElement;\n    if (this.descriptionText) {\n      this.resizeObserver.observe(this.descriptionText);\n    }\n  }\n\n  private onToggleExpand() {\n    this.isExpanded = !this.isExpanded;\n  }\n\n  private getLineClampClass() {\n    const lineClampMap: Record<typeof this.truncateAfter, string> = {\n      none: 'line-clamp-none',\n      1: 'line-clamp-1',\n      2: 'line-clamp-2',\n      3: 'line-clamp-3',\n      4: 'line-clamp-4',\n    };\n    return lineClampMap[this.truncateAfter] || 'line-clamp-2';\n  }\n\n  disconnectedCallback() {\n    this.resizeObserver.disconnect();\n  }\n\n  private renderProductDescription() {\n    const productDescription = this.product[this.field] ?? '';\n\n    if (productDescription !== null) {\n      return (\n        <atomic-commerce-text\n          class={`product-description-text ${!this.isExpanded ? this.getLineClampClass() : ''}`}\n          value={getFieldValueCaption(\n            this.field,\n            productDescription,\n            this.bindings.i18n\n          )}\n        ></atomic-commerce-text>\n      );\n    }\n  }\n\n  private renderShowMoreButton() {\n    return (\n      <Button\n        style=\"text-primary\"\n        part=\"label-button\"\n        class={`my-2 p-1 text-xs ${this.isExpanded ? 'hidden' : ''}`}\n        title={this.bindings.i18n.t('show-more')}\n        onClick={() => this.onToggleExpand()}\n      >\n        <atomic-icon\n          icon={PlusIcon}\n          class=\"w-2 ml-1 align-baseline\"\n        ></atomic-icon>{' '}\n        {this.bindings.i18n.t('show-more')}\n      </Button>\n    );\n  }\n\n  public render() {\n    return (\n      <div class=\"flex flex-col items-start\">\n        {this.renderProductDescription()}\n        {this.isTruncated &&\n          this.truncateAfter !== 'none' &&\n          this.renderShowMoreButton()}\n      </div>\n    );\n  }\n}\n"],"mappings":"4ZAAA,MAAMA,EAA8B,w+tCACpC,MAAAC,EAAeD,E,iXCqBFE,EAAwB,MA0BnC,WAAAC,CAAAC,G,UAhBiBC,KAAAC,WAAa,MACbD,KAAAE,YAAc,MAQhBF,KAAAG,cAAgD,IAKhDH,KAAAI,MAA2C,e,gBAd5B,M,iBACC,M,mBAQgC,I,WAKL,eAGxDJ,KAAKK,eAAiB,IAAIC,gBAAe,KACvC,GACEN,KAAKO,iBACLP,KAAKO,gBAAgBC,aAAeR,KAAKO,gBAAgBE,aACzD,CACAT,KAAKE,YAAc,I,KACd,CACLF,KAAKE,YAAc,K,KAGvBF,KAAKU,e,CAGC,aAAAA,GACN,IAAIC,EAAO,CACTR,cAAe,IAAIS,EAAY,CAC7BC,YAAa,CAAC,OAAQ,IAAK,IAAK,IAAK,OAEvCT,MAAO,IAAIQ,EAAY,CAACC,YAAa,CAAC,eAAgB,sBACrDC,SAAS,CACVX,cAAeH,KAAKG,cACpBC,MAAOJ,KAAKI,O,CAIhB,gBAAAW,GACEf,KAAKO,gBAAkBP,KAAKgB,YAAYC,cACtC,6BAEF,GAAIjB,KAAKO,gBAAiB,CACxBP,KAAKK,eAAea,QAAQlB,KAAKO,gB,EAI7B,cAAAY,GACNnB,KAAKC,YAAcD,KAAKC,U,CAGlB,iBAAAmB,GACN,MAAMC,EAA0D,CAC9DC,KAAM,kBACN,EAAG,eACH,EAAG,eACH,EAAG,eACH,EAAG,gBAEL,OAAOD,EAAarB,KAAKG,gBAAkB,c,CAG7C,oBAAAoB,GACEvB,KAAKK,eAAemB,Y,CAGd,wBAAAC,G,MACN,MAAMC,GAAqBC,EAAA3B,KAAK4B,QAAQ5B,KAAKI,UAAM,MAAAuB,SAAA,EAAAA,EAAI,GAEvD,GAAID,IAAuB,KAAM,CAC/B,OACEG,EAAA,wBACEC,MAAO,6BAA6B9B,KAAKC,WAAaD,KAAKoB,oBAAsB,KACjFW,MAAOC,EACLhC,KAAKI,MACLsB,EACA1B,KAAKiC,SAASC,O,EAOhB,oBAAAC,GACN,OACEN,EAACO,EAAM,CACLC,MAAM,eACNC,KAAK,eACLR,MAAO,oBAAoB9B,KAAKC,WAAa,SAAW,KACxDsC,MAAOvC,KAAKiC,SAASC,KAAKM,EAAE,aAC5BC,QAAS,IAAMzC,KAAKmB,kBAEpBU,EAAA,eACEa,KAAMC,EACNb,MAAM,4BACQ,IACf9B,KAAKiC,SAASC,KAAKM,EAAE,a,CAKrB,MAAAI,GACL,OACEf,EAAA,OAAAgB,IAAA,2CAAKf,MAAM,6BACR9B,KAAKyB,2BACLzB,KAAKE,aACJF,KAAKG,gBAAkB,QACvBH,KAAKmC,uB,oCAtHgBW,EAAA,CAA5BC,K,+BACyBD,EAAA,CAAzBE,K"}