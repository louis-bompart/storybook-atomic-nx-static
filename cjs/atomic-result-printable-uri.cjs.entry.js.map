{"file":"atomic-result-printable-uri.entry.cjs.js","mappings":"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","names":["FocusTargetController","Schema","NumberValue","getAttributesFromLinkSlot","buildInteractiveResult","h","parseXML","Arrow","LinkWithItemAnalytics","InitializeBindings","ResultContext"],"sources":["src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.pcss?tag=atomic-result-printable-uri","src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.tsx"],"sourcesContent":["atomic-result-printable-uri {\r\n  max-width: 100%;\r\n  word-break: break-word;\r\n\r\n  a,\r\n  button {\r\n    color: var(--atomic-primary);\r\n\r\n    &:hover,\r\n    &:focus-visible {\r\n      text-decoration: underline;\r\n      color: var(--atomic-primary);\r\n    }\r\n\r\n    &:focus {\r\n      outline: none;\r\n    }\r\n\r\n    &:visited {\r\n      color: var(--atomic-visited);\r\n    }\r\n  }\r\n\r\n  ul {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  li {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    max-width: 100%;\r\n\r\n    a {\r\n      display: inline-block;\r\n      vertical-align: middle;\r\n      max-width: 100%;\r\n      text-overflow: ellipsis;\r\n      overflow: hidden;\r\n    }\r\n\r\n    white-space: nowrap;\r\n    &:last-child {\r\n      white-space: normal;\r\n\r\n      &::after {\r\n        content: none;\r\n      }\r\n    }\r\n\r\n    .result-printable-uri-separator {\r\n      display: inline-block;\r\n      margin: 0 0.5rem;\r\n      vertical-align: middle;\r\n      width: 0.75rem;\r\n      height: 0.75rem;\r\n      color: var(--atomic-neutral-dark);\r\n    }\r\n  }\r\n}\r\n","import {Schema, NumberValue} from '@coveo/bueno';\r\nimport {\r\n  buildInteractiveResult,\r\n  InteractiveResult,\r\n  Result,\r\n} from '@coveo/headless';\r\nimport {Component, Element, h, Prop, State, VNode} from '@stencil/core';\r\nimport Arrow from '../../../../images/arrow-right.svg';\r\nimport {FocusTargetController} from '../../../../utils/accessibility-utils';\r\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\r\nimport {parseXML} from '../../../../utils/utils';\r\nimport {getAttributesFromLinkSlot} from '../../../common/item-link/attributes-slot';\r\nimport {LinkWithItemAnalytics} from '../../../common/item-link/item-link';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {ResultContext} from '../result-template-decorators';\r\n\r\n/**\r\n * The `atomic-result-printable-uri` component displays the URI, or path, to access a result.\r\n *\r\n * @slot attributes - Lets you pass [attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes) down to anchor elements, overriding other attributes.\r\n * To be used exclusively in anchor elements, such as: `<a slot=\"attributes\" target=\"_blank\" download></a>`.\r\n */\r\n@Component({\r\n  tag: 'atomic-result-printable-uri',\r\n  styleUrl: 'atomic-result-printable-uri.pcss',\r\n  shadow: false,\r\n})\r\nexport class AtomicResultPrintableUri {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ResultContext() private result!: Result;\r\n  @Element() public host!: HTMLElement;\r\n\r\n  @State() listExpanded = false;\r\n  @State() error!: Error;\r\n\r\n  /**\r\n   * The maximum number of Uri parts to display. This has to be over the minimum of `3` in order to be effective. Putting `Infinity` will disable the ellipsis.\r\n   */\r\n  @Prop({reflect: true}) maxNumberOfParts = 5;\r\n\r\n  private expandedPartFocus?: FocusTargetController;\r\n\r\n  private interactiveResult!: InteractiveResult;\r\n  private linkAttributes?: Attr[];\r\n\r\n  private get focusTarget() {\r\n    if (!this.expandedPartFocus) {\r\n      this.expandedPartFocus = new FocusTargetController(this);\r\n    }\r\n    return this.expandedPartFocus;\r\n  }\r\n\r\n  public connectedCallback() {\r\n    try {\r\n      new Schema({\r\n        maxNumberOfParts: new NumberValue({min: 3}),\r\n      }).validate({maxNumberOfParts: this.maxNumberOfParts});\r\n    } catch (error) {\r\n      this.error = error as Error;\r\n    }\r\n    const slotName = 'attributes';\r\n    this.linkAttributes = getAttributesFromLinkSlot(this.host, slotName);\r\n  }\r\n\r\n  public initialize() {\r\n    this.interactiveResult = buildInteractiveResult(this.bindings.engine, {\r\n      options: {result: this.result},\r\n    });\r\n  }\r\n\r\n  private getIndexOfEllipsis(parentsCount: number) {\r\n    const valuesToHide = Math.max(2, parentsCount - this.maxNumberOfParts);\r\n    const valuesToShowBeforeEllipsis = parentsCount - valuesToHide - 1;\r\n    return valuesToShowBeforeEllipsis;\r\n  }\r\n\r\n  private renderEllipsis() {\r\n    return (\r\n      <li>\r\n        <button\r\n          aria-label={this.bindings.i18n.t('collapsed-uri-parts')}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            this.focusTarget.focusOnNextTarget();\r\n            this.listExpanded = true;\r\n          }}\r\n        >\r\n          ...\r\n        </button>\r\n        {this.renderSeparator()}\r\n      </li>\r\n    );\r\n  }\r\n\r\n  private get allParents() {\r\n    const parentsXml = parseXML(`${this.result.raw.parents}`);\r\n    const parents = Array.from(parentsXml.getElementsByTagName('parent'));\r\n    const ellipsisIndex = this.getIndexOfEllipsis(parents.length);\r\n    return parents.map((parent, i) => {\r\n      const name = parent.getAttribute('name');\r\n      const uri = parent.getAttribute('uri')!;\r\n      return (\r\n        <li>\r\n          {this.renderLink(name, uri, i === ellipsisIndex)}\r\n          {i === parents.length - 1 ? null : this.renderSeparator()}\r\n        </li>\r\n      );\r\n    });\r\n  }\r\n\r\n  private renderSeparator() {\r\n    return (\r\n      <atomic-icon\r\n        class=\"result-printable-uri-separator\"\r\n        icon={Arrow}\r\n        role=\"separator\"\r\n      ></atomic-icon>\r\n    );\r\n  }\r\n\r\n  private renderParents() {\r\n    const parents = this.allParents;\r\n    if (this.listExpanded || parents.length <= this.maxNumberOfParts) {\r\n      return parents;\r\n    }\r\n\r\n    return [\r\n      parents.slice(0, this.getIndexOfEllipsis(parents.length)),\r\n      this.renderEllipsis(),\r\n      parents.slice(-1),\r\n    ];\r\n  }\r\n\r\n  private renderLink(\r\n    content: VNode | string | null,\r\n    uri: string,\r\n    shouldSetTarget: boolean\r\n  ) {\r\n    return (\r\n      <LinkWithItemAnalytics\r\n        href={uri}\r\n        title={typeof content === 'string' ? content : undefined}\r\n        onSelect={() => this.interactiveResult.select()}\r\n        onBeginDelayedSelect={() => this.interactiveResult.beginDelayedSelect()}\r\n        onCancelPendingSelect={() =>\r\n          this.interactiveResult.cancelPendingSelect()\r\n        }\r\n        attributes={this.linkAttributes}\r\n        ref={\r\n          shouldSetTarget\r\n            ? (el?: HTMLAnchorElement) => this.focusTarget.setTarget(el)\r\n            : undefined\r\n        }\r\n      >\r\n        {content}\r\n      </LinkWithItemAnalytics>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    const parents = this.renderParents();\r\n    if (parents.length) {\r\n      return (\r\n        <ul aria-label={this.bindings.i18n.t('printable-uri')}>{parents}</ul>\r\n      );\r\n    }\r\n\r\n    return this.renderLink(\r\n      <atomic-result-text field=\"printableUri\"></atomic-result-text>,\r\n      this.result.clickUri,\r\n      false\r\n    );\r\n  }\r\n}\r\n"],"version":3}