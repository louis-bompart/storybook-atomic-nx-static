{"file":"result-utils-9f11ee00.js","mappings":"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","names":["buildInteractiveResult","ResultTemplatesHelpers"],"sources":["src/utils/result-utils.ts"],"sourcesContent":["import {\n  buildInteractiveResult,\n  SearchEngine,\n  Result,\n  ResultTemplatesHelpers,\n} from '@coveo/headless';\nimport {Bindings} from '../components/search/atomic-search-interface/atomic-search-interface';\n\n/**\n * Binds the logging of document\n * @returns An unbind function for the events\n * @param engine A headless search engine instance.\n * @param result The result object\n * @param resultElement Parent result element\n * @param selector Optional. Css selector that selects all links to the document. Default: \"a\" tags with the clickUri as \"href\" parameter.\n */\nexport function bindLogDocumentOpenOnResult(\n  engine: SearchEngine,\n  result: Result,\n  resultElement: Element | ShadowRoot,\n  selector?: string\n) {\n  const interactiveResult = buildInteractiveResult(engine, {\n    options: {result},\n  });\n\n  const eventsMap: Record<string, EventListenerOrEventListenerObject> = {\n    contextmenu: () => interactiveResult.select(),\n    click: () => interactiveResult.select(),\n    mouseup: () => interactiveResult.select(),\n    mousedown: () => interactiveResult.select(),\n    touchstart: () => interactiveResult.beginDelayedSelect(),\n    touchend: () => interactiveResult.cancelPendingSelect(),\n  };\n  const elements = resultElement.querySelectorAll(selector || 'a');\n\n  elements.forEach((element) => {\n    Object.keys(eventsMap).forEach((key) =>\n      element.addEventListener(key, eventsMap[key])\n    );\n  });\n\n  return () => {\n    elements.forEach((element) => {\n      Object.keys(eventsMap).forEach((key) =>\n        element.removeEventListener(key, eventsMap[key])\n      );\n    });\n  };\n}\n\nexport function buildStringTemplateFromResult(\n  template: string,\n  result: Result,\n  bindings: Bindings\n) {\n  return template.replace(/\\${(.*?)}/g, (value: string) => {\n    const key = value.substring(2, value.length - 1);\n    let newValue = readFromObject(result, key);\n    if (!newValue) {\n      newValue = readFromObject(window, key);\n    }\n\n    if (!newValue) {\n      bindings.engine.logger.warn(\n        `${key} used in the href template is undefined for this result: ${result.uniqueId}`\n      );\n      return '';\n    }\n\n    return newValue;\n  });\n}\n\nexport function getStringValueFromResultOrNull(result: Result, field: string) {\n  const value = ResultTemplatesHelpers.getResultProperty(result, field);\n\n  if (typeof value !== 'string' || value.trim() === '') {\n    return null;\n  }\n\n  return value;\n}\n\n// eslint-disable-next-line  @typescript-eslint/no-explicit-any\nfunction readFromObject(object: any, key: string): string {\n  const firstPeriodIndex = key.indexOf('.');\n  if (object && firstPeriodIndex !== -1) {\n    const newKey = key.substring(firstPeriodIndex + 1);\n    key = key.substring(0, firstPeriodIndex);\n    return readFromObject(object[key], newKey);\n  }\n  return object ? object[key] : undefined;\n}\n"],"version":3}