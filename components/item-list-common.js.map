{"file":"item-list-common.js","mappings":";;;;MAaa,oBAAoB,GAAG,mBAAmB;MAgB1C,cAAc;IAKzB,YAAoB,KAA0B;QAA1B,UAAK,GAAL,KAAK,CAAqB;QAC5C,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;QACxD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,MAAM,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;KAC7E;IAEM,iBAAiB;QACtB,IAAI,CAAC,qBAAqB,EAAE,CAAC;KAC9B;IAEM,WAAW,CAChB,gBAAwB,EACxB,gBAAwB,EACxB,OAA2B,EAC3B,SAA+B;QAE/B,OAAO,GAAG,gBAAgB,GAAG,gBAAgB,GAAG,OAAO,GAAG,SAAS,EAAE,CAAC;KACvE;IAEM,eAAe,CAAC,OAAoB,EAAE,WAAmB;;QAC9D,IAAI,WAAW,KAAK,CAAC,EAAE;YACrB,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC;SAC9B;QACD,IAAI,WAAW,KAAK,IAAI,CAAC,oBAAoB,EAAE;YAC7C,OAAO;SACR;QAED,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,IAAI,EAAC,MAAA,OAAO,CAAC,UAAU,0CAAE,QAAQ,CAAC,MAAM,CAAA,EAAE;YACpE,OAAO;SACR;QAED,IAAI,CAAC,oBAAoB,GAAG,SAAS,CAAC;QACtC,MAAM,cAAc,GAAG,MAAA,2BAA2B,CAAC,OAAO,CAAC,mCAAI,OAAO,CAAC;QACvE,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;KACxD;IAEM,oBAAoB;QACzB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,KAAK,CAAC,uBAAuB,EAAE,CAAC;QACjE,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,CAAC;KAClD;IAEM,MAAM,iCAAiC;QAC5C,MAAM,KAAK,EAAE,CAAC;QACd,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO;YAC/B,IAAI,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE;gBAC7B,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;aAChC;YAED,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC;;gBACvC,MAAM,KAAK,EAAE,CAAC;gBACd,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,IAAI,IAAI,CAAC,aAAa,EAAE;oBACpD,MAAM,cAAc,GAClB,MAAA,2BAA2B,CAAC,IAAI,CAAC,aAAa,CAAC,mCAC/C,IAAI,CAAC,aAAa,CAAC;oBACrB,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;oBACvD,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;oBACrC,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;oBAC/B,KAAK,EAAE,CAAC;oBACR,OAAO,EAAE,CAAC;iBACX;aACF,CAAC,CAAC;SACJ,CAAC,CAAC;KACJ;;;;;","names":[],"sources":["src/components/common/item-list/item-list-common.tsx"],"sourcesContent":["import {\n  FocusTargetController,\n  getFirstFocusableDescendant,\n} from '../../../utils/accessibility-utils';\nimport {updateBreakpoints} from '../../../utils/replace-breakpoint';\nimport {defer, once} from '../../../utils/utils';\nimport {AnyItem} from '../interface/item';\nimport {AtomicCommonStore, AtomicCommonStoreData} from '../interface/store';\nimport {\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n} from '../layout/display-options';\n\nexport const resultComponentClass = 'result-component';\n\nexport type ItemRenderingFunction<SpecificResult extends AnyItem = AnyItem> =\n  | ((result: SpecificResult, root: HTMLElement) => string)\n  | undefined;\n\nexport interface ItemListCommonProps {\n  store: AtomicCommonStore<AtomicCommonStoreData>;\n  loadingFlag: string;\n  host: HTMLElement;\n  nextNewItemTarget: FocusTargetController;\n  getCurrentNumberOfItems: () => number;\n  getIsLoading: () => boolean;\n  engineSubscribe: (cb: () => void) => () => void;\n}\n\nexport class ItemListCommon {\n  private indexOfResultToFocus?: number;\n  private firstResultEl?: HTMLElement;\n  private updateBreakpointsOnce: () => void;\n\n  constructor(private props: ItemListCommonProps) {\n    this.props.store.setLoadingFlag(this.props.loadingFlag);\n    this.props.store.registerResultList(this);\n    this.updateBreakpointsOnce = once(() => updateBreakpoints(this.props.host));\n  }\n\n  public updateBreakpoints() {\n    this.updateBreakpointsOnce();\n  }\n\n  public getResultId(\n    uniqueIdOnResult: string,\n    searchResponseId: string,\n    density: ItemDisplayDensity,\n    imageSize: ItemDisplayImageSize\n  ) {\n    return `${uniqueIdOnResult}${searchResponseId}${density}${imageSize}`;\n  }\n\n  public setNewResultRef(element: HTMLElement, resultIndex: number) {\n    if (resultIndex === 0) {\n      this.firstResultEl = element;\n    }\n    if (resultIndex !== this.indexOfResultToFocus) {\n      return;\n    }\n\n    if (!element.children.length && !element.shadowRoot?.children.length) {\n      return;\n    }\n\n    this.indexOfResultToFocus = undefined;\n    const elementToFocus = getFirstFocusableDescendant(element) ?? element;\n    this.props.nextNewItemTarget.setTarget(elementToFocus);\n  }\n\n  public focusOnNextNewResult() {\n    this.indexOfResultToFocus = this.props.getCurrentNumberOfItems();\n    this.props.nextNewItemTarget.focusOnNextTarget();\n  }\n\n  public async focusOnFirstResultAfterNextSearch() {\n    await defer();\n    return new Promise<void>((resolve) => {\n      if (this.props.getIsLoading()) {\n        this.firstResultEl = undefined;\n      }\n\n      const unsub = this.props.engineSubscribe(async () => {\n        await defer();\n        if (!this.props.getIsLoading() && this.firstResultEl) {\n          const elementToFocus =\n            getFirstFocusableDescendant(this.firstResultEl) ??\n            this.firstResultEl;\n          this.props.nextNewItemTarget.setTarget(elementToFocus);\n          this.props.nextNewItemTarget.focus();\n          this.firstResultEl = undefined;\n          unsub();\n          resolve();\n        }\n      });\n    });\n  }\n}\n"],"version":3}