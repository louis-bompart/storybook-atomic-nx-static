{"version":3,"names":["getAnalyticsConfig","searchEngineConfig","enabled","store","_a","analytics","analyticsMode","getNextAnalyticsConfig","getLegacyAnalyticsConfig","analyticsClientMiddleware","event","payload","augmentAnalytics","defaultConfiguration","augmentAnalyticsConfigWithDocument","immutableConfiguration","augmentAnalyticsConfigWithAtomicVersion","config","result","augmentWithExternalMiddleware","augmentAnalyticsWithAtomicVersion","augmentAnalyticsWithFacetTitles","allFacets","getAllFacets","getAtomicFacetLabelOrOriginalTitle","facetId","originalTitle","label","facetState","map","analyticsFacetState","id","title","customData","facetTitle","createAtomicStore","commonStore","createAtomicCommonStore","loadingFlags","facets","numericFacets","dateFacets","categoryFacets","facetElements","sortOptions","iconAssetsPath","mobileBreakpoint","DEFAULT_MOBILE_BREAKPOINT","fieldsToInclude","currentQuickviewPosition","state","isMobile","window","matchMedia","makeDesktopQuery","matches","getUniqueIDFromEngine","engine","search","response","searchUid","atomicSearchInterfaceCss","AtomicSearchInterfaceStyle0","FirstSearchExecutedFlag","AtomicSearchInterface","constructor","hostRef","this","unsubscribeUrlManager","unsubscribeSearchStatus","initialized","relevanceInspectorIsOpen","localizationCompatibilityVersion","i18n","i18next","createInstance","language","reflectStateInUrl","scrollContainer","languageAssetsPath","enableRelevanceInspector","onHashChange","urlManager","synchronize","fragment","initRelevanceInspector","commonInterfaceHelper","CommonAtomicInterfaceHelper","connectedCallback","setLoadingFlag","updateMobileBreakpoint","i18nClone","cloneInstance","addResourceBundle","lng","ns","resources","deep","overwrite","addResourceBundleWithWarning","componentWillLoad","CspNonce","setNonce","initAriaLive","initFieldsToInclude","updateSearchConfiguration","updatedProp","newValue","engineIsCreated","loadSearchConfigurationActions","dispatch","updateSearchHub","searchHub","updatePipeline","pipeline","toggleAnalytics","onAnalyticsChange","updateLanguage","locale","onLanguageChange","updateIconAssetsPath","set","disconnectedCallback","removeEventListener","handleInitialization","onComponentInitializing","scrollToTop","scrollContainerElement","document","querySelector","bindings","logger","warn","scrollIntoView","behavior","closeRelevanceInspector","initialize","options","internalInitialization","initEngine","initializeWithSearchEngine","console","mismatchedInterfaceAndEnginePropError","executeFirstSearch","error","host","safeStorage","SafeStorage","standaloneSearchBoxData","getParsedJSON","StorageItems","STANDALONE_SEARCH_BOX_DATA","removeItem","updateQuery","loadQueryActions","value","enableQuerySyntax","q","executeFirstSearchAfterStandaloneSearchBoxRedirect","getOrganizationEndpoints","organizationId","env","getOrganizationEndpointsHeadless","interfaceElement","createStyleElement","styleTag","createElement","setAttribute","createScriptElement","fields","EcommerceDefaultFieldsToInclude","concat","addFieldsToInclude","registerFieldsToInclude","loadFieldActions","breakpoint","searchConfig","getSearchConfiguration","analyticsConfig","buildSearchEngine","configuration","loggerOptions","level","logLevel","searchConfigFromProps","timezone","location","hash","slice","initUrlManager","buildUrlManager","initialState","subscribe","updateHash","addEventListener","Array","from","children","some","element","tagName","prepend","e","altKey","initSearchStatus","searchStatus","buildSearchStatus","hasNoResultsAfterInitialSearch","hasResults","firstSearchExecuted","hasError","classList","toggle","hasLoadingFlag","unsetLoadingFlag","newFragment","history","replaceState","info","pushState","onInitialization","hasV3Keys","Object","keys","k","includes","render","h","key","open","__decorate","ArrayProp"],"sources":["src/components/search/atomic-search-interface/analytics-config.ts","src/components/search/atomic-search-interface/store.ts","src/components/search/atomic-search-interface/atomic-search-interface.pcss?tag=atomic-search-interface&encapsulation=shadow","src/components/search/atomic-search-interface/atomic-search-interface.tsx"],"sourcesContent":["import {\r\n  AnalyticsConfiguration,\r\n  SearchEngineConfiguration,\r\n} from '@coveo/headless';\r\nimport {\r\n  AnalyticsPayload,\r\n  augmentAnalyticsWithAtomicVersion,\r\n  augmentWithExternalMiddleware,\r\n  augmentAnalyticsConfigWithDocument,\r\n  augmentAnalyticsConfigWithAtomicVersion,\r\n  getNextAnalyticsConfig,\r\n} from '../../common/interface/analytics-config';\r\nimport {createAtomicStore} from './store';\r\n\r\nexport function getAnalyticsConfig(\r\n  searchEngineConfig: SearchEngineConfiguration,\r\n  enabled: boolean,\r\n  store: ReturnType<typeof createAtomicStore>\r\n): AnalyticsConfiguration {\r\n  switch (searchEngineConfig.analytics?.analyticsMode) {\r\n    case 'next':\r\n      return getNextAnalyticsConfig(searchEngineConfig, enabled);\r\n    case 'legacy':\r\n    default:\r\n      return getLegacyAnalyticsConfig(searchEngineConfig, enabled, store);\r\n  }\r\n}\r\n\r\nfunction getLegacyAnalyticsConfig(\r\n  searchEngineConfig: SearchEngineConfiguration,\r\n  enabled: boolean,\r\n  store: ReturnType<typeof createAtomicStore>\r\n): AnalyticsConfiguration {\r\n  const analyticsClientMiddleware = (\r\n    event: string,\r\n    payload: AnalyticsPayload\r\n  ) => augmentAnalytics(event, payload, store, searchEngineConfig);\r\n\r\n  const defaultConfiguration: AnalyticsConfiguration = {\r\n    analyticsClientMiddleware,\r\n    enabled,\r\n    ...augmentAnalyticsConfigWithDocument(),\r\n  };\r\n\r\n  const immutableConfiguration: AnalyticsConfiguration = {\r\n    ...augmentAnalyticsConfigWithAtomicVersion(),\r\n  };\r\n\r\n  if (searchEngineConfig.analytics) {\r\n    return {\r\n      ...defaultConfiguration,\r\n      ...searchEngineConfig.analytics,\r\n      analyticsClientMiddleware,\r\n      ...immutableConfiguration,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...defaultConfiguration,\r\n    ...immutableConfiguration,\r\n  };\r\n}\r\n\r\nfunction augmentAnalytics(\r\n  event: string,\r\n  payload: AnalyticsPayload,\r\n  store: ReturnType<typeof createAtomicStore>,\r\n  config: SearchEngineConfiguration\r\n) {\r\n  let result = augmentWithExternalMiddleware(event, payload, config);\r\n  result = augmentAnalyticsWithAtomicVersion(result);\r\n  result = augmentAnalyticsWithFacetTitles(result, store);\r\n  return result;\r\n}\r\n\r\nfunction augmentAnalyticsWithFacetTitles(\r\n  payload: AnalyticsPayload,\r\n  store: ReturnType<typeof createAtomicStore>\r\n) {\r\n  const allFacets = store.getAllFacets();\r\n  const getAtomicFacetLabelOrOriginalTitle = (\r\n    facetId: string,\r\n    originalTitle: string\r\n  ) => (allFacets[facetId] ? allFacets[facetId].label() : originalTitle);\r\n\r\n  if (payload.facetState) {\r\n    payload.facetState = payload.facetState.map(\r\n      (analyticsFacetState: {id: string; title: string}) => {\r\n        const {id, title: originalTitle} = analyticsFacetState;\r\n        return {\r\n          ...analyticsFacetState,\r\n          title: getAtomicFacetLabelOrOriginalTitle(id, originalTitle),\r\n        };\r\n      }\r\n    );\r\n  }\r\n\r\n  if (\r\n    payload.customData &&\r\n    payload.customData.facetTitle &&\r\n    payload.customData.facetId &&\r\n    payload.customData.facetTitle\r\n  ) {\r\n    payload.customData.facetTitle = getAtomicFacetLabelOrOriginalTitle(\r\n      payload.customData.facetId,\r\n      payload.customData.facetTitle\r\n    );\r\n  }\r\n  return payload;\r\n}\r\n","import {\r\n  NumericFacetValue,\r\n  DateFacetValue,\r\n  SortCriterion,\r\n  SearchEngine,\r\n} from '@coveo/headless';\r\nimport {DEFAULT_MOBILE_BREAKPOINT} from '../../../utils/replace-breakpoint';\r\nimport {\r\n  FacetInfo,\r\n  FacetStore,\r\n  FacetValueFormat,\r\n} from '../../common/facets/facet-common-store';\r\nimport {\r\n  createAtomicCommonStore,\r\n  AtomicCommonStoreData,\r\n  AtomicCommonStore,\r\n} from '../../common/interface/store';\r\nimport {makeDesktopQuery} from '../atomic-layout/search-layout';\r\n\r\nexport interface SortDropdownOption {\r\n  expression: string;\r\n  criteria: SortCriterion[];\r\n  label: string;\r\n}\r\n\r\nexport interface AtomicStoreData extends AtomicCommonStoreData {\r\n  facets: FacetStore<FacetInfo>;\r\n  numericFacets: FacetStore<FacetInfo & FacetValueFormat<NumericFacetValue>>;\r\n  dateFacets: FacetStore<FacetInfo & FacetValueFormat<DateFacetValue>>;\r\n  categoryFacets: FacetStore<FacetInfo>;\r\n  sortOptions: SortDropdownOption[];\r\n  mobileBreakpoint: string;\r\n  currentQuickviewPosition: number;\r\n}\r\n\r\nexport interface AtomicStore extends AtomicCommonStore<AtomicStoreData> {\r\n  getAllFacets(): FacetInfoMap;\r\n\r\n  isMobile(): boolean;\r\n}\r\n\r\nexport interface FacetInfoMap {\r\n  [facetId: string]:\r\n    | FacetInfo\r\n    | (FacetInfo & FacetValueFormat<NumericFacetValue>)\r\n    | (FacetInfo & FacetValueFormat<DateFacetValue>);\r\n}\r\n\r\nexport function createAtomicStore(): AtomicStore {\r\n  const commonStore = createAtomicCommonStore<AtomicStoreData>({\r\n    loadingFlags: [],\r\n    facets: {},\r\n    numericFacets: {},\r\n    dateFacets: {},\r\n    categoryFacets: {},\r\n    facetElements: [],\r\n    sortOptions: [],\r\n    iconAssetsPath: '',\r\n    mobileBreakpoint: DEFAULT_MOBILE_BREAKPOINT,\r\n    fieldsToInclude: [],\r\n    currentQuickviewPosition: -1,\r\n  });\r\n\r\n  return {\r\n    ...commonStore,\r\n\r\n    getAllFacets() {\r\n      return {\r\n        ...commonStore.state.facets,\r\n        ...commonStore.state.dateFacets,\r\n        ...commonStore.state.categoryFacets,\r\n        ...commonStore.state.numericFacets,\r\n      };\r\n    },\r\n\r\n    isMobile() {\r\n      return !window.matchMedia(\r\n        makeDesktopQuery(commonStore.state.mobileBreakpoint)\r\n      ).matches;\r\n    },\r\n\r\n    getUniqueIDFromEngine(engine: SearchEngine): string {\r\n      return engine.state.search.response.searchUid;\r\n    },\r\n  };\r\n}\r\n","@import '../../../global/global.pcss';\r\n\r\n:host {\r\n  height: inherit;\r\n  width: inherit;\r\n  & > slot {\r\n    height: inherit;\r\n  }\r\n}\r\n","import {\r\n  LogLevel,\r\n  Unsubscribe,\r\n  buildUrlManager,\r\n  UrlManager,\r\n  buildSearchEngine,\r\n  SearchEngine,\r\n  SearchEngineConfiguration,\r\n  SearchStatus,\r\n  buildSearchStatus,\r\n  loadSearchConfigurationActions,\r\n  loadQueryActions,\r\n  EcommerceDefaultFieldsToInclude,\r\n  loadFieldActions,\r\n  getOrganizationEndpoints as getOrganizationEndpointsHeadless,\r\n  PlatformEnvironment,\r\n} from '@coveo/headless';\r\nimport {\r\n  Component,\r\n  Prop,\r\n  h,\r\n  Listen,\r\n  Method,\r\n  Watch,\r\n  Element,\r\n  State,\r\n  setNonce,\r\n} from '@stencil/core';\r\nimport i18next, {i18n} from 'i18next';\r\nimport {InitializeEvent} from '../../../utils/initialization-utils';\r\nimport {\r\n  SafeStorage,\r\n  StandaloneSearchBoxData,\r\n  StorageItems,\r\n} from '../../../utils/local-storage-utils';\r\nimport {ArrayProp} from '../../../utils/props-utils';\r\nimport {CommonBindings, NonceBindings} from '../../common/interface/bindings';\r\nimport {i18nCompatibilityVersion} from '../../common/interface/i18n';\r\nimport {\r\n  BaseAtomicInterface,\r\n  CommonAtomicInterfaceHelper,\r\n  mismatchedInterfaceAndEnginePropError,\r\n} from '../../common/interface/interface-common';\r\nimport {getAnalyticsConfig} from './analytics-config';\r\nimport {AtomicStore, createAtomicStore} from './store';\r\n\r\nconst FirstSearchExecutedFlag = 'firstSearchExecuted';\r\nexport type InitializationOptions = SearchEngineConfiguration;\r\nexport type Bindings = CommonBindings<\r\n  SearchEngine,\r\n  AtomicStore,\r\n  HTMLAtomicSearchInterfaceElement\r\n> &\r\n  NonceBindings;\r\n\r\n/**\r\n * The `atomic-search-interface` component is the parent to all other atomic components in a search page. It handles the headless search engine and localization configurations.\r\n */\r\n@Component({\r\n  tag: 'atomic-search-interface',\r\n  styleUrl: 'atomic-search-interface.pcss',\r\n  shadow: true,\r\n  assetsDirs: ['lang'],\r\n})\r\nexport class AtomicSearchInterface\r\n  implements BaseAtomicInterface<SearchEngine>\r\n{\r\n  private urlManager!: UrlManager;\r\n  private searchStatus!: SearchStatus;\r\n  private unsubscribeUrlManager: Unsubscribe = () => {};\r\n  private unsubscribeSearchStatus: Unsubscribe = () => {};\r\n  private initialized = false;\r\n  private store = createAtomicStore();\r\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<SearchEngine>;\r\n\r\n  @Element() public host!: HTMLAtomicSearchInterfaceElement;\r\n\r\n  @State() public error?: Error;\r\n  @State() relevanceInspectorIsOpen = false;\r\n\r\n  /**\r\n   * A list of non-default fields to include in the query results.\r\n   *\r\n   * Specify the property as an array using a JSON string representation:\r\n   * ```html\r\n   * <atomic-search-interface fields-to-include='[\"fieldA\", \"fieldB\"]'></atomic-search-interface>\r\n   * ```\r\n   */\r\n  @ArrayProp()\r\n  @Prop({mutable: true})\r\n  public fieldsToInclude: string[] | string = '[]';\r\n\r\n  /**\r\n   * The search interface [query pipeline](https://docs.coveo.com/en/180/).\r\n   *\r\n   * If the search interface is initialized using [`initializeWithSearchEngine`](https://docs.coveo.com/en/atomic/latest/reference/components/atomic-search-interface/#initializewithsearchengine), the query pipeline should instead be configured in the target engine.\r\n   */\r\n  @Prop({reflect: true, mutable: true}) public pipeline?: string;\r\n\r\n  /**\r\n   * The search interface [search hub](https://docs.coveo.com/en/1342/).\r\n   *\r\n   * If the search interface is initialized using [`initializeWithSearchEngine`](https://docs.coveo.com/en/atomic/latest/reference/components/atomic-search-interface/#initializewithsearchengine, the search hub should instead be configured in the target engine.\r\n   */\r\n  @Prop({reflect: true, mutable: true}) public searchHub?: string;\r\n\r\n  /**\r\n   * Whether analytics should be enabled.\r\n   */\r\n  @Prop({reflect: true}) public analytics = true;\r\n\r\n  /**\r\n   * The [tz database](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) identifier of the time zone to use to correctly interpret dates in the query expression, facets, and result items.\r\n   * By default, the timezone will be [guessed](https://day.js.org/docs/en/timezone/guessing-user-timezone).\r\n   *\r\n   * @example \"America/Montreal\"\r\n   */\r\n  @Prop({reflect: true}) public timezone?: string;\r\n\r\n  /**\r\n   * The severity level of the messages to log in the console.\r\n   */\r\n  @Prop({reflect: true}) public logLevel?: LogLevel;\r\n\r\n  /**\r\n   * The compatibility JSON version for i18next to use (see [i18next Migration Guide](https://www.i18next.com/misc/migration-guide#v20.x.x-to-v21.0.0)).\r\n   */\r\n  @Prop() public localizationCompatibilityVersion: i18nCompatibilityVersion =\r\n    'v3';\r\n\r\n  /**\r\n   * The search interface i18next instance.\r\n   */\r\n  @Prop() public i18n: i18n = i18next.createInstance();\r\n\r\n  /**\r\n   * The search interface language.\r\n   */\r\n  @Prop({reflect: true}) public language = 'en';\r\n\r\n  /**\r\n   * The search interface headless engine.\r\n   */\r\n  @Prop({mutable: true}) public engine?: SearchEngine;\r\n\r\n  /**\r\n   * Whether the state should be reflected in the URL parameters.\r\n   */\r\n  @Prop({reflect: true}) public reflectStateInUrl = true;\r\n\r\n  /**\r\n   * The CSS selector for the container where the interface will scroll back to.\r\n   */\r\n  @Prop({reflect: true}) public scrollContainer = 'atomic-search-interface';\r\n\r\n  /**\r\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\r\n   *\r\n   * @example \"/mypublicpath/languages\"\r\n   *\r\n   */\r\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\r\n\r\n  /**\r\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\r\n   *\r\n   * @example \"/mypublicpath/icons\"\r\n   *\r\n   */\r\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\r\n\r\n  /**\r\n   * Whether the relevance inspector shortcut should be enabled for this interface.\r\n   *\r\n   * The relevance inspector can be opened by holding the Alt key (Option on Mac) while over the interface, and performing a double click.\r\n   *\r\n   * The relevance inspector allows to troubleshoot and debug queries.\r\n   */\r\n  @Prop({reflect: true}) public enableRelevanceInspector = true;\r\n\r\n  /**\r\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\r\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\r\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\r\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\r\n   * Otherwise you may see console errors such as\r\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\r\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\r\n   * @example\r\n   * ```html\r\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\r\n   *  import {setNonce} from '@coveo/atomic';\r\n   *  setNonce('<YOUR_GENERATED_NONCE>');\r\n   * </script>\r\n   * ```\r\n   */\r\n  @Prop({reflect: true}) public CspNonce?: string;\r\n\r\n  /**\r\n   * A reference clone of the search interface i18next instance.\r\n   */\r\n  private i18nClone!: i18n;\r\n\r\n  public constructor() {\r\n    this.initRelevanceInspector();\r\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\r\n      this,\r\n      'CoveoAtomic'\r\n    );\r\n  }\r\n\r\n  public connectedCallback() {\r\n    this.store.setLoadingFlag(FirstSearchExecutedFlag);\r\n    this.updateMobileBreakpoint();\r\n    this.i18nClone = this.i18n.cloneInstance();\r\n    this.i18n.addResourceBundle = (\r\n      lng: string,\r\n      ns: string,\r\n      resources: object,\r\n      deep?: boolean,\r\n      overwrite?: boolean\r\n    ) => this.addResourceBundleWithWarning(lng, ns, resources, deep, overwrite);\r\n  }\r\n\r\n  componentWillLoad() {\r\n    if (this.CspNonce) {\r\n      setNonce(this.CspNonce);\r\n    }\r\n    this.initAriaLive();\r\n    this.initFieldsToInclude();\r\n  }\r\n\r\n  public updateSearchConfiguration(\r\n    updatedProp: 'searchHub' | 'pipeline',\r\n    newValue: string | undefined\r\n  ) {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    if (this.engine.state[updatedProp] === newValue) {\r\n      return;\r\n    }\r\n\r\n    const {updateSearchConfiguration} = loadSearchConfigurationActions(\r\n      this.engine\r\n    );\r\n    this.engine.dispatch(\r\n      updateSearchConfiguration({\r\n        [updatedProp]: newValue,\r\n      })\r\n    );\r\n  }\r\n\r\n  @Watch('searchHub')\r\n  public updateSearchHub() {\r\n    this.updateSearchConfiguration('searchHub', this.searchHub ?? 'default');\r\n  }\r\n\r\n  @Watch('pipeline')\r\n  public updatePipeline() {\r\n    this.updateSearchConfiguration('pipeline', this.pipeline);\r\n  }\r\n\r\n  @Watch('analytics')\r\n  public toggleAnalytics() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    this.commonInterfaceHelper.onAnalyticsChange();\r\n  }\r\n\r\n  @Watch('language')\r\n  public updateLanguage() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    const {updateSearchConfiguration} = loadSearchConfigurationActions(\r\n      this.engine\r\n    );\r\n    this.engine.dispatch(\r\n      updateSearchConfiguration({\r\n        locale: this.language,\r\n      })\r\n    );\r\n    this.commonInterfaceHelper.onLanguageChange();\r\n  }\r\n\r\n  @Watch('iconAssetsPath')\r\n  public updateIconAssetsPath() {\r\n    this.store.set('iconAssetsPath', this.iconAssetsPath);\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    this.unsubscribeUrlManager();\r\n    this.unsubscribeSearchStatus();\r\n    window.removeEventListener('hashchange', this.onHashChange);\r\n  }\r\n\r\n  @Listen('atomic/initializeComponent')\r\n  public handleInitialization(event: InitializeEvent) {\r\n    this.commonInterfaceHelper.onComponentInitializing(event);\r\n  }\r\n\r\n  @Listen('atomic/scrollToTop')\r\n  public scrollToTop() {\r\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\r\n    if (!scrollContainerElement) {\r\n      this.bindings.engine.logger.warn(\r\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\r\n      );\r\n      return;\r\n    }\r\n\r\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\r\n  }\r\n\r\n  @Listen('atomic/relevanceInspector/close')\r\n  public closeRelevanceInspector() {\r\n    this.relevanceInspectorIsOpen = false;\r\n  }\r\n\r\n  /**\r\n   * Initializes the connection with the headless search engine using options for accessToken (required), organizationId (required), renewAccessToken, organizationEndpoints (recommended), and platformUrl (deprecated).\r\n   */\r\n  @Method() public initialize(options: InitializationOptions) {\r\n    return this.internalInitialization(() => this.initEngine(options));\r\n  }\r\n\r\n  /**\r\n   * Initializes the connection with an already preconfigured [headless search engine](https://docs.coveo.com/en/headless/latest/reference/search/), as opposed to the `initialize` method, which will internally create a new search engine instance.\r\n   * This bypasses the properties set on the component, such as analytics, searchHub, pipeline, language, timezone & logLevel.\r\n   */\r\n  @Method() public initializeWithSearchEngine(engine: SearchEngine) {\r\n    if (this.pipeline && this.pipeline !== engine.state.pipeline) {\r\n      console.warn(\r\n        mismatchedInterfaceAndEnginePropError('search', 'query pipeline')\r\n      );\r\n    }\r\n    if (this.searchHub && this.searchHub !== engine.state.searchHub) {\r\n      console.warn(\r\n        mismatchedInterfaceAndEnginePropError('search', 'search hub')\r\n      );\r\n    }\r\n    return this.internalInitialization(() => (this.engine = engine));\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Executes the first search and logs the interface load event to analytics, after initializing connection to the headless search engine.\r\n   */\r\n  @Method() public async executeFirstSearch() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    if (!this.initialized) {\r\n      console.error(\r\n        'You have to wait until the \"initialize\" promise is fulfilled before executing a search.',\r\n        this.host\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (this.localizationCompatibilityVersion !== 'v4') {\r\n      this.engine.logger.warn(\r\n        `As of Atomic version 3.0.0, support for JSON compatibility ${this.localizationCompatibilityVersion} will be deprecated. Please update the JSON compatibility to v4: <atomic-search-interface localization-compatibility-version=\"v4\" ...></atomic-search-interface> For more information, see i18next Migration Guide: https://www.i18next.com/misc/migration-guide#v20.x.x-to-v21.0.0.`\r\n      );\r\n    }\r\n\r\n    const safeStorage = new SafeStorage();\r\n    const standaloneSearchBoxData =\r\n      safeStorage.getParsedJSON<StandaloneSearchBoxData | null>(\r\n        StorageItems.STANDALONE_SEARCH_BOX_DATA,\r\n        null\r\n      );\r\n\r\n    if (!standaloneSearchBoxData) {\r\n      this.engine.executeFirstSearch();\r\n      return;\r\n    }\r\n\r\n    safeStorage.removeItem(StorageItems.STANDALONE_SEARCH_BOX_DATA);\r\n    const {updateQuery} = loadQueryActions(this.engine!);\r\n    const {value, enableQuerySyntax, analytics} = standaloneSearchBoxData;\r\n    this.engine!.dispatch(updateQuery({q: value, enableQuerySyntax}));\r\n    this.engine.executeFirstSearchAfterStandaloneSearchBoxRedirect(analytics);\r\n  }\r\n\r\n  /**\r\n   * Returns the unique, organization-specific endpoint(s).\r\n   * @param {string} organizationId\r\n   * @param {'prod'|'hipaa'|'staging'|'dev'} [env=Prod]\r\n   */\r\n  @Method() public async getOrganizationEndpoints(\r\n    organizationId: string,\r\n    env: PlatformEnvironment = 'prod'\r\n  ) {\r\n    return getOrganizationEndpointsHeadless(organizationId, env);\r\n  }\r\n\r\n  public get bindings(): Bindings {\r\n    return {\r\n      engine: this.engine!,\r\n      i18n: this.i18n,\r\n      store: this.store,\r\n      interfaceElement: this.host,\r\n      createStyleElement: () => {\r\n        const styleTag = document.createElement('style');\r\n        if (this.CspNonce) {\r\n          styleTag.setAttribute('nonce', this.CspNonce);\r\n        }\r\n        return styleTag;\r\n      },\r\n      createScriptElement: () => {\r\n        const styleTag = document.createElement('script');\r\n        if (this.CspNonce) {\r\n          styleTag.setAttribute('nonce', this.CspNonce);\r\n        }\r\n        return styleTag;\r\n      },\r\n    };\r\n  }\r\n\r\n  private initFieldsToInclude() {\r\n    const fields = EcommerceDefaultFieldsToInclude.concat(this.fieldsToInclude);\r\n    this.store.addFieldsToInclude(fields);\r\n  }\r\n\r\n  public registerFieldsToInclude() {\r\n    this.engine?.dispatch(\r\n      loadFieldActions(this.engine!).registerFieldsToInclude(\r\n        this.store.state.fieldsToInclude\r\n      )\r\n    );\r\n  }\r\n\r\n  private updateMobileBreakpoint() {\r\n    const breakpoint = this.host.querySelector(\r\n      'atomic-search-layout'\r\n    )?.mobileBreakpoint;\r\n    if (breakpoint) {\r\n      this.store.set('mobileBreakpoint', breakpoint);\r\n    }\r\n  }\r\n\r\n  private initEngine(options: InitializationOptions) {\r\n    const searchConfig = this.getSearchConfiguration(options);\r\n    const analyticsConfig = getAnalyticsConfig(\r\n      options,\r\n      this.analytics,\r\n      this.store\r\n    );\r\n    try {\r\n      this.engine = buildSearchEngine({\r\n        configuration: {\r\n          ...options,\r\n          search: searchConfig,\r\n          analytics: analyticsConfig,\r\n        },\r\n        loggerOptions: {\r\n          level: this.logLevel,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      this.error = error as Error;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private getSearchConfiguration(options: InitializationOptions) {\r\n    const searchConfigFromProps = {\r\n      searchHub: this.searchHub ?? 'default',\r\n      pipeline: this.pipeline,\r\n      locale: this.language,\r\n      timezone: this.timezone,\r\n    };\r\n\r\n    if (options.search) {\r\n      return {\r\n        ...searchConfigFromProps,\r\n        ...options.search,\r\n      };\r\n    }\r\n\r\n    return searchConfigFromProps;\r\n  }\r\n\r\n  private get fragment() {\r\n    return window.location.hash.slice(1);\r\n  }\r\n\r\n  private initUrlManager() {\r\n    if (!this.reflectStateInUrl) {\r\n      return;\r\n    }\r\n\r\n    this.urlManager = buildUrlManager(this.engine!, {\r\n      initialState: {fragment: this.fragment},\r\n    });\r\n\r\n    this.unsubscribeUrlManager = this.urlManager.subscribe(() =>\r\n      this.updateHash()\r\n    );\r\n\r\n    window.addEventListener('hashchange', this.onHashChange);\r\n  }\r\n\r\n  private initAriaLive() {\r\n    if (\r\n      Array.from(this.host.children).some(\r\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\r\n      )\r\n    ) {\r\n      return;\r\n    }\r\n    this.host.prepend(document.createElement('atomic-aria-live'));\r\n  }\r\n\r\n  private initRelevanceInspector() {\r\n    if (this.enableRelevanceInspector) {\r\n      this.host.addEventListener('dblclick', (e) => {\r\n        if (e.altKey) {\r\n          this.relevanceInspectorIsOpen = !this.relevanceInspectorIsOpen;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private initSearchStatus() {\r\n    this.searchStatus = buildSearchStatus(this.engine!);\r\n    this.unsubscribeSearchStatus = this.searchStatus.subscribe(() => {\r\n      const hasNoResultsAfterInitialSearch =\r\n        !this.searchStatus.state.hasResults &&\r\n        this.searchStatus.state.firstSearchExecuted &&\r\n        !this.searchStatus.state.hasError;\r\n\r\n      this.host.classList.toggle(\r\n        'atomic-search-interface-no-results',\r\n        hasNoResultsAfterInitialSearch\r\n      );\r\n\r\n      this.host.classList.toggle(\r\n        'atomic-search-interface-error',\r\n        this.searchStatus.state.hasError\r\n      );\r\n\r\n      this.host.classList.toggle(\r\n        'atomic-search-interface-search-executed',\r\n        this.searchStatus.state.firstSearchExecuted\r\n      );\r\n\r\n      if (\r\n        this.searchStatus.state.firstSearchExecuted &&\r\n        this.store.hasLoadingFlag(FirstSearchExecutedFlag)\r\n      ) {\r\n        this.store.unsetLoadingFlag(FirstSearchExecutedFlag);\r\n      }\r\n    });\r\n  }\r\n\r\n  private updateHash() {\r\n    const newFragment = this.urlManager.state.fragment;\r\n\r\n    if (!this.searchStatus.state.firstSearchExecuted) {\r\n      history.replaceState(null, document.title, `#${newFragment}`);\r\n      this.bindings.engine.logger.info(`History replaceState #${newFragment}`);\r\n\r\n      return;\r\n    }\r\n\r\n    history.pushState(null, document.title, `#${newFragment}`);\r\n    this.bindings.engine.logger.info(`History pushState #${newFragment}`);\r\n  }\r\n\r\n  private onHashChange = () => {\r\n    this.urlManager.synchronize(this.fragment);\r\n  };\r\n\r\n  private async internalInitialization(initEngine: () => void) {\r\n    await this.commonInterfaceHelper.onInitialization(initEngine);\r\n    this.pipeline = this.engine!.state.pipeline;\r\n    this.searchHub = this.engine!.state.searchHub;\r\n    this.initSearchStatus();\r\n    this.initUrlManager();\r\n    this.initialized = true;\r\n  }\r\n\r\n  private addResourceBundleWithWarning(\r\n    lng: string,\r\n    ns: string,\r\n    resources: object,\r\n    deep?: boolean,\r\n    overwrite?: boolean\r\n  ) {\r\n    const hasV3Keys = Object.keys(resources).some((k) => k.includes('_plural'));\r\n    if (hasV3Keys && ns === 'translation') {\r\n      this.engine &&\r\n        this.engine.logger.warn(\r\n          `Translation keys using the v3 JSON compatibility format have been detected. As of Atomic version 3.0.0, support for JSON compatibility ${this.localizationCompatibilityVersion} will be deprecated. Please update your translation JSON keys to v4 format: { my-key_other: 'My translations!' } For more information, see i18next Migration Guide: https://www.i18next.com/misc/migration-guide#v20.x.x-to-v21.0.0.`\r\n        );\r\n    }\r\n    return this.i18nClone.addResourceBundle(\r\n      lng,\r\n      ns,\r\n      resources,\r\n      deep,\r\n      overwrite\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    return [\r\n      this.engine && this.enableRelevanceInspector && (\r\n        <atomic-relevance-inspector\r\n          open={this.relevanceInspectorIsOpen}\r\n          bindings={this.bindings}\r\n        ></atomic-relevance-inspector>\r\n      ),\r\n      <slot></slot>,\r\n    ];\r\n  }\r\n}\r\n"],"mappings":"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"}