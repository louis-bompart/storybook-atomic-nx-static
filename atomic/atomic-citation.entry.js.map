{"file":"atomic-citation.entry.esm.js","mappings":"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","names":[],"sources":["src/components/common/generated-answer/atomic-citation/atomic-citation.pcss?tag=atomic-citation","src/components/common/generated-answer/atomic-citation/atomic-citation.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\r\n@import '../../../../global/mixins.pcss';\r\n\r\n[part='citation'] {\r\n  --height: 2.2em;\r\n  --index-height: 1.1em;\r\n  --max-citation-width: 400px;\r\n\r\n  max-width: var(--max-citation-width);\r\n  height: var(--height);\r\n}\r\n\r\n[part='citation-index'] {\r\n  height: var(--index-height);\r\n  width: var(--index-height);\r\n}\r\n\r\n[part='citation-popover'] {\r\n  --popover-width: 350px;\r\n\r\n  width: var(--popover-width);\r\n\r\n  p {\r\n    @mixin set-font-size var(--atomic-text-sm);\r\n  }\r\n}\r\n","import {GeneratedAnswerCitation, InteractiveCitation} from '@coveo/headless';\r\nimport {\r\n  createPopper,\r\n  preventOverflow,\r\n  Instance as PopperInstance,\r\n} from '@popperjs/core';\r\nimport {Component, h, State, Prop, Element, Watch} from '@stencil/core';\r\nimport {Heading} from '../../heading';\r\nimport {LinkWithItemAnalytics} from '../../item-link/item-link';\r\n\r\n/**\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-citation',\r\n  styleUrl: 'atomic-citation.pcss',\r\n})\r\nexport class AtomicCitation {\r\n  @Element() public host!: HTMLElement;\r\n\r\n  /**\r\n   * The citation item information.\r\n   */\r\n  @Prop() citation!: GeneratedAnswerCitation;\r\n  /**\r\n   * The citation index.\r\n   */\r\n  @Prop() index!: number;\r\n  /**\r\n   * Callback function invoked when the user stops hovering over a citation. `citationHoverTimeMs` is the amount of time over which the citation has been hovered.\r\n   */\r\n  @Prop() sendHoverEndEvent!: (citationHoverTimeMs: number) => void;\r\n  /**\r\n   * An `InteractiveCitation` controller instance. It is used when the user interacts with the citation by selecting or hovering over it.\r\n   */\r\n  @Prop() interactiveCitation!: InteractiveCitation;\r\n\r\n  @State() public isOpen = false;\r\n\r\n  private citationRef!: HTMLElement;\r\n  private popupRef!: HTMLElement;\r\n  private popperInstance?: PopperInstance;\r\n  private stopPropagation?: boolean;\r\n\r\n  private hoverStart?: number;\r\n  private hoverAnalyticsTimeout = 1000;\r\n\r\n  private hoverTimeout?: ReturnType<typeof setTimeout>;\r\n  private hoverDebounceTimeoutMs = 200;\r\n\r\n  @Watch('isOpen')\r\n  sendHoverAnalytics() {\r\n    if (this.isOpen) {\r\n      this.hoverStart = new Date().getTime();\r\n      return;\r\n    }\r\n    if (!this.hoverStart) {\r\n      return;\r\n    }\r\n    const difference = new Date().getTime() - this.hoverStart;\r\n    if (difference > this.hoverAnalyticsTimeout) {\r\n      this.sendHoverEndEvent(difference);\r\n    }\r\n    this.hoverStart = undefined;\r\n  }\r\n\r\n  public componentDidRender() {\r\n    if (this.popperInstance || !this.citationRef || !this.popupRef) {\r\n      return;\r\n    }\r\n\r\n    this.popperInstance = createPopper(this.citationRef, this.popupRef, {\r\n      placement: 'top-start',\r\n      modifiers: [\r\n        {\r\n          name: 'offset',\r\n          options: {\r\n            offset: [0, 6],\r\n          },\r\n        },\r\n        preventOverflow,\r\n      ],\r\n    });\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    this.popperInstance?.forceUpdate();\r\n  }\r\n\r\n  private getTruncatedText() {\r\n    return (\r\n      this.citation.text &&\r\n      `${this.citation.text?.trim().slice(0, 200)}${\r\n        this.citation.text.length > 200 ? '...' : ''\r\n      }`\r\n    );\r\n  }\r\n\r\n  private openPopover = () => {\r\n    this.isOpen = true;\r\n  };\r\n\r\n  private closePopover = () => {\r\n    clearTimeout(this.hoverTimeout);\r\n    this.isOpen = false;\r\n  };\r\n\r\n  private delayedPopoverOpen = () => {\r\n    clearTimeout(this.hoverTimeout);\r\n    this.hoverTimeout = setTimeout(\r\n      this.openPopover,\r\n      this.hoverDebounceTimeoutMs\r\n    );\r\n  };\r\n\r\n  private renderPopover() {\r\n    return (\r\n      <div\r\n        part=\"citation-popover\"\r\n        class={`rounded-md border border-neutral p-4 shadow z-10 bg-background ${\r\n          this.isOpen ? 'desktop-only:flex' : 'hidden'\r\n        } flex-col gap-3 mobile-only:hidden`}\r\n        ref={(el) => (this.popupRef = el!)}\r\n        role=\"dialog\"\r\n      >\r\n        <div class=\"truncate text-neutral-dark text-sm\">\r\n          {this.citation.uri}\r\n        </div>\r\n        <Heading level={0} class=\"font-bold text-md\">\r\n          {this.citation.title}\r\n        </Heading>\r\n        <p class=\"text-on-background text-sm\">{this.getTruncatedText()}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div class=\"relative\">\r\n        <LinkWithItemAnalytics\r\n          href={this.citation.clickUri ?? this.citation.uri}\r\n          ref={(el) => (this.citationRef = el!)}\r\n          part=\"citation\"\r\n          target=\"_blank\"\r\n          rel=\"noopener\"\r\n          aria-haspopup=\"dialog\"\r\n          className=\"flex items-center p-1 bg-background btn-outline-primary border rounded-full border-neutral text-on-background\"\r\n          onSelect={() => this.interactiveCitation.select()}\r\n          onBeginDelayedSelect={() =>\r\n            this.interactiveCitation.beginDelayedSelect()\r\n          }\r\n          onCancelPendingSelect={() =>\r\n            this.interactiveCitation.cancelPendingSelect()\r\n          }\r\n          stopPropagation={this.stopPropagation}\r\n          onMouseLeave={this.closePopover}\r\n          onMouseOver={this.delayedPopoverOpen}\r\n          onFocus={this.openPopover}\r\n          onBlur={this.closePopover}\r\n        >\r\n          <div\r\n            part=\"citation-index\"\r\n            class=\"rounded-full font-medium flex items-center text-bg-primary shrink-0\"\r\n          >\r\n            <div class=\"mx-auto\">{this.index + 1}</div>\r\n          </div>\r\n          <span class=\"citation-title truncate mx-1\">\r\n            {this.citation.title}\r\n          </span>\r\n        </LinkWithItemAnalytics>\r\n        {this.renderPopover()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}