{"file":"atomic-commerce-facet.entry.esm.js","mappings":"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","names":[],"sources":["src/components/commerce/facets/atomic-commerce-facet/atomic-commerce-facet.pcss?tag=atomic-commerce-facet&encapsulation=shadow","src/components/commerce/facets/atomic-commerce-facet/atomic-commerce-facet.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\r\n@import '../../../common/facets/facet-search/facet-search.pcss';\r\n@import '../../../common/facets/facet-common.pcss';\r\n@import '../../../common/facets/facet-value-checkbox/facet-value-checkbox.pcss';\r\n@import '../../../common/facets/facet-value-exclude/facet-value-exclude.pcss';\r\n@import '../../../common/facets/facet-value-box/facet-value-box.pcss';\r\n","import {\r\n  RegularFacet,\r\n  RegularFacetState,\r\n  buildListingSummary,\r\n  buildSearchSummary,\r\n  SearchSummary,\r\n  ListingSummary,\r\n} from '@coveo/headless/commerce';\r\nimport {\r\n  Component,\r\n  h,\r\n  State,\r\n  Prop,\r\n  Element,\r\n  VNode,\r\n  Fragment,\r\n} from '@stencil/core';\r\nimport {\r\n  AriaLiveRegion,\r\n  FocusTargetController,\r\n} from '../../../../utils/accessibility-utils';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {FacetInfo} from '../../../common/facets/facet-common-store';\r\nimport {FacetContainer} from '../../../common/facets/facet-container/facet-container';\r\nimport {FacetGuard} from '../../../common/facets/facet-guard';\r\nimport {FacetHeader} from '../../../common/facets/facet-header/facet-header';\r\nimport {FacetPlaceholder} from '../../../common/facets/facet-placeholder/facet-placeholder';\r\nimport {announceFacetSearchResultsWithAriaLive} from '../../../common/facets/facet-search/facet-search-aria-live';\r\nimport {FacetSearchInput} from '../../../common/facets/facet-search/facet-search-input';\r\nimport {FacetSearchInputGuard} from '../../../common/facets/facet-search/facet-search-input-guard';\r\nimport {FacetSearchMatches} from '../../../common/facets/facet-search/facet-search-matches';\r\nimport {\r\n  shouldDisplaySearchResults,\r\n  shouldUpdateFacetSearchComponent,\r\n} from '../../../common/facets/facet-search/facet-search-utils';\r\nimport {FacetSearchValue} from '../../../common/facets/facet-search/facet-search-value';\r\nimport {FacetShowMoreLess} from '../../../common/facets/facet-show-more-less/facet-show-more-less';\r\nimport {\r\n  FacetValueProps,\r\n  FacetValue,\r\n} from '../../../common/facets/facet-value/facet-value';\r\nimport {FacetValuesGroup} from '../../../common/facets/facet-values-group/facet-values-group';\r\nimport {initializePopover} from '../../../search/facets/atomic-popover/popover-type';\r\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\r\n\r\n/**\r\n * The `atomic-commerce-facet` component renders a commerce facet that the end user can interact with to filter products.\r\n *\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-commerce-facet',\r\n  styleUrl: 'atomic-commerce-facet.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicCommerceFacet implements InitializableComponent<Bindings> {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  public summary!: SearchSummary | ListingSummary;\r\n  @Element() private host!: HTMLElement;\r\n\r\n  @Prop() public facet!: RegularFacet;\r\n\r\n  @BindStateToController('facet')\r\n  @State()\r\n  public facetState!: RegularFacetState;\r\n\r\n  @State() public error!: Error;\r\n\r\n  private isCollapsed = false;\r\n  private showLessFocus?: FocusTargetController;\r\n  private showMoreFocus?: FocusTargetController;\r\n  private headerFocus?: FocusTargetController;\r\n\r\n  @AriaLiveRegion('facet-search')\r\n  protected facetSearchAriaMessage!: string;\r\n\r\n  public initialize() {\r\n    this.initSummary();\r\n    this.initAriaLive();\r\n    this.initPopover();\r\n    this.registerFacet();\r\n  }\r\n\r\n  public componentShouldUpdate(\r\n    next: unknown,\r\n    prev: unknown,\r\n    propName: keyof AtomicCommerceFacet\r\n  ) {\r\n    if (\r\n      this.isFacetState(prev, propName) &&\r\n      this.isFacetState(next, propName)\r\n    ) {\r\n      return shouldUpdateFacetSearchComponent(\r\n        next.facetSearch,\r\n        prev.facetSearch\r\n      );\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public render() {\r\n    const {hasError, firstSearchExecuted} = this.summary.state;\r\n    return (\r\n      <FacetGuard\r\n        enabled={true}\r\n        hasError={hasError}\r\n        firstSearchExecuted={firstSearchExecuted}\r\n        hasResults={this.facetState.values.length > 0}\r\n      >\r\n        {firstSearchExecuted ? (\r\n          <FacetContainer>\r\n            <FacetHeader\r\n              i18n={this.bindings.i18n}\r\n              label={this.displayName}\r\n              onClearFilters={() => {\r\n                this.focusTargets.header.focusAfterSearch();\r\n                this.facet.deselectAll();\r\n              }}\r\n              numberOfActiveValues={this.activeValues.length}\r\n              isCollapsed={this.isCollapsed}\r\n              headingLevel={0}\r\n              onToggleCollapse={() => (this.isCollapsed = !this.isCollapsed)}\r\n              headerRef={(el) => this.focusTargets.header.setTarget(el)}\r\n            ></FacetHeader>\r\n            {this.renderBody()}\r\n          </FacetContainer>\r\n        ) : (\r\n          <FacetPlaceholder numberOfValues={8} isCollapsed={this.isCollapsed} />\r\n        )}\r\n      </FacetGuard>\r\n    );\r\n  }\r\n\r\n  private renderBody() {\r\n    if (this.isCollapsed) {\r\n      return;\r\n    }\r\n    return (\r\n      <Fragment>\r\n        <FacetSearchInputGuard\r\n          canShowMoreValues={this.facetState.canShowMoreValues}\r\n          numberOfDisplayedValues={this.facetState.values.length}\r\n          withSearch={true}\r\n        >\r\n          <FacetSearchInput\r\n            i18n={this.bindings.i18n}\r\n            label={this.displayName}\r\n            onChange={(value) => {\r\n              if (value === '') {\r\n                this.facet.facetSearch.clear();\r\n                return;\r\n              }\r\n              this.facet.facetSearch.updateText(value);\r\n              this.facet.facetSearch.search();\r\n            }}\r\n            onClear={() => this.facet.facetSearch.clear()}\r\n            query={this.facetState.facetSearch.query}\r\n          />\r\n        </FacetSearchInputGuard>\r\n        {shouldDisplaySearchResults(this.facetState.facetSearch)\r\n          ? [this.renderSearchResults(), this.renderMatches()]\r\n          : [this.renderValues(), this.renderShowMoreLess()]}\r\n      </Fragment>\r\n    );\r\n  }\r\n\r\n  private renderValuesContainer(children: VNode[], query?: string) {\r\n    return (\r\n      <FacetValuesGroup\r\n        i18n={this.bindings.i18n}\r\n        label={this.displayName}\r\n        query={query}\r\n      >\r\n        <ul part=\"values\">{children}</ul>\r\n      </FacetValuesGroup>\r\n    );\r\n  }\r\n\r\n  private renderSearchResults() {\r\n    return this.renderValuesContainer(\r\n      this.facet.state.facetSearch.values.map((value) => (\r\n        <FacetSearchValue\r\n          {...this.facetValueProps}\r\n          facetCount={value.count}\r\n          onExclude={() => this.facet.facetSearch.exclude(value)}\r\n          onSelect={() => this.facet.facetSearch.select(value)}\r\n          facetValue={value.rawValue}\r\n        />\r\n      ))\r\n    );\r\n  }\r\n\r\n  private renderValues() {\r\n    return this.renderValuesContainer(\r\n      this.facet.state.values.map((value, i) => {\r\n        const shouldFocusOnShowLessAfterInteraction = i === 0;\r\n        const shouldFocusOnShowMoreAfterInteraction = i === 0;\r\n\r\n        return (\r\n          <FacetValue\r\n            {...this.facetValueProps}\r\n            facetCount={value.numberOfResults}\r\n            onExclude={() => this.facet.toggleExclude(value)}\r\n            onSelect={() => this.facet.toggleSelect(value)}\r\n            facetValue={value.value}\r\n            facetState={value.state}\r\n            setRef={(btn) => {\r\n              if (shouldFocusOnShowLessAfterInteraction) {\r\n                this.showLessFocus?.setTarget(btn);\r\n              }\r\n              if (shouldFocusOnShowMoreAfterInteraction) {\r\n                this.showMoreFocus?.setTarget(btn);\r\n              }\r\n            }}\r\n          />\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private renderShowMoreLess() {\r\n    return (\r\n      <FacetShowMoreLess\r\n        label={this.displayName}\r\n        i18n={this.bindings.i18n}\r\n        onShowMore={() => {\r\n          this.focusTargets.showMore.focusAfterSearch();\r\n          this.facet.showMoreValues();\r\n        }}\r\n        onShowLess={() => {\r\n          this.focusTargets.showLess.focusAfterSearch();\r\n          this.facet.showLessValues();\r\n        }}\r\n        canShowMoreValues={this.facet.state.canShowMoreValues}\r\n        canShowLessValues={this.facet.state.canShowLessValues}\r\n      ></FacetShowMoreLess>\r\n    );\r\n  }\r\n\r\n  private renderMatches() {\r\n    return (\r\n      <FacetSearchMatches\r\n        i18n={this.bindings.i18n}\r\n        query={this.facet.state.facetSearch.query}\r\n        numberOfMatches={this.facet.state.facetSearch.values.length}\r\n        hasMoreMatches={this.facet.state.facetSearch.moreValuesAvailable}\r\n      ></FacetSearchMatches>\r\n    );\r\n  }\r\n\r\n  private get activeValues() {\r\n    return this.facet.state.values.filter(({state}) => state !== 'idle');\r\n  }\r\n\r\n  private get displayName() {\r\n    return this.facet.state.displayName || 'no-label';\r\n  }\r\n\r\n  private get facetValueProps(): Pick<\r\n    FacetValueProps,\r\n    | 'facetSearchQuery'\r\n    | 'enableExclusion'\r\n    | 'field'\r\n    | 'i18n'\r\n    | 'displayValuesAs'\r\n  > {\r\n    return {\r\n      facetSearchQuery: this.facetState.facetSearch.query,\r\n      displayValuesAs: 'checkbox',\r\n      enableExclusion: false,\r\n      field: this.facetState.field,\r\n      i18n: this.bindings.i18n,\r\n    };\r\n  }\r\n\r\n  private get isHidden() {\r\n    return !this.facetState.values.length;\r\n  }\r\n\r\n  private registerFacet() {\r\n    this.bindings.store.registerFacet('facets', this.facetInfo);\r\n  }\r\n\r\n  private initPopover() {\r\n    initializePopover(this.host, {\r\n      ...this.facetInfo,\r\n      hasValues: () => !!this.facet.state.values.length,\r\n      numberOfActiveValues: () => this.activeValues.length,\r\n    });\r\n  }\r\n\r\n  private initSummary() {\r\n    if (this.bindings.interfaceElement.type === 'product-listing') {\r\n      this.summary = buildListingSummary(this.bindings.engine);\r\n    } else {\r\n      this.summary = buildSearchSummary(this.bindings.engine);\r\n    }\r\n  }\r\n\r\n  private initAriaLive() {\r\n    announceFacetSearchResultsWithAriaLive(\r\n      this.facet,\r\n      this.displayName,\r\n      (msg) => (this.facetSearchAriaMessage = msg),\r\n      this.bindings.i18n\r\n    );\r\n  }\r\n\r\n  private get facetInfo(): FacetInfo {\r\n    return {\r\n      label: () => this.bindings.i18n.t(this.displayName),\r\n      facetId: this.facet.state.facetId,\r\n      element: this.host,\r\n      isHidden: () => this.isHidden,\r\n    };\r\n  }\r\n\r\n  private get focusTargets(): {\r\n    showLess: FocusTargetController;\r\n    showMore: FocusTargetController;\r\n    header: FocusTargetController;\r\n  } {\r\n    if (!this.showLessFocus) {\r\n      this.showLessFocus = new FocusTargetController(this);\r\n    }\r\n    if (!this.showMoreFocus) {\r\n      this.showMoreFocus = new FocusTargetController(this);\r\n    }\r\n    if (!this.headerFocus) {\r\n      this.headerFocus = new FocusTargetController(this);\r\n    }\r\n\r\n    return {\r\n      showLess: this.showLessFocus,\r\n      showMore: this.showMoreFocus,\r\n      header: this.headerFocus,\r\n    };\r\n  }\r\n\r\n  private isFacetState(\r\n    state: unknown,\r\n    propName: string\r\n  ): state is RegularFacetState {\r\n    return (\r\n      propName === 'facetState' &&\r\n      typeof (state as RegularFacetState)?.facetId === 'string'\r\n    );\r\n  }\r\n}\r\n"],"version":3}