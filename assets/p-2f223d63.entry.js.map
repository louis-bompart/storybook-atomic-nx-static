{"version":3,"names":["atomicResultsPerPageCss","AtomicResultsPerPageStyle0","AtomicResultsPerPage","this","radioGroupName","randomID","choicesDisplayed","initialize","choices","validateChoicesDisplayed","validateInitialChoice","searchStatus","buildSearchStatus","bindings","engine","resultPerPage","buildResultsPerPage","initialState","numberOfResults","initialChoice","split","map","choice","parsedChoice","parseInt","isNaN","errorMsg","logger","error","Error","includes","buildChoice","isSelected","isSetTo","parts","push","text","toLocaleString","i18n","language","h","RadioButton","key","groupName","style","checked","ariaLabel","onChecked","focusOnProperResultDependingOnChoice","set","class","part","join","resultPerPageState","_a","store","state","resultList","focusOnFirstResultAfterNextSearch","then","scrollToTopEvent","emit","_b","focusOnNextNewResult","render","isAppLoaded","searchStatusState","hasResults","label","t","FieldsetGroup","role","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/atomic-results-per-page/atomic-results-per-page.pcss?tag=atomic-results-per-page&encapsulation=shadow","src/components/search/atomic-results-per-page/atomic-results-per-page.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\r\n\r\n.btn-page {\r\n  @apply w-10 h-10;\r\n}\r\n","import {\r\n  ResultsPerPage,\r\n  buildResultsPerPage,\r\n  ResultsPerPageState,\r\n  buildSearchStatus,\r\n  SearchStatus,\r\n  SearchStatusState,\r\n} from '@coveo/headless';\r\nimport {Component, Event, EventEmitter, h, Prop, State} from '@stencil/core';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../utils/initialization-utils';\r\nimport {randomID} from '../../../utils/utils';\r\nimport {FieldsetGroup} from '../../common/fieldset-group';\r\nimport {RadioButton} from '../../common/radio-button';\r\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\r\n\r\n/**\r\n * The `atomic-results-per-page` component determines how many results to display per page.\r\n *\r\n * @part label - The \"Results per page\" label.\r\n * @part buttons - The list of buttons.\r\n * @part button - The result per page button.\r\n * @part active-button - The active result per page button.\r\n */\r\n@Component({\r\n  tag: 'atomic-results-per-page',\r\n  styleUrl: 'atomic-results-per-page.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicResultsPerPage implements InitializableComponent {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  private resultPerPage!: ResultsPerPage;\r\n  public searchStatus!: SearchStatus;\r\n  private choices!: number[];\r\n  private readonly radioGroupName = randomID('atomic-results-per-page-');\r\n\r\n  @State()\r\n  @BindStateToController('resultPerPage')\r\n  public resultPerPageState!: ResultsPerPageState;\r\n  @BindStateToController('searchStatus')\r\n  @State()\r\n  private searchStatusState!: SearchStatusState;\r\n  @State() public error!: Error;\r\n\r\n  /**\r\n   * A list of choices for the number of results to display per page, separated by commas.\r\n   */\r\n  @Prop({reflect: true}) choicesDisplayed = '10,25,50,100';\r\n  /**\r\n   * The initial selection for the number of result per page. This should be part of the `choicesDisplayed` option. By default, this is set to the first value in `choicesDisplayed`.\r\n   */\r\n  @Prop({mutable: true, reflect: true}) initialChoice?: number;\r\n\r\n  @Event({\r\n    eventName: 'atomic/scrollToTop',\r\n  })\r\n  private scrollToTopEvent!: EventEmitter;\r\n\r\n  public initialize() {\r\n    this.choices = this.validateChoicesDisplayed();\r\n    this.validateInitialChoice();\r\n\r\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\r\n    this.resultPerPage = buildResultsPerPage(this.bindings.engine, {\r\n      initialState: {numberOfResults: this.initialChoice},\r\n    });\r\n  }\r\n\r\n  private validateChoicesDisplayed() {\r\n    return this.choicesDisplayed.split(',').map((choice) => {\r\n      const parsedChoice = parseInt(choice);\r\n      if (isNaN(parsedChoice)) {\r\n        const errorMsg = `The choice value \"${choice}\" from the \"choicesDisplayed\" option is not a number.`;\r\n        this.bindings.engine.logger.error(errorMsg, this);\r\n        throw new Error(errorMsg);\r\n      }\r\n\r\n      return parsedChoice;\r\n    });\r\n  }\r\n\r\n  private validateInitialChoice() {\r\n    if (!this.initialChoice) {\r\n      this.initialChoice = this.choices[0];\r\n      return;\r\n    }\r\n    if (!this.choices.includes(this.initialChoice)) {\r\n      const errorMsg = `The \"initialChoice\" option value \"${this.initialChoice}\" is not included in the \"choicesDisplayed\" option \"${this.choicesDisplayed}\".`;\r\n      this.bindings.engine.logger.error(errorMsg, this);\r\n      throw new Error(errorMsg);\r\n    }\r\n  }\r\n\r\n  private buildChoice(choice: number) {\r\n    const isSelected = this.resultPerPage.isSetTo(choice);\r\n    const parts = ['button'];\r\n    if (isSelected) {\r\n      parts.push('active-button');\r\n    }\r\n    const text = choice.toLocaleString(this.bindings.i18n.language);\r\n\r\n    return (\r\n      <RadioButton\r\n        key={choice}\r\n        groupName={this.radioGroupName}\r\n        style=\"outline-neutral\"\r\n        checked={isSelected}\r\n        ariaLabel={text}\r\n        onChecked={() => {\r\n          this.focusOnProperResultDependingOnChoice(choice);\r\n          this.resultPerPage.set(choice);\r\n        }}\r\n        class=\"btn-page focus-visible:bg-neutral-light\"\r\n        part={parts.join(' ')}\r\n        text={text}\r\n      ></RadioButton>\r\n    );\r\n  }\r\n\r\n  private focusOnProperResultDependingOnChoice(choice: number) {\r\n    if (choice < this.resultPerPageState.numberOfResults) {\r\n      this.bindings.store.state.resultList\r\n        ?.focusOnFirstResultAfterNextSearch()\r\n        .then(() => this.scrollToTopEvent.emit());\r\n    } else if (choice > this.resultPerPageState.numberOfResults) {\r\n      this.bindings.store.state.resultList?.focusOnNextNewResult();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    if (\r\n      !this.bindings.store.isAppLoaded() ||\r\n      !this.searchStatusState.hasResults\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const label = this.bindings.i18n.t('results-per-page');\r\n\r\n    return (\r\n      <div class=\"flex items-center\">\r\n        <span\r\n          part=\"label\"\r\n          class=\"self-start text-on-background text-lg mr-3 leading-10\"\r\n          aria-hidden=\"true\"\r\n        >\r\n          {label}\r\n        </span>\r\n        <FieldsetGroup label={label}>\r\n          <div\r\n            part=\"buttons\"\r\n            role=\"radiogroup\"\r\n            aria-label={this.bindings.i18n.t('results-per-page')}\r\n            class=\"flex flex-wrap gap-2\"\r\n          >\r\n            {this.choices.map((choice) => this.buildChoice(choice))}\r\n          </div>\r\n        </FieldsetGroup>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"+UAAA,MAAMA,EAA0B,6guCAChC,MAAAC,EAAeD,E,iXC+BFE,EAAoB,M,8EAKdC,KAAAC,eAAiBC,EAAS,4BAapBF,KAAAG,iBAAmB,e,8GAAA,e,6BAWnC,UAAAC,GACLJ,KAAKK,QAAUL,KAAKM,2BACpBN,KAAKO,wBAELP,KAAKQ,aAAeC,EAAkBT,KAAKU,SAASC,QACpDX,KAAKY,cAAgBC,EAAoBb,KAAKU,SAASC,OAAQ,CAC7DG,aAAc,CAACC,gBAAiBf,KAAKgB,gB,CAIjC,wBAAAV,GACN,OAAON,KAAKG,iBAAiBc,MAAM,KAAKC,KAAKC,IAC3C,MAAMC,EAAeC,SAASF,GAC9B,GAAIG,MAAMF,GAAe,CACvB,MAAMG,EAAW,qBAAqBJ,yDACtCnB,KAAKU,SAASC,OAAOa,OAAOC,MAAMF,EAAUvB,MAC5C,MAAM,IAAI0B,MAAMH,E,CAGlB,OAAOH,CAAY,G,CAIf,qBAAAb,GACN,IAAKP,KAAKgB,cAAe,CACvBhB,KAAKgB,cAAgBhB,KAAKK,QAAQ,GAClC,M,CAEF,IAAKL,KAAKK,QAAQsB,SAAS3B,KAAKgB,eAAgB,CAC9C,MAAMO,EAAW,qCAAqCvB,KAAKgB,oEAAoEhB,KAAKG,qBACpIH,KAAKU,SAASC,OAAOa,OAAOC,MAAMF,EAAUvB,MAC5C,MAAM,IAAI0B,MAAMH,E,EAIZ,WAAAK,CAAYT,GAClB,MAAMU,EAAa7B,KAAKY,cAAckB,QAAQX,GAC9C,MAAMY,EAAQ,CAAC,UACf,GAAIF,EAAY,CACdE,EAAMC,KAAK,gB,CAEb,MAAMC,EAAOd,EAAOe,eAAelC,KAAKU,SAASyB,KAAKC,UAEtD,OACEC,EAACC,EAAW,CACVC,IAAKpB,EACLqB,UAAWxC,KAAKC,eAChBwC,MAAM,kBACNC,QAASb,EACTc,UAAWV,EACXW,UAAW,KACT5C,KAAK6C,qCAAqC1B,GAC1CnB,KAAKY,cAAckC,IAAI3B,EAAO,EAEhC4B,MAAM,0CACNC,KAAMjB,EAAMkB,KAAK,KACjBhB,KAAMA,G,CAKJ,oCAAAY,CAAqC1B,G,QAC3C,GAAIA,EAASnB,KAAKkD,mBAAmBnC,gBAAiB,EACpDoC,EAAAnD,KAAKU,SAAS0C,MAAMC,MAAMC,cAAU,MAAAH,SAAA,SAAAA,EAChCI,oCACDC,MAAK,IAAMxD,KAAKyD,iBAAiBC,Q,MAC/B,GAAIvC,EAASnB,KAAKkD,mBAAmBnC,gBAAiB,EAC3D4C,EAAA3D,KAAKU,SAAS0C,MAAMC,MAAMC,cAAU,MAAAK,SAAA,SAAAA,EAAEC,sB,EAInC,MAAAC,GACL,IACG7D,KAAKU,SAAS0C,MAAMU,gBACpB9D,KAAK+D,kBAAkBC,WACxB,CACA,M,CAGF,MAAMC,EAAQjE,KAAKU,SAASyB,KAAK+B,EAAE,oBAEnC,OACE7B,EAAA,OAAKU,MAAM,qBACTV,EAAA,QACEW,KAAK,QACLD,MAAM,wDAAuD,cACjD,QAEXkB,GAEH5B,EAAC8B,EAAa,CAACF,MAAOA,GACpB5B,EAAA,OACEW,KAAK,UACLoB,KAAK,aAAY,aACLpE,KAAKU,SAASyB,KAAK+B,EAAE,oBACjCnB,MAAM,wBAEL/C,KAAKK,QAAQa,KAAKC,GAAWnB,KAAK4B,YAAYT,O,GA7H5BkD,EAAA,CAA5BC,K,+BAQMD,EAAA,CADNE,EAAsB,kB,yCAIfF,EAAA,CAFPE,EAAsB,iB"}