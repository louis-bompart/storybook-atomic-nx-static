{"version":3,"names":["augmentWithExternalMiddleware","event","payload","config","_a","analytics","analyticsClientMiddleware","augmentAnalyticsWithAtomicVersion","customData","coveoAtomicVersion","getAtomicEnvironment","version","augmentAnalyticsConfigWithDocument","documentLocation","document","location","href","referrer","originLevel3","versionMatcher","augmentAnalyticsConfigWithAtomicVersion","source","exec","getNextAnalyticsConfig","searchEngineConfig","enabled","defaultConfiguration"],"sources":["src/components/common/interface/analytics-config.ts"],"sourcesContent":["import {\n  SearchEngineConfiguration,\n  AnalyticsConfiguration,\n  EngineConfiguration,\n} from '@coveo/headless';\nimport {AnalyticsClientSendEventHook} from '@coveo/headless';\nimport {getAtomicEnvironment} from '../../../global/environment';\nimport {InsightEngineConfiguration} from '../../insight';\nimport {RecommendationEngineConfiguration} from '../../recommendations';\n\nexport type AnalyticsPayload = Parameters<AnalyticsClientSendEventHook>[1];\n\nexport function augmentWithExternalMiddleware(\n  event: string,\n  payload: AnalyticsPayload,\n  config:\n    | InsightEngineConfiguration\n    | SearchEngineConfiguration\n    | RecommendationEngineConfiguration\n) {\n  if (config.analytics?.analyticsClientMiddleware) {\n    return config.analytics.analyticsClientMiddleware(event, payload);\n  }\n  return payload;\n}\n\nexport function augmentAnalyticsWithAtomicVersion(payload: AnalyticsPayload) {\n  if (payload.customData) {\n    payload.customData.coveoAtomicVersion = getAtomicEnvironment().version;\n  }\n  return payload;\n}\n\nexport function augmentAnalyticsConfigWithDocument(): AnalyticsConfiguration {\n  return {\n    documentLocation: document.location.href,\n    ...(document.referrer && {originLevel3: document.referrer}),\n  };\n}\n\nconst versionMatcher = /^(\\d+\\.\\d+\\.\\d+)/;\n\nexport function augmentAnalyticsConfigWithAtomicVersion(): Required<\n  Pick<AnalyticsConfiguration, 'source'>\n> {\n  return {\n    source: {\n      '@coveo/atomic':\n        versionMatcher.exec(getAtomicEnvironment().version)?.[0] || '0.0.0',\n    },\n  };\n}\n\nexport function getNextAnalyticsConfig(\n  searchEngineConfig: EngineConfiguration,\n  enabled: boolean\n): AnalyticsConfiguration {\n  const defaultConfiguration: AnalyticsConfiguration = {\n    enabled,\n    documentLocation: document.location.href,\n    ...(document.referrer && {originLevel3: document.referrer}),\n  };\n\n  if (searchEngineConfig.analytics) {\n    return {\n      ...defaultConfiguration,\n      ...searchEngineConfig.analytics,\n    };\n  }\n  return defaultConfiguration;\n}\n"],"mappings":"6CAYgBA,EACdC,EACAC,EACAC,G,MAKA,IAAIC,EAAAD,EAAOE,aAAS,MAAAD,SAAA,SAAAA,EAAEE,0BAA2B,CAC/C,OAAOH,EAAOE,UAAUC,0BAA0BL,EAAOC,E,CAE3D,OAAOA,CACT,C,SAEgBK,EAAkCL,GAChD,GAAIA,EAAQM,WAAY,CACtBN,EAAQM,WAAWC,mBAAqBC,IAAuBC,O,CAEjE,OAAOT,CACT,C,SAEgBU,IACd,MAAO,CACLC,iBAAkBC,SAASC,SAASC,QAChCF,SAASG,UAAY,CAACC,aAAcJ,SAASG,UAErD,CAEA,MAAME,EAAiB,mB,SAEPC,I,MAGd,MAAO,CACLC,OAAQ,CACN,kBACEjB,EAAAe,EAAeG,KAAKZ,IAAuBC,YAAQ,MAAAP,SAAA,SAAAA,EAAG,KAAM,SAGpE,C,SAEgBmB,EACdC,EACAC,GAEA,MAAMC,EAA+C,CACnDD,UACAZ,iBAAkBC,SAASC,SAASC,QAChCF,SAASG,UAAY,CAACC,aAAcJ,SAASG,WAGnD,GAAIO,EAAmBnB,UAAW,CAChC,MAAO,IACFqB,KACAF,EAAmBnB,U,CAG1B,OAAOqB,CACT,Q"}