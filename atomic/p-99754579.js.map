{"version":3,"names":["SmartSnippetFeedbackBanner","props","inquiryId","id","thankYouId","radioGroupName","Inquiry","h","part","class","i18n","t","Buttons","liked","icon","Checkmark","RadioButton","groupName","text","checked","onChecked","onLike","disliked","Cross","onDislike","ThankYouMessage","ExplainWhyButton","Button","style","onClick","onPressExplainWhy","ref","element","_a","explainWhyRef","call","ThankYouContainer","visible","feedbackSent","role","SmartSnippetCommon","constructor","this","styleTag","getHost","querySelector","content","getSnippetStyle","innerHTML","loadModal","getModalRef","modalRef","document","createElement","modalTagName","addEventListener","setFeedbackSent","setModalRef","insertAdjacentElement","renderQuestion","headingLevel","getHeadingLevel","Heading","level","getSmartSnippetState","question","canSnippetCollapse","_b","getSnippetMaximumHeight","undefined","renderContent","state","exportparts","htmlContent","answer","innerStyle","expanded","maximumHeight","getMaximumHeight","collapsedHeight","getCollapsedHeight","snippetStyle","onExpand","getSmartSnippet","expand","onCollapse","collapse","renderFeedbackBanner","getBindings","getFeedbackSent","like","dislike","isOpen","button","source","hideDuringRender","shouldHide","host","visibility","position","render","answerFound","Hidden","classList","contains","_c","_e","_d","getSnippetCollapsedHeight","anchorAttributes","_g","_f","getSourceAnchorAttributes","onSelectSource","selectSource","onBeginDelayedSelectSource","beginDelayedSelectSource","onCancelPendingSelectSource","cancelPendingSelectSource"],"sources":["src/components/common/smart-snippets/atomic-smart-snippet-feedback-banner.tsx","src/components/common/smart-snippets/atomic-smart-snippet/smart-snippet-common.tsx"],"sourcesContent":["import {h, FunctionalComponent} from '@stencil/core';\nimport {i18n} from 'i18next';\nimport Checkmark from '../../../images/checkmark.svg';\nimport Cross from '../../../images/cross.svg';\nimport {Button} from '../button';\nimport {RadioButton} from '../radio-button';\n\ninterface SmartSnippetFeedbackBannerProps {\n  i18n: i18n;\n  id: string;\n  liked: boolean;\n  disliked: boolean;\n  feedbackSent: boolean;\n  onLike(): void;\n  onDislike(): void;\n  onPressExplainWhy(): void;\n  explainWhyRef?(element?: HTMLButtonElement): void;\n}\n\nexport const SmartSnippetFeedbackBanner: FunctionalComponent<\n  SmartSnippetFeedbackBannerProps\n> = (props) => {\n  const inquiryId = 'feedback-inquiry-' + props.id;\n  const thankYouId = 'feedback-thank-you-' + props.id;\n  const radioGroupName = 'feedback-options-' + props.id;\n\n  const Inquiry = () => (\n    <span id={inquiryId} part=\"feedback-inquiry\" class=\"shrink-0\">\n      {props.i18n.t('smart-snippet-feedback-inquiry')}\n    </span>\n  );\n\n  const Buttons = () => (\n    <div part=\"feedback-buttons\" class=\"flex gap-x-4\">\n      <label\n        part=\"feedback-like-button\"\n        class={\n          'flex items-center gap-x-1.5 ' +\n          (props.liked ? 'text-success' : 'cursor-pointer hover:underline')\n        }\n      >\n        <atomic-icon icon={Checkmark} class=\"w-3.5\"></atomic-icon>\n        <RadioButton\n          groupName={radioGroupName}\n          text={props.i18n.t('yes')}\n          checked={props.liked}\n          onChecked={() => props.onLike()}\n          class=\"text-inherit cursor-inherit\"\n        ></RadioButton>\n      </label>\n      <label\n        part=\"feedback-dislike-button\"\n        class={\n          'flex items-center gap-x-1.5 ' +\n          (props.disliked ? 'text-error' : 'cursor-pointer hover:underline')\n        }\n      >\n        <atomic-icon icon={Cross} class=\"w-3.5\"></atomic-icon>\n        <RadioButton\n          groupName={radioGroupName}\n          text={props.i18n.t('no')}\n          checked={props.disliked}\n          onChecked={() => props.onDislike()}\n          class=\"text-inherit cursor-inherit\"\n        ></RadioButton>\n      </label>\n    </div>\n  );\n\n  const ThankYouMessage = () => (\n    <span id={thankYouId} part=\"feedback-thank-you\" class=\"inline-flex\">\n      {props.i18n.t('smart-snippet-feedback-thanks')}\n    </span>\n  );\n\n  const ExplainWhyButton = () => (\n    <Button\n      part=\"feedback-explain-why-button\"\n      style=\"text-primary\"\n      onClick={() => props.onPressExplainWhy()}\n      ref={(element) => props.explainWhyRef?.(element)}\n    >\n      {props.i18n.t('smart-snippet-feedback-explain-why')}\n    </Button>\n  );\n\n  const ThankYouContainer = ({visible}: {visible: boolean}) =>\n    visible ? (\n      <div part=\"feedback-thank-you-wrapper\" class=\"flex flex-wrap gap-1\">\n        <ThankYouMessage></ThankYouMessage>\n        {props.disliked && !props.feedbackSent ? (\n          <ExplainWhyButton></ExplainWhyButton>\n        ) : (\n          []\n        )}\n      </div>\n    ) : (\n      []\n    );\n\n  return (\n    <div\n      part=\"feedback-banner\"\n      class=\"flex flex-wrap items-center gap-4 text-sm leading-4\"\n    >\n      <div\n        part=\"feedback-inquiry-and-buttons\"\n        role=\"radiogroup\"\n        aria-labelledby={inquiryId}\n        class=\"inline-flex flex-wrap gap-4\"\n      >\n        <Inquiry></Inquiry>\n        <Buttons></Buttons>\n      </div>\n      <ThankYouContainer\n        visible={props.liked || props.disliked}\n      ></ThankYouContainer>\n    </div>\n  );\n};\n","import {SmartSnippetState, SmartSnippet} from '@coveo/headless';\nimport {h} from '@stencil/core';\nimport {Heading} from '../../heading';\nimport {Hidden} from '../../hidden';\nimport {AnyBindings} from '../../interface/bindings';\nimport {SmartSnippetFeedbackBanner} from '../atomic-smart-snippet-feedback-banner';\n\ntype FeedBackModalElement =\n  | HTMLAtomicSmartSnippetFeedbackModalElement\n  | HTMLAtomicInsightSmartSnippetFeedbackModalElement;\n\ninterface SmartSnippetProps {\n  id: string;\n  modalTagName: string;\n  getSourceAnchorAttributes?: () => Attr[] | undefined;\n  getHost: () => HTMLElement;\n  getBindings: () => AnyBindings;\n  getModalRef: () => FeedBackModalElement | undefined;\n  getHeadingLevel: () => number;\n  getCollapsedHeight: () => number;\n  getMaximumHeight: () => number;\n  getSmartSnippetState: () => SmartSnippetState;\n  getSmartSnippet: () => SmartSnippet;\n  getSnippetStyle: () => string | undefined;\n  getFeedbackSent: () => boolean;\n  getSnippetMaximumHeight?: () => number;\n  getSnippetCollapsedHeight?: () => number;\n  setModalRef: (ref: HTMLElement) => void;\n  setFeedbackSent: (isSent: boolean) => void;\n}\n\nexport class SmartSnippetCommon {\n  constructor(private props: SmartSnippetProps) {}\n\n  private get style() {\n    const styleTag = this.props\n      .getHost()\n      .querySelector('template')\n      ?.content.querySelector('style');\n    if (!styleTag) {\n      return this.props.getSnippetStyle();\n    }\n    return styleTag.innerHTML;\n  }\n\n  private loadModal() {\n    if (this.props.getModalRef()) {\n      return;\n    }\n    const modalRef = document.createElement(this.props.modalTagName);\n    modalRef.addEventListener('feedbackSent', () => {\n      this.props.setFeedbackSent(true);\n    });\n    this.props.setModalRef(modalRef);\n    this.props.getHost().insertAdjacentElement('beforebegin', modalRef);\n  }\n\n  private renderQuestion() {\n    const headingLevel = this.props.getHeadingLevel();\n    return (\n      <Heading\n        level={headingLevel ? headingLevel + 1 : 0}\n        class=\"text-xl font-bold\"\n        part=\"question\"\n      >\n        {this.props.getSmartSnippetState().question}\n      </Heading>\n    );\n  }\n\n  private canSnippetCollapse() {\n    return this.props.getSnippetMaximumHeight?.() !== undefined;\n  }\n\n  private renderContent() {\n    const state = this.props.getSmartSnippetState();\n    if (this.canSnippetCollapse()) {\n      return (\n        <div part=\"truncated-answer\">\n          <atomic-smart-snippet-answer\n            exportparts=\"answer\"\n            part=\"body\"\n            htmlContent={state.answer}\n            innerStyle={this.style}\n          ></atomic-smart-snippet-answer>\n        </div>\n      );\n    }\n    return (\n      <atomic-smart-snippet-expandable-answer\n        exportparts=\"answer,show-more-button,show-less-button,truncated-answer\"\n        part=\"body\"\n        htmlContent={state.answer}\n        expanded={state.expanded}\n        maximumHeight={this.props.getMaximumHeight()}\n        collapsedHeight={this.props.getCollapsedHeight()}\n        snippetStyle={this.style}\n        onExpand={() => this.props.getSmartSnippet().expand()}\n        onCollapse={() => this.props.getSmartSnippet().collapse()}\n      ></atomic-smart-snippet-expandable-answer>\n    );\n  }\n\n  private renderFeedbackBanner() {\n    const state = this.props.getSmartSnippetState();\n    return (\n      <SmartSnippetFeedbackBanner\n        i18n={this.props.getBindings().i18n}\n        id={this.props.id}\n        liked={state.liked}\n        disliked={state.disliked}\n        feedbackSent={this.props.getFeedbackSent()}\n        onLike={() => this.props.getSmartSnippet().like()}\n        onDislike={() => {\n          this.loadModal();\n          this.props.getSmartSnippet().dislike();\n        }}\n        onPressExplainWhy={() => (this.props.getModalRef()!.isOpen = true)}\n        explainWhyRef={(button) => {\n          if (this.props.getModalRef()) {\n            this.props.getModalRef()!.source = button;\n          }\n        }}\n      ></SmartSnippetFeedbackBanner>\n    );\n  }\n\n  public hideDuringRender(shouldHide: boolean) {\n    const host = this.props.getHost();\n    host.style.visibility = shouldHide ? 'hidden' : '';\n    host.style.position = shouldHide ? 'absolute' : '';\n  }\n\n  public render() {\n    if (!this.props.getSmartSnippetState().answerFound) {\n      return <Hidden></Hidden>;\n    }\n\n    if (this.props.getHost().classList.contains('atomic-hidden')) {\n      this.hideDuringRender(true);\n    }\n\n    const source = this.props.getSmartSnippetState().source;\n\n    return (\n      <aside>\n        <Heading\n          level={this.props.getHeadingLevel() ?? 0}\n          class=\"accessibility-only\"\n        >\n          {this.props.getBindings().i18n.t('smart-snippet')}\n        </Heading>\n        <article\n          class=\"bg-background border border-neutral rounded-lg p-6 pb-4 text-on-background\"\n          part=\"smart-snippet\"\n        >\n          <atomic-smart-snippet-collapse-wrapper\n            maximumHeight={this.props.getSnippetMaximumHeight?.()}\n            collapsedHeight={this.props.getSnippetCollapsedHeight?.()}\n          >\n            {this.renderQuestion()}\n            {this.renderContent()}\n            <footer\n              part=\"footer\"\n              aria-label={this.props\n                .getBindings()\n                .i18n.t('smart-snippet-source')}\n            >\n              {source && (\n                <atomic-smart-snippet-source\n                  anchorAttributes={this.props.getSourceAnchorAttributes?.()}\n                  source={source}\n                  onSelectSource={this.props.getSmartSnippet().selectSource}\n                  onBeginDelayedSelectSource={\n                    this.props.getSmartSnippet().beginDelayedSelectSource\n                  }\n                  onCancelPendingSelectSource={\n                    this.props.getSmartSnippet().cancelPendingSelectSource\n                  }\n                ></atomic-smart-snippet-source>\n              )}\n              {this.renderFeedbackBanner()}\n            </footer>\n          </atomic-smart-snippet-collapse-wrapper>\n        </article>\n      </aside>\n    );\n  }\n}\n"],"mappings":"k0BAmBO,MAAMA,EAERC,IACH,MAAMC,EAAY,oBAAsBD,EAAME,GAC9C,MAAMC,EAAa,sBAAwBH,EAAME,GACjD,MAAME,EAAiB,oBAAsBJ,EAAME,GAEnD,MAAMG,EAAU,IACdC,EAAA,QAAMJ,GAAID,EAAWM,KAAK,mBAAmBC,MAAM,YAChDR,EAAMS,KAAKC,EAAE,mCAIlB,MAAMC,EAAU,IACdL,EAAA,OAAKC,KAAK,mBAAmBC,MAAM,gBACjCF,EAAA,SACEC,KAAK,uBACLC,MACE,gCACCR,EAAMY,MAAQ,eAAiB,mCAGlCN,EAAA,eAAaO,KAAMC,EAAWN,MAAM,UACpCF,EAACS,EAAW,CACVC,UAAWZ,EACXa,KAAMjB,EAAMS,KAAKC,EAAE,OACnBQ,QAASlB,EAAMY,MACfO,UAAW,IAAMnB,EAAMoB,SACvBZ,MAAM,iCAGVF,EAAA,SACEC,KAAK,0BACLC,MACE,gCACCR,EAAMqB,SAAW,aAAe,mCAGnCf,EAAA,eAAaO,KAAMS,EAAOd,MAAM,UAChCF,EAACS,EAAW,CACVC,UAAWZ,EACXa,KAAMjB,EAAMS,KAAKC,EAAE,MACnBQ,QAASlB,EAAMqB,SACfF,UAAW,IAAMnB,EAAMuB,YACvBf,MAAM,kCAMd,MAAMgB,EAAkB,IACtBlB,EAAA,QAAMJ,GAAIC,EAAYI,KAAK,qBAAqBC,MAAM,eACnDR,EAAMS,KAAKC,EAAE,kCAIlB,MAAMe,EAAmB,IACvBnB,EAACoB,EAAM,CACLnB,KAAK,8BACLoB,MAAM,eACNC,QAAS,IAAM5B,EAAM6B,oBACrBC,IAAMC,IAAO,IAAAC,EAAK,OAAAA,EAAAhC,EAAMiC,iBAAa,MAAAD,SAAA,SAAAA,EAAAE,KAAAlC,EAAG+B,EAAQ,GAE/C/B,EAAMS,KAAKC,EAAE,uCAIlB,MAAMyB,EAAoB,EAAEC,aAC1BA,EACE9B,EAAA,OAAKC,KAAK,6BAA6BC,MAAM,wBAC3CF,EAACkB,EAAe,MACfxB,EAAMqB,WAAarB,EAAMqC,aACxB/B,EAACmB,EAAgB,MAAoB,IAInC,GAKV,OACEnB,EAAA,OACEC,KAAK,kBACLC,MAAM,uDAENF,EAAA,OACEC,KAAK,+BACL+B,KAAK,aAAY,kBACArC,EACjBO,MAAM,+BAENF,EAACD,EAAO,MACRC,EAACK,EAAO,OAEVL,EAAC6B,EAAiB,CAChBC,QAASpC,EAAMY,OAASZ,EAAMqB,WAE5B,E,MCtFGkB,EACX,WAAAC,CAAoBxC,GAAAyC,KAAAzC,O,CAEpB,SAAY2B,G,MACV,MAAMe,GAAWV,EAAAS,KAAKzC,MACnB2C,UACAC,cAAc,eAAW,MAAAZ,SAAA,SAAAA,EACxBa,QAAQD,cAAc,SAC1B,IAAKF,EAAU,CACb,OAAOD,KAAKzC,MAAM8C,iB,CAEpB,OAAOJ,EAASK,S,CAGV,SAAAC,GACN,GAAIP,KAAKzC,MAAMiD,cAAe,CAC5B,M,CAEF,MAAMC,EAAWC,SAASC,cAAcX,KAAKzC,MAAMqD,cACnDH,EAASI,iBAAiB,gBAAgB,KACxCb,KAAKzC,MAAMuD,gBAAgB,KAAK,IAElCd,KAAKzC,MAAMwD,YAAYN,GACvBT,KAAKzC,MAAM2C,UAAUc,sBAAsB,cAAeP,E,CAGpD,cAAAQ,GACN,MAAMC,EAAelB,KAAKzC,MAAM4D,kBAChC,OACEtD,EAACuD,EAAO,CACNC,MAAOH,EAAeA,EAAe,EAAI,EACzCnD,MAAM,oBACND,KAAK,YAEJkC,KAAKzC,MAAM+D,uBAAuBC,S,CAKjC,kBAAAC,G,QACN,QAAOC,GAAAlC,EAAAS,KAAKzC,OAAMmE,2BAAuB,MAAAD,SAAA,SAAAA,EAAAhC,KAAAF,MAASoC,S,CAG5C,aAAAC,GACN,MAAMC,EAAQ7B,KAAKzC,MAAM+D,uBACzB,GAAItB,KAAKwB,qBAAsB,CAC7B,OACE3D,EAAA,OAAKC,KAAK,oBACRD,EAAA,+BACEiE,YAAY,SACZhE,KAAK,OACLiE,YAAaF,EAAMG,OACnBC,WAAYjC,KAAKd,Q,CAKzB,OACErB,EAAA,0CACEiE,YAAY,4DACZhE,KAAK,OACLiE,YAAaF,EAAMG,OACnBE,SAAUL,EAAMK,SAChBC,cAAenC,KAAKzC,MAAM6E,mBAC1BC,gBAAiBrC,KAAKzC,MAAM+E,qBAC5BC,aAAcvC,KAAKd,MACnBsD,SAAU,IAAMxC,KAAKzC,MAAMkF,kBAAkBC,SAC7CC,WAAY,IAAM3C,KAAKzC,MAAMkF,kBAAkBG,Y,CAK7C,oBAAAC,GACN,MAAMhB,EAAQ7B,KAAKzC,MAAM+D,uBACzB,OACEzD,EAACP,EAA0B,CACzBU,KAAMgC,KAAKzC,MAAMuF,cAAc9E,KAC/BP,GAAIuC,KAAKzC,MAAME,GACfU,MAAO0D,EAAM1D,MACbS,SAAUiD,EAAMjD,SAChBgB,aAAcI,KAAKzC,MAAMwF,kBACzBpE,OAAQ,IAAMqB,KAAKzC,MAAMkF,kBAAkBO,OAC3ClE,UAAW,KACTkB,KAAKO,YACLP,KAAKzC,MAAMkF,kBAAkBQ,SAAS,EAExC7D,kBAAmB,IAAOY,KAAKzC,MAAMiD,cAAe0C,OAAS,KAC7D1D,cAAgB2D,IACd,GAAInD,KAAKzC,MAAMiD,cAAe,CAC5BR,KAAKzC,MAAMiD,cAAe4C,OAASD,C,KAOtC,gBAAAE,CAAiBC,GACtB,MAAMC,EAAOvD,KAAKzC,MAAM2C,UACxBqD,EAAKrE,MAAMsE,WAAaF,EAAa,SAAW,GAChDC,EAAKrE,MAAMuE,SAAWH,EAAa,WAAa,E,CAG3C,MAAAI,G,kBACL,IAAK1D,KAAKzC,MAAM+D,uBAAuBqC,YAAa,CAClD,OAAO9F,EAAC+F,EAAM,K,CAGhB,GAAI5D,KAAKzC,MAAM2C,UAAU2D,UAAUC,SAAS,iBAAkB,CAC5D9D,KAAKqD,iBAAiB,K,CAGxB,MAAMD,EAASpD,KAAKzC,MAAM+D,uBAAuB8B,OAEjD,OACEvF,EAAA,aACEA,EAACuD,EAAO,CACNC,OAAO9B,EAAAS,KAAKzC,MAAM4D,qBAAiB,MAAA5B,SAAA,EAAAA,EAAI,EACvCxB,MAAM,sBAELiC,KAAKzC,MAAMuF,cAAc9E,KAAKC,EAAE,kBAEnCJ,EAAA,WACEE,MAAM,6EACND,KAAK,iBAELD,EAAA,yCACEsE,eAAe4B,GAAAtC,EAAAzB,KAAKzC,OAAMmE,2BAAuB,MAAAqC,SAAA,SAAAA,EAAAtE,KAAAgC,GACjDY,iBAAiB2B,GAAAC,EAAAjE,KAAKzC,OAAM2G,6BAAyB,MAAAF,SAAA,SAAAA,EAAAvE,KAAAwE,IAEpDjE,KAAKiB,iBACLjB,KAAK4B,gBACN/D,EAAA,UACEC,KAAK,SAAQ,aACDkC,KAAKzC,MACduF,cACA9E,KAAKC,EAAE,yBAETmF,GACCvF,EAAA,+BACEsG,kBAAkBC,GAAAC,EAAArE,KAAKzC,OAAM+G,6BAAyB,MAAAF,SAAA,SAAAA,EAAA3E,KAAA4E,GACtDjB,OAAQA,EACRmB,eAAgBvE,KAAKzC,MAAMkF,kBAAkB+B,aAC7CC,2BACEzE,KAAKzC,MAAMkF,kBAAkBiC,yBAE/BC,4BACE3E,KAAKzC,MAAMkF,kBAAkBmC,4BAIlC5E,KAAK6C,0B"}