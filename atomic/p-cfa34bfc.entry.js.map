{"version":3,"names":["atomicPopoverCss","AtomicPopoverStyle0","AtomicPopover","this","isOpen","initialize","searchStatus","buildSearchStatus","bindings","engine","host","children","length","error","Error","initializePopover","event","childFacet","detail","element","classList","add","popoverClass","handleKeyDown","e","key","togglePopover","popoverId","_a","facetId","label","componentDidRender","popperInstance","buttonRef","popupRef","createPopper","placement","modifiers","preventOverflow","componentDidUpdate","forceUpdate","renderDropdownButton","hasActiveValues","numberOfActiveValues","count","toLocaleString","ariaLabel","i18n","t","h","Button","ref","el","style","onClick","part","ariaExpanded","ariaControls","class","title","text","icon","ArrowBottomIcon","renderBackdrop","renderPopover","id","render","state","hasError","Hidden","firstSearchExecuted","hasResults","hasValues","Host","source","container","active","shouldHideSelf","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/facets/atomic-popover/atomic-popover.pcss?tag=atomic-popover&encapsulation=shadow","src/components/search/facets/atomic-popover/atomic-popover.tsx"],"sourcesContent":["@import '../../../common/facets/facet-common.pcss';\r\n","import {\r\n  buildSearchStatus,\r\n  SearchStatus,\r\n  SearchStatusState,\r\n  FacetState,\r\n} from '@coveo/headless';\r\nimport {\r\n  createPopperLite as createPopper,\r\n  preventOverflow,\r\n  Instance as PopperInstance,\r\n} from '@popperjs/core';\r\nimport {Component, h, Listen, State, Element, Host} from '@stencil/core';\r\nimport ArrowBottomIcon from '../../../../images/arrow-bottom-rounded.svg';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {Button} from '../../../common/button';\r\nimport {Hidden} from '../../../common/hidden';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {PopoverChildFacet, popoverClass} from './popover-type';\r\n\r\n/**\r\n * The `atomic-popover` component displays any facet as a popover menu.\r\n *\r\n * @slot default - The required slotted facet.\r\n * @part backdrop - The transparent backdrop hiding the content behind popover menu.\r\n * @part popover-button - The button to click to display or hide the popover menu.\r\n * @part value-label - The associated facet label.\r\n * @part value-count - Number of selected values for the facet\r\n * @part arrow-icon - The arrow icon on the button to display or hide the popover menu.\r\n * @part placeholder - The placeholder displayed when the facet is loading.\r\n * @part facet - The wrapper that contains the slotted 'facet'.\r\n */\r\n@Component({\r\n  tag: 'atomic-popover',\r\n  styleUrl: 'atomic-popover.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicPopover implements InitializableComponent {\r\n  @Element() private host!: HTMLElement;\r\n  private buttonRef!: HTMLElement;\r\n  private popupRef!: HTMLElement;\r\n  private popperInstance?: PopperInstance;\r\n  @InitializeBindings()\r\n  public bindings!: Bindings;\r\n  private searchStatus!: SearchStatus;\r\n\r\n  @BindStateToController('searchStatus')\r\n  @State()\r\n  public searchStatusState!: SearchStatusState;\r\n  @BindStateToController('facet')\r\n  @State()\r\n  public facetState!: FacetState;\r\n  @State()\r\n  public error!: Error;\r\n  @State() private isOpen = false;\r\n  @State() private childFacet?: PopoverChildFacet;\r\n\r\n  public initialize() {\r\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\r\n\r\n    if (this.host.children.length === 0) {\r\n      this.error = new Error(\r\n        'One child is required inside a set of popover tags.'\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    if (this.host.children.length > 1) {\r\n      this.error = new Error(\r\n        'Cannot have more than one child inside a set of popover tags.'\r\n      );\r\n    }\r\n  }\r\n\r\n  @Listen('atomic/initializePopover')\r\n  public initializePopover(event: CustomEvent<PopoverChildFacet>) {\r\n    if (this.childFacet || !event.detail) {\r\n      return;\r\n    }\r\n\r\n    this.childFacet = event.detail;\r\n    this.childFacet.element.classList.add(popoverClass);\r\n  }\r\n\r\n  @Listen('keydown')\r\n  public handleKeyDown(e: KeyboardEvent) {\r\n    if (e.key === 'Escape' && this.isOpen) {\r\n      this.togglePopover();\r\n    }\r\n  }\r\n\r\n  private get popoverId() {\r\n    return `${this.childFacet?.facetId}-popover`;\r\n  }\r\n\r\n  private get label() {\r\n    return this.childFacet!.label();\r\n  }\r\n\r\n  private togglePopover() {\r\n    this.isOpen = !this.isOpen;\r\n  }\r\n\r\n  public componentDidRender() {\r\n    if (this.popperInstance || !this.buttonRef || !this.popupRef) {\r\n      return;\r\n    }\r\n\r\n    this.popperInstance = createPopper(this.buttonRef, this.popupRef, {\r\n      placement: 'bottom-start',\r\n      modifiers: [preventOverflow],\r\n    });\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    this.popperInstance?.forceUpdate();\r\n  }\r\n\r\n  private renderDropdownButton() {\r\n    const label = this.label;\r\n    const hasActiveValues = !!this.childFacet!.numberOfActiveValues();\r\n    const count = this.childFacet!.numberOfActiveValues().toLocaleString();\r\n    const ariaLabel = this.bindings.i18n.t('popover', {label});\r\n\r\n    return (\r\n      <Button\r\n        ref={(el) => (this.buttonRef = el!)}\r\n        style=\"square-neutral\"\r\n        onClick={() => this.togglePopover()}\r\n        part=\"popover-button\"\r\n        ariaExpanded={`${this.isOpen}`}\r\n        ariaLabel={ariaLabel}\r\n        ariaControls={this.popoverId}\r\n        class={`rounded flex box-border h-full items-center min-w-[6rem] max-w-[15rem] p-2.5 group hover:border-primary-light focus-visible:border-primary-light ${\r\n          this.isOpen\r\n            ? 'border-primary ring ring-ring-primary text-primary z-[9999]'\r\n            : ''\r\n        }`}\r\n      >\r\n        <span\r\n          title={label}\r\n          part=\"value-label\"\r\n          class={`truncate mr-1.5 ${\r\n            this.isOpen\r\n              ? ''\r\n              : 'group-hover:text-primary-light group-focus:text-primary'\r\n          }`}\r\n        >\r\n          {label}\r\n        </span>\r\n        <span\r\n          part=\"value-count\"\r\n          class={`truncate mr-1.5 text-sm group-hover:text-primary-light group-focus:text-primary ${\r\n            hasActiveValues ? '' : 'hidden'\r\n          } ${this.isOpen ? 'text-primary' : 'text-neutral-dark'}`}\r\n        >\r\n          {this.bindings.i18n.t('between-parentheses', {\r\n            text: count,\r\n          })}\r\n        </span>\r\n        <atomic-icon\r\n          part=\"arrow-icon\"\r\n          class={`w-2 ml-auto group-hover:text-primary-light group-focus:text-primary ${\r\n            this.isOpen ? 'rotate-180' : ''\r\n          } `}\r\n          icon={ArrowBottomIcon}\r\n        ></atomic-icon>\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  private renderBackdrop() {\r\n    return (\r\n      <div\r\n        part=\"backdrop\"\r\n        class=\"fixed left-0 top-0 right-0 bottom-0 z-[9998] bg-transparent cursor-pointer\"\r\n        onClick={() => this.togglePopover()}\r\n      ></div>\r\n    );\r\n  }\r\n\r\n  private renderPopover() {\r\n    return (\r\n      <div class={`relative ${this.isOpen ? 'z-[9999]' : ''}`}>\r\n        {this.renderDropdownButton()}\r\n        <div\r\n          id={this.popoverId}\r\n          ref={(el) => (this.popupRef = el!)}\r\n          part=\"facet\"\r\n          class={`absolute pt-0.5 ${this.isOpen ? 'block' : 'hidden'}`}\r\n        >\r\n          <slot></slot>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    if (this.searchStatus.state.hasError) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    if (!this.searchStatus.state.firstSearchExecuted) {\r\n      return (\r\n        <div\r\n          part=\"placeholder\"\r\n          aria-hidden\r\n          class=\"h-8 w-32 bg-neutral animate-pulse rounded\"\r\n        ></div>\r\n      );\r\n    }\r\n\r\n    if (!this.searchStatus.state.hasResults || !this.childFacet?.hasValues()) {\r\n      return <Hidden></Hidden>;\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        <atomic-focus-trap\r\n          source={this.buttonRef}\r\n          container={this.popupRef}\r\n          active={this.isOpen}\r\n          shouldHideSelf={false}\r\n        >\r\n          {this.renderPopover()}\r\n        </atomic-focus-trap>\r\n        {this.isOpen && this.renderBackdrop()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}