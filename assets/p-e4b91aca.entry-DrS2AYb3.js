import{N as a,g as t,O as h}from"./atomic-breadbox.new.stories-D03zBEda.js";import{D as u,E as d}from"./p-e12016d2-D4PWgvR2.js";import{s as l}from"./p-cfb3c589-B_FPW2aN.js";import{t as g,n as m,a as b,r as f}from"./p-484590fe-CSgJ6p35.js";import{r as c}from"./p-a6063f86-B30eqkoD.js";import{o as p}from"./p-c280cd05-7zHi8rD9.js";import{t as x,r as o}from"./p-0943c4bd-Erj32V3d.js";import{r as Q}from"./p-9935af75-BsJQUBM3.js";import{n as y,i as S,a as I,l as L,c as C,s as E}from"./p-82ef9a5b-Dz9HOGXZ.js";import"./iframe-DTo5wNcQ.js";import"../sb-preview/runtime.js";import"./p-8f5830b4-EwJYRc8T.js";import"./p-1580513b-De1d4bsn.js";import"./p-e9c4f463-BPmi-3c5.js";const A=class{constructor(e){a(this,e),this.error=void 0,this.icon=void 0,this.maxWithQuery=void 0,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}initialize(){const e=this.bindings.engine,{registerQuerySuggest:i,fetchQuerySuggestions:s}=u(e);return e.dispatch(i({id:this.bindings.id,count:this.bindings.numberOfQueries})),{position:Array.from(this.host.parentNode.children).indexOf(this.host),onInput:()=>e.dispatch(s({id:this.bindings.id})),renderItems:()=>this.renderItems()}}renderItems(){const i=this.bindings.searchBoxController.state.value!==""?this.maxWithQuery:this.maxWithoutQuery;return this.bindings.searchBoxController.state.suggestions.slice(0,i).map(s=>this.renderItem(s))}renderItem(e){const i=this.bindings.searchBoxController.state.value!=="";return{...g(e,this.bindings.i18n),content:t(f,null,t(b,{icon:this.icon||l,hasSuggestion:this.bindings.getSuggestions().length>1}),t(m,{suggestion:e,hasQuery:i})),onSelect:()=>{this.bindings.searchBoxController.selectSuggestion(e.rawValue)}}}render(){if(this.error)return t("atomic-component-error",{key:"d49f09374cfe7ddb9d66591b7fc1732a8b38a53c",element:this.host,error:this.error})}get host(){return h(this)}},J=class{constructor(e){a(this,e),this.maxWithQuery=3,this.warnUser=Q(()=>this.bindings.engine.logger.warn("Because analytics are disabled, the recent queries feature is deactivated.")),this.error=void 0,this.icon=void 0,this.maxWithQuery=3,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}renderIcon(){return this.icon||p}initialize(){return this.storage=new x,this.recentQueriesList=d(this.bindings.engine,{initialState:{queries:this.retrieveLocalStorage()},options:{maxLength:1e3,clearFilters:this.bindings.clearFilters}}),this.recentQueriesList.subscribe(()=>this.updateLocalStorage()),{position:Array.from(this.host.parentNode.children).indexOf(this.host),renderItems:()=>this.renderItems()}}retrieveLocalStorage(){return this.storage.getParsedJSON(o.RECENT_QUERIES,[])}updateLocalStorage(){return this.recentQueriesList.state.analyticsEnabled?this.storage.setJSON(o.RECENT_QUERIES,this.recentQueriesList.state.queries):this.disableFeature()}disableFeature(){this.warnUser(),this.storage.removeItem(o.RECENT_QUERIES)}renderItems(){if(!this.recentQueriesList.state.analyticsEnabled)return[];const e=this.bindings.searchBoxController.state.value,s=e!==""?this.maxWithQuery:this.maxWithoutQuery,n=this.recentQueriesList.state.queries.filter(r=>r!==e&&r.toLowerCase().startsWith(e.toLowerCase())).slice(0,s).map(r=>this.renderItem(r));return n.length&&n.unshift(this.renderClear()),n}renderClear(){return{...y(this.bindings.i18n),content:t(S,{i18n:this.bindings.i18n}),onSelect:()=>{this.recentQueriesList.clear(),this.bindings.triggerSuggestions()}}}renderItem(e){const i=this.bindings.searchBoxController.state.value;return{...I(e,this.bindings.i18n),content:t(E,null,t(C,{icon:this.renderIcon()}),t(L,{query:i,value:e})),onSelect:()=>{if(this.bindings.isStandalone){this.bindings.searchBoxController.updateText(e),this.bindings.searchBoxController.submit();return}this.recentQueriesList.executeRecentQuery(this.recentQueriesList.state.queries.indexOf(e))}}}render(){if(this.error)return t("atomic-component-error",{key:"e3e8f148ef23dc520931455150df5ba295be136d",element:this.host,error:this.error})}get host(){return h(this)}};export{A as atomic_search_box_query_suggestions,J as atomic_search_box_recent_queries};
