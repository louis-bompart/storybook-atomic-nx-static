import{g as u,v as E,L as b}from"./preview-C4e5QyPH.js";import{e as P}from"./p-c58ca89b-DK00LRHh.js";import{s as m}from"./p-7e7b1a62-C6-3oFSh.js";import{i as A}from"./p-f5723aee-BNyovPuY.js";import{n as k}from"./p-e48090a7-An2ObuCc.js";import{a as V,s as L}from"./p-2130c607-ChH9Gsy8.js";import{o as F}from"./p-c86021c8-CKMZ6u52.js";const W=(t,e)=>u("div",{part:"wrapper",class:(()=>{const s="flex bg-background w-full border border-neutral rounded-md focus-within:ring",i=t.disabled?"focus-within:border-disabled focus-within:ring-neutral":"focus-within:border-primary focus-within:ring-ring-primary",l=t.textArea?"absolute top-0 left-0":"relative h-full";return[s,i,l].join(" ")})()},e),I=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15 1.00012L1.00012 14.9999" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M0.999878 1L14.9999 15" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,q=({inputRef:t,bindings:e,onClick:n,...s})=>u("div",{part:"clear-button-wrapper",class:"py-2 flex items-start justify-center items-center ml-2"},u(P,{style:"text-transparent",part:"clear-button",class:"flex items-center justify-center w-8 h-8 text-neutral-dark shrink-0",onClick:()=>{n==null||n(),t==null||t.focus()},ariaLabel:e.i18n.t("clear"),...s},u("atomic-icon",{part:"clear-icon",icon:I,class:"w-4 h-4"})));function C(t){return{role:"combobox",autocomplete:"off",autocapitalize:"off",autocorrect:"off",...t.activeDescendant&&{"aria-activedescendant":t.activeDescendant},"aria-expanded":`${t.hasSuggestions&&t.expanded}`,"aria-autocomplete":"both","aria-haspopup":"true","aria-controls":t.id}}function d(t,e){const n=t==null?void 0:t.parentNode;n&&t.value!==`
`&&(n.dataset.replicatedValue=t.value)}function B(t){const e=t==null?void 0:t.parentNode;e&&delete e.dataset.replicatedValue}function Q(t){const e=t==null?void 0:t.parentNode;e&&e.classList.remove("expanded")}function O(t){const e=t==null?void 0:t.parentNode;e&&e.classList.add("expanded")}const X=({textAreaRef:t,loading:e,bindings:n,onInput:s,onFocus:i,onBlur:l,onChange:r,onKeyDown:g,onKeyUp:a,value:c,ariaLabel:h,onClear:f,popup:v,...p})=>u("div",{class:"grow flex overflow-hidden"},u("div",{part:"textarea-expander",class:"grow grid overflow-hidden"},u("textarea",{part:"textarea","aria-label":h,placeholder:n.i18n.t("search"),class:"placeholder-neutral-dark",rows:1,onInput:o=>{s==null||s(o),d(t)},onKeyDown:o=>{if(d(t),o.key==="Enter"){if(o.shiftKey)return;o.preventDefault()}g==null||g(o)},onKeyUp:o=>{if(a==null||a(o),o.key==="Enter"){o.preventDefault();return}d(t)},onBlur:o=>{l==null||l(o),Q(t),d(t)},onChange:o=>{r==null||r(o),d(t)},onFocus:o=>{i==null||i(o);const S=o.target;d(t??S),O(t??S)},autocomplete:"off",...v&&C(v),...p,value:c})),e&&u("div",{class:"searchbox-button-wrapper flex items-center justify-center ml-2"},u("span",{part:"loading",class:"loading w-5 h-5 rounded-full bg-gradient-to-r animate-spin mr-2 grid place-items-center"})),!e&&c&&u(q,{inputRef:t,bindings:n,onClick:()=>{f(),B(t)}})),Y=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle cx="7" cy="7" r="6.5" stroke="currentColor"/>
<path d="M16 16L12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;function y(t,e){let n;const s=new Promise((i,l)=>{n=setTimeout(()=>{l(new Error("Promise timed out."))},e)});return Promise.race([t,s]).then(()=>{clearTimeout(n)})}class Z{constructor(e){this.ownerSearchBoxProps=e,this.suggestions=[],this.leftSuggestionElements=[],this.rightSuggestionElements=[],this.leftPanel=void 0,this.rightPanel=void 0,this.activeDescendant="",this.suggestedQuery="",this.queryDataAttribute="data-query",this.suggestionEvents=[],this.previousActiveDescendantElement=null,this.leftSuggestions=[],this.rightSuggestions=[],this.triggerSuggestions=k(()=>this.executeQuerySuggestion(),this.ownerSearchBoxProps.getSuggestionDelay())}get partialSuggestionBindings(){return{suggestedQuery:()=>this.suggestedQuery,clearSuggestions:()=>this.clearSuggestions(),triggerSuggestions:()=>this.triggerSuggestions(),getSuggestions:()=>this.suggestions,getSuggestionElements:()=>this.allSuggestionElements}}get activeDescendantElement(){var e,n;return this.hasActiveDescendant&&(((e=this.leftPanel)===null||e===void 0?void 0:e.querySelector(`#${this.activeDescendant}`))||((n=this.rightPanel)===null||n===void 0?void 0:n.querySelector(`#${this.activeDescendant}`)))||null}onSubmit(){this.updateActiveDescendant(),this.clearSuggestions()}updateActiveDescendant(e=""){this.activeDescendant=e,E(this.ownerSearchBoxProps.getHost())}clickOnActiveElement(){var e;(e=this.activeDescendantElement)===null||e===void 0||e.click(),this.updateActiveDescendant()}isRightPanelInFocus(){return m(this.panelInFocus)||m(this.rightPanel)?!1:this.panelInFocus===this.rightPanel}initializeSuggestions(e){this.suggestions=this.suggestionEvents.map(n=>n(e))}registerSuggestionsFromEvent(e,n){e.preventDefault(),e.stopPropagation(),this.suggestionEvents.push(e.detail),this.suggestions.push(e.detail(n))}registerSuggestions(e){this.suggestions.push(e)}get isDoubleList(){return!!(this.leftSuggestionElements.length&&this.rightSuggestionElements.length)}focusPanel(e){const n=e==="left"?this.leftPanel:this.rightPanel;if(this.panelInFocus!==n&&n&&n.firstElementChild){const i=this.previousActiveDescendantElement&&n.contains(this.previousActiveDescendantElement)?this.previousActiveDescendantElement:n.firstElementChild;this.updateDescendants(i.id)}}clearSuggestions(){this.clearSuggestionElements(),this.updateActiveDescendant()}focusNextValue(){!this.hasSuggestions||!this.nextOrFirstValue||this.focusValue(this.nextOrFirstValue)}focusValue(e){this.updateActiveDescendant(e.id),this.scrollActiveDescendantIntoView(),this.updateQueryFromSuggestion()}onSuggestionMouseOver(e,n,s){const i=n==="left"?this.leftPanel:this.rightPanel;this.panelInFocus===i?this.updateActiveDescendant(s):this.updateDescendants(s),e.query&&this.updateSuggestedQuery(e.query)}onSuggestionClick(e,n){e.query&&(this.clearSuggestions(),this.updateOwnerSearchboxQuery(e.query)),e.onSelect&&e.onSelect(n)}get hasSuggestions(){return!!this.allSuggestionElements.length}get allSuggestionElements(){return[...this.leftSuggestionElements,...this.rightSuggestionElements]}focusPreviousValue(){if(this.firstValue===this.activeDescendantElement){this.updateActiveDescendant();return}!this.hasSuggestions||!this.previousOrLastValue||this.focusValue(this.previousOrLastValue)}get hasActiveDescendant(){return this.activeDescendant!==""}async executeQuerySuggestion(){var e;this.updateActiveDescendant();const n=await Promise.allSettled(this.suggestions.map(r=>y(r.onInput?r.onInput():Promise.resolve(),this.ownerSearchBoxProps.getSuggestionTimeout()))),s=[];n.forEach((r,g)=>{r.status==="fulfilled"?s.push(this.suggestions[g]):this.ownerSearchBoxProps.getLogger().warn("Some query suggestions are not being shown because the promise timed out.")});const i=(r,g=!1)=>s.filter(a=>a.panel===r||!a.panel&&g).sort(this.sortSuggestions);this.leftSuggestions=i("left",!0),this.leftSuggestionElements=this.getAndFilterLeftSuggestionElements(),this.rightSuggestions=i("right"),this.rightSuggestionElements=this.getSuggestionElements(this.rightSuggestions);const l=((e=this.allSuggestionElements.find(V))===null||e===void 0?void 0:e.query)||"";this.updateSuggestedQuery(l)}get lastValue(){var e;return(e=this.panelInFocus)===null||e===void 0?void 0:e.lastElementChild}get previousOrLastValue(){var e;return this.hasActiveDescendant?((e=this.activeDescendantElement)===null||e===void 0?void 0:e.previousElementSibling)||this.lastValue:this.lastValue}sortSuggestions(e,n){return e.position-n.position}get nextOrFirstValue(){var e;return this.hasActiveDescendant?((e=this.activeDescendantElement)===null||e===void 0?void 0:e.nextElementSibling)||this.firstValue:this.firstValue}get firstValue(){var e;return(e=this.panelInFocus)===null||e===void 0?void 0:e.firstElementChild}get panelInFocus(){var e,n;return!((e=this.leftPanel)===null||e===void 0)&&e.contains(this.activeDescendantElement)?this.leftPanel:!((n=this.rightPanel)===null||n===void 0)&&n.contains(this.activeDescendantElement)?this.rightPanel:this.leftPanel||this.rightPanel}scrollActiveDescendantIntoView(){var e;(e=this.activeDescendantElement)===null||e===void 0||e.scrollIntoView({block:"nearest"})}updateQueryFromSuggestion(){var e;const n=(e=this.activeDescendantElement)===null||e===void 0?void 0:e.getAttribute(this.queryDataAttribute);this.updateOwnerSearchboxQuery(n||"")}updateOwnerSearchboxQuery(e){e&&this.ownerSearchBoxProps.getSearchBoxValue()!==e&&(this.ownerSearchBoxProps.updateQuery(e),this.updateSuggestedQuery(e))}async updateSuggestedQuery(e){await Promise.allSettled(this.suggestions.map(n=>y(n.onSuggestedQueryChange?n.onSuggestedQueryChange(e):Promise.resolve(),this.ownerSearchBoxProps.getSuggestionTimeout()))),this.suggestedQuery=e,this.updateSuggestionElements(e),E(this.ownerSearchBoxProps.getHost())}updateSuggestionElements(e){this.isPanelInFocus(this.leftPanel,e)||(this.leftSuggestionElements=this.getAndFilterLeftSuggestionElements()),this.isPanelInFocus(this.rightPanel,e)||(this.rightSuggestionElements=this.getSuggestionElements(this.rightSuggestions))}isPanelInFocus(e,n){var s;if(!this.activeDescendantElement)return!1;if(n){const i=A.sanitize(n);return!!(e!=null&&e.querySelector(`[${this.queryDataAttribute}="${i}"]`))}return((s=this.activeDescendantElement)===null||s===void 0?void 0:s.closest("ul"))===e}getAndFilterLeftSuggestionElements(){const e=this.getSuggestionElements(this.leftSuggestions),n=new Set;return e.filter(i=>m(i.query)?!0:n.has(i.query)?!1:(n.add(i.query),!0))}getSuggestionElements(e){const n=e.map(i=>i.renderItems()).flat(),s=this.ownerSearchBoxProps.getNumberOfSuggestionsToDisplay()+n.filter(L).length;return n.slice(0,s)}updateDescendants(e=""){const n=this.activeDescendantElement;this.previousActiveDescendantElement=n,this.updateActiveDescendant(e)}clearSuggestionElements(){this.leftSuggestionElements=[],this.rightSuggestionElements=[]}}const j="data-query";function M(t,e){let n="suggestion";return e&&(n+=" active-suggestion"),t.query&&(n+=" suggestion-with-query"),t.part&&(n+=` ${t.part}`),n}function $(t){return`flex px-4 min-h-[40px] items-center text-left text-neutral-dark cursor-pointer ${t?"bg-neutral-light":""}`}function x(t){return t instanceof HTMLElement}function T({renderedSuggestion:t,suggestion:e}){x(e.content)&&t.replaceChildren(e.content)}function N({bindings:t,renderedSuggestion:e,suggestion:n,side:s,index:i,lastIndex:l,isDoubleList:r,isButton:g}){var a,c,h;const f=(h=(c=(a=n.ariaLabel)!==null&&a!==void 0?a:n.query)!==null&&c!==void 0?c:e.innerText)!==null&&h!==void 0?h:t.i18n.t("no-title"),v=F()&&g?t.i18n.t("search-suggestion-button",{label:f,interpolation:{escapeValue:!1}}):f,p=i+1,o=l+1;return r?t.i18n.t("search-suggestion-double-list",{label:v,position:p,count:o,side:t.i18n.t(s==="left"?"left":"right"),interpolation:{escapeValue:!1}}):t.i18n.t("search-suggestion-single-list",{label:v,position:p,count:o,interpolation:{escapeValue:!1}})}function D(t){return x(t.content)?u(b,null):t.content}function w({bindings:t,id:e,suggestion:n,isSelected:s,side:i,index:l,lastIndex:r,isDoubleList:g},a){return{id:e,key:n.key,part:M(n,s),class:$(s),ref:c=>{c&&(T({renderedSuggestion:c,suggestion:n}),c.setAttribute("aria-label",N({bindings:t,renderedSuggestion:c,suggestion:n,side:i,index:l,lastIndex:r,isDoubleList:g,isButton:a})))}}}const _=t=>u("span",{...w(t,!1)},D(t.suggestion)),ee=t=>u("button",{...w(t,!0),onMouseDown:e=>e.preventDefault(),onClick:e=>{var n;return(n=t.onClick)===null||n===void 0?void 0:n.call(t,e)},onMouseOver:e=>{var n;return(n=t.onMouseOver)===null||n===void 0?void 0:n.call(t,e)},[j]:t.suggestion.query},D(t.suggestion));export{ee as B,Z as S,_ as V,X as b,W as h,Y as w};
