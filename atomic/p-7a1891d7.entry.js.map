{"version":3,"names":["atomicGeneratedAnswerFeedbackModalCss","AtomicGeneratedAnswerFeedbackModalStyle0","AtomicGeneratedAnswerFeedbackModal","this","isOpen","feedbackSubmitted","formId","randomID","updateBreakpoints","once","host","watchToggleOpen","generatedAnswer","openFeedbackModal","setIsOpen","close","detailsInputRef","value","currentAnswer","undefined","closeFeedbackModal","setCurrentAnswer","answer","sendFeedback","sendDetailedFeedback","feedbackSent","emit","renderHeader","h","slot","part","class","bindings","i18n","t","IconButton","style","onClick","icon","CloseIcon","partPrefix","ariaLabel","renderOptions","options","map","id","localeKey","correspondingAnswer","key","type","name","checked","onChange","e","_a","currentTarget","required","htmlFor","renderDetails","ref","detailsInput","rows","placeholder","renderBody","onSubmit","preventDefault","Success","renderFooter","Button","form","render","fullscreen","container","exportparts","__decorate","InitializeBindings"],"sources":["src/components/common/generated-answer/atomic-generated-answer-feedback/atomic-generated-answer-feedback-modal.pcss?tag=atomic-generated-answer-feedback-modal&encapsulation=shadow","src/components/common/generated-answer/atomic-generated-answer-feedback/atomic-generated-answer-feedback-modal.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n","import {GeneratedAnswer, GeneratedAnswerFeedback} from '@coveo/headless';\nimport {\n  Component,\n  State,\n  h,\n  Watch,\n  Prop,\n  Element,\n  Event,\n  EventEmitter,\n} from '@stencil/core/internal';\nimport {AnyBindings} from '../../../../components';\nimport CloseIcon from '../../../../images/close.svg';\nimport Success from '../../../../images/success.svg';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {updateBreakpoints} from '../../../../utils/replace-breakpoint';\nimport {once, randomID} from '../../../../utils/utils';\nimport {Button} from '../../button';\nimport {IconButton} from '../../iconButton';\n\n/**\n * @internal\n */\n@Component({\n  tag: 'atomic-generated-answer-feedback-modal',\n  styleUrl: 'atomic-generated-answer-feedback-modal.pcss',\n  shadow: true,\n})\nexport class AtomicGeneratedAnswerFeedbackModal\n  implements InitializableComponent<AnyBindings>\n{\n  @InitializeBindings() public bindings!: AnyBindings;\n  @Element() public host!: HTMLElement;\n\n  /**\n   * Indicates whether the modal is open.\n   */\n  @Prop({reflect: true, mutable: true}) isOpen = false;\n  /**\n   * A `GeneratedAnswer` controller instance. It is used when the user interacts with the modal.\n   */\n  @Prop({reflect: true, mutable: true}) generatedAnswer!: GeneratedAnswer;\n\n  @State() public error!: Error;\n  @State() currentAnswer?: GeneratedAnswerFeedback | 'other' | undefined;\n  @State() feedbackSubmitted: boolean = false;\n\n  private readonly formId = randomID(\n    'atomic-generated-answer-feedback-modal-form-'\n  );\n  private detailsInputRef?: HTMLTextAreaElement;\n\n  @Event() feedbackSent!: EventEmitter;\n\n  @Watch('isOpen')\n  watchToggleOpen(isOpen: boolean) {\n    if (isOpen) {\n      this.generatedAnswer.openFeedbackModal();\n    }\n  }\n\n  private static options: {\n    id: string;\n    localeKey: string;\n    correspondingAnswer: GeneratedAnswerFeedback | 'other';\n  }[] = [\n    {\n      id: 'irrelevant',\n      localeKey: 'irrelevant',\n      correspondingAnswer: 'irrelevant',\n    },\n    {\n      id: 'notAccurate',\n      localeKey: 'not-accurate',\n      correspondingAnswer: 'notAccurate',\n    },\n    {\n      id: 'outOfDate',\n      localeKey: 'out-of-date',\n      correspondingAnswer: 'outOfDate',\n    },\n    {\n      id: 'harmful',\n      localeKey: 'harmful',\n      correspondingAnswer: 'harmful',\n    },\n    {\n      id: 'other',\n      localeKey: 'other',\n      correspondingAnswer: 'other',\n    },\n  ];\n\n  private setIsOpen(isOpen: boolean) {\n    this.isOpen = isOpen;\n  }\n\n  private close() {\n    this.feedbackSubmitted = false;\n    if (this.detailsInputRef) {\n      this.detailsInputRef.value = '';\n    }\n    this.currentAnswer = undefined;\n    this.setIsOpen(false);\n    this.generatedAnswer.closeFeedbackModal();\n  }\n\n  private updateBreakpoints = once(() => updateBreakpoints(this.host));\n\n  private setCurrentAnswer(answer?: GeneratedAnswerFeedback | 'other') {\n    this.currentAnswer = answer;\n  }\n\n  public sendFeedback() {\n    if (this.currentAnswer === 'other') {\n      this.generatedAnswer.sendDetailedFeedback(this.detailsInputRef!.value);\n    } else {\n      this.generatedAnswer.sendFeedback(\n        this.currentAnswer as GeneratedAnswerFeedback\n      );\n    }\n    this.feedbackSent.emit();\n  }\n\n  private renderHeader() {\n    return (\n      <div\n        slot=\"header\"\n        part=\"modal-header\"\n        class=\"w-full flex justify-between items-center\"\n      >\n        <h1>{this.bindings.i18n.t('feedback')}</h1>\n        <IconButton\n          style=\"text-transparent\"\n          class=\"search-clear-button\"\n          onClick={() => this.close()}\n          icon={CloseIcon}\n          partPrefix={'close'}\n          ariaLabel={this.bindings.i18n.t('modal-done')}\n        />\n      </div>\n    );\n  }\n\n  private renderOptions() {\n    return (\n      <fieldset>\n        <legend part=\"reason-title\" class=\"text-base\">\n          {this.bindings.i18n.t('generated-answer-feedback-instructions')}\n        </legend>\n        {AtomicGeneratedAnswerFeedbackModal.options.map(\n          ({id, localeKey, correspondingAnswer}) => (\n            <div\n              class={`flex items-center ${correspondingAnswer} mobile-only:mt-4 desktop-only:mt-6`}\n              key={id}\n              part=\"reason\"\n            >\n              <input\n                part=\"reason-radio\"\n                type=\"radio\"\n                name=\"answer\"\n                id={id}\n                checked={this.currentAnswer === correspondingAnswer}\n                onChange={(e) =>\n                  (e.currentTarget as HTMLInputElement | null)?.checked &&\n                  this.setCurrentAnswer(correspondingAnswer)\n                }\n                class=\"mr-2\"\n                required\n              />\n              <label part=\"reason-label\" htmlFor={id}>\n                {this.bindings.i18n.t(localeKey)}\n              </label>\n            </div>\n          )\n        )}\n      </fieldset>\n    );\n  }\n\n  private renderDetails() {\n    if (this.currentAnswer !== 'other') {\n      return;\n    }\n\n    return (\n      <fieldset>\n        <textarea\n          part=\"details-input\"\n          name=\"answer-details\"\n          ref={(detailsInput) => (this.detailsInputRef = detailsInput)}\n          class=\"mt-2 p-2 w-full text-base leading-5 border border-neutral resize-none rounded\"\n          rows={4}\n          placeholder={this.bindings.i18n.t('add-details')}\n          required\n        ></textarea>\n      </fieldset>\n    );\n  }\n\n  private renderBody() {\n    return !this.feedbackSubmitted ? (\n      <form\n        part=\"form\"\n        id={this.formId}\n        slot=\"body\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.feedbackSubmitted = true;\n          this.sendFeedback();\n        }}\n        class=\"flex flex-col gap-8 text-base leading-4 text-neutral-dark p-2\"\n      >\n        {this.renderOptions()}\n        {this.renderDetails()}\n      </form>\n    ) : (\n      <div slot=\"body\" class=\"flex flex-col items-center gap-4 my-4\">\n        <atomic-icon icon={Success} class=\"w-48\" />\n        <p class=\"text-base\">\n          {this.bindings.i18n.t('generated-answer-feedback-success')}\n        </p>\n      </div>\n    );\n  }\n\n  private renderFooter() {\n    return (\n      <div slot=\"footer\" part=\"modalFooter\">\n        {!this.feedbackSubmitted ? (\n          <div part=\"buttons\" class=\"flex justify-end gap-2 px-4\">\n            <Button\n              part=\"cancel-button\"\n              style=\"outline-neutral\"\n              class=\"text-primary flex justify-center text-sm leading-4 p-2\"\n              ariaLabel={this.bindings.i18n.t('close')}\n              onClick={() => this.close()}\n            >\n              {this.bindings.i18n.t('close')}\n            </Button>\n            <Button\n              part=\"submit-button\"\n              style=\"primary\"\n              type=\"submit\"\n              form={this.formId}\n              class=\"flex justify-center text-sm leading-4 p-2\"\n              ariaLabel={this.bindings.i18n.t('feedback-send')}\n            >\n              {this.bindings.i18n.t('feedback-send')}\n            </Button>\n          </div>\n        ) : (\n          <div part=\"buttons\" class=\"flex justify-end gap-2 p-2\">\n            <Button\n              part=\"cancel-button\"\n              style=\"primary\"\n              onClick={() => this.close()}\n              class=\"flex justify-center text-sm leading-4 p-2\"\n              ariaLabel={this.bindings.i18n.t('modal-done')}\n            >\n              {this.bindings.i18n.t('modal-done')}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  public render() {\n    this.updateBreakpoints();\n\n    return (\n      <atomic-modal\n        fullscreen={false}\n        isOpen={this.isOpen}\n        close={() => this.close()}\n        container={this.host}\n        exportparts=\"backdrop,container,header,header-wrapper,header-ruler,body,body-wrapper,footer,footer-wrapper,footer-wrapper\"\n      >\n        {this.renderHeader()}\n        {this.renderBody()}\n        {this.renderFooter()}\n      </atomic-modal>\n    );\n  }\n}\n"],"mappings":"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"}