{"file":"result-children-common-22a06ebf.js","mappings":"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","names":[],"sources":["src/components/common/result-children/result-children-common.tsx"],"sourcesContent":["import {\r\n  FoldedResult,\r\n  FoldedResultList,\r\n  FoldedResultListState,\r\n} from '@coveo/headless';\r\nimport {Host, VNode, h} from '@stencil/core';\r\nimport {ResultsPlaceholder} from '../atomic-result-placeholder/placeholders';\r\nimport {Button} from '../button';\r\nimport {AnyBindings} from '../interface/bindings';\r\nimport {DisplayConfig} from '../item-list/item-decorators';\r\nimport {ItemDisplayImageSize} from '../layout/display-options';\r\n\r\ninterface ResultChildrenProps {\r\n  getHost: () => HTMLElement;\r\n  getBindings: () => AnyBindings;\r\n  getFoldedResultListState: () => FoldedResultListState;\r\n  getResult: () => FoldedResult;\r\n  getShowInitialChildren: () => boolean;\r\n  getFoldedResultList: () => FoldedResultList;\r\n  getInitialChildren: () => FoldedResult[];\r\n  getInheritTemplates: () => boolean;\r\n  getResultTemplateRegistered: () => boolean;\r\n  getTemplateHasError: () => boolean;\r\n  getNoResultText: () => string;\r\n  getDisplayConfig: () => DisplayConfig;\r\n  getImageSize: () => ItemDisplayImageSize | undefined;\r\n  renderChild: (child: FoldedResult, isLast: boolean) => VNode;\r\n  setInitialChildren: (initialChildren: FoldedResult[]) => void;\r\n  toggleShowInitialChildren: () => void;\r\n}\r\n\r\nexport class ResultChildrenCommon {\r\n  constructor(private props: ResultChildrenProps) {}\r\n\r\n  private get foldedResult(): FoldedResult {\r\n    return this.collection || this.props.getResult();\r\n  }\r\n\r\n  private get numberOfChildren() {\r\n    return this.foldedResult.children.length;\r\n  }\r\n\r\n  private get hasChildren() {\r\n    return !!this.numberOfChildren;\r\n  }\r\n\r\n  private get collection() {\r\n    return this.props.getFoldedResultListState().results.find((r) => {\r\n      return r.result.uniqueId === this.props.getResult().result.uniqueId;\r\n    });\r\n  }\r\n\r\n  private renderPlaceholder() {\r\n    return (\r\n      <ResultsPlaceholder\r\n        numberOfPlaceholders={this.numberOfChildren || 2}\r\n        density={this.props.getDisplayConfig().density}\r\n        display={'list'}\r\n        imageSize={\r\n          this.props.getImageSize() || this.props.getDisplayConfig().imageSize\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  private renderNoResult() {\r\n    return (\r\n      <p part=\"no-result-root\" class=\"no-result-root my-3\">\r\n        {this.props.getBindings().i18n.t(this.props.getNoResultText())}\r\n      </p>\r\n    );\r\n  }\r\n\r\n  private renderCollapseButton() {\r\n    const collection = this.collection!;\r\n    if (!!collection.children.length && !collection.moreResultsAvailable) {\r\n      return (\r\n        <Button\r\n          part=\"show-hide-button\"\r\n          class=\"show-hide-button\"\r\n          style=\"text-primary\"\r\n          onClick={() => {\r\n            if (this.props.getShowInitialChildren()) {\r\n              this.props\r\n                .getFoldedResultList()\r\n                .logShowMoreFoldedResults(this.foldedResult.result);\r\n            } else {\r\n              this.props.getFoldedResultList().logShowLessFoldedResults();\r\n            }\r\n            this.props.toggleShowInitialChildren();\r\n          }}\r\n        >\r\n          {this.props\r\n            .getBindings()\r\n            .i18n.t(\r\n              this.props.getShowInitialChildren()\r\n                ? 'load-all-results'\r\n                : 'collapse-results'\r\n            )}\r\n        </Button>\r\n      );\r\n    }\r\n    return;\r\n  }\r\n\r\n  private renderChildrenWrapper(content: VNode | VNode[]) {\r\n    return (\r\n      <div part=\"children-root\">\r\n        {this.hasChildren && <slot name=\"before-children\"></slot>}\r\n        {content}\r\n        {this.hasChildren && <slot name=\"after-children\"></slot>}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderChildren(children: FoldedResult[]): VNode | VNode[] {\r\n    return this.renderChildrenWrapper(\r\n      children.map((child, i) =>\r\n        this.props.renderChild(child, i === children.length - 1)\r\n      )\r\n    );\r\n  }\r\n\r\n  private renderCollection() {\r\n    const collection = this.collection!;\r\n\r\n    if (collection.isLoadingMoreResults) {\r\n      return this.renderChildrenWrapper(this.renderPlaceholder());\r\n    }\r\n\r\n    if (!collection.moreResultsAvailable && !this.hasChildren) {\r\n      return this.props.getNoResultText()?.trim().length\r\n        ? this.renderNoResult()\r\n        : null;\r\n    }\r\n\r\n    if (!this.hasChildren) {\r\n      return;\r\n    }\r\n\r\n    const childrenToRender = this.props.getShowInitialChildren()\r\n      ? this.props.getInitialChildren()\r\n      : collection.children;\r\n\r\n    return (\r\n      <Host>\r\n        {this.renderCollapseButton()}\r\n        {this.renderChildren(childrenToRender)}\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  private renderFoldedResult() {\r\n    if (!this.hasChildren) {\r\n      return;\r\n    }\r\n\r\n    return this.renderChildren(this.foldedResult.children);\r\n  }\r\n\r\n  public componentWillRender() {\r\n    const collection = this.collection;\r\n    if (this.props.getInitialChildren() || !collection) {\r\n      return;\r\n    }\r\n\r\n    this.props.setInitialChildren(collection.children);\r\n  }\r\n\r\n  public render() {\r\n    if (\r\n      !this.props.getInheritTemplates() &&\r\n      !this.props.getResultTemplateRegistered()\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.props.getInheritTemplates() && this.props.getTemplateHasError()) {\r\n      return <slot></slot>;\r\n    }\r\n\r\n    return this.collection\r\n      ? this.renderCollection()\r\n      : this.renderFoldedResult();\r\n  }\r\n}\r\n"],"version":3}