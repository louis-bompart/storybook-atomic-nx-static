{"version":3,"names":["atomicCommerceSortDropdownCss","AtomicCommerceSortDropdownStyle0","AtomicCommerceSortDropdown","this","id","randomID","initialize","bindings","interfaceElement","type","searchOrListing","buildProductListing","engine","buildSearch","sort","select","e","composedPath","sortBy","getSortByLabel","value","getLabel","by","fields","map","sortByField","displayName","name","join","render","error","responseId","products","searchOrListingState","i18n","h","SortGuard","key","firstSearchExecuted","hasError","hasResults","length","sortState","availableSorts","SortContainer","SortLabel","SortSelect","onSelect","evt","availableSort","label","SortOption","selected","isSortedBy","sortByLabel","forEach","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/commerce/atomic-commerce-sort-dropdown/atomic-commerce-sort-dropdown.pcss?tag=atomic-commerce-sort-dropdown&encapsulation=shadow","src/components/commerce/atomic-commerce-sort-dropdown/atomic-commerce-sort-dropdown.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\r\n\r\nselect:hover + div,\r\nselect:focus-visible + div {\r\n  @apply border-primary-light text-primary-light;\r\n}\r\n","import {\r\n  Sort,\r\n  SortState,\r\n  Search,\r\n  ProductListing,\r\n  buildProductListing,\r\n  buildSearch,\r\n  SearchState,\r\n  ProductListingState,\r\n  SortCriterion,\r\n} from '@coveo/headless/commerce';\r\nimport {Component, h, State, Element} from '@stencil/core';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../utils/initialization-utils';\r\nimport {randomID} from '../../../utils/utils';\r\nimport {SortContainer} from '../../common/sort/container';\r\nimport {SortGuard} from '../../common/sort/guard';\r\nimport {SortLabel} from '../../common/sort/label';\r\nimport {SortOption} from '../../common/sort/option';\r\nimport {SortSelect} from '../../common/sort/select';\r\nimport {CommerceBindings} from '../atomic-commerce-interface/atomic-commerce-interface';\r\n\r\n/**\r\n * The `atomic-commerce-sort-dropdown` component renders a dropdown that the end user can interact with to select the criteria to use when sorting products.\r\n *\r\n * @part label - The \"Sort by\" label of the `<select>` element.\r\n * @part select-parent - The `<select>` element parent.\r\n * @part select - The `<select>` element of the dropdown list.\r\n * @part select-separator - The element separating the select from the icon.\r\n * @part placeholder - The dropdown placeholder for while the interface is initializing.\r\n *\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-commerce-sort-dropdown',\r\n  styleUrl: 'atomic-commerce-sort-dropdown.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicCommerceSortDropdown\r\n  implements InitializableComponent<CommerceBindings>\r\n{\r\n  @InitializeBindings() public bindings!: CommerceBindings;\r\n\r\n  private id = randomID('atomic-commerce-sort-dropdown-');\r\n\r\n  @Element() host!: HTMLElement;\r\n\r\n  public sort!: Sort;\r\n  @BindStateToController('sort')\r\n  @State()\r\n  public sortState!: SortState;\r\n\r\n  public searchOrListing!: Search | ProductListing;\r\n  @BindStateToController('searchOrListing')\r\n  @State()\r\n  private searchOrListingState!: SearchState | ProductListingState;\r\n\r\n  @State() public error!: Error;\r\n\r\n  public initialize() {\r\n    if (this.bindings.interfaceElement.type === 'product-listing') {\r\n      this.searchOrListing = buildProductListing(this.bindings.engine);\r\n    } else {\r\n      this.searchOrListing = buildSearch(this.bindings.engine);\r\n    }\r\n    this.sort = this.searchOrListing.sort();\r\n  }\r\n\r\n  private select(e: Event) {\r\n    const select = e.composedPath()[0] as HTMLSelectElement;\r\n    this.sort.sortBy(this.getSortByLabel(select.value));\r\n  }\r\n\r\n  private getLabel(sort: SortCriterion) {\r\n    if (sort.by === 'relevance') {\r\n      return 'relevance';\r\n    } else {\r\n      return sort.fields\r\n        .map((sortByField) => {\r\n          return sortByField.displayName || sortByField.name;\r\n        })\r\n        .join(' ');\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    const {error, responseId, products} = this.searchOrListingState;\r\n    const {\r\n      bindings: {i18n},\r\n      id,\r\n    } = this;\r\n    return (\r\n      <SortGuard\r\n        firstSearchExecuted={responseId !== ''}\r\n        hasError={error !== null}\r\n        hasResults={\r\n          products.length > 0 && this.sortState.availableSorts.length > 1\r\n        }\r\n      >\r\n        <SortContainer>\r\n          <SortLabel i18n={i18n} id={id} />\r\n          <SortSelect i18n={i18n} id={id} onSelect={(evt) => this.select(evt)}>\r\n            {this.sortState.availableSorts.map((availableSort) => {\r\n              const label = this.getLabel(availableSort);\r\n              return (\r\n                <SortOption\r\n                  i18n={i18n}\r\n                  label={label}\r\n                  selected={this.sort.isSortedBy(availableSort)}\r\n                  value={label}\r\n                />\r\n              );\r\n            })}\r\n          </SortSelect>\r\n        </SortContainer>\r\n      </SortGuard>\r\n    );\r\n  }\r\n\r\n  private getSortByLabel(label: string) {\r\n    const sortByLabel: Record<string, SortCriterion> = {};\r\n    this.sortState.availableSorts.forEach((availableSort) => {\r\n      sortByLabel[this.getLabel(availableSort)] = availableSort;\r\n    });\r\n\r\n    return sortByLabel[label];\r\n  }\r\n}\r\n"],"mappings":"+SAAA,MAAMA,EAAgC,8wuCACtC,MAAAC,EAAeD,E,iXCwCFE,EAA0B,M,yBAK7BC,KAAAC,GAAKC,EAAS,kC,kFAgBf,UAAAC,GACL,GAAIH,KAAKI,SAASC,iBAAiBC,OAAS,kBAAmB,CAC7DN,KAAKO,gBAAkBC,EAAoBR,KAAKI,SAASK,O,KACpD,CACLT,KAAKO,gBAAkBG,EAAYV,KAAKI,SAASK,O,CAEnDT,KAAKW,KAAOX,KAAKO,gBAAgBI,M,CAG3B,MAAAC,CAAOC,GACb,MAAMD,EAASC,EAAEC,eAAe,GAChCd,KAAKW,KAAKI,OAAOf,KAAKgB,eAAeJ,EAAOK,O,CAGtC,QAAAC,CAASP,GACf,GAAIA,EAAKQ,KAAO,YAAa,CAC3B,MAAO,W,KACF,CACL,OAAOR,EAAKS,OACTC,KAAKC,GACGA,EAAYC,aAAeD,EAAYE,OAE/CC,KAAK,I,EAIL,MAAAC,GACL,MAAMC,MAACA,EAAKC,WAAEA,EAAUC,SAAEA,GAAY7B,KAAK8B,qBAC3C,MACE1B,UAAU2B,KAACA,GAAK9B,GAChBA,GACED,KACJ,OACEgC,EAACC,EAAS,CAAAC,IAAA,2CACRC,oBAAqBP,IAAe,GACpCQ,SAAUT,IAAU,KACpBU,WACER,EAASS,OAAS,GAAKtC,KAAKuC,UAAUC,eAAeF,OAAS,GAGhEN,EAACS,EAAa,CAAAP,IAAA,4CACZF,EAACU,EAAS,CAAAR,IAAA,2CAACH,KAAMA,EAAM9B,GAAIA,IAC3B+B,EAACW,EAAU,CAAAT,IAAA,2CAACH,KAAMA,EAAM9B,GAAIA,EAAI2C,SAAWC,GAAQ7C,KAAKY,OAAOiC,IAC5D7C,KAAKuC,UAAUC,eAAenB,KAAKyB,IAClC,MAAMC,EAAQ/C,KAAKkB,SAAS4B,GAC5B,OACEd,EAACgB,EAAU,CACTjB,KAAMA,EACNgB,MAAOA,EACPE,SAAUjD,KAAKW,KAAKuC,WAAWJ,GAC/B7B,MAAO8B,GACP,M,CASR,cAAA/B,CAAe+B,GACrB,MAAMI,EAA6C,GACnDnD,KAAKuC,UAAUC,eAAeY,SAASN,IACrCK,EAAYnD,KAAKkB,SAAS4B,IAAkBA,CAAa,IAG3D,OAAOK,EAAYJ,E,6BApFQM,EAAA,CAA5BC,K,+BASMD,EAAA,CAFNE,EAAsB,S,gCAOfF,EAAA,CAFPE,EAAsB,oB"}