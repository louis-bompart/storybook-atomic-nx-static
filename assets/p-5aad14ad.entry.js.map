{"version":3,"names":["getAnalyticsConfig","commerceEngineConfig","enabled","defaultConfiguration","documentLocation","document","location","href","referrer","originLevel3","analyticsMode","analytics","createAtomicCommerceStore","commonStore","createAtomicCommonStore","loadingFlags","facets","numericFacets","dateFacets","categoryFacets","facetElements","sortOptions","iconAssetsPath","mobileBreakpoint","DEFAULT_MOBILE_BREAKPOINT","fieldsToInclude","currentQuickviewPosition","getAllFacets","state","isMobile","window","matchMedia","makeDesktopQuery","matches","atomicCommerceInterfaceCss","AtomicCommerceInterfaceStyle0","FirstSearchExecutedFlag","AtomicCommerceInterface","constructor","hostRef","this","unsubscribeUrlManager","unsubscribeSearchStatus","initialized","store","type","i18n","i18next","createInstance","language","reflectStateInUrl","scrollContainer","languageAssetsPath","onHashChange","urlManager","synchronize","fragment","commonInterfaceHelper","CommonAtomicInterfaceHelper","connectedCallback","setLoadingFlag","i18nClone","cloneInstance","addResourceBundle","lng","ns","resources","deep","overwrite","componentWillLoad","CspNonce","setNonce","initAriaLive","toggleAnalytics","engineIsCreated","engine","onAnalyticsChange","updateLanguage","onLanguageChange","updateIconAssetsPath","set","disconnectedCallback","removeEventListener","handleInitialization","event","onComponentInitializing","scrollToTop","scrollContainerElement","querySelector","bindings","logger","warn","scrollIntoView","behavior","initialize","options","internalInitialization","initEngine","initializeWithEngine","executeFirstSearch","console","error","host","safeStorage","SafeStorage","standaloneSearchBoxData","getParsedJSON","StorageItems","STANDALONE_SEARCH_BOX_DATA","removeItem","value","dispatch","updateQuery","query","getOrganizationEndpoints","organizationId","env","getOrganizationEndpointsHeadless","interfaceElement","createStyleElement","styleTag","createElement","setAttribute","createScriptElement","analyticsConfig","buildCommerceEngine","configuration","loggerOptions","level","logLevel","hash","slice","Array","from","children","some","element","tagName","prepend","initUrlManager","searchStatus","initialState","subscribe","updateHash","addEventListener","initSearchStatus","buildProductListing","buildSearch","isLoading","hasLoadingFlag","unsetLoadingFlag","newFragment","history","replaceState","title","info","pushState","onInitialization","render","h","key"],"sources":["src/components/commerce/atomic-commerce-interface/analytics-config.ts","src/components/commerce/atomic-commerce-interface/store.ts","src/components/commerce/atomic-commerce-interface/atomic-commerce-interface.pcss?tag=atomic-commerce-interface&encapsulation=shadow","src/components/commerce/atomic-commerce-interface/atomic-commerce-interface.tsx"],"sourcesContent":["import {\r\n  AnalyticsConfiguration,\r\n  CommerceEngineConfiguration,\r\n} from '@coveo/headless/commerce';\r\n\r\nexport function getAnalyticsConfig(\r\n  commerceEngineConfig: CommerceEngineConfiguration,\r\n  enabled: boolean\r\n): AnalyticsConfiguration {\r\n  const defaultConfiguration: AnalyticsConfiguration = {\r\n    enabled,\r\n    documentLocation: document.location.href,\r\n    ...(document.referrer && {originLevel3: document.referrer}),\r\n    analyticsMode: 'next',\r\n  };\r\n\r\n  if (commerceEngineConfig.analytics) {\r\n    return {\r\n      ...defaultConfiguration,\r\n      ...commerceEngineConfig.analytics,\r\n    };\r\n  }\r\n  return defaultConfiguration;\r\n}\r\n","import {\r\n  NumericFacetValue,\r\n  DateFacetValue,\r\n  SortCriterion,\r\n} from '@coveo/headless/commerce';\r\nimport {DEFAULT_MOBILE_BREAKPOINT} from '../../../utils/replace-breakpoint';\r\nimport {\r\n  FacetInfo,\r\n  FacetStore,\r\n  FacetValueFormat,\r\n} from '../../common/facets/facet-common-store';\r\nimport {\r\n  createAtomicCommonStore,\r\n  AtomicCommonStoreData,\r\n  AtomicCommonStore,\r\n} from '../../common/interface/store';\r\nimport {makeDesktopQuery} from '../../search/atomic-layout/search-layout';\r\n\r\nexport interface SortDropdownOption {\r\n  expression: string;\r\n  criteria: SortCriterion[];\r\n  label: string;\r\n}\r\n\r\nexport interface AtomicStoreData extends AtomicCommonStoreData {\r\n  facets: FacetStore<FacetInfo>;\r\n  numericFacets: FacetStore<FacetInfo & FacetValueFormat<NumericFacetValue>>;\r\n  dateFacets: FacetStore<FacetInfo & FacetValueFormat<DateFacetValue>>;\r\n  categoryFacets: FacetStore<FacetInfo>;\r\n  sortOptions: SortDropdownOption[];\r\n  mobileBreakpoint: string;\r\n  currentQuickviewPosition: number;\r\n}\r\n\r\nexport interface AtomicCommerceStore\r\n  extends AtomicCommonStore<AtomicStoreData> {\r\n  getAllFacets(): FacetInfoMap;\r\n\r\n  isMobile(): boolean;\r\n}\r\n\r\nexport interface FacetInfoMap {\r\n  [facetId: string]:\r\n    | FacetInfo\r\n    | (FacetInfo & FacetValueFormat<NumericFacetValue>)\r\n    | (FacetInfo & FacetValueFormat<DateFacetValue>);\r\n}\r\n\r\nexport function createAtomicCommerceStore(): AtomicCommerceStore {\r\n  const commonStore = createAtomicCommonStore<AtomicStoreData>({\r\n    loadingFlags: [],\r\n    facets: {},\r\n    numericFacets: {},\r\n    dateFacets: {},\r\n    categoryFacets: {},\r\n    facetElements: [],\r\n    sortOptions: [],\r\n    iconAssetsPath: '',\r\n    mobileBreakpoint: DEFAULT_MOBILE_BREAKPOINT,\r\n    fieldsToInclude: [],\r\n    currentQuickviewPosition: -1,\r\n  });\r\n\r\n  return {\r\n    ...commonStore,\r\n\r\n    getAllFacets() {\r\n      return {\r\n        ...commonStore.state.facets,\r\n        ...commonStore.state.dateFacets,\r\n        ...commonStore.state.categoryFacets,\r\n        ...commonStore.state.numericFacets,\r\n      };\r\n    },\r\n\r\n    isMobile() {\r\n      return !window.matchMedia(\r\n        makeDesktopQuery(commonStore.state.mobileBreakpoint)\r\n      ).matches;\r\n    },\r\n  };\r\n}\r\n","@import '../../../global/global.pcss';\r\n\r\n:host {\r\n  height: inherit;\r\n  width: inherit;\r\n  & > slot {\r\n    height: inherit;\r\n  }\r\n}\r\n","import {\r\n  PlatformEnvironment,\r\n  LogLevel,\r\n  Search,\r\n  Unsubscribe,\r\n  UrlManager,\r\n  buildSearch,\r\n  getOrganizationEndpoints as getOrganizationEndpointsHeadless,\r\n  updateQuery,\r\n  CommerceEngine,\r\n  CommerceEngineConfiguration,\r\n  buildCommerceEngine,\r\n  buildProductListing,\r\n  ProductListing,\r\n} from '@coveo/headless/commerce';\r\nimport {\r\n  Component,\r\n  Prop,\r\n  h,\r\n  Listen,\r\n  Method,\r\n  Watch,\r\n  Element,\r\n  State,\r\n  setNonce,\r\n} from '@stencil/core';\r\nimport i18next, {i18n} from 'i18next';\r\nimport {InitializeEvent} from '../../../utils/initialization-utils';\r\nimport {\r\n  SafeStorage,\r\n  StandaloneSearchBoxData,\r\n  StorageItems,\r\n} from '../../../utils/local-storage-utils';\r\nimport {CommonBindings, NonceBindings} from '../../common/interface/bindings';\r\nimport {\r\n  BaseAtomicInterface,\r\n  CommonAtomicInterfaceHelper,\r\n} from '../../common/interface/interface-common';\r\nimport {getAnalyticsConfig} from './analytics-config';\r\nimport {AtomicCommerceStore, createAtomicCommerceStore} from './store';\r\n\r\nconst FirstSearchExecutedFlag = 'firstSearchExecuted';\r\n\r\nexport type CommerceInitializationOptions = CommerceEngineConfiguration;\r\nexport type CommerceBindings = CommonBindings<\r\n  CommerceEngine,\r\n  AtomicCommerceStore,\r\n  HTMLAtomicCommerceInterfaceElement\r\n> &\r\n  NonceBindings;\r\n\r\n/**\r\n * @internal\r\n * The `atomic-commerce-interface` component is the parent to all other atomic commerce components in a commerce page. It handles the headless search engine and localization configurations.\r\n */\r\n@Component({\r\n  tag: 'atomic-commerce-interface',\r\n  styleUrl: 'atomic-commerce-interface.pcss',\r\n  shadow: true,\r\n  assetsDirs: ['lang'],\r\n})\r\nexport class AtomicCommerceInterface\r\n  implements BaseAtomicInterface<CommerceEngine>\r\n{\r\n  private urlManager!: UrlManager;\r\n  private searchStatus!: Search | ProductListing;\r\n  private unsubscribeUrlManager: Unsubscribe = () => {};\r\n  private unsubscribeSearchStatus: Unsubscribe = () => {};\r\n  private initialized = false;\r\n  private store = createAtomicCommerceStore();\r\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<CommerceEngine>;\r\n\r\n  @Element() public host!: HTMLAtomicCommerceInterfaceElement;\r\n\r\n  @State() public error?: Error;\r\n\r\n  /**\r\n   * The type of the interface.\r\n   * - 'search': Indicates that the interface is used for Search.\r\n   * - 'product-listing': Indicates that the interface is used for Product listing.\r\n   */\r\n  @Prop({reflect: true, mutable: true}) public type:\r\n    | 'search'\r\n    | 'product-listing'\r\n    | 'recommendations' = 'search';\r\n\r\n  /**\r\n   * Whether analytics should be enabled.\r\n   */\r\n  @Prop({reflect: true}) public analytics = true;\r\n\r\n  /**\r\n   * The severity level of the messages to log in the console.\r\n   */\r\n  @Prop({reflect: true}) public logLevel?: LogLevel;\r\n\r\n  /**\r\n   * the commerce interface i18next instance.\r\n   */\r\n  @Prop() public i18n: i18n = i18next.createInstance();\r\n\r\n  /**\r\n   * the commerce interface language.\r\n   */\r\n  @Prop({reflect: true}) public language = 'en';\r\n\r\n  /**\r\n   * The commerce interface headless engine.\r\n   */\r\n  @Prop({mutable: true}) public engine?: CommerceEngine;\r\n\r\n  /**\r\n   * Whether the state should be reflected in the URL parameters.\r\n   */\r\n  @Prop({reflect: true}) public reflectStateInUrl = true;\r\n\r\n  /**\r\n   * The CSS selector for the container where the interface will scroll back to.\r\n   */\r\n  @Prop({reflect: true}) public scrollContainer = 'atomic-commerce-interface';\r\n\r\n  /**\r\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\r\n   *\r\n   * Example: \"/mypublicpath/languages\"\r\n   *\r\n   */\r\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\r\n\r\n  /**\r\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\r\n   *\r\n   * Example: \"/mypublicpath/icons\"\r\n   *\r\n   */\r\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\r\n\r\n  /**\r\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\r\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\r\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\r\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\r\n   * Otherwise you may see console errors such as\r\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\r\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\r\n   * @example:\r\n   * ```html\r\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\r\n   *  import {setNonce} from '@coveo/atomic';\r\n   *  setNonce('<YOUR_GENERATED_NONCE>');\r\n   * </script>\r\n   * ```\r\n   */\r\n  @Prop({reflect: true}) public CspNonce?: string;\r\n\r\n  /**\r\n   * A reference clone of the interface i18next instance.\r\n   */\r\n  private i18nClone!: i18n;\r\n\r\n  public constructor() {\r\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\r\n      this,\r\n      'CoveoAtomic'\r\n    );\r\n  }\r\n\r\n  public connectedCallback() {\r\n    this.store.setLoadingFlag(FirstSearchExecutedFlag);\r\n    this.i18nClone = this.i18n.cloneInstance();\r\n    this.i18n.addResourceBundle = (\r\n      lng: string,\r\n      ns: string,\r\n      resources: object,\r\n      deep?: boolean,\r\n      overwrite?: boolean\r\n    ) => this.addResourceBundle(lng, ns, resources, deep, overwrite);\r\n  }\r\n\r\n  componentWillLoad() {\r\n    if (this.CspNonce) {\r\n      setNonce(this.CspNonce);\r\n    }\r\n    this.initAriaLive();\r\n  }\r\n\r\n  @Watch('analytics')\r\n  public toggleAnalytics() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    this.commonInterfaceHelper.onAnalyticsChange();\r\n  }\r\n\r\n  @Watch('language')\r\n  public updateLanguage() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n    this.commonInterfaceHelper.onLanguageChange();\r\n  }\r\n\r\n  @Watch('iconAssetsPath')\r\n  public updateIconAssetsPath() {\r\n    this.store.set('iconAssetsPath', this.iconAssetsPath);\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    this.unsubscribeUrlManager();\r\n    this.unsubscribeSearchStatus();\r\n    window.removeEventListener('hashchange', this.onHashChange);\r\n  }\r\n\r\n  @Listen('atomic/initializeComponent')\r\n  public handleInitialization(event: InitializeEvent) {\r\n    this.commonInterfaceHelper.onComponentInitializing(event);\r\n  }\r\n\r\n  @Listen('atomic/scrollToTop')\r\n  public scrollToTop() {\r\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\r\n    if (!scrollContainerElement) {\r\n      this.bindings.engine.logger.warn(\r\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\r\n      );\r\n      return;\r\n    }\r\n\r\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\r\n  }\r\n\r\n  /**\r\n   * Initializes the connection with the headless search engine using options for accessToken (required), organizationId (required), renewAccessToken, organizationEndpoints (recommended), and platformUrl (deprecated).\r\n   */\r\n  @Method() public initialize(options: CommerceInitializationOptions) {\r\n    return this.internalInitialization(() => this.initEngine(options));\r\n  }\r\n\r\n  /**\r\n   * Initializes the connection with an already preconfigured [headless search engine](https://docs.coveo.com/en/headless/latest/reference/search/), as opposed to the `initialize` method, which will internally create a new search engine instance.\r\n   * This bypasses the properties set on the component, such as analytics, searchHub, pipeline, language, timezone & logLevel.\r\n   */\r\n  @Method() public initializeWithEngine(engine: CommerceEngine) {\r\n    return this.internalInitialization(() => (this.engine = engine));\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Executes the first search after initializing connection to the headless search engine.\r\n   */\r\n  @Method() public async executeFirstSearch() {\r\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\r\n      return;\r\n    }\r\n\r\n    if (!this.initialized) {\r\n      console.error(\r\n        'You have to wait until the \"initialize\" promise is fulfilled before executing a search.',\r\n        this.host\r\n      );\r\n      return;\r\n    }\r\n\r\n    const safeStorage = new SafeStorage();\r\n\r\n    const standaloneSearchBoxData =\r\n      safeStorage.getParsedJSON<StandaloneSearchBoxData | null>(\r\n        StorageItems.STANDALONE_SEARCH_BOX_DATA,\r\n        null\r\n      );\r\n\r\n    if (!standaloneSearchBoxData) {\r\n      this.engine.executeFirstSearch();\r\n      return;\r\n    }\r\n\r\n    safeStorage.removeItem(StorageItems.STANDALONE_SEARCH_BOX_DATA);\r\n    const {value} = standaloneSearchBoxData;\r\n    this.engine!.dispatch(updateQuery({query: value}));\r\n    this.engine.executeFirstSearch();\r\n  }\r\n\r\n  /**\r\n   * Returns the unique, organization-specific endpoint(s).\r\n   * @param {string} organizationId\r\n   * @param {'prod'|'hipaa'|'staging'|'dev'} [env=Prod]\r\n   */\r\n  @Method() public async getOrganizationEndpoints(\r\n    organizationId: string,\r\n    env: PlatformEnvironment = 'prod'\r\n  ) {\r\n    return getOrganizationEndpointsHeadless(organizationId, env);\r\n  }\r\n\r\n  public get bindings(): CommerceBindings {\r\n    return {\r\n      engine: this.engine!,\r\n      i18n: this.i18n,\r\n      store: this.store,\r\n      interfaceElement: this.host,\r\n      createStyleElement: () => {\r\n        const styleTag = document.createElement('style');\r\n        if (this.CspNonce) {\r\n          styleTag.setAttribute('nonce', this.CspNonce);\r\n        }\r\n        return styleTag;\r\n      },\r\n      createScriptElement: () => {\r\n        const styleTag = document.createElement('script');\r\n        if (this.CspNonce) {\r\n          styleTag.setAttribute('nonce', this.CspNonce);\r\n        }\r\n        return styleTag;\r\n      },\r\n    };\r\n  }\r\n\r\n  private initEngine(options: CommerceInitializationOptions) {\r\n    const analyticsConfig = getAnalyticsConfig(options, this.analytics);\r\n    try {\r\n      this.engine = buildCommerceEngine({\r\n        configuration: {\r\n          ...options,\r\n          analytics: analyticsConfig,\r\n        },\r\n        loggerOptions: {\r\n          level: this.logLevel,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      this.error = error as Error;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private get fragment() {\r\n    return window.location.hash.slice(1);\r\n  }\r\n\r\n  private initAriaLive() {\r\n    if (\r\n      Array.from(this.host.children).some(\r\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\r\n      )\r\n    ) {\r\n      return;\r\n    }\r\n    this.host.prepend(document.createElement('atomic-aria-live'));\r\n  }\r\n\r\n  private initUrlManager() {\r\n    if (!this.reflectStateInUrl) {\r\n      return;\r\n    }\r\n\r\n    this.urlManager = this.searchStatus.urlManager({\r\n      initialState: {fragment: this.fragment},\r\n    });\r\n\r\n    this.unsubscribeUrlManager = this.urlManager.subscribe(() =>\r\n      this.updateHash()\r\n    );\r\n\r\n    window.addEventListener('hashchange', this.onHashChange);\r\n  }\r\n\r\n  private initSearchStatus() {\r\n    if (this.type === 'product-listing') {\r\n      this.searchStatus = buildProductListing(this.engine!);\r\n    } else if (this.type === 'search') {\r\n      this.searchStatus = buildSearch(this.engine!);\r\n    }\r\n    this.unsubscribeSearchStatus = this.searchStatus.subscribe(() => {\r\n      if (\r\n        !this.searchStatus.state.isLoading &&\r\n        this.store.hasLoadingFlag(FirstSearchExecutedFlag)\r\n      ) {\r\n        this.store.unsetLoadingFlag(FirstSearchExecutedFlag);\r\n      }\r\n    });\r\n  }\r\n\r\n  private updateHash() {\r\n    const newFragment = this.urlManager.state.fragment;\r\n\r\n    if (!this.searchStatus.state.isLoading) {\r\n      history.replaceState(null, document.title, `#${newFragment}`);\r\n      this.bindings.engine.logger.info(`History replaceState #${newFragment}`);\r\n\r\n      return;\r\n    }\r\n\r\n    history.pushState(null, document.title, `#${newFragment}`);\r\n    this.bindings.engine.logger.info(`History pushState #${newFragment}`);\r\n  }\r\n\r\n  private onHashChange = () => {\r\n    this.urlManager.synchronize(this.fragment);\r\n  };\r\n\r\n  private async internalInitialization(initEngine: () => void) {\r\n    await this.commonInterfaceHelper.onInitialization(initEngine);\r\n\r\n    this.initSearchStatus();\r\n    this.initUrlManager();\r\n    this.initialized = true;\r\n  }\r\n\r\n  private addResourceBundle(\r\n    lng: string,\r\n    ns: string,\r\n    resources: object,\r\n    deep?: boolean,\r\n    overwrite?: boolean\r\n  ) {\r\n    return this.i18nClone.addResourceBundle(\r\n      lng,\r\n      ns,\r\n      resources,\r\n      deep,\r\n      overwrite\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    return [<slot></slot>];\r\n  }\r\n}\r\n"],"mappings":"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"}