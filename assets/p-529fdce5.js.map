{"version":3,"names":["MissingParentError","Error","constructor","elementName","parentName","super","ItemContext","opts","folded","component","itemVariable","connectedCallback","componentWillRender","render","element","getElement","this","event","buildCustomEvent","itemContextEventName","item","extractFolded","canceled","dispatchEvent","error","nodeName","toLowerCase","call","remove","console","InteractiveItemContext","interactiveItemVariable","interactiveItemContextEventName","itemContext","Promise","resolve","reject","closest","returnFolded","children","result","childTemplatesContextEventName","ChildTemplatesContext","itemTemplateProviderProp","itemTemplateProvider","itemDisplayConfigContextEventName","ItemDisplayConfigContext","config"],"sources":["src/components/common/item-list/item-decorators.tsx"],"sourcesContent":["import {ComponentInterface, getElement} from '@stencil/core';\r\nimport {buildCustomEvent} from '../../../utils/event-utils';\r\nimport {closest} from '../../../utils/utils';\r\nimport {AnyItem} from '../interface/item';\r\nimport {\r\n  ItemDisplayDensity,\r\n  ItemDisplayImageSize,\r\n} from '../layout/display-options';\r\nimport {ItemTemplateProvider} from './item-template-provider';\r\n\r\nexport class MissingParentError extends Error {\r\n  constructor(elementName: string, parentName: string) {\r\n    super(\r\n      `The \"${elementName}\" element must be the child of an \"${parentName}\" element.`\r\n    );\r\n  }\r\n}\r\n\r\nexport function ItemContext(\r\n  opts: {parentName: string; folded: boolean} = {\r\n    parentName: 'atomic-result',\r\n    folded: false,\r\n  }\r\n) {\r\n  return (component: ComponentInterface, itemVariable: string) => {\r\n    const {connectedCallback, componentWillRender, render} = component;\r\n    component.connectedCallback = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        itemContextEventName,\r\n        (item: Record<string, unknown>) => {\r\n          this[itemVariable] = extractFolded(item, opts.folded);\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        this.error = new MissingParentError(\r\n          element.nodeName.toLowerCase(),\r\n          opts.parentName\r\n        );\r\n        return;\r\n      }\r\n      return connectedCallback && connectedCallback.call(this);\r\n    };\r\n\r\n    component.componentWillRender = function () {\r\n      if (this.error) {\r\n        return;\r\n      }\r\n\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n\r\n    component.render = function () {\r\n      if (this.error) {\r\n        const element = getElement(this);\r\n        element.remove();\r\n        console.error(\r\n          'Result component is in error and has been removed from the DOM',\r\n          this.error,\r\n          this,\r\n          element\r\n        );\r\n        return;\r\n      }\r\n      return render && render.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nexport function InteractiveItemContext() {\r\n  return (component: ComponentInterface, interactiveItemVariable: string) => {\r\n    const {connectedCallback} = component;\r\n    component.connectedCallback = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        interactiveItemContextEventName,\r\n        (item: AnyItem) => {\r\n          this[interactiveItemVariable] = item;\r\n        }\r\n      );\r\n      element.dispatchEvent(event);\r\n      return connectedCallback && connectedCallback.call(this);\r\n    };\r\n  };\r\n}\r\n\r\ntype ItemContextEventHandler<T> = (item: T) => void;\r\nexport type ItemContextEvent<T> = CustomEvent<ItemContextEventHandler<T>>;\r\nconst itemContextEventName = 'atomic/resolveResult';\r\nexport type InteractiveItemContextEvent = CustomEvent<\r\n  (interactiveItem: unknown) => void\r\n>;\r\nconst interactiveItemContextEventName = 'atomic/resolveInteractiveResult';\r\n\r\nexport function itemContext<T>(element: Element, parentName: string) {\r\n  return new Promise<T>((resolve, reject) => {\r\n    const event = buildCustomEvent<ItemContextEventHandler<T>>(\r\n      itemContextEventName,\r\n      (item: T) => {\r\n        return resolve(item);\r\n      }\r\n    );\r\n    element.dispatchEvent(event);\r\n\r\n    if (!closest(element, parentName)) {\r\n      reject(\r\n        new MissingParentError(element.nodeName.toLowerCase(), parentName)\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\nfunction extractFolded(item: Record<string, unknown>, returnFolded: boolean) {\r\n  if (returnFolded) {\r\n    if ('children' in item) {\r\n      return item;\r\n    } else {\r\n      return {children: [], result: item};\r\n    }\r\n  }\r\n\r\n  if ('children' in item && 'result' in item) {\r\n    return item.result;\r\n  }\r\n  return item;\r\n}\r\n\r\ntype ChildTemplatesContextEventHandler = (\r\n  itemTemplateProvider?: ItemTemplateProvider\r\n) => void;\r\nexport type ChildTemplatesContextEvent =\r\n  CustomEvent<ChildTemplatesContextEventHandler>;\r\nconst childTemplatesContextEventName = 'atomic/resolveChildTemplates';\r\n\r\ninterface AtomicItemChildren {\r\n  itemTemplateProvider?: ItemTemplateProvider;\r\n}\r\n\r\nexport function ChildTemplatesContext() {\r\n  return (component: ComponentInterface, itemTemplateProviderProp: string) => {\r\n    const {componentWillRender} = component;\r\n    component.componentWillRender = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        childTemplatesContextEventName,\r\n        (itemTemplateProvider?: ItemTemplateProvider) => {\r\n          const component = this as AtomicItemChildren;\r\n          if (component.itemTemplateProvider) {\r\n            return;\r\n          }\r\n\r\n          this[itemTemplateProviderProp] = itemTemplateProvider;\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        this[itemTemplateProviderProp] = null;\r\n        return;\r\n      }\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nexport type DisplayConfig = {\r\n  density: ItemDisplayDensity;\r\n  imageSize: ItemDisplayImageSize;\r\n};\r\n\r\ntype ItemDisplayConfigContextEventHandler = (config: DisplayConfig) => void;\r\nexport type ItemDisplayConfigContextEvent =\r\n  CustomEvent<ItemDisplayConfigContextEventHandler>;\r\nconst itemDisplayConfigContextEventName = 'atomic/resolveResultDisplayConfig';\r\n\r\nexport function ItemDisplayConfigContext() {\r\n  return (component: ComponentInterface, itemVariable: string) => {\r\n    const {componentWillRender} = component;\r\n    component.componentWillRender = function () {\r\n      const element = getElement(this);\r\n      const event = buildCustomEvent(\r\n        itemDisplayConfigContextEventName,\r\n        (config: DisplayConfig) => {\r\n          this[itemVariable] = config;\r\n        }\r\n      );\r\n\r\n      const canceled = element.dispatchEvent(event);\r\n      if (canceled) {\r\n        return;\r\n      }\r\n      return componentWillRender && componentWillRender.call(this);\r\n    };\r\n  };\r\n}\r\n"],"mappings":"kHAUaA,UAA2BC,MACtC,WAAAC,CAAYC,EAAqBC,GAC/BC,MACE,QAAQF,uCAAiDC,c,WAK/CE,EACdC,EAA8C,CAC5CH,WAAY,gBACZI,OAAQ,QAGV,MAAO,CAACC,EAA+BC,KACrC,MAAMC,kBAACA,EAAiBC,oBAAEA,EAAmBC,OAAEA,GAAUJ,EACzDA,EAAUE,kBAAoB,WAC5B,MAAMG,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZC,GACCC,IACCJ,KAAKN,GAAgBW,EAAcD,EAAMb,EAAKC,OAAO,IAIzD,MAAMc,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZN,KAAKQ,MAAQ,IAAIxB,EACfc,EAAQW,SAASC,cACjBnB,EAAKH,YAEP,M,CAEF,OAAOO,GAAqBA,EAAkBgB,KAAKX,K,EAGrDP,EAAUG,oBAAsB,WAC9B,GAAII,KAAKQ,MAAO,CACd,M,CAGF,OAAOZ,GAAuBA,EAAoBe,KAAKX,K,EAGzDP,EAAUI,OAAS,WACjB,GAAIG,KAAKQ,MAAO,CACd,MAAMV,EAAUC,EAAWC,MAC3BF,EAAQc,SACRC,QAAQL,MACN,iEACAR,KAAKQ,MACLR,KACAF,GAEF,M,CAEF,OAAOD,GAAUA,EAAOc,KAAKX,K,CAC9B,CAEL,C,SAEgBc,IACd,MAAO,CAACrB,EAA+BsB,KACrC,MAAMpB,kBAACA,GAAqBF,EAC5BA,EAAUE,kBAAoB,WAC5B,MAAMG,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZc,GACCZ,IACCJ,KAAKe,GAA2BX,CAAI,IAGxCN,EAAQS,cAAcN,GACtB,OAAON,GAAqBA,EAAkBgB,KAAKX,K,CACpD,CAEL,CAIA,MAAMG,EAAuB,uBAI7B,MAAMa,EAAkC,kC,SAExBC,EAAenB,EAAkBV,GAC/C,OAAO,IAAI8B,SAAW,CAACC,EAASC,KAC9B,MAAMnB,EAAQC,EACZC,GACCC,GACQe,EAAQf,KAGnBN,EAAQS,cAAcN,GAEtB,IAAKoB,EAAQvB,EAASV,GAAa,CACjCgC,EACE,IAAIpC,EAAmBc,EAAQW,SAASC,cAAetB,G,IAI/D,CAEA,SAASiB,EAAcD,EAA+BkB,GACpD,GAAIA,EAAc,CAChB,GAAI,aAAclB,EAAM,CACtB,OAAOA,C,KACF,CACL,MAAO,CAACmB,SAAU,GAAIC,OAAQpB,E,EAIlC,GAAI,aAAcA,GAAQ,WAAYA,EAAM,CAC1C,OAAOA,EAAKoB,M,CAEd,OAAOpB,CACT,CAOA,MAAMqB,EAAiC,+B,SAMvBC,IACd,MAAO,CAACjC,EAA+BkC,KACrC,MAAM/B,oBAACA,GAAuBH,EAC9BA,EAAUG,oBAAsB,WAC9B,MAAME,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZuB,GACCG,IACC,MAAMnC,EAAYO,KAClB,GAAIP,EAAUmC,qBAAsB,CAClC,M,CAGF5B,KAAK2B,GAA4BC,CAAoB,IAIzD,MAAMtB,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZN,KAAK2B,GAA4B,KACjC,M,CAEF,OAAO/B,GAAuBA,EAAoBe,KAAKX,K,CACxD,CAEL,CAUA,MAAM6B,EAAoC,oC,SAE1BC,IACd,MAAO,CAACrC,EAA+BC,KACrC,MAAME,oBAACA,GAAuBH,EAC9BA,EAAUG,oBAAsB,WAC9B,MAAME,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZ2B,GACCE,IACC/B,KAAKN,GAAgBqC,CAAM,IAI/B,MAAMzB,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZ,M,CAEF,OAAOV,GAAuBA,EAAoBe,KAAKX,K,CACxD,CAEL,Q"}