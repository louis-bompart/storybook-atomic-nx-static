{"version":3,"names":["atomicCommerceSortDropdownCss","AtomicCommerceSortDropdownStyle0","AtomicCommerceSortDropdown","this","id","randomID","initialize","bindings","interfaceElement","type","searchOrListing","buildProductListing","engine","buildSearch","sort","select","e","composedPath","sortBy","getSortByLabel","value","getLabel","by","fields","map","sortByField","displayName","name","join","render","error","responseId","products","searchOrListingState","i18n","h","SortGuard","key","firstSearchExecuted","hasError","hasResults","length","sortState","availableSorts","SortContainer","SortLabel","SortSelect","onSelect","evt","availableSort","label","SortOption","selected","isSortedBy","sortByLabel","forEach","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/commerce/atomic-commerce-sort-dropdown/atomic-commerce-sort-dropdown.pcss?tag=atomic-commerce-sort-dropdown&encapsulation=shadow","src/components/commerce/atomic-commerce-sort-dropdown/atomic-commerce-sort-dropdown.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n\nselect:hover + div,\nselect:focus-visible + div {\n  @apply border-primary-light text-primary-light;\n}\n","import {\n  Sort,\n  SortState,\n  Search,\n  ProductListing,\n  buildProductListing,\n  buildSearch,\n  SearchState,\n  ProductListingState,\n  SortCriterion,\n} from '@coveo/headless/commerce';\nimport {Component, h, State, Element} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {randomID} from '../../../utils/utils';\nimport {SortContainer} from '../../common/sort/container';\nimport {SortGuard} from '../../common/sort/guard';\nimport {SortLabel} from '../../common/sort/label';\nimport {SortOption} from '../../common/sort/option';\nimport {SortSelect} from '../../common/sort/select';\nimport {CommerceBindings} from '../atomic-commerce-interface/atomic-commerce-interface';\n\n/**\n * The `atomic-commerce-sort-dropdown` component renders a dropdown that the end user can interact with to select the criteria to use when sorting products.\n *\n * @part label - The \"Sort by\" label of the `<select>` element.\n * @part select-parent - The `<select>` element parent.\n * @part select - The `<select>` element of the dropdown list.\n * @part select-separator - The element separating the select from the icon.\n * @part placeholder - The dropdown placeholder for while the interface is initializing.\n *\n * @internal\n */\n@Component({\n  tag: 'atomic-commerce-sort-dropdown',\n  styleUrl: 'atomic-commerce-sort-dropdown.pcss',\n  shadow: true,\n})\nexport class AtomicCommerceSortDropdown\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n\n  private id = randomID('atomic-commerce-sort-dropdown-');\n\n  @Element() host!: HTMLElement;\n\n  public sort!: Sort;\n  @BindStateToController('sort')\n  @State()\n  public sortState!: SortState;\n\n  public searchOrListing!: Search | ProductListing;\n  @BindStateToController('searchOrListing')\n  @State()\n  private searchOrListingState!: SearchState | ProductListingState;\n\n  @State() public error!: Error;\n\n  public initialize() {\n    if (this.bindings.interfaceElement.type === 'product-listing') {\n      this.searchOrListing = buildProductListing(this.bindings.engine);\n    } else {\n      this.searchOrListing = buildSearch(this.bindings.engine);\n    }\n    this.sort = this.searchOrListing.sort();\n  }\n\n  private select(e: Event) {\n    const select = e.composedPath()[0] as HTMLSelectElement;\n    this.sort.sortBy(this.getSortByLabel(select.value));\n  }\n\n  private getLabel(sort: SortCriterion) {\n    if (sort.by === 'relevance') {\n      return 'relevance';\n    } else {\n      return sort.fields\n        .map((sortByField) => {\n          return sortByField.displayName || sortByField.name;\n        })\n        .join(' ');\n    }\n  }\n\n  public render() {\n    const {error, responseId, products} = this.searchOrListingState;\n    const {\n      bindings: {i18n},\n      id,\n    } = this;\n    return (\n      <SortGuard\n        firstSearchExecuted={responseId !== ''}\n        hasError={error !== null}\n        hasResults={\n          products.length > 0 && this.sortState.availableSorts.length > 1\n        }\n      >\n        <SortContainer>\n          <SortLabel i18n={i18n} id={id} />\n          <SortSelect i18n={i18n} id={id} onSelect={(evt) => this.select(evt)}>\n            {this.sortState.availableSorts.map((availableSort) => {\n              const label = this.getLabel(availableSort);\n              return (\n                <SortOption\n                  i18n={i18n}\n                  label={label}\n                  selected={this.sort.isSortedBy(availableSort)}\n                  value={label}\n                />\n              );\n            })}\n          </SortSelect>\n        </SortContainer>\n      </SortGuard>\n    );\n  }\n\n  private getSortByLabel(label: string) {\n    const sortByLabel: Record<string, SortCriterion> = {};\n    this.sortState.availableSorts.forEach((availableSort) => {\n      sortByLabel[this.getLabel(availableSort)] = availableSort;\n    });\n\n    return sortByLabel[label];\n  }\n}\n"],"mappings":"+SAAA,MAAMA,EAAgC,8wuCACtC,MAAAC,EAAeD,E,iXCwCFE,EAA0B,M,yBAK7BC,KAAAC,GAAKC,EAAS,kC,kFAgBf,UAAAC,GACL,GAAIH,KAAKI,SAASC,iBAAiBC,OAAS,kBAAmB,CAC7DN,KAAKO,gBAAkBC,EAAoBR,KAAKI,SAASK,O,KACpD,CACLT,KAAKO,gBAAkBG,EAAYV,KAAKI,SAASK,O,CAEnDT,KAAKW,KAAOX,KAAKO,gBAAgBI,M,CAG3B,MAAAC,CAAOC,GACb,MAAMD,EAASC,EAAEC,eAAe,GAChCd,KAAKW,KAAKI,OAAOf,KAAKgB,eAAeJ,EAAOK,O,CAGtC,QAAAC,CAASP,GACf,GAAIA,EAAKQ,KAAO,YAAa,CAC3B,MAAO,W,KACF,CACL,OAAOR,EAAKS,OACTC,KAAKC,GACGA,EAAYC,aAAeD,EAAYE,OAE/CC,KAAK,I,EAIL,MAAAC,GACL,MAAMC,MAACA,EAAKC,WAAEA,EAAUC,SAAEA,GAAY7B,KAAK8B,qBAC3C,MACE1B,UAAU2B,KAACA,GAAK9B,GAChBA,GACED,KACJ,OACEgC,EAACC,EAAS,CAAAC,IAAA,2CACRC,oBAAqBP,IAAe,GACpCQ,SAAUT,IAAU,KACpBU,WACER,EAASS,OAAS,GAAKtC,KAAKuC,UAAUC,eAAeF,OAAS,GAGhEN,EAACS,EAAa,CAAAP,IAAA,4CACZF,EAACU,EAAS,CAAAR,IAAA,2CAACH,KAAMA,EAAM9B,GAAIA,IAC3B+B,EAACW,EAAU,CAAAT,IAAA,2CAACH,KAAMA,EAAM9B,GAAIA,EAAI2C,SAAWC,GAAQ7C,KAAKY,OAAOiC,IAC5D7C,KAAKuC,UAAUC,eAAenB,KAAKyB,IAClC,MAAMC,EAAQ/C,KAAKkB,SAAS4B,GAC5B,OACEd,EAACgB,EAAU,CACTjB,KAAMA,EACNgB,MAAOA,EACPE,SAAUjD,KAAKW,KAAKuC,WAAWJ,GAC/B7B,MAAO8B,GACP,M,CASR,cAAA/B,CAAe+B,GACrB,MAAMI,EAA6C,GACnDnD,KAAKuC,UAAUC,eAAeY,SAASN,IACrCK,EAAYnD,KAAKkB,SAAS4B,IAAkBA,CAAa,IAG3D,OAAOK,EAAYJ,E,6BApFQM,EAAA,CAA5BC,K,+BASMD,EAAA,CAFNE,EAAsB,S,gCAOfF,EAAA,CAFPE,EAAsB,oB"}