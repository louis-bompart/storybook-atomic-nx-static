{"version":3,"names":["atomicResultMultiValueTextCss","AtomicResultMultiValueTextStyle0","AtomicResultMultiText","this","maxValuesToDisplay","delimiter","sortedValues","initialize","breadcrumbManager","buildBreadcrumbManager","bindings","engine","resultValues","value","ResultTemplatesHelpers","getResultProperty","result","field","Array","isArray","map","v","trim","error","Error","split","facetSelectedValues","state","facetBreadcrumbs","filter","facet","reduce","values","updateSortedValues","allValues","allValuesSet","Set","firstValues","has","from","set","add","getShouldDisplayLabel","length","getNumberOfValuesToDisplay","Math","min","renderValue","label","getFieldValueCaption","i18n","kebabValue","titleToKebab","h","key","part","name","renderSeparator","beforeValue","afterValue","class","renderMoreLabel","t","renderListItems","numberOfValuesToDisplay","nodes","i","push","componentWillRender","render","host","remove","__decorate","InitializeBindings","ResultContext"],"sources":["src/components/search/result-template-components/atomic-result-multi-value-text/atomic-result-multi-value-text.pcss?tag=atomic-result-multi-value-text&encapsulation=shadow","src/components/search/result-template-components/atomic-result-multi-value-text/atomic-result-multi-value-text.tsx"],"sourcesContent":[":host {\r\n  > ul {\r\n    display: flex;\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 0;\r\n\r\n    li {\r\n      display: inline-block;\r\n    }\r\n  }\r\n}\r\n\r\n.separator {\r\n  &::before {\r\n    display: inline;\r\n    content: ',\\00a0';\r\n  }\r\n}\r\n","import {\r\n  BreadcrumbManager,\r\n  buildBreadcrumbManager,\r\n  Result,\r\n  ResultTemplatesHelpers,\r\n} from '@coveo/headless';\r\nimport {Component, Element, Prop, h, State, VNode} from '@stencil/core';\r\nimport {getFieldValueCaption} from '../../../../utils/field-utils';\r\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\r\nimport {titleToKebab} from '../../../../utils/utils';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {ResultContext} from '../result-template-decorators';\r\n\r\n/**\r\n * The `atomic-result-multi-value-text` component renders the values of a multi-value string field.\r\n * @part result-multi-value-text-list - The list of field values.\r\n * @part result-multi-value-text-separator - The separator to display between each of the field values.\r\n * @part result-multi-value-text-value - A field value.\r\n * @part result-multi-value-text-value-more - A label indicating some values were omitted.\r\n * @slot result-multi-value-text-value-* - A custom caption value that's specified for a given part of a multi-text field value. For example, if you want to use `Off-Campus Resident` as a caption value for `Off-campus apartment` in `Off-campus apartment;On-campus apartment`, you'd use `<span slot=\"result-multi-value-text-value-off-campus-apartment\">Off-Campus Resident</span>`). The suffix of this slot corresponds with the field value, written in kebab case.\r\n */\r\n@Component({\r\n  tag: 'atomic-result-multi-value-text',\r\n  styleUrl: 'atomic-result-multi-value-text.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicResultMultiText {\r\n  public breadcrumbManager!: BreadcrumbManager;\r\n\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ResultContext() private result!: Result;\r\n\r\n  @Element() host!: HTMLElement;\r\n\r\n  @State() public error!: Error;\r\n\r\n  /**\r\n   * The field that the component should use.\r\n   * The component will try to find this field in the `Result.raw` object unless it finds it in the `Result` object first.\r\n   * Make sure this field is present in the `fieldsToInclude` property of the `atomic-search-interface` component.\r\n   */\r\n  @Prop({reflect: true}) public field!: string;\r\n\r\n  /**\r\n   * The maximum number of field values to display.\r\n   * If there are _n_ more values than the specified maximum, the last displayed value will be \"_n_ more...\".\r\n   */\r\n  @Prop({reflect: true}) public maxValuesToDisplay = 3;\r\n\r\n  /**\r\n   * The delimiter used to separate values when the field isn't indexed as a multi value field.\r\n   */\r\n  @Prop({reflect: true}) public delimiter: string | null = null;\r\n\r\n  private sortedValues: string[] | null = null;\r\n\r\n  public initialize() {\r\n    this.breadcrumbManager = buildBreadcrumbManager(this.bindings.engine);\r\n  }\r\n\r\n  private get resultValues() {\r\n    const value = ResultTemplatesHelpers.getResultProperty(\r\n      this.result,\r\n      this.field\r\n    );\r\n\r\n    if (value === null) {\r\n      return null;\r\n    }\r\n\r\n    if (Array.isArray(value)) {\r\n      return value.map((v) => `${v}`.trim());\r\n    }\r\n\r\n    if (typeof value !== 'string' || value.trim() === '') {\r\n      this.error = new Error(\r\n        `Could not parse \"${value}\" from field \"${this.field}\" as a string array.`\r\n      );\r\n      return null;\r\n    }\r\n\r\n    return this.delimiter\r\n      ? value.split(this.delimiter).map((value) => value.trim())\r\n      : [value];\r\n  }\r\n\r\n  private get facetSelectedValues() {\r\n    return this.breadcrumbManager.state.facetBreadcrumbs\r\n      .filter((facet) => facet.field === this.field)\r\n      .reduce(\r\n        (values, facet) => [\r\n          ...values,\r\n          ...facet.values.map(({value}) => value.value),\r\n        ],\r\n        [] as string[]\r\n      );\r\n  }\r\n\r\n  private updateSortedValues() {\r\n    const allValues = this.resultValues;\r\n    if (allValues === null) {\r\n      this.sortedValues = null;\r\n      return;\r\n    }\r\n    const allValuesSet = new Set(allValues);\r\n    const firstValues = this.facetSelectedValues.filter((value) =>\r\n      allValuesSet.has(value)\r\n    );\r\n    this.sortedValues = Array.from(\r\n      allValues.reduce((set, value) => set.add(value), new Set(firstValues))\r\n    );\r\n  }\r\n\r\n  private getShouldDisplayLabel(values: string[]) {\r\n    return (\r\n      this.maxValuesToDisplay > 0 && values.length > this.maxValuesToDisplay\r\n    );\r\n  }\r\n\r\n  private getNumberOfValuesToDisplay(values: string[]) {\r\n    if (values.length <= this.maxValuesToDisplay) {\r\n      return values.length;\r\n    }\r\n    if (this.maxValuesToDisplay < 2) {\r\n      return this.maxValuesToDisplay;\r\n    }\r\n    return Math.min(values.length - 2, this.maxValuesToDisplay);\r\n  }\r\n\r\n  private renderValue(value: string) {\r\n    const label = getFieldValueCaption(this.field, value, this.bindings.i18n);\r\n    const kebabValue = titleToKebab(value);\r\n    return (\r\n      <li key={value} part=\"result-multi-value-text-value\">\r\n        <slot name={`result-multi-value-text-value-${kebabValue}`}>\r\n          {label}\r\n        </slot>\r\n      </li>\r\n    );\r\n  }\r\n\r\n  private renderSeparator(beforeValue: string, afterValue: string) {\r\n    return (\r\n      <li\r\n        aria-hidden=\"true\"\r\n        part=\"result-multi-value-text-separator\"\r\n        key={`${beforeValue}~${afterValue}`}\r\n        class=\"separator\"\r\n      ></li>\r\n    );\r\n  }\r\n\r\n  private renderMoreLabel(value: number) {\r\n    return (\r\n      <li key=\"more-field-values\" part=\"result-multi-value-text-value-more\">\r\n        {this.bindings.i18n.t('n-more', {value})}\r\n      </li>\r\n    );\r\n  }\r\n\r\n  private renderListItems(values: string[]) {\r\n    const numberOfValuesToDisplay = this.getNumberOfValuesToDisplay(values);\r\n\r\n    const nodes: VNode[] = [];\r\n    for (let i = 0; i < numberOfValuesToDisplay; i++) {\r\n      if (i > 0) {\r\n        nodes.push(this.renderSeparator(values[i - 1], values[i]));\r\n      }\r\n      nodes.push(this.renderValue(values[i]));\r\n    }\r\n    if (this.getShouldDisplayLabel(values)) {\r\n      nodes.push(\r\n        this.renderSeparator(\r\n          values[numberOfValuesToDisplay - 1],\r\n          'more-field-values'\r\n        )\r\n      );\r\n      nodes.push(this.renderMoreLabel(values.length - numberOfValuesToDisplay));\r\n    }\r\n    return nodes;\r\n  }\r\n\r\n  public componentWillRender() {\r\n    this.updateSortedValues();\r\n  }\r\n\r\n  public render() {\r\n    if (this.sortedValues === null) {\r\n      this.host.remove();\r\n      return;\r\n    }\r\n    return (\r\n      <ul part=\"result-multi-value-text-list\">\r\n        {...this.renderListItems(this.sortedValues)}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}