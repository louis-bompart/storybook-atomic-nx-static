{"version":3,"names":["bindLogDocumentOpenOnResult","engine","result","resultElement","selector","interactiveResult","buildInteractiveResult","options","eventsMap","contextmenu","select","click","mouseup","mousedown","touchstart","beginDelayedSelect","touchend","cancelPendingSelect","elements","querySelectorAll","forEach","element","Object","keys","key","addEventListener","removeEventListener","buildStringTemplateFromResult","template","bindings","replace","value","substring","length","newValue","readFromObject","window","logger","warn","uniqueId","getStringValueFromResultOrNull","field","ResultTemplatesHelpers","getResultProperty","trim","object","firstPeriodIndex","indexOf","newKey","undefined"],"sources":["src/utils/result-utils.ts"],"sourcesContent":["import {\r\n  buildInteractiveResult,\r\n  SearchEngine,\r\n  Result,\r\n  ResultTemplatesHelpers,\r\n} from '@coveo/headless';\r\nimport {Bindings} from '../components/search/atomic-search-interface/atomic-search-interface';\r\n\r\n/**\r\n * Binds the logging of document\r\n * @returns An unbind function for the events\r\n * @param engine A headless search engine instance.\r\n * @param result The result object\r\n * @param resultElement Parent result element\r\n * @param selector Optional. Css selector that selects all links to the document. Default: \"a\" tags with the clickUri as \"href\" parameter.\r\n */\r\nexport function bindLogDocumentOpenOnResult(\r\n  engine: SearchEngine,\r\n  result: Result,\r\n  resultElement: Element | ShadowRoot,\r\n  selector?: string\r\n) {\r\n  const interactiveResult = buildInteractiveResult(engine, {\r\n    options: {result},\r\n  });\r\n\r\n  const eventsMap: Record<string, EventListenerOrEventListenerObject> = {\r\n    contextmenu: () => interactiveResult.select(),\r\n    click: () => interactiveResult.select(),\r\n    mouseup: () => interactiveResult.select(),\r\n    mousedown: () => interactiveResult.select(),\r\n    touchstart: () => interactiveResult.beginDelayedSelect(),\r\n    touchend: () => interactiveResult.cancelPendingSelect(),\r\n  };\r\n  const elements = resultElement.querySelectorAll(selector || 'a');\r\n\r\n  elements.forEach((element) => {\r\n    Object.keys(eventsMap).forEach((key) =>\r\n      element.addEventListener(key, eventsMap[key])\r\n    );\r\n  });\r\n\r\n  return () => {\r\n    elements.forEach((element) => {\r\n      Object.keys(eventsMap).forEach((key) =>\r\n        element.removeEventListener(key, eventsMap[key])\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function buildStringTemplateFromResult(\r\n  template: string,\r\n  result: Result,\r\n  bindings: Bindings\r\n) {\r\n  return template.replace(/\\${(.*?)}/g, (value: string) => {\r\n    const key = value.substring(2, value.length - 1);\r\n    let newValue = readFromObject(result, key);\r\n    if (!newValue) {\r\n      newValue = readFromObject(window, key);\r\n    }\r\n\r\n    if (!newValue) {\r\n      bindings.engine.logger.warn(\r\n        `${key} used in the href template is undefined for this result: ${result.uniqueId}`\r\n      );\r\n      return '';\r\n    }\r\n\r\n    return newValue;\r\n  });\r\n}\r\n\r\nexport function getStringValueFromResultOrNull(result: Result, field: string) {\r\n  const value = ResultTemplatesHelpers.getResultProperty(result, field);\r\n\r\n  if (typeof value !== 'string' || value.trim() === '') {\r\n    return null;\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\n// eslint-disable-next-line  @typescript-eslint/no-explicit-any\r\nfunction readFromObject(object: any, key: string): string {\r\n  const firstPeriodIndex = key.indexOf('.');\r\n  if (object && firstPeriodIndex !== -1) {\r\n    const newKey = key.substring(firstPeriodIndex + 1);\r\n    key = key.substring(0, firstPeriodIndex);\r\n    return readFromObject(object[key], newKey);\r\n  }\r\n  return object ? object[key] : undefined;\r\n}\r\n"],"mappings":"oDAgBgBA,EACdC,EACAC,EACAC,EACAC,GAEA,MAAMC,EAAoBC,EAAuBL,EAAQ,CACvDM,QAAS,CAACL,YAGZ,MAAMM,EAAgE,CACpEC,YAAa,IAAMJ,EAAkBK,SACrCC,MAAO,IAAMN,EAAkBK,SAC/BE,QAAS,IAAMP,EAAkBK,SACjCG,UAAW,IAAMR,EAAkBK,SACnCI,WAAY,IAAMT,EAAkBU,qBACpCC,SAAU,IAAMX,EAAkBY,uBAEpC,MAAMC,EAAWf,EAAcgB,iBAAiBf,GAAY,KAE5Dc,EAASE,SAASC,IAChBC,OAAOC,KAAKf,GAAWY,SAASI,GAC9BH,EAAQI,iBAAiBD,EAAKhB,EAAUgB,KACzC,IAGH,MAAO,KACLN,EAASE,SAASC,IAChBC,OAAOC,KAAKf,GAAWY,SAASI,GAC9BH,EAAQK,oBAAoBF,EAAKhB,EAAUgB,KAC5C,GACD,CAEN,C,SAEgBG,EACdC,EACA1B,EACA2B,GAEA,OAAOD,EAASE,QAAQ,cAAeC,IACrC,MAAMP,EAAMO,EAAMC,UAAU,EAAGD,EAAME,OAAS,GAC9C,IAAIC,EAAWC,EAAejC,EAAQsB,GACtC,IAAKU,EAAU,CACbA,EAAWC,EAAeC,OAAQZ,E,CAGpC,IAAKU,EAAU,CACbL,EAAS5B,OAAOoC,OAAOC,KACrB,GAAGd,6DAA+DtB,EAAOqC,YAE3E,MAAO,E,CAGT,OAAOL,CAAQ,GAEnB,C,SAEgBM,EAA+BtC,EAAgBuC,GAC7D,MAAMV,EAAQW,EAAuBC,kBAAkBzC,EAAQuC,GAE/D,UAAWV,IAAU,UAAYA,EAAMa,SAAW,GAAI,CACpD,OAAO,I,CAGT,OAAOb,CACT,CAGA,SAASI,EAAeU,EAAarB,GACnC,MAAMsB,EAAmBtB,EAAIuB,QAAQ,KACrC,GAAIF,GAAUC,KAAsB,EAAG,CACrC,MAAME,EAASxB,EAAIQ,UAAUc,EAAmB,GAChDtB,EAAMA,EAAIQ,UAAU,EAAGc,GACvB,OAAOX,EAAeU,EAAOrB,GAAMwB,E,CAErC,OAAOH,EAASA,EAAOrB,GAAOyB,SAChC,Q"}