import{N as l,g as n,O as u}from"./preview-C4e5QyPH.js";import{r as h,L as m}from"./p-abea0bd2-55DIQVI1.js";import{r as d}from"./p-8f5830b4-EwJYRc8T.js";import{s as c}from"./p-4ac00d9f-DFgWfiY6.js";import{e as g,l as p,r as b}from"./p-0e55feeb-DBDwGCra.js";import{r as y}from"./p-2130c607-ChH9Gsy8.js";import"./p-f5723aee-BNyovPuY.js";import"./iframe-DZOcfrC1.js";import"../sb-preview/runtime.js";import"./chunk-GKNNPQCW-BkHQSocK.js";import"./p-a2fc549d-BcKcO86e.js";import"./p-b0ede3ce-D6gWHOV3.js";import"./p-1580513b-3LX64KEr.js";import"./p-e9c4f463-BPmi-3c5.js";const $=class{constructor(t){l(this,t),this.results=[],this.display="list",this.templateHasError=!1,this.maxResultsPerQuery=4,this.density="normal",this.imageSize="icon",this.error=void 0,this.templateHasError=!1,this.maxResultsPerQuery=4,this.density="normal",this.imageSize="icon",this.ariaLabelGenerator=void 0}async setRenderFunction(t){this.itemRenderingFunction=t}componentWillLoad(){try{y(t=>(this.bindings=t,this.initialize()),this.host)}catch(t){this.error=t}}getLink(t){var s;const e=t.tagName==="ATOMIC-RESULT"?t:t==null?void 0:t.querySelector("atomic-result");return((s=e==null?void 0:e.shadowRoot)===null||s===void 0?void 0:s.querySelector("atomic-result-link a"))||null}handleLinkClick(t,s){const e=o=>t.setAttribute("target",o),i=t.getAttribute("target");return s&&e("_blank"),t.click(),s&&e(i||""),!0}renderItems(){if(!this.bindings.suggestedQuery()||this.bindings.store.isMobile())return[];const s=(this.instantResults.state.results.length?this.instantResults.state.results:this.results).map(e=>{var i;return{...g(this.bindings.i18n,((i=this.ariaLabelGenerator)===null||i===void 0?void 0:i.call(this,this.bindings,e))||e.title,e.uniqueId),content:n("atomic-result",{key:`instant-result-${d(e.uniqueId)}`,part:"outline",result:e,interactiveResult:h(this.bindings.engine,{options:{result:e}}),display:this.display,density:this.density,imageSize:this.imageSize,content:this.itemTemplateProvider.getTemplateContent(e),stopPropagation:!1,renderingFunction:this.itemRenderingFunction}),onSelect:r=>{const a=this.getLink(r.target);a&&this.handleLinkClick(a,r.ctrlKey||r.metaKey)}}});if(s.length){const e=p(this.bindings.i18n);s.push({...e,content:n(b,{i18n:this.bindings.i18n}),onSelect:()=>{this.bindings.clearSuggestions(),this.bindings.searchBoxController.updateText(this.instantResults.state.q),this.bindings.searchBoxController.submit()}})}return s}initialize(){return this.instantResults=m(this.bindings.engine,{options:{maxResultsPerQuery:this.maxResultsPerQuery}}),this.itemTemplateProvider=new c({includeDefaultTemplate:!0,templateElements:Array.from(this.host.querySelectorAll("atomic-result-template")),getResultTemplateRegistered:()=>!0,setResultTemplateRegistered:()=>{},getTemplateHasError:()=>this.templateHasError,setTemplateHasError:t=>{this.templateHasError=t},bindings:this.bindings}),{position:Array.from(this.host.parentNode.children).indexOf(this.host),panel:"right",onSuggestedQueryChange:t=>(this.instantResults.updateQuery(t),this.onSuggestedQueryChange()),renderItems:()=>this.renderItems()}}onSuggestedQueryChange(){return!this.bindings.getSuggestionElements().length&&!this.bindings.searchBoxController.state.value&&console.warn("There doesn't seem to be any query suggestions configured. Make sure to include either an atomic-search-box-query-suggestions or atomic-search-box-recent-queries in your search box in order to see some instant results."),new Promise(t=>{const s=this.instantResults.subscribe(()=>{const e=this.instantResults.state;e.isLoading||(e.results.length&&(this.results=e.results),s(),t())})})}render(){if(this.error)return n("atomic-component-error",{key:"4bdc55b2d53ff284f4c274c9c43916ca9511c9fa",element:this.host,error:this.error})}get host(){return u(this)}};export{$ as atomic_search_box_instant_results};
