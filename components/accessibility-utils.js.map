{"file":"accessibility-utils.js","mappings":"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","names":[],"sources":["src/utils/accessibility-utils.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {AnyBindings} from '../components/common/interface/bindings';\nimport {buildCustomEvent} from './event-utils';\nimport {InitializableComponent} from './initialization-utils';\nimport {defer} from './utils';\n\nexport const findAriaLiveEventName = 'atomic/accessibility/findAriaLive';\n\nexport interface FindAriaLiveEventArgs {\n  element?: HTMLAtomicAriaLiveElement;\n}\n\nexport function AriaLiveRegion(regionName: string, assertive = false) {\n  function getAriaLiveElement() {\n    const event = buildCustomEvent<FindAriaLiveEventArgs>(\n      findAriaLiveEventName,\n      {}\n    );\n    document.dispatchEvent(event);\n    const {element} = event.detail;\n    return element;\n  }\n\n  function dispatchMessage(message: string) {\n    getAriaLiveElement()?.updateMessage(regionName, message, assertive);\n  }\n\n  function registerRegion() {\n    getAriaLiveElement()?.registerRegion(regionName, assertive);\n  }\n\n  return (\n    component: InitializableComponent<AnyBindings>,\n    setterName: string\n  ) => {\n    const {componentWillRender} = component;\n    Object.defineProperty(component, setterName, {\n      set: (message: string) => dispatchMessage(message),\n    });\n\n    component.componentWillRender = function () {\n      componentWillRender && componentWillRender.call(this);\n      registerRegion();\n    };\n  };\n}\n\nexport class FocusTargetController {\n  private bindings: AnyBindings;\n  private lastSearchId?: string;\n  private element?: HTMLElement;\n  private onFocusCallback?: Function;\n  private doFocusAfterSearch = false;\n  private doFocusOnNextTarget = false;\n\n  constructor(private component: InitializableComponent<AnyBindings>) {\n    this.bindings = component.bindings;\n    this.handleComponentRenderLoop();\n  }\n\n  public setTarget(el: HTMLElement | undefined) {\n    if (!el) {\n      return;\n    }\n    this.element = el;\n    if (this.doFocusOnNextTarget) {\n      this.doFocusOnNextTarget = false;\n      this.focus();\n    }\n  }\n\n  public async focus() {\n    await defer();\n    this.element?.focus();\n    this.onFocusCallback?.();\n  }\n\n  public focusAfterSearch() {\n    this.lastSearchId = this.bindings.store.getUniqueIDFromEngine(\n      this.bindings.engine\n    );\n    this.doFocusAfterSearch = true;\n    return new Promise((resolve) => (this.onFocusCallback = resolve));\n  }\n\n  public focusOnNextTarget() {\n    this.doFocusOnNextTarget = true;\n    return new Promise((resolve) => (this.onFocusCallback = resolve));\n  }\n\n  public disableForCurrentSearch() {\n    if (\n      this.bindings.store.getUniqueIDFromEngine(this.bindings.engine) !==\n      this.lastSearchId\n    ) {\n      this.doFocusAfterSearch = false;\n    }\n  }\n\n  private handleComponentRenderLoop() {\n    const originalComponentDidRender = this.component.componentDidRender;\n\n    this.component.componentDidRender = () => {\n      originalComponentDidRender &&\n        originalComponentDidRender.call(this.component);\n      if (!this.bindings) {\n        return;\n      }\n      if (\n        this.doFocusAfterSearch &&\n        this.bindings.store.getUniqueIDFromEngine(this.bindings.engine) !==\n          this.lastSearchId\n      ) {\n        this.doFocusAfterSearch = false;\n        if (this.element) {\n          const el = this.element;\n          // The focus seems to be flaky without deferring, especially on iOS.\n          defer().then(() => {\n            el.focus();\n            this.onFocusCallback?.();\n          });\n        }\n      }\n    };\n  }\n}\n\nfunction isFocusable(element: Element) {\n  // Source: https://stackoverflow.com/a/30753870\n  if (element.getAttribute('tabindex') === '-1') {\n    return false;\n  }\n  if (element.hasAttribute('tabindex')) {\n    return true;\n  }\n  if (element.getAttribute('contentEditable') === 'true') {\n    return true;\n  }\n  switch (element.tagName) {\n    case 'A':\n    case 'AREA':\n      return element.hasAttribute('href');\n    case 'INPUT':\n    case 'SELECT':\n    case 'TEXTAREA':\n    case 'BUTTON':\n      return !element.hasAttribute('disabled');\n    case 'IFRAME':\n      return true;\n    default:\n      return false;\n  }\n}\n\nexport function* getFocusableDescendants(\n  element: Element\n): Generator<HTMLElement> {\n  if (isFocusable(element)) {\n    yield element as HTMLElement;\n  }\n  let children = Array.from(element.children);\n  if (element instanceof HTMLSlotElement) {\n    children = element.assignedElements();\n  } else if (element.shadowRoot) {\n    children.push(...Array.from(element.shadowRoot.children));\n  }\n  for (const child of children) {\n    yield* getFocusableDescendants(child);\n  }\n}\n\nexport function getFirstFocusableDescendant(\n  element: Element\n): HTMLElement | null {\n  return getFocusableDescendants(element).next().value ?? null;\n}\n"],"version":3}