{"version":3,"names":["atomicResultPrintableUriCss","AtomicResultPrintableUriStyle0","AtomicResultPrintableUri","this","listExpanded","maxNumberOfParts","focusTarget","expandedPartFocus","FocusTargetController","connectedCallback","Schema","NumberValue","min","validate","error","slotName","linkAttributes","getAttributesFromLinkSlot","host","initialize","interactiveResult","buildInteractiveResult","bindings","engine","options","result","getIndexOfEllipsis","parentsCount","valuesToHide","Math","max","valuesToShowBeforeEllipsis","renderEllipsis","h","i18n","t","onClick","e","stopPropagation","focusOnNextTarget","renderSeparator","allParents","parentsXml","parseXML","raw","parents","Array","from","getElementsByTagName","ellipsisIndex","length","map","parent","i","name","getAttribute","uri","renderLink","class","icon","Arrow","role","renderParents","slice","content","shouldSetTarget","LinkWithItemAnalytics","href","title","undefined","onSelect","select","onBeginDelayedSelect","beginDelayedSelect","onCancelPendingSelect","cancelPendingSelect","attributes","ref","el","setTarget","render","field","clickUri","__decorate","InitializeBindings","ResultContext"],"sources":["src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.pcss?tag=atomic-result-printable-uri","src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.tsx"],"sourcesContent":["atomic-result-printable-uri {\r\n  max-width: 100%;\r\n  word-break: break-word;\r\n\r\n  a,\r\n  button {\r\n    color: var(--atomic-primary);\r\n\r\n    &:hover,\r\n    &:focus-visible {\r\n      text-decoration: underline;\r\n      color: var(--atomic-primary);\r\n    }\r\n\r\n    &:focus {\r\n      outline: none;\r\n    }\r\n\r\n    &:visited {\r\n      color: var(--atomic-visited);\r\n    }\r\n  }\r\n\r\n  ul {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  li {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    max-width: 100%;\r\n\r\n    a {\r\n      display: inline-block;\r\n      vertical-align: middle;\r\n      max-width: 100%;\r\n      text-overflow: ellipsis;\r\n      overflow: hidden;\r\n    }\r\n\r\n    white-space: nowrap;\r\n    &:last-child {\r\n      white-space: normal;\r\n\r\n      &::after {\r\n        content: none;\r\n      }\r\n    }\r\n\r\n    .result-printable-uri-separator {\r\n      display: inline-block;\r\n      margin: 0 0.5rem;\r\n      vertical-align: middle;\r\n      width: 0.75rem;\r\n      height: 0.75rem;\r\n      color: var(--atomic-neutral-dark);\r\n    }\r\n  }\r\n}\r\n","import {Schema, NumberValue} from '@coveo/bueno';\r\nimport {\r\n  buildInteractiveResult,\r\n  InteractiveResult,\r\n  Result,\r\n} from '@coveo/headless';\r\nimport {Component, Element, h, Prop, State, VNode} from '@stencil/core';\r\nimport Arrow from '../../../../images/arrow-right.svg';\r\nimport {FocusTargetController} from '../../../../utils/accessibility-utils';\r\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\r\nimport {parseXML} from '../../../../utils/utils';\r\nimport {getAttributesFromLinkSlot} from '../../../common/item-link/attributes-slot';\r\nimport {LinkWithItemAnalytics} from '../../../common/item-link/item-link';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\nimport {ResultContext} from '../result-template-decorators';\r\n\r\n/**\r\n * The `atomic-result-printable-uri` component displays the URI, or path, to access a result.\r\n *\r\n * @slot attributes - Lets you pass [attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes) down to anchor elements, overriding other attributes.\r\n * To be used exclusively in anchor elements, such as: `<a slot=\"attributes\" target=\"_blank\" download></a>`.\r\n */\r\n@Component({\r\n  tag: 'atomic-result-printable-uri',\r\n  styleUrl: 'atomic-result-printable-uri.pcss',\r\n  shadow: false,\r\n})\r\nexport class AtomicResultPrintableUri {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ResultContext() private result!: Result;\r\n  @Element() public host!: HTMLElement;\r\n\r\n  @State() listExpanded = false;\r\n  @State() error!: Error;\r\n\r\n  /**\r\n   * The maximum number of Uri parts to display. This has to be over the minimum of `3` in order to be effective. Putting `Infinity` will disable the ellipsis.\r\n   */\r\n  @Prop({reflect: true}) maxNumberOfParts = 5;\r\n\r\n  private expandedPartFocus?: FocusTargetController;\r\n\r\n  private interactiveResult!: InteractiveResult;\r\n  private linkAttributes?: Attr[];\r\n\r\n  private get focusTarget() {\r\n    if (!this.expandedPartFocus) {\r\n      this.expandedPartFocus = new FocusTargetController(this);\r\n    }\r\n    return this.expandedPartFocus;\r\n  }\r\n\r\n  public connectedCallback() {\r\n    try {\r\n      new Schema({\r\n        maxNumberOfParts: new NumberValue({min: 3}),\r\n      }).validate({maxNumberOfParts: this.maxNumberOfParts});\r\n    } catch (error) {\r\n      this.error = error as Error;\r\n    }\r\n    const slotName = 'attributes';\r\n    this.linkAttributes = getAttributesFromLinkSlot(this.host, slotName);\r\n  }\r\n\r\n  public initialize() {\r\n    this.interactiveResult = buildInteractiveResult(this.bindings.engine, {\r\n      options: {result: this.result},\r\n    });\r\n  }\r\n\r\n  private getIndexOfEllipsis(parentsCount: number) {\r\n    const valuesToHide = Math.max(2, parentsCount - this.maxNumberOfParts);\r\n    const valuesToShowBeforeEllipsis = parentsCount - valuesToHide - 1;\r\n    return valuesToShowBeforeEllipsis;\r\n  }\r\n\r\n  private renderEllipsis() {\r\n    return (\r\n      <li>\r\n        <button\r\n          aria-label={this.bindings.i18n.t('collapsed-uri-parts')}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            this.focusTarget.focusOnNextTarget();\r\n            this.listExpanded = true;\r\n          }}\r\n        >\r\n          ...\r\n        </button>\r\n        {this.renderSeparator()}\r\n      </li>\r\n    );\r\n  }\r\n\r\n  private get allParents() {\r\n    const parentsXml = parseXML(`${this.result.raw.parents}`);\r\n    const parents = Array.from(parentsXml.getElementsByTagName('parent'));\r\n    const ellipsisIndex = this.getIndexOfEllipsis(parents.length);\r\n    return parents.map((parent, i) => {\r\n      const name = parent.getAttribute('name');\r\n      const uri = parent.getAttribute('uri')!;\r\n      return (\r\n        <li>\r\n          {this.renderLink(name, uri, i === ellipsisIndex)}\r\n          {i === parents.length - 1 ? null : this.renderSeparator()}\r\n        </li>\r\n      );\r\n    });\r\n  }\r\n\r\n  private renderSeparator() {\r\n    return (\r\n      <atomic-icon\r\n        class=\"result-printable-uri-separator\"\r\n        icon={Arrow}\r\n        role=\"separator\"\r\n      ></atomic-icon>\r\n    );\r\n  }\r\n\r\n  private renderParents() {\r\n    const parents = this.allParents;\r\n    if (this.listExpanded || parents.length <= this.maxNumberOfParts) {\r\n      return parents;\r\n    }\r\n\r\n    return [\r\n      parents.slice(0, this.getIndexOfEllipsis(parents.length)),\r\n      this.renderEllipsis(),\r\n      parents.slice(-1),\r\n    ];\r\n  }\r\n\r\n  private renderLink(\r\n    content: VNode | string | null,\r\n    uri: string,\r\n    shouldSetTarget: boolean\r\n  ) {\r\n    return (\r\n      <LinkWithItemAnalytics\r\n        href={uri}\r\n        title={typeof content === 'string' ? content : undefined}\r\n        onSelect={() => this.interactiveResult.select()}\r\n        onBeginDelayedSelect={() => this.interactiveResult.beginDelayedSelect()}\r\n        onCancelPendingSelect={() =>\r\n          this.interactiveResult.cancelPendingSelect()\r\n        }\r\n        attributes={this.linkAttributes}\r\n        ref={\r\n          shouldSetTarget\r\n            ? (el?: HTMLAnchorElement) => this.focusTarget.setTarget(el)\r\n            : undefined\r\n        }\r\n      >\r\n        {content}\r\n      </LinkWithItemAnalytics>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    const parents = this.renderParents();\r\n    if (parents.length) {\r\n      return (\r\n        <ul aria-label={this.bindings.i18n.t('printable-uri')}>{parents}</ul>\r\n      );\r\n    }\r\n\r\n    return this.renderLink(\r\n      <atomic-result-text field=\"printableUri\"></atomic-result-text>,\r\n      this.result.clickUri,\r\n      false\r\n    );\r\n  }\r\n}\r\n"],"mappings":"6dAAA,MAAMA,EAA8B,kkDACpC,MAAAC,EAAeD,E,iXC0BFE,EAAwB,M,yBAK1BC,KAAAC,aAAe,MAMDD,KAAAE,iBAAmB,E,kBANlB,M,2CAMkB,C,CAO1C,eAAYC,GACV,IAAKH,KAAKI,kBAAmB,CAC3BJ,KAAKI,kBAAoB,IAAIC,EAAsBL,K,CAErD,OAAOA,KAAKI,iB,CAGP,iBAAAE,GACL,IACE,IAAIC,EAAO,CACTL,iBAAkB,IAAIM,EAAY,CAACC,IAAK,MACvCC,SAAS,CAACR,iBAAkBF,KAAKE,kB,CACpC,MAAOS,GACPX,KAAKW,MAAQA,C,CAEf,MAAMC,EAAW,aACjBZ,KAAKa,eAAiBC,EAA0Bd,KAAKe,KAAMH,E,CAGtD,UAAAI,GACLhB,KAAKiB,kBAAoBC,EAAuBlB,KAAKmB,SAASC,OAAQ,CACpEC,QAAS,CAACC,OAAQtB,KAAKsB,S,CAInB,kBAAAC,CAAmBC,GACzB,MAAMC,EAAeC,KAAKC,IAAI,EAAGH,EAAexB,KAAKE,kBACrD,MAAM0B,EAA6BJ,EAAeC,EAAe,EACjE,OAAOG,C,CAGD,cAAAC,GACN,OACEC,EAAA,UACEA,EAAA,uBACc9B,KAAKmB,SAASY,KAAKC,EAAE,uBACjCC,QAAUC,IACRA,EAAEC,kBACFnC,KAAKG,YAAYiC,oBACjBpC,KAAKC,aAAe,IAAI,GACzB,OAIFD,KAAKqC,kB,CAKZ,cAAYC,GACV,MAAMC,EAAaC,EAAS,GAAGxC,KAAKsB,OAAOmB,IAAIC,WAC/C,MAAMA,EAAUC,MAAMC,KAAKL,EAAWM,qBAAqB,WAC3D,MAAMC,EAAgB9C,KAAKuB,mBAAmBmB,EAAQK,QACtD,OAAOL,EAAQM,KAAI,CAACC,EAAQC,KAC1B,MAAMC,EAAOF,EAAOG,aAAa,QACjC,MAAMC,EAAMJ,EAAOG,aAAa,OAChC,OACEtB,EAAA,UACG9B,KAAKsD,WAAWH,EAAME,EAAKH,IAAMJ,GACjCI,IAAMR,EAAQK,OAAS,EAAI,KAAO/C,KAAKqC,kBACrC,G,CAKH,eAAAA,GACN,OACEP,EAAA,eACEyB,MAAM,iCACNC,KAAMC,EACNC,KAAK,a,CAKH,aAAAC,GACN,MAAMjB,EAAU1C,KAAKsC,WACrB,GAAItC,KAAKC,cAAgByC,EAAQK,QAAU/C,KAAKE,iBAAkB,CAChE,OAAOwC,C,CAGT,MAAO,CACLA,EAAQkB,MAAM,EAAG5D,KAAKuB,mBAAmBmB,EAAQK,SACjD/C,KAAK6B,iBACLa,EAAQkB,OAAO,G,CAIX,UAAAN,CACNO,EACAR,EACAS,GAEA,OACEhC,EAACiC,EAAqB,CACpBC,KAAMX,EACNY,aAAcJ,IAAY,SAAWA,EAAUK,UAC/CC,SAAU,IAAMnE,KAAKiB,kBAAkBmD,SACvCC,qBAAsB,IAAMrE,KAAKiB,kBAAkBqD,qBACnDC,sBAAuB,IACrBvE,KAAKiB,kBAAkBuD,sBAEzBC,WAAYzE,KAAKa,eACjB6D,IACEZ,EACKa,GAA2B3E,KAAKG,YAAYyE,UAAUD,GACvDT,WAGLL,E,CAKA,MAAAgB,GACL,MAAMnC,EAAU1C,KAAK2D,gBACrB,GAAIjB,EAAQK,OAAQ,CAClB,OACEjB,EAAA,mBAAgB9B,KAAKmB,SAASY,KAAKC,EAAE,kBAAmBU,E,CAI5D,OAAO1C,KAAKsD,WACVxB,EAAA,sBAAoBgD,MAAM,iBAC1B9E,KAAKsB,OAAOyD,SACZ,M,6BA9IyBC,EAAA,CAA5BC,K,+BACwBD,EAAA,CAAxBE,K"}