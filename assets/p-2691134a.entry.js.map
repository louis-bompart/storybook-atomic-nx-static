{"version":3,"names":["atomicTimeframeFacetCss","AtomicTimeframeFacetStyle0","AtomicTimeframeFacet","this","label","field","withDatePicker","isCollapsed","headingLevel","filterFacetCount","injectionDepth","dependsOn","sortCriteria","focusTarget","headerFocus","FocusTargetController","initialize","timeframeFacetCommon","TimeframeFacetCommon","facetId","host","bindings","parseDependsOn","setFacetId","id","buildDependenciesManager","buildFacetConditionsManager","engine","_b","_a","facetForDateRange","state","filter","conditions","buildDateRange","getSearchStatusState","searchStatusState","deserializeRelativeDate","initializeFacetForDatePicker","initializeFacetForDateRange","values","initializeFilter","min","max","searchStatus","buildSearchStatus","disconnectedCallback","facetForDatePicker","buildDateFacet","options","numberOfValues","generateAutomaticRanges","currentValues","buildDateFilter","applyDateInput","dispatch","loadDateFacetSetActions","deselectAllDateFacetValues","render","h","FacetPlaceholder","hasError","firstSearchExecuted","onToggleCollapse","__decorate","InitializeBindings","BindStateToController","MapProp"],"sources":["src/components/search/facets/atomic-timeframe-facet/atomic-timeframe-facet.pcss?tag=atomic-timeframe-facet&encapsulation=shadow","src/components/search/facets/atomic-timeframe-facet/atomic-timeframe-facet.tsx"],"sourcesContent":["@import '../../../common/facets/facet-common.pcss';\r\n","import {\r\n  buildDateFacet,\r\n  buildDateFilter,\r\n  buildDateRange,\r\n  buildFacetConditionsManager,\r\n  buildSearchStatus,\r\n  DateFacet,\r\n  DateFacetState,\r\n  DateFilter,\r\n  DateFilterState,\r\n  DateRangeRequest,\r\n  deserializeRelativeDate,\r\n  RangeFacetSortCriterion,\r\n  loadDateFacetSetActions,\r\n  SearchStatus,\r\n  SearchStatusState,\r\n  FacetValueRequest,\r\n  CategoryFacetValueRequest,\r\n} from '@coveo/headless';\r\nimport {Component, Element, h, Listen, Prop, State} from '@stencil/core';\r\nimport {FocusTargetController} from '../../../../utils/accessibility-utils';\r\nimport {\r\n  BindStateToController,\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../../utils/initialization-utils';\r\nimport {MapProp} from '../../../../utils/props-utils';\r\nimport {parseDependsOn} from '../../../common/facets/depends-on';\r\nimport {FacetPlaceholder} from '../../../common/facets/facet-placeholder/facet-placeholder';\r\nimport {TimeframeFacetCommon} from '../../../common/facets/timeframe-facet-common';\r\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\r\n\r\n/**\r\n * A facet is a list of values for a certain field occurring in the results.\r\n * An `atomic-timeframe-facet` displays a facet of the results for the current query as date intervals.\r\n *\r\n * @slot default - The `atomic-timeframe` components defining the timeframes to display.\r\n *\r\n * @part facet - The wrapper for the entire facet.\r\n * @part placeholder - The placeholder shown before the first search is executed.\r\n *\r\n * @part label-button - The button that displays the label and allows to expand/collapse the facet.\r\n * @part label-button-icon - The label button icon.\r\n * @part clear-button - The button that resets the actively selected facet values.\r\n * @part clear-button-icon - The clear button icon.\r\n *\r\n * @part values - The facet values container.\r\n * @part value-label - The facet value label, common for all displays.\r\n * @part value-count - The facet value count, common for all displays.\r\n * @part value-link - The facet value when display is 'link'.\r\n * @part value-link-selected - The selected facet value when display is 'link'.\r\n *\r\n * @part input-start - The input for the starting value of the custom date range.\r\n * @part input-end - The input for the ending value of the custom date range.\r\n * @part input-label - The label for both the start and end input.\r\n * @part input-apply-button - The apply button for the custom range.\r\n */\r\n@Component({\r\n  tag: 'atomic-timeframe-facet',\r\n  styleUrl: './atomic-timeframe-facet.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicTimeframeFacet implements InitializableComponent {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  public facetForDateRange?: DateFacet;\r\n  public facetForDatePicker?: DateFacet;\r\n\r\n  private timeframeFacetCommon?: TimeframeFacetCommon;\r\n  public filter?: DateFilter;\r\n  public searchStatus!: SearchStatus;\r\n  @Element() private host!: HTMLElement;\r\n\r\n  @BindStateToController('facetForDateRange')\r\n  @State()\r\n  public facetState!: DateFacetState;\r\n  @BindStateToController('facetForDatePicker')\r\n  @State()\r\n  public facetForDatePickerState?: DateFacetState;\r\n  @BindStateToController('filter')\r\n  @State()\r\n  public filterState?: DateFilterState;\r\n  @BindStateToController('searchStatus')\r\n  @State()\r\n  public searchStatusState!: SearchStatusState;\r\n  @State() public error!: Error;\r\n\r\n  /**\r\n   * Specifies a unique identifier for the facet.\r\n   */\r\n  @Prop({mutable: true, reflect: true}) public facetId?: string;\r\n  /**\r\n   * The non-localized label for the facet.\r\n   * Used in the atomic-breadbox component through the bindings store.\r\n   */\r\n  @Prop({reflect: true}) public label = 'no-label';\r\n  /**\r\n   * The field whose values you want to display in the facet.\r\n   */\r\n  @Prop({reflect: true}) public field = 'date';\r\n  /**\r\n   * Whether this facet should contain an datepicker allowing users to set custom ranges.\r\n   */\r\n  @Prop({reflect: true}) public withDatePicker = false;\r\n  /**\r\n   * Specifies whether the facet is collapsed. When the facet is the child of an `atomic-facet-manager` component, the facet manager controls this property.\r\n   */\r\n  @Prop({reflect: true, mutable: true}) public isCollapsed = false;\r\n  /**\r\n   * The [heading level](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements) to use for the heading over the facet, from 1 to 6.\r\n   */\r\n  @Prop({reflect: true}) public headingLevel = 0;\r\n  /**\r\n   * Whether to exclude the parents of folded results when estimating the result count for each facet value.\r\n   */\r\n  @Prop({reflect: true}) public filterFacetCount = true;\r\n  /**\r\n   * The maximum number of results to scan in the index to ensure that the facet lists all potential facet values.\r\n   * Note: A high injectionDepth may negatively impact the facet request performance.\r\n   * Minimum: `0`\r\n   * Default: `1000`\r\n   */\r\n  @Prop({reflect: true}) public injectionDepth = 1000;\r\n\r\n  /**\r\n   * The required facets and values for this facet to be displayed.\r\n   * @example\r\n   * ```html\r\n   * <atomic-facet facet-id=\"abc\" field=\"objecttype\" ...></atomic-facet>\r\n   *\r\n   * <!-- To show the facet when any value is selected in the facet with id \"abc\": -->\r\n   * <atomic-timeframe-facet\r\n   *   depends-on-abc\r\n   *   ...\r\n   * ></atomic-timeframe-facet>\r\n   *\r\n   * <!-- To show the facet when value \"doc\" is selected in the facet with id \"abc\": -->\r\n   * <atomic-timeframe-facet\r\n   *   depends-on-abc=\"doc\"\r\n   *   ...\r\n   * ></atomic-timeframe-facet>\r\n   * ```\r\n   */\r\n  @MapProp() @Prop() public dependsOn: Record<string, string> = {};\r\n\r\n  /**\r\n   * The earliest date to accept from user input when the `withDatepicker` option is enabled.\r\n   *\r\n   * This value must be a valid date string in the format `YYYY-MM-DD`.\r\n   *\r\n   * If this format is not respected, the date picker ignores this property, behaving as if no `min` value had been set.\r\n   *\r\n   * See also [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date#min).\r\n   */\r\n  @Prop({reflect: true}) public min?: string;\r\n\r\n  /**\r\n   * The latest date to accept from user input when the `withDatepicker` option is enabled.\r\n   *\r\n   * This value must be a valid date string in the format `YYYY-MM-DD`.\r\n   *\r\n   * If this format is not respected, the date picker ignores this property, behaving as if no `max` value had been set.\r\n   *\r\n   * See also [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date#max).\r\n   */\r\n  @Prop({reflect: true}) public max?: string;\r\n\r\n  /**\r\n   * The sort criterion to apply to the returned facet values.\r\n   * Possible values are 'ascending' and 'descending'.\r\n   */\r\n  @Prop({reflect: true}) public sortCriteria: RangeFacetSortCriterion =\r\n    'descending';\r\n\r\n  private headerFocus?: FocusTargetController;\r\n\r\n  private get focusTarget(): FocusTargetController {\r\n    if (!this.headerFocus) {\r\n      this.headerFocus = new FocusTargetController(this);\r\n    }\r\n    return this.headerFocus;\r\n  }\r\n\r\n  public initialize() {\r\n    this.timeframeFacetCommon = new TimeframeFacetCommon({\r\n      facetId: this.facetId,\r\n      host: this.host,\r\n      bindings: this.bindings,\r\n      label: this.label,\r\n      field: this.field,\r\n      headingLevel: this.headingLevel,\r\n      dependsOn: parseDependsOn(this.dependsOn) && this.dependsOn,\r\n      withDatePicker: this.withDatePicker,\r\n      setFacetId: (id: string) => (this.facetId = id),\r\n      buildDependenciesManager: () =>\r\n        buildFacetConditionsManager(this.bindings.engine, {\r\n          facetId:\r\n            this.facetForDateRange?.state.facetId ?? this.filter!.state.facetId,\r\n          conditions: parseDependsOn<\r\n            FacetValueRequest | CategoryFacetValueRequest\r\n          >(this.dependsOn),\r\n        }),\r\n      buildDateRange,\r\n      getSearchStatusState: () => this.searchStatusState,\r\n      deserializeRelativeDate,\r\n      initializeFacetForDatePicker: () => this.initializeFacetForDatePicker(),\r\n      initializeFacetForDateRange: (values: DateRangeRequest[]) =>\r\n        this.initializeFacetForDateRange(values),\r\n      initializeFilter: () => this.initializeFilter(),\r\n      min: this.min,\r\n      max: this.max,\r\n      sortCriteria: this.sortCriteria,\r\n    });\r\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    this.timeframeFacetCommon?.disconnectedCallback();\r\n  }\r\n\r\n  private initializeFacetForDatePicker() {\r\n    this.facetForDatePicker = buildDateFacet(this.bindings.engine, {\r\n      options: {\r\n        facetId: `${this.facetId}_input_range`,\r\n        numberOfValues: 1,\r\n        generateAutomaticRanges: true,\r\n        field: this.field,\r\n        filterFacetCount: this.filterFacetCount,\r\n        injectionDepth: this.injectionDepth,\r\n      },\r\n    });\r\n    return this.facetForDatePicker;\r\n  }\r\n\r\n  private initializeFacetForDateRange(values: DateRangeRequest[]) {\r\n    this.facetForDateRange = buildDateFacet(this.bindings.engine, {\r\n      options: {\r\n        facetId: this.facetId,\r\n        field: this.field,\r\n        currentValues: values,\r\n        generateAutomaticRanges: false,\r\n        sortCriteria: this.sortCriteria,\r\n        filterFacetCount: this.filterFacetCount,\r\n        injectionDepth: this.injectionDepth,\r\n      },\r\n    });\r\n    return this.facetForDateRange;\r\n  }\r\n\r\n  private initializeFilter() {\r\n    this.filter = buildDateFilter(this.bindings.engine, {\r\n      options: {\r\n        facetId: `${this.facetId}_input`,\r\n        field: this.field,\r\n      },\r\n    });\r\n\r\n    return this.filter;\r\n  }\r\n\r\n  @Listen('atomic/dateInputApply')\r\n  public applyDateInput() {\r\n    this.facetId &&\r\n      this.bindings.engine.dispatch(\r\n        loadDateFacetSetActions(\r\n          this.bindings.engine\r\n        ).deselectAllDateFacetValues(this.facetId)\r\n      );\r\n  }\r\n\r\n  public render() {\r\n    if (!this.timeframeFacetCommon) {\r\n      return (\r\n        <FacetPlaceholder\r\n          numberOfValues={5}\r\n          isCollapsed={this.isCollapsed}\r\n        ></FacetPlaceholder>\r\n      );\r\n    }\r\n    return this.timeframeFacetCommon.render({\r\n      hasError: this.searchStatusState.hasError,\r\n      firstSearchExecuted: this.searchStatusState.firstSearchExecuted,\r\n      isCollapsed: this.isCollapsed,\r\n      headerFocus: this.focusTarget,\r\n      onToggleCollapse: () => (this.isCollapsed = !this.isCollapsed),\r\n    });\r\n  }\r\n}\r\n"],"mappings":"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"}