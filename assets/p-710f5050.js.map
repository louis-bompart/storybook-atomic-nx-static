{"version":3,"names":["ResultChildrenCommon","constructor","props","this","foldedResult","collection","getResult","numberOfChildren","children","length","hasChildren","getFoldedResultListState","results","find","r","result","uniqueId","renderPlaceholder","h","ResultsPlaceholder","numberOfPlaceholders","density","getDisplayConfig","display","imageSize","getImageSize","renderNoResult","part","class","getBindings","i18n","t","getNoResultText","renderCollapseButton","moreResultsAvailable","Button","style","onClick","getShowInitialChildren","getFoldedResultList","logShowMoreFoldedResults","logShowLessFoldedResults","toggleShowInitialChildren","renderChildrenWrapper","content","name","renderChildren","map","child","i","renderChild","renderCollection","isLoadingMoreResults","_a","trim","childrenToRender","getInitialChildren","Host","renderFoldedResult","componentWillRender","setInitialChildren","render","getInheritTemplates","getResultTemplateRegistered","getTemplateHasError"],"sources":["src/components/common/result-children/result-children-common.tsx"],"sourcesContent":["import {\r\n  FoldedResult,\r\n  FoldedResultList,\r\n  FoldedResultListState,\r\n} from '@coveo/headless';\r\nimport {Host, VNode, h} from '@stencil/core';\r\nimport {ResultsPlaceholder} from '../atomic-result-placeholder/placeholders';\r\nimport {Button} from '../button';\r\nimport {AnyBindings} from '../interface/bindings';\r\nimport {DisplayConfig} from '../item-list/item-decorators';\r\nimport {ItemDisplayImageSize} from '../layout/display-options';\r\n\r\ninterface ResultChildrenProps {\r\n  getHost: () => HTMLElement;\r\n  getBindings: () => AnyBindings;\r\n  getFoldedResultListState: () => FoldedResultListState;\r\n  getResult: () => FoldedResult;\r\n  getShowInitialChildren: () => boolean;\r\n  getFoldedResultList: () => FoldedResultList;\r\n  getInitialChildren: () => FoldedResult[];\r\n  getInheritTemplates: () => boolean;\r\n  getResultTemplateRegistered: () => boolean;\r\n  getTemplateHasError: () => boolean;\r\n  getNoResultText: () => string;\r\n  getDisplayConfig: () => DisplayConfig;\r\n  getImageSize: () => ItemDisplayImageSize | undefined;\r\n  renderChild: (child: FoldedResult, isLast: boolean) => VNode;\r\n  setInitialChildren: (initialChildren: FoldedResult[]) => void;\r\n  toggleShowInitialChildren: () => void;\r\n}\r\n\r\nexport class ResultChildrenCommon {\r\n  constructor(private props: ResultChildrenProps) {}\r\n\r\n  private get foldedResult(): FoldedResult {\r\n    return this.collection || this.props.getResult();\r\n  }\r\n\r\n  private get numberOfChildren() {\r\n    return this.foldedResult.children.length;\r\n  }\r\n\r\n  private get hasChildren() {\r\n    return !!this.numberOfChildren;\r\n  }\r\n\r\n  private get collection() {\r\n    return this.props.getFoldedResultListState().results.find((r) => {\r\n      return r.result.uniqueId === this.props.getResult().result.uniqueId;\r\n    });\r\n  }\r\n\r\n  private renderPlaceholder() {\r\n    return (\r\n      <ResultsPlaceholder\r\n        numberOfPlaceholders={this.numberOfChildren || 2}\r\n        density={this.props.getDisplayConfig().density}\r\n        display={'list'}\r\n        imageSize={\r\n          this.props.getImageSize() || this.props.getDisplayConfig().imageSize\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  private renderNoResult() {\r\n    return (\r\n      <p part=\"no-result-root\" class=\"no-result-root my-3\">\r\n        {this.props.getBindings().i18n.t(this.props.getNoResultText())}\r\n      </p>\r\n    );\r\n  }\r\n\r\n  private renderCollapseButton() {\r\n    const collection = this.collection!;\r\n    if (!!collection.children.length && !collection.moreResultsAvailable) {\r\n      return (\r\n        <Button\r\n          part=\"show-hide-button\"\r\n          class=\"show-hide-button\"\r\n          style=\"text-primary\"\r\n          onClick={() => {\r\n            if (this.props.getShowInitialChildren()) {\r\n              this.props\r\n                .getFoldedResultList()\r\n                .logShowMoreFoldedResults(this.foldedResult.result);\r\n            } else {\r\n              this.props.getFoldedResultList().logShowLessFoldedResults();\r\n            }\r\n            this.props.toggleShowInitialChildren();\r\n          }}\r\n        >\r\n          {this.props\r\n            .getBindings()\r\n            .i18n.t(\r\n              this.props.getShowInitialChildren()\r\n                ? 'load-all-results'\r\n                : 'collapse-results'\r\n            )}\r\n        </Button>\r\n      );\r\n    }\r\n    return;\r\n  }\r\n\r\n  private renderChildrenWrapper(content: VNode | VNode[]) {\r\n    return (\r\n      <div part=\"children-root\">\r\n        {this.hasChildren && <slot name=\"before-children\"></slot>}\r\n        {content}\r\n        {this.hasChildren && <slot name=\"after-children\"></slot>}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderChildren(children: FoldedResult[]): VNode | VNode[] {\r\n    return this.renderChildrenWrapper(\r\n      children.map((child, i) =>\r\n        this.props.renderChild(child, i === children.length - 1)\r\n      )\r\n    );\r\n  }\r\n\r\n  private renderCollection() {\r\n    const collection = this.collection!;\r\n\r\n    if (collection.isLoadingMoreResults) {\r\n      return this.renderChildrenWrapper(this.renderPlaceholder());\r\n    }\r\n\r\n    if (!collection.moreResultsAvailable && !this.hasChildren) {\r\n      return this.props.getNoResultText()?.trim().length\r\n        ? this.renderNoResult()\r\n        : null;\r\n    }\r\n\r\n    if (!this.hasChildren) {\r\n      return;\r\n    }\r\n\r\n    const childrenToRender = this.props.getShowInitialChildren()\r\n      ? this.props.getInitialChildren()\r\n      : collection.children;\r\n\r\n    return (\r\n      <Host>\r\n        {this.renderCollapseButton()}\r\n        {this.renderChildren(childrenToRender)}\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  private renderFoldedResult() {\r\n    if (!this.hasChildren) {\r\n      return;\r\n    }\r\n\r\n    return this.renderChildren(this.foldedResult.children);\r\n  }\r\n\r\n  public componentWillRender() {\r\n    const collection = this.collection;\r\n    if (this.props.getInitialChildren() || !collection) {\r\n      return;\r\n    }\r\n\r\n    this.props.setInitialChildren(collection.children);\r\n  }\r\n\r\n  public render() {\r\n    if (\r\n      !this.props.getInheritTemplates() &&\r\n      !this.props.getResultTemplateRegistered()\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.props.getInheritTemplates() && this.props.getTemplateHasError()) {\r\n      return <slot></slot>;\r\n    }\r\n\r\n    return this.collection\r\n      ? this.renderCollection()\r\n      : this.renderFoldedResult();\r\n  }\r\n}\r\n"],"mappings":"yHA+BaA,EACX,WAAAC,CAAoBC,GAAAC,KAAAD,O,CAEpB,gBAAYE,GACV,OAAOD,KAAKE,YAAcF,KAAKD,MAAMI,W,CAGvC,oBAAYC,GACV,OAAOJ,KAAKC,aAAaI,SAASC,M,CAGpC,eAAYC,GACV,QAASP,KAAKI,gB,CAGhB,cAAYF,GACV,OAAOF,KAAKD,MAAMS,2BAA2BC,QAAQC,MAAMC,GAClDA,EAAEC,OAAOC,WAAab,KAAKD,MAAMI,YAAYS,OAAOC,U,CAIvD,iBAAAC,GACN,OACEC,EAACC,EAAkB,CACjBC,qBAAsBjB,KAAKI,kBAAoB,EAC/Cc,QAASlB,KAAKD,MAAMoB,mBAAmBD,QACvCE,QAAS,OACTC,UACErB,KAAKD,MAAMuB,gBAAkBtB,KAAKD,MAAMoB,mBAAmBE,W,CAM3D,cAAAE,GACN,OACER,EAAA,KAAGS,KAAK,iBAAiBC,MAAM,uBAC5BzB,KAAKD,MAAM2B,cAAcC,KAAKC,EAAE5B,KAAKD,MAAM8B,mB,CAK1C,oBAAAC,GACN,MAAM5B,EAAaF,KAAKE,WACxB,KAAMA,EAAWG,SAASC,SAAWJ,EAAW6B,qBAAsB,CACpE,OACEhB,EAACiB,EAAM,CACLR,KAAK,mBACLC,MAAM,mBACNQ,MAAM,eACNC,QAAS,KACP,GAAIlC,KAAKD,MAAMoC,yBAA0B,CACvCnC,KAAKD,MACFqC,sBACAC,yBAAyBrC,KAAKC,aAAaW,O,KACzC,CACLZ,KAAKD,MAAMqC,sBAAsBE,0B,CAEnCtC,KAAKD,MAAMwC,2BAA2B,GAGvCvC,KAAKD,MACH2B,cACAC,KAAKC,EACJ5B,KAAKD,MAAMoC,yBACP,mBACA,oB,CAKd,M,CAGM,qBAAAK,CAAsBC,GAC5B,OACE1B,EAAA,OAAKS,KAAK,iBACPxB,KAAKO,aAAeQ,EAAA,QAAM2B,KAAK,oBAC/BD,EACAzC,KAAKO,aAAeQ,EAAA,QAAM2B,KAAK,mB,CAK9B,cAAAC,CAAetC,GACrB,OAAOL,KAAKwC,sBACVnC,EAASuC,KAAI,CAACC,EAAOC,IACnB9C,KAAKD,MAAMgD,YAAYF,EAAOC,IAAMzC,EAASC,OAAS,K,CAKpD,gBAAA0C,G,MACN,MAAM9C,EAAaF,KAAKE,WAExB,GAAIA,EAAW+C,qBAAsB,CACnC,OAAOjD,KAAKwC,sBAAsBxC,KAAKc,oB,CAGzC,IAAKZ,EAAW6B,uBAAyB/B,KAAKO,YAAa,CACzD,QAAO2C,EAAAlD,KAAKD,MAAM8B,qBAAiB,MAAAqB,SAAA,SAAAA,EAAEC,OAAO7C,QACxCN,KAAKuB,iBACL,I,CAGN,IAAKvB,KAAKO,YAAa,CACrB,M,CAGF,MAAM6C,EAAmBpD,KAAKD,MAAMoC,yBAChCnC,KAAKD,MAAMsD,qBACXnD,EAAWG,SAEf,OACEU,EAACuC,EAAI,KACFtD,KAAK8B,uBACL9B,KAAK2C,eAAeS,G,CAKnB,kBAAAG,GACN,IAAKvD,KAAKO,YAAa,CACrB,M,CAGF,OAAOP,KAAK2C,eAAe3C,KAAKC,aAAaI,S,CAGxC,mBAAAmD,GACL,MAAMtD,EAAaF,KAAKE,WACxB,GAAIF,KAAKD,MAAMsD,uBAAyBnD,EAAY,CAClD,M,CAGFF,KAAKD,MAAM0D,mBAAmBvD,EAAWG,S,CAGpC,MAAAqD,GACL,IACG1D,KAAKD,MAAM4D,wBACX3D,KAAKD,MAAM6D,8BACZ,CACA,M,CAGF,IAAK5D,KAAKD,MAAM4D,uBAAyB3D,KAAKD,MAAM8D,sBAAuB,CACzE,OAAO9C,EAAA,Y,CAGT,OAAOf,KAAKE,WACRF,KAAKgD,mBACLhD,KAAKuD,oB"}