import{N as a,g as t,O as h}from"./atomic-breadbox.new.stories-D5_t4T0B.js";import{l as u,y as d}from"./p-794b93a9-Bwn0XXeG.js";import{s as l}from"./p-cfb3c589-B_FPW2aN.js";import{t as m,n as g,a as b,r as p}from"./p-484590fe-zLGppYb8.js";import{r as c}from"./p-2130c607-z19UWwf_.js";import{o as f}from"./p-c280cd05-7zHi8rD9.js";import{t as x,r as o}from"./p-0943c4bd-Erj32V3d.js";import{r as y}from"./p-f5723aee-D-iZ1npx.js";import{n as Q,i as S,a as I,l as L,c as C,s as E}from"./p-82ef9a5b-CYvpkEDQ.js";import"./p-e12016d2-bJLTunAq.js";import"./index-Bqoxw6Vv.js";import"./_commonjsHelpers-BosuxZz1.js";import"./iframe-0V_eukm8.js";import"../sb-preview/runtime.js";import"./p-8f5830b4-EwJYRc8T.js";import"./p-1580513b-3LX64KEr.js";import"./p-e9c4f463-BPmi-3c5.js";const V=class{constructor(e){a(this,e),this.error=void 0,this.icon=void 0,this.maxWithQuery=void 0,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}initialize(){const e=this.bindings.engine,{registerQuerySuggest:i,fetchQuerySuggestions:r}=u(e);return e.dispatch(i({id:this.bindings.id,count:this.bindings.numberOfQueries})),{position:Array.from(this.host.parentNode.children).indexOf(this.host),onInput:()=>e.dispatch(r({id:this.bindings.id})),renderItems:()=>this.renderItems()}}renderItems(){const i=this.bindings.searchBoxController.state.value!==""?this.maxWithQuery:this.maxWithoutQuery;return this.bindings.searchBoxController.state.suggestions.slice(0,i).map(r=>this.renderItem(r))}renderItem(e){const i=this.bindings.searchBoxController.state.value!=="";return{...m(e,this.bindings.i18n),content:t(p,null,t(b,{icon:this.icon||l,hasSuggestion:this.bindings.getSuggestions().length>1}),t(g,{suggestion:e,hasQuery:i})),onSelect:()=>{this.bindings.searchBoxController.selectSuggestion(e.rawValue)}}}render(){if(this.error)return t("atomic-component-error",{key:"2d1032c727dfd928bf0c4b182d03c05e3b53cb92",element:this.host,error:this.error})}get host(){return h(this)}},j=class{constructor(e){a(this,e),this.maxWithQuery=3,this.warnUser=y(()=>this.bindings.engine.logger.warn("The recent queries feature is deactivated because analytics are disabled.")),this.error=void 0,this.icon=void 0,this.maxWithQuery=3,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}renderIcon(){return this.icon||f}initialize(){return this.storage=new x,this.recentQueriesList=d(this.bindings.engine,{initialState:{queries:this.retrieveLocalStorage()},options:{maxLength:1e3,clearFilters:this.bindings.clearFilters}}),this.recentQueriesList.subscribe(()=>this.updateLocalStorage()),{position:Array.from(this.host.parentNode.children).indexOf(this.host),renderItems:()=>this.renderItems()}}retrieveLocalStorage(){return this.storage.getParsedJSON(o.RECENT_QUERIES,[])}updateLocalStorage(){return this.recentQueriesList.state.analyticsEnabled?this.storage.setJSON(o.RECENT_QUERIES,this.recentQueriesList.state.queries):this.disableFeature()}disableFeature(){this.warnUser(),this.storage.removeItem(o.RECENT_QUERIES)}renderItems(){if(!this.recentQueriesList.state.analyticsEnabled)return[];const e=this.bindings.searchBoxController.state.value,r=e!==""?this.maxWithQuery:this.maxWithoutQuery,n=this.recentQueriesList.state.queries.filter(s=>s!==e&&s.toLowerCase().startsWith(e.toLowerCase())).slice(0,r).map(s=>this.renderItem(s));return n.length&&n.unshift(this.renderClear()),n}renderClear(){return{...Q(this.bindings.i18n),content:t(S,{i18n:this.bindings.i18n}),onSelect:()=>{this.recentQueriesList.clear(),this.bindings.triggerSuggestions()}}}renderItem(e){const i=this.bindings.searchBoxController.state.value;return{...I(e,this.bindings.i18n),content:t(E,null,t(C,{icon:this.renderIcon()}),t(L,{query:i,value:e})),onSelect:()=>{if(this.bindings.isStandalone){this.bindings.searchBoxController.updateText(e),this.bindings.searchBoxController.submit();return}this.recentQueriesList.executeRecentQuery(this.recentQueriesList.state.queries.indexOf(e))}}}render(){if(this.error)return t("atomic-component-error",{key:"57d2db4a5b30a56207d447c406197e6380845694",element:this.host,error:this.error})}get host(){return h(this)}};export{V as atomic_commerce_search_box_query_suggestions,j as atomic_commerce_search_box_recent_queries};
