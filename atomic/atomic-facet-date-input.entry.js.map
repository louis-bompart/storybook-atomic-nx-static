{"file":"atomic-facet-date-input.entry.esm.js","mappings":"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","names":[],"sources":["src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["import {buildDateRange} from '@coveo/headless';\r\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\r\nimport {parseDate} from '../../../../utils/date-utils';\r\nimport {Button} from '../../button';\r\nimport {AnyBindings} from '../../interface/bindings';\r\nimport {DateFilter, DateFilterState} from '../../types';\r\n\r\n/**\r\n * Internal component made to be integrated in a TimeframeFacet.\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-facet-date-input',\r\n  shadow: false,\r\n})\r\nexport class FacetDateInput {\r\n  @State() private start?: Date;\r\n  @State() private end?: Date;\r\n  private startRef!: HTMLInputElement;\r\n  private endRef!: HTMLInputElement;\r\n\r\n  @Prop() public bindings!: AnyBindings;\r\n  @Prop() public filter!: DateFilter;\r\n  @Prop() public filterState!: DateFilterState;\r\n  @Prop() public label!: string;\r\n  @Prop() public min?: string;\r\n  @Prop() public max?: string;\r\n\r\n  @Event({\r\n    eventName: 'atomic/dateInputApply',\r\n  })\r\n  private applyInput!: EventEmitter;\r\n\r\n  public connectedCallback() {\r\n    this.start = this.filterState.range\r\n      ? parseDate(this.filterState.range.start).toDate()\r\n      : undefined;\r\n    this.end = this.filterState.range\r\n      ? parseDate(this.filterState.range.end).toDate()\r\n      : undefined;\r\n  }\r\n\r\n  private apply() {\r\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\r\n      return;\r\n    }\r\n\r\n    this.applyInput.emit();\r\n    this.filter.setRange(\r\n      buildDateRange({\r\n        start: this.start!,\r\n        end: this.end!.setHours(23, 59, 59, 999),\r\n      })\r\n    );\r\n  }\r\n\r\n  private formattedDateValue(date?: string | Date) {\r\n    if (!date) {\r\n      return '';\r\n    }\r\n    return parseDate(date).format('YYYY-MM-DD');\r\n  }\r\n\r\n  render() {\r\n    const label = this.bindings.i18n.t(this.label);\r\n    const startLabel = this.bindings.i18n.t('start');\r\n    const endLabel = this.bindings.i18n.t('end');\r\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\r\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\r\n    const apply = this.bindings.i18n.t('apply');\r\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\r\n\r\n    const inputClasses = 'input-primary p-2.5';\r\n    const labelClasses = 'text-neutral-dark self-center';\r\n\r\n    const placeholder = 'yyyy-mm-dd';\r\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\r\n    const pattern =\r\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\r\n\r\n    return (\r\n      <form\r\n        class=\"grid gap-2 grid-cols-min-1fr mt-4 px-2\"\r\n        onSubmit={(e) => {\r\n          e.preventDefault();\r\n          this.apply();\r\n          return false;\r\n        }}\r\n      >\r\n        <label\r\n          part=\"input-label\"\r\n          class={labelClasses}\r\n          htmlFor={`${this.filterState.facetId}_start`}\r\n        >\r\n          {startLabel}:\r\n        </label>\r\n        <input\r\n          id={`${this.filterState.facetId}_start`}\r\n          part=\"input-start\"\r\n          type=\"date\"\r\n          ref={(ref) => (this.startRef = ref!)}\r\n          class={inputClasses}\r\n          aria-label={startAria}\r\n          placeholder={placeholder}\r\n          pattern={pattern}\r\n          required\r\n          // API/Index minimum supported date\r\n          min={this.min || this.formattedDateValue('1401-01-01')}\r\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\r\n          value={this.formattedDateValue(this.filterState.range?.start)}\r\n          onInput={(e) =>\r\n            (this.start = parseDate(\r\n              (e.target as HTMLInputElement).value\r\n            ).toDate())\r\n          }\r\n        />\r\n        <label\r\n          part=\"input-label\"\r\n          class={labelClasses}\r\n          htmlFor={`${this.filterState.facetId}_end`}\r\n        >\r\n          {endLabel}:\r\n        </label>\r\n        <input\r\n          id={`${this.filterState.facetId}_end`}\r\n          part=\"input-end\"\r\n          type=\"date\"\r\n          ref={(ref) => (this.endRef = ref!)}\r\n          class={inputClasses}\r\n          aria-label={endAria}\r\n          placeholder={placeholder}\r\n          pattern={pattern}\r\n          required\r\n          min={this.min || this.formattedDateValue(this.start)}\r\n          max={this.max}\r\n          value={this.formattedDateValue(this.filterState.range?.end)}\r\n          onInput={(e) =>\r\n            (this.end = parseDate(\r\n              (e.target as HTMLInputElement).value\r\n            ).toDate())\r\n          }\r\n        />\r\n        <Button\r\n          style=\"outline-primary\"\r\n          type=\"submit\"\r\n          part=\"input-apply-button\"\r\n          class=\"p-2.5 col-span-2 truncate\"\r\n          ariaLabel={applyAria}\r\n          text={apply}\r\n        ></Button>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n"],"version":3}