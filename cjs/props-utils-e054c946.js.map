{"file":"props-utils-e054c946.js","mappings":"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","names":["getElement","camelToKebab","isArray","kebabToCamel"],"sources":["src/utils/props-utils.ts"],"sourcesContent":["import {isArray} from '@coveo/bueno';\r\nimport {ComponentInterface, getElement} from '@stencil/core';\r\nimport {camelToKebab, kebabToCamel} from './utils';\r\n\r\ninterface MapPropOptions {\r\n  attributePrefix?: string;\r\n  splitValues?: boolean;\r\n}\r\n\r\nexport function MapProp(opts?: MapPropOptions) {\r\n  return (component: ComponentInterface, variableName: string) => {\r\n    const {componentWillLoad} = component;\r\n    if (!componentWillLoad) {\r\n      console.error(\r\n        'The \"componentWillLoad\" lifecycle method has to be defined for the MapProp decorator to work.'\r\n      );\r\n      return;\r\n    }\r\n\r\n    component.componentWillLoad = function () {\r\n      const prefix = (opts && opts.attributePrefix) || variableName;\r\n      const variable = this[variableName];\r\n      const attributes = getElement(this).attributes;\r\n      mapAttributesToProp(\r\n        prefix,\r\n        variable,\r\n        Array.from(attributes),\r\n        opts?.splitValues ?? false\r\n      );\r\n      componentWillLoad.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nexport function ArrayProp() {\r\n  return (component: ComponentInterface, variableName: string) => {\r\n    const {componentWillLoad} = component;\r\n\r\n    const attributeWithBrackets = camelToKebab(variableName);\r\n\r\n    component.componentWillLoad = function () {\r\n      const value = this[variableName];\r\n      if (!value || isArray(value)) {\r\n        componentWillLoad?.call(this);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const valueAsArray = JSON.parse(value);\r\n        if (isArray(valueAsArray)) {\r\n          this[variableName] = valueAsArray;\r\n        } else {\r\n          console.error(\r\n            `Property ${attributeWithBrackets} should be an array`,\r\n            getElement(this)\r\n          );\r\n        }\r\n      } catch (e) {\r\n        console.error(\r\n          `Error while parsing attribute ${attributeWithBrackets} as array`,\r\n          e\r\n        );\r\n      }\r\n\r\n      componentWillLoad?.call(this);\r\n    };\r\n  };\r\n}\r\n\r\nfunction splitAttributeValueOnCommas(attributeValue: string) {\r\n  const splitButIgnoreEscapeSymbolsExpression = /(?:\\\\.|[^,])+/g;\r\n  const [...valuesWithEscapeSymbols] =\r\n    attributeValue.matchAll(splitButIgnoreEscapeSymbolsExpression) ?? [];\r\n\r\n  const removeEscapeSymbolsExpression = /\\\\(.)/g;\r\n  return valuesWithEscapeSymbols.map(([valuesWithEscapeSymbols]) =>\r\n    valuesWithEscapeSymbols.replace(removeEscapeSymbolsExpression, '$1')\r\n  );\r\n}\r\n\r\nexport function mapAttributesToProp(\r\n  prefix: string,\r\n  mapVariable: Record<string, string | string[]>,\r\n  attributes: {name: string; value: string}[],\r\n  splitValues: boolean\r\n) {\r\n  const map = attributesToStringMap(prefix, attributes);\r\n  Object.assign(\r\n    mapVariable,\r\n    splitValues ? stringMapToStringArrayMap(map) : map\r\n  );\r\n}\r\n\r\nfunction stringMapToStringArrayMap(map: Record<string, string>) {\r\n  return Object.entries(map).reduce(\r\n    (acc, [key, value]) => ({\r\n      ...acc,\r\n      [key]: splitAttributeValueOnCommas(value).map((subValue) =>\r\n        subValue.trim()\r\n      ),\r\n    }),\r\n    {}\r\n  );\r\n}\r\n\r\nfunction attributesToStringMap(\r\n  prefix: string,\r\n  attributes: {name: string; value: string}[]\r\n) {\r\n  const mapVariable: Record<string, string> = {};\r\n  const kebabPrefix = camelToKebab(prefix) + '-';\r\n  for (let i = 0; i < attributes.length; i++) {\r\n    const attribute = attributes[i];\r\n    if (attribute.name.indexOf(kebabPrefix) !== 0) {\r\n      continue;\r\n    }\r\n\r\n    const property = kebabToCamel(attribute.name.replace(kebabPrefix, ''));\r\n    mapVariable[property] = `${attribute.value}`;\r\n  }\r\n  return mapVariable;\r\n}\r\n"],"version":3}