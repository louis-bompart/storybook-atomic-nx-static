{"version":3,"names":["MissingParentError","Error","constructor","elementName","parentName","super","ItemContext","opts","folded","component","itemVariable","connectedCallback","componentWillRender","render","element","getElement","this","event","buildCustomEvent","itemContextEventName","item","extractFolded","canceled","dispatchEvent","error","nodeName","toLowerCase","call","remove","console","InteractiveItemContext","interactiveItemVariable","interactiveItemContextEventName","itemContext","Promise","resolve","reject","closest","returnFolded","children","result","childTemplatesContextEventName","ChildTemplatesContext","itemTemplateProviderProp","itemTemplateProvider","itemDisplayConfigContextEventName","ItemDisplayConfigContext","config"],"sources":["src/components/common/item-list/item-decorators.tsx"],"sourcesContent":["import {ComponentInterface, getElement} from '@stencil/core';\nimport {buildCustomEvent} from '../../../utils/event-utils';\nimport {closest} from '../../../utils/utils';\nimport {AnyItem} from '../interface/item';\nimport {\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n} from '../layout/display-options';\nimport {ItemTemplateProvider} from './item-template-provider';\n\nexport class MissingParentError extends Error {\n  constructor(elementName: string, parentName: string) {\n    super(\n      `The \"${elementName}\" element must be the child of an \"${parentName}\" element.`\n    );\n  }\n}\n\nexport function ItemContext(\n  opts: {parentName: string; folded: boolean} = {\n    parentName: 'atomic-result',\n    folded: false,\n  }\n) {\n  return (component: ComponentInterface, itemVariable: string) => {\n    const {connectedCallback, componentWillRender, render} = component;\n    component.connectedCallback = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        itemContextEventName,\n        (item: Record<string, unknown>) => {\n          this[itemVariable] = extractFolded(item, opts.folded);\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        this.error = new MissingParentError(\n          element.nodeName.toLowerCase(),\n          opts.parentName\n        );\n        return;\n      }\n      return connectedCallback && connectedCallback.call(this);\n    };\n\n    component.componentWillRender = function () {\n      if (this.error) {\n        return;\n      }\n\n      return componentWillRender && componentWillRender.call(this);\n    };\n\n    component.render = function () {\n      if (this.error) {\n        const element = getElement(this);\n        element.remove();\n        console.error(\n          'Result component is in error and has been removed from the DOM',\n          this.error,\n          this,\n          element\n        );\n        return;\n      }\n      return render && render.call(this);\n    };\n  };\n}\n\nexport function InteractiveItemContext() {\n  return (component: ComponentInterface, interactiveItemVariable: string) => {\n    const {connectedCallback} = component;\n    component.connectedCallback = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        interactiveItemContextEventName,\n        (item: AnyItem) => {\n          this[interactiveItemVariable] = item;\n        }\n      );\n      element.dispatchEvent(event);\n      return connectedCallback && connectedCallback.call(this);\n    };\n  };\n}\n\ntype ItemContextEventHandler<T> = (item: T) => void;\nexport type ItemContextEvent<T> = CustomEvent<ItemContextEventHandler<T>>;\nconst itemContextEventName = 'atomic/resolveResult';\nexport type InteractiveItemContextEvent = CustomEvent<\n  (interactiveItem: unknown) => void\n>;\nconst interactiveItemContextEventName = 'atomic/resolveInteractiveResult';\n\nexport function itemContext<T>(element: Element, parentName: string) {\n  return new Promise<T>((resolve, reject) => {\n    const event = buildCustomEvent<ItemContextEventHandler<T>>(\n      itemContextEventName,\n      (item: T) => {\n        return resolve(item);\n      }\n    );\n    element.dispatchEvent(event);\n\n    if (!closest(element, parentName)) {\n      reject(\n        new MissingParentError(element.nodeName.toLowerCase(), parentName)\n      );\n    }\n  });\n}\n\nfunction extractFolded(item: Record<string, unknown>, returnFolded: boolean) {\n  if (returnFolded) {\n    if ('children' in item) {\n      return item;\n    } else {\n      return {children: [], result: item};\n    }\n  }\n\n  if ('children' in item && 'result' in item) {\n    return item.result;\n  }\n  return item;\n}\n\ntype ChildTemplatesContextEventHandler = (\n  itemTemplateProvider?: ItemTemplateProvider\n) => void;\nexport type ChildTemplatesContextEvent =\n  CustomEvent<ChildTemplatesContextEventHandler>;\nconst childTemplatesContextEventName = 'atomic/resolveChildTemplates';\n\ninterface AtomicItemChildren {\n  itemTemplateProvider?: ItemTemplateProvider;\n}\n\nexport function ChildTemplatesContext() {\n  return (component: ComponentInterface, itemTemplateProviderProp: string) => {\n    const {componentWillRender} = component;\n    component.componentWillRender = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        childTemplatesContextEventName,\n        (itemTemplateProvider?: ItemTemplateProvider) => {\n          const component = this as AtomicItemChildren;\n          if (component.itemTemplateProvider) {\n            return;\n          }\n\n          this[itemTemplateProviderProp] = itemTemplateProvider;\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        this[itemTemplateProviderProp] = null;\n        return;\n      }\n      return componentWillRender && componentWillRender.call(this);\n    };\n  };\n}\n\nexport type DisplayConfig = {\n  density: ItemDisplayDensity;\n  imageSize: ItemDisplayImageSize;\n};\n\ntype ItemDisplayConfigContextEventHandler = (config: DisplayConfig) => void;\nexport type ItemDisplayConfigContextEvent =\n  CustomEvent<ItemDisplayConfigContextEventHandler>;\nconst itemDisplayConfigContextEventName = 'atomic/resolveResultDisplayConfig';\n\nexport function ItemDisplayConfigContext() {\n  return (component: ComponentInterface, itemVariable: string) => {\n    const {componentWillRender} = component;\n    component.componentWillRender = function () {\n      const element = getElement(this);\n      const event = buildCustomEvent(\n        itemDisplayConfigContextEventName,\n        (config: DisplayConfig) => {\n          this[itemVariable] = config;\n        }\n      );\n\n      const canceled = element.dispatchEvent(event);\n      if (canceled) {\n        return;\n      }\n      return componentWillRender && componentWillRender.call(this);\n    };\n  };\n}\n"],"mappings":"kHAUaA,UAA2BC,MACtC,WAAAC,CAAYC,EAAqBC,GAC/BC,MACE,QAAQF,uCAAiDC,c,WAK/CE,EACdC,EAA8C,CAC5CH,WAAY,gBACZI,OAAQ,QAGV,MAAO,CAACC,EAA+BC,KACrC,MAAMC,kBAACA,EAAiBC,oBAAEA,EAAmBC,OAAEA,GAAUJ,EACzDA,EAAUE,kBAAoB,WAC5B,MAAMG,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZC,GACCC,IACCJ,KAAKN,GAAgBW,EAAcD,EAAMb,EAAKC,OAAO,IAIzD,MAAMc,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZN,KAAKQ,MAAQ,IAAIxB,EACfc,EAAQW,SAASC,cACjBnB,EAAKH,YAEP,M,CAEF,OAAOO,GAAqBA,EAAkBgB,KAAKX,K,EAGrDP,EAAUG,oBAAsB,WAC9B,GAAII,KAAKQ,MAAO,CACd,M,CAGF,OAAOZ,GAAuBA,EAAoBe,KAAKX,K,EAGzDP,EAAUI,OAAS,WACjB,GAAIG,KAAKQ,MAAO,CACd,MAAMV,EAAUC,EAAWC,MAC3BF,EAAQc,SACRC,QAAQL,MACN,iEACAR,KAAKQ,MACLR,KACAF,GAEF,M,CAEF,OAAOD,GAAUA,EAAOc,KAAKX,K,CAC9B,CAEL,C,SAEgBc,IACd,MAAO,CAACrB,EAA+BsB,KACrC,MAAMpB,kBAACA,GAAqBF,EAC5BA,EAAUE,kBAAoB,WAC5B,MAAMG,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZc,GACCZ,IACCJ,KAAKe,GAA2BX,CAAI,IAGxCN,EAAQS,cAAcN,GACtB,OAAON,GAAqBA,EAAkBgB,KAAKX,K,CACpD,CAEL,CAIA,MAAMG,EAAuB,uBAI7B,MAAMa,EAAkC,kC,SAExBC,EAAenB,EAAkBV,GAC/C,OAAO,IAAI8B,SAAW,CAACC,EAASC,KAC9B,MAAMnB,EAAQC,EACZC,GACCC,GACQe,EAAQf,KAGnBN,EAAQS,cAAcN,GAEtB,IAAKoB,EAAQvB,EAASV,GAAa,CACjCgC,EACE,IAAIpC,EAAmBc,EAAQW,SAASC,cAAetB,G,IAI/D,CAEA,SAASiB,EAAcD,EAA+BkB,GACpD,GAAIA,EAAc,CAChB,GAAI,aAAclB,EAAM,CACtB,OAAOA,C,KACF,CACL,MAAO,CAACmB,SAAU,GAAIC,OAAQpB,E,EAIlC,GAAI,aAAcA,GAAQ,WAAYA,EAAM,CAC1C,OAAOA,EAAKoB,M,CAEd,OAAOpB,CACT,CAOA,MAAMqB,EAAiC,+B,SAMvBC,IACd,MAAO,CAACjC,EAA+BkC,KACrC,MAAM/B,oBAACA,GAAuBH,EAC9BA,EAAUG,oBAAsB,WAC9B,MAAME,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZuB,GACCG,IACC,MAAMnC,EAAYO,KAClB,GAAIP,EAAUmC,qBAAsB,CAClC,M,CAGF5B,KAAK2B,GAA4BC,CAAoB,IAIzD,MAAMtB,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZN,KAAK2B,GAA4B,KACjC,M,CAEF,OAAO/B,GAAuBA,EAAoBe,KAAKX,K,CACxD,CAEL,CAUA,MAAM6B,EAAoC,oC,SAE1BC,IACd,MAAO,CAACrC,EAA+BC,KACrC,MAAME,oBAACA,GAAuBH,EAC9BA,EAAUG,oBAAsB,WAC9B,MAAME,EAAUC,EAAWC,MAC3B,MAAMC,EAAQC,EACZ2B,GACCE,IACC/B,KAAKN,GAAgBqC,CAAM,IAI/B,MAAMzB,EAAWR,EAAQS,cAAcN,GACvC,GAAIK,EAAU,CACZ,M,CAEF,OAAOV,GAAuBA,EAAoBe,KAAKX,K,CACxD,CAEL,Q"}