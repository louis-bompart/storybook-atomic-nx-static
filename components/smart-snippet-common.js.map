{"file":"smart-snippet-common.js","mappings":"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","names":[],"sources":["src/components/common/smart-snippets/atomic-smart-snippet-feedback-banner.tsx","src/components/common/smart-snippets/atomic-smart-snippet/smart-snippet-common.tsx"],"sourcesContent":["import {h, FunctionalComponent} from '@stencil/core';\nimport {i18n} from 'i18next';\nimport Checkmark from '../../../images/checkmark.svg';\nimport Cross from '../../../images/cross.svg';\nimport {Button} from '../button';\nimport {RadioButton} from '../radio-button';\n\ninterface SmartSnippetFeedbackBannerProps {\n  i18n: i18n;\n  id: string;\n  liked: boolean;\n  disliked: boolean;\n  feedbackSent: boolean;\n  onLike(): void;\n  onDislike(): void;\n  onPressExplainWhy(): void;\n  explainWhyRef?(element?: HTMLButtonElement): void;\n}\n\nexport const SmartSnippetFeedbackBanner: FunctionalComponent<\n  SmartSnippetFeedbackBannerProps\n> = (props) => {\n  const inquiryId = 'feedback-inquiry-' + props.id;\n  const thankYouId = 'feedback-thank-you-' + props.id;\n  const radioGroupName = 'feedback-options-' + props.id;\n\n  const Inquiry = () => (\n    <span id={inquiryId} part=\"feedback-inquiry\" class=\"shrink-0\">\n      {props.i18n.t('smart-snippet-feedback-inquiry')}\n    </span>\n  );\n\n  const Buttons = () => (\n    <div part=\"feedback-buttons\" class=\"flex gap-x-4\">\n      <label\n        part=\"feedback-like-button\"\n        class={\n          'flex items-center gap-x-1.5 ' +\n          (props.liked ? 'text-success' : 'cursor-pointer hover:underline')\n        }\n      >\n        <atomic-icon icon={Checkmark} class=\"w-3.5\"></atomic-icon>\n        <RadioButton\n          groupName={radioGroupName}\n          text={props.i18n.t('yes')}\n          checked={props.liked}\n          onChecked={() => props.onLike()}\n          class=\"text-inherit cursor-inherit\"\n        ></RadioButton>\n      </label>\n      <label\n        part=\"feedback-dislike-button\"\n        class={\n          'flex items-center gap-x-1.5 ' +\n          (props.disliked ? 'text-error' : 'cursor-pointer hover:underline')\n        }\n      >\n        <atomic-icon icon={Cross} class=\"w-3.5\"></atomic-icon>\n        <RadioButton\n          groupName={radioGroupName}\n          text={props.i18n.t('no')}\n          checked={props.disliked}\n          onChecked={() => props.onDislike()}\n          class=\"text-inherit cursor-inherit\"\n        ></RadioButton>\n      </label>\n    </div>\n  );\n\n  const ThankYouMessage = () => (\n    <span id={thankYouId} part=\"feedback-thank-you\" class=\"inline-flex\">\n      {props.i18n.t('smart-snippet-feedback-thanks')}\n    </span>\n  );\n\n  const ExplainWhyButton = () => (\n    <Button\n      part=\"feedback-explain-why-button\"\n      style=\"text-primary\"\n      onClick={() => props.onPressExplainWhy()}\n      ref={(element) => props.explainWhyRef?.(element)}\n    >\n      {props.i18n.t('smart-snippet-feedback-explain-why')}\n    </Button>\n  );\n\n  const ThankYouContainer = ({visible}: {visible: boolean}) =>\n    visible ? (\n      <div part=\"feedback-thank-you-wrapper\" class=\"flex flex-wrap gap-1\">\n        <ThankYouMessage></ThankYouMessage>\n        {props.disliked && !props.feedbackSent ? (\n          <ExplainWhyButton></ExplainWhyButton>\n        ) : (\n          []\n        )}\n      </div>\n    ) : (\n      []\n    );\n\n  return (\n    <div\n      part=\"feedback-banner\"\n      class=\"flex flex-wrap items-center gap-4 text-sm leading-4\"\n    >\n      <div\n        part=\"feedback-inquiry-and-buttons\"\n        role=\"radiogroup\"\n        aria-labelledby={inquiryId}\n        class=\"inline-flex flex-wrap gap-4\"\n      >\n        <Inquiry></Inquiry>\n        <Buttons></Buttons>\n      </div>\n      <ThankYouContainer\n        visible={props.liked || props.disliked}\n      ></ThankYouContainer>\n    </div>\n  );\n};\n","import {SmartSnippetState, SmartSnippet} from '@coveo/headless';\nimport {h} from '@stencil/core';\nimport {Heading} from '../../heading';\nimport {Hidden} from '../../hidden';\nimport {AnyBindings} from '../../interface/bindings';\nimport {SmartSnippetFeedbackBanner} from '../atomic-smart-snippet-feedback-banner';\n\ntype FeedBackModalElement =\n  | HTMLAtomicSmartSnippetFeedbackModalElement\n  | HTMLAtomicInsightSmartSnippetFeedbackModalElement;\n\ninterface SmartSnippetProps {\n  id: string;\n  modalTagName: string;\n  getSourceAnchorAttributes?: () => Attr[] | undefined;\n  getHost: () => HTMLElement;\n  getBindings: () => AnyBindings;\n  getModalRef: () => FeedBackModalElement | undefined;\n  getHeadingLevel: () => number;\n  getCollapsedHeight: () => number;\n  getMaximumHeight: () => number;\n  getSmartSnippetState: () => SmartSnippetState;\n  getSmartSnippet: () => SmartSnippet;\n  getSnippetStyle: () => string | undefined;\n  getFeedbackSent: () => boolean;\n  getSnippetMaximumHeight?: () => number;\n  getSnippetCollapsedHeight?: () => number;\n  setModalRef: (ref: HTMLElement) => void;\n  setFeedbackSent: (isSent: boolean) => void;\n}\n\nexport class SmartSnippetCommon {\n  constructor(private props: SmartSnippetProps) {}\n\n  private get style() {\n    const styleTag = this.props\n      .getHost()\n      .querySelector('template')\n      ?.content.querySelector('style');\n    if (!styleTag) {\n      return this.props.getSnippetStyle();\n    }\n    return styleTag.innerHTML;\n  }\n\n  private loadModal() {\n    if (this.props.getModalRef()) {\n      return;\n    }\n    const modalRef = document.createElement(this.props.modalTagName);\n    modalRef.addEventListener('feedbackSent', () => {\n      this.props.setFeedbackSent(true);\n    });\n    this.props.setModalRef(modalRef);\n    this.props.getHost().insertAdjacentElement('beforebegin', modalRef);\n  }\n\n  private renderQuestion() {\n    const headingLevel = this.props.getHeadingLevel();\n    return (\n      <Heading\n        level={headingLevel ? headingLevel + 1 : 0}\n        class=\"text-xl font-bold\"\n        part=\"question\"\n      >\n        {this.props.getSmartSnippetState().question}\n      </Heading>\n    );\n  }\n\n  private canSnippetCollapse() {\n    return this.props.getSnippetMaximumHeight?.() !== undefined;\n  }\n\n  private renderContent() {\n    const state = this.props.getSmartSnippetState();\n    if (this.canSnippetCollapse()) {\n      return (\n        <div part=\"truncated-answer\">\n          <atomic-smart-snippet-answer\n            exportparts=\"answer\"\n            part=\"body\"\n            htmlContent={state.answer}\n            innerStyle={this.style}\n          ></atomic-smart-snippet-answer>\n        </div>\n      );\n    }\n    return (\n      <atomic-smart-snippet-expandable-answer\n        exportparts=\"answer,show-more-button,show-less-button,truncated-answer\"\n        part=\"body\"\n        htmlContent={state.answer}\n        expanded={state.expanded}\n        maximumHeight={this.props.getMaximumHeight()}\n        collapsedHeight={this.props.getCollapsedHeight()}\n        snippetStyle={this.style}\n        onExpand={() => this.props.getSmartSnippet().expand()}\n        onCollapse={() => this.props.getSmartSnippet().collapse()}\n      ></atomic-smart-snippet-expandable-answer>\n    );\n  }\n\n  private renderFeedbackBanner() {\n    const state = this.props.getSmartSnippetState();\n    return (\n      <SmartSnippetFeedbackBanner\n        i18n={this.props.getBindings().i18n}\n        id={this.props.id}\n        liked={state.liked}\n        disliked={state.disliked}\n        feedbackSent={this.props.getFeedbackSent()}\n        onLike={() => this.props.getSmartSnippet().like()}\n        onDislike={() => {\n          this.loadModal();\n          this.props.getSmartSnippet().dislike();\n        }}\n        onPressExplainWhy={() => (this.props.getModalRef()!.isOpen = true)}\n        explainWhyRef={(button) => {\n          if (this.props.getModalRef()) {\n            this.props.getModalRef()!.source = button;\n          }\n        }}\n      ></SmartSnippetFeedbackBanner>\n    );\n  }\n\n  public hideDuringRender(shouldHide: boolean) {\n    const host = this.props.getHost();\n    host.style.visibility = shouldHide ? 'hidden' : '';\n    host.style.position = shouldHide ? 'absolute' : '';\n  }\n\n  public render() {\n    if (!this.props.getSmartSnippetState().answerFound) {\n      return <Hidden></Hidden>;\n    }\n\n    if (this.props.getHost().classList.contains('atomic-hidden')) {\n      this.hideDuringRender(true);\n    }\n\n    const source = this.props.getSmartSnippetState().source;\n\n    return (\n      <aside>\n        <Heading\n          level={this.props.getHeadingLevel() ?? 0}\n          class=\"accessibility-only\"\n        >\n          {this.props.getBindings().i18n.t('smart-snippet')}\n        </Heading>\n        <article\n          class=\"bg-background border border-neutral rounded-lg p-6 pb-4 text-on-background\"\n          part=\"smart-snippet\"\n        >\n          <atomic-smart-snippet-collapse-wrapper\n            maximumHeight={this.props.getSnippetMaximumHeight?.()}\n            collapsedHeight={this.props.getSnippetCollapsedHeight?.()}\n          >\n            {this.renderQuestion()}\n            {this.renderContent()}\n            <footer\n              part=\"footer\"\n              aria-label={this.props\n                .getBindings()\n                .i18n.t('smart-snippet-source')}\n            >\n              {source && (\n                <atomic-smart-snippet-source\n                  anchorAttributes={this.props.getSourceAnchorAttributes?.()}\n                  source={source}\n                  onSelectSource={this.props.getSmartSnippet().selectSource}\n                  onBeginDelayedSelectSource={\n                    this.props.getSmartSnippet().beginDelayedSelectSource\n                  }\n                  onCancelPendingSelectSource={\n                    this.props.getSmartSnippet().cancelPendingSelectSource\n                  }\n                ></atomic-smart-snippet-source>\n              )}\n              {this.renderFeedbackBanner()}\n            </footer>\n          </atomic-smart-snippet-collapse-wrapper>\n        </article>\n      </aside>\n    );\n  }\n}\n"],"version":3}