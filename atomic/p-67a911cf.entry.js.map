{"version":3,"names":["atomicDidYouMeanCss","AtomicDidYouMeanStyle0","AtomicDidYouMean","this","automaticallyCorrectQuery","queryCorrectionMode","initialize","didYouMean","buildDidYouMean","bindings","engine","options","queryTrigger","buildQueryTrigger","withQuery","key","query","h","LocalizedString","params","part","renderQueryTriggerAutomaticallyCorrected","Fragment","class","queryTriggerState","newQuery","onClick","undo","_a","originalQuery","renderDidYouMeanAutomaticallyCorrected","didYouMeanState","wasCorrectedTo","renderDidYouMeanCorrection","applyCorrection","queryCorrection","correctedQuery","render","hasQueryCorrection","wasAutomaticallyCorrected","_b","wasQueryModified","Hidden","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/atomic-did-you-mean/atomic-did-you-mean.pcss?tag=atomic-did-you-mean&encapsulation=shadow","src/components/search/atomic-did-you-mean/atomic-did-you-mean.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n","import {\n  DidYouMean,\n  DidYouMeanState,\n  buildDidYouMean,\n  QueryTrigger,\n  buildQueryTrigger,\n  QueryTriggerState,\n} from '@coveo/headless';\nimport {Component, Fragment, h, Prop, State} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {LocalizedString} from '../../../utils/jsx-utils';\nimport {Hidden} from '../../common/hidden';\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\n\n/**\n * The `atomic-did-you-mean` component is responsible for handling query corrections. When a query returns no result but finds a possible query correction, the component either suggests the correction or automatically triggers a new query with the suggested term.\n *\n * @part no-results - The text displayed when there are no results.\n * @part auto-corrected - The text displayed for the automatically corrected query.\n * @part showing-results-for - The first paragraph of the text displayed when a query trigger changes a query.\n * @part search-instead-for - The second paragraph of the text displayed when a query trigger changes a query.\n * @part did-you-mean - The text displayed around the button to manually correct a query.\n * @part correction-btn - The button used to manually correct a query.\n * @part undo-btn - The button used to undo a query changed by a query trigger.\n * @part highlight - The query highlights.\n */\n@Component({\n  tag: 'atomic-did-you-mean',\n  styleUrl: 'atomic-did-you-mean.pcss',\n  shadow: true,\n})\nexport class AtomicDidYouMean implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  private didYouMean!: DidYouMean;\n  protected queryTrigger!: QueryTrigger;\n\n  @BindStateToController('didYouMean')\n  @State()\n  private didYouMeanState?: DidYouMeanState;\n  @BindStateToController('queryTrigger')\n  @State()\n  private queryTriggerState?: QueryTriggerState;\n  @State() public error!: Error;\n\n  /**\n   * Whether to automatically apply corrections for queries that would otherwise return no results.\n   * When `automaticallyCorrectQuery` is `true`, the component automatically triggers a new query using the suggested term.\n   * When `automaticallyCorrectQuery` is `false`, the component returns the suggested term without triggering a new query.\n   *\n   * The default value is `true`.\n   */\n  @Prop({reflect: true}) public automaticallyCorrectQuery = true;\n\n  // TODO: V3: Default to `next`\n  /**\n   * Define which query correction system to use\n   *\n   * `legacy`: Query correction is powered by the legacy index system. This system relies on an algorithm using solely the index content to compute the suggested terms.\n   * `next`: Query correction is powered by a machine learning system, requiring a valid query suggestion model configured in your Coveo environment to function properly. This system relies on machine learning algorithms to compute the suggested terms.\n   *\n   * Default value is `legacy`. In the next major version of Atomic, the default value will be `next`.\n   */\n  @Prop({reflect: true})\n  public queryCorrectionMode: 'legacy' | 'next' = 'legacy';\n\n  public initialize() {\n    this.didYouMean = buildDidYouMean(this.bindings.engine, {\n      options: {\n        automaticallyCorrectQuery: this.automaticallyCorrectQuery,\n        queryCorrectionMode: this.queryCorrectionMode,\n      },\n    });\n    this.queryTrigger = buildQueryTrigger(this.bindings.engine);\n  }\n\n  private withQuery(\n    key:\n      | 'no-results-for-did-you-mean'\n      | 'query-auto-corrected-to'\n      | 'showing-results-for',\n    query: string\n  ) {\n    return (\n      <LocalizedString\n        bindings={this.bindings}\n        key={key}\n        params={{query: <b part=\"highlight\">{query}</b>}}\n      />\n    );\n  }\n\n  private renderQueryTriggerAutomaticallyCorrected() {\n    return (\n      <Fragment>\n        <p\n          class=\"text-on-background leading-6 text-lg\"\n          part=\"showing-results-for\"\n        >\n          {this.withQuery(\n            'showing-results-for',\n            this.queryTriggerState!.newQuery\n          )}\n        </p>\n        <p\n          class=\"text-on-background leading-5 text-base\"\n          part=\"search-instead-for\"\n        >\n          <LocalizedString\n            bindings={this.bindings}\n            key=\"search-instead-for\"\n            params={{\n              query: (\n                <button\n                  class=\"link py-1\"\n                  part=\"undo-btn\"\n                  onClick={() => this.queryTrigger.undo()}\n                >\n                  {this.queryTriggerState?.originalQuery}\n                </button>\n              ),\n            }}\n          />\n        </p>\n      </Fragment>\n    );\n  }\n\n  private renderDidYouMeanAutomaticallyCorrected() {\n    return (\n      <Fragment>\n        <p class=\"text-on-background mb-1\" part=\"no-results\">\n          {this.withQuery(\n            'no-results-for-did-you-mean',\n            this.didYouMeanState!.originalQuery\n          )}\n        </p>\n        <p class=\"text-on-background\" part=\"auto-corrected\">\n          {this.withQuery(\n            'query-auto-corrected-to',\n            this.didYouMeanState!.wasCorrectedTo\n          )}\n        </p>\n      </Fragment>\n    );\n  }\n\n  private renderDidYouMeanCorrection() {\n    return (\n      <p class=\"text-on-background\" part=\"did-you-mean\">\n        <LocalizedString\n          bindings={this.bindings}\n          key=\"did-you-mean\"\n          params={{\n            query: (\n              <button\n                class=\"link py-1\"\n                part=\"correction-btn\"\n                onClick={() => this.didYouMean.applyCorrection()}\n              >\n                {this.didYouMeanState!.queryCorrection.correctedQuery}\n              </button>\n            ),\n          }}\n        />\n      </p>\n    );\n  }\n\n  public render() {\n    if (this.didYouMeanState?.hasQueryCorrection) {\n      if (this.didYouMeanState.wasAutomaticallyCorrected) {\n        return this.renderDidYouMeanAutomaticallyCorrected();\n      }\n      return this.renderDidYouMeanCorrection();\n    }\n\n    if (this.queryTriggerState?.wasQueryModified) {\n      return this.renderQueryTriggerAutomaticallyCorrected();\n    }\n\n    return <Hidden></Hidden>;\n  }\n}\n"],"mappings":"sPAAA,MAAMA,EAAsB,w+tCAC5B,MAAAC,EAAeD,E,iXCkCFE,EAAgB,M,yBAoBGC,KAAAC,0BAA4B,KAYnDD,KAAAE,oBAAyC,S,oHAZU,K,yBAYV,Q,CAEzC,UAAAC,GACLH,KAAKI,WAAaC,EAAgBL,KAAKM,SAASC,OAAQ,CACtDC,QAAS,CACPP,0BAA2BD,KAAKC,0BAChCC,oBAAqBF,KAAKE,uBAG9BF,KAAKS,aAAeC,EAAkBV,KAAKM,SAASC,O,CAG9C,SAAAI,CACNC,EAIAC,GAEA,OACEC,EAACC,EAAe,CACdT,SAAUN,KAAKM,SACfM,IAAKA,EACLI,OAAQ,CAACH,MAAOC,EAAA,KAAGG,KAAK,aAAaJ,K,CAKnC,wCAAAK,G,MACN,OACEJ,EAACK,EAAQ,KACPL,EAAA,KACEM,MAAM,uCACNH,KAAK,uBAEJjB,KAAKW,UACJ,sBACAX,KAAKqB,kBAAmBC,WAG5BR,EAAA,KACEM,MAAM,yCACNH,KAAK,sBAELH,EAACC,EAAe,CACdT,SAAUN,KAAKM,SACfM,IAAI,qBACJI,OAAQ,CACNH,MACEC,EAAA,UACEM,MAAM,YACNH,KAAK,WACLM,QAAS,IAAMvB,KAAKS,aAAae,SAEhCC,EAAAzB,KAAKqB,qBAAiB,MAAAI,SAAA,SAAAA,EAAEC,mB,CAUjC,sCAAAC,GACN,OACEb,EAACK,EAAQ,KACPL,EAAA,KAAGM,MAAM,0BAA0BH,KAAK,cACrCjB,KAAKW,UACJ,8BACAX,KAAK4B,gBAAiBF,gBAG1BZ,EAAA,KAAGM,MAAM,qBAAqBH,KAAK,kBAChCjB,KAAKW,UACJ,0BACAX,KAAK4B,gBAAiBC,iB,CAOxB,0BAAAC,GACN,OACEhB,EAAA,KAAGM,MAAM,qBAAqBH,KAAK,gBACjCH,EAACC,EAAe,CACdT,SAAUN,KAAKM,SACfM,IAAI,eACJI,OAAQ,CACNH,MACEC,EAAA,UACEM,MAAM,YACNH,KAAK,iBACLM,QAAS,IAAMvB,KAAKI,WAAW2B,mBAE9B/B,KAAK4B,gBAAiBI,gBAAgBC,mB,CAS9C,MAAAC,G,QACL,IAAIT,EAAAzB,KAAK4B,mBAAe,MAAAH,SAAA,SAAAA,EAAEU,mBAAoB,CAC5C,GAAInC,KAAK4B,gBAAgBQ,0BAA2B,CAClD,OAAOpC,KAAK2B,wC,CAEd,OAAO3B,KAAK8B,4B,CAGd,IAAIO,EAAArC,KAAKqB,qBAAiB,MAAAgB,SAAA,SAAAA,EAAEC,iBAAkB,CAC5C,OAAOtC,KAAKkB,0C,CAGd,OAAOJ,EAACyB,EAAM,K,GApJaC,EAAA,CAA5BC,K,+BAMOD,EAAA,CAFPE,EAAsB,e,sCAKfF,EAAA,CAFPE,EAAsB,iB"}