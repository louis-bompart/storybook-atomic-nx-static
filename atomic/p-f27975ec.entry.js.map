{"version":3,"names":["atomicIpxButtonCss","AtomicIpxButtonStyle0","numberOrPixelValuePattern","RegExp","AtomicIPXButton","this","closeIcon","CloseIcon","openIcon","SearchIcon","isModalOpen","recommendationsLoaded","getRecommendations","recsEngine","_a","bindings","interfaceElement","querySelector","engine","dispatch","loadRecommendationActions","onClick","close","open","render","renderIPXButton","h","Button","style","part","class","icon","getIcon","label","displayedIcon","hiddenIcon","Fragment","key","ipxModal","host","classList","add","setAttribute","remove","initialDiv","document","createElement","innerHTML","iconElement","iconWidth","getIconWidth","iconHeight","getIconHeight","cleanupSVGStyles","removeAttribute","width","getAttribute","test","height","__decorate","InitializeBindings"],"sources":["src/components/ipx/atomic-ipx-button/atomic-ipx-button.pcss?tag=atomic-ipx-button&encapsulation=shadow","src/components/ipx/atomic-ipx-button/atomic-ipx-button.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\r\n\r\n/**\r\n * @prop --atomic-ipx-button-height: height of the IPX button.\r\n */\r\n:host {\r\n  &::part(ipx-button) {\r\n    @apply btn-primary fixed bottom-1 right-12 block px-3 whitespace-nowrap;\r\n    height: var(--atomic-ipx-button-height, 2.75rem);\r\n    background-color: var(--atomic-primary);\r\n  }\r\n\r\n  &::part(button-icon) {\r\n    @apply p-0 inline-block mr-2 w-4 h-4 align-middle relative;\r\n    font-size: 100%;\r\n  }\r\n\r\n  &::part(button-text) {\r\n    @apply overflow-hidden;\r\n  }\r\n\r\n  &::part(ipx-close-icon),\r\n  &::part(ipx-open-icon) {\r\n    @apply absolute left-0;\r\n    transition: transform 500ms;\r\n  }\r\n}\r\n","import {loadRecommendationActions} from '@coveo/headless/recommendation';\r\nimport {Component, Element, Fragment, h, Prop, State} from '@stencil/core';\r\nimport CloseIcon from '../../../images/close.svg';\r\nimport SearchIcon from '../../../images/search.svg';\r\nimport {\r\n  InitializableComponent,\r\n  InitializeBindings,\r\n} from '../../../utils/initialization-utils';\r\nimport {Button} from '../../common/button';\r\nimport {Bindings} from '../../search/atomic-search-interface/atomic-search-interface';\r\n\r\nconst numberOrPixelValuePattern = new RegExp(/^(?=.*(?:\\d+|px)$).*$/);\r\n\r\n/**\r\n * @internal\r\n */\r\n@Component({\r\n  tag: 'atomic-ipx-button',\r\n  styleUrl: './atomic-ipx-button.pcss',\r\n  shadow: true,\r\n})\r\nexport class AtomicIPXButton implements InitializableComponent {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n\r\n  @State() public error!: Error;\r\n\r\n  @Element() public host!: HTMLElement;\r\n\r\n  /**\r\n   * The label that will be shown to the user.\r\n   */\r\n  @Prop({reflect: true}) public label?: string;\r\n\r\n  /**\r\n   * The close icon of the button.\r\n   */\r\n  @Prop({reflect: true}) public closeIcon = CloseIcon;\r\n\r\n  /**\r\n   * The open icon of the button.\r\n   */\r\n  @Prop({reflect: true}) public openIcon = SearchIcon;\r\n\r\n  /**\r\n   * Whether the IPX modal is open.\r\n   */\r\n  @Prop({mutable: true, reflect: true}) public isModalOpen = false;\r\n\r\n  private recommendationsLoaded = false;\r\n\r\n  private async getRecommendations() {\r\n    const recsEngine = this.bindings.interfaceElement.querySelector(\r\n      'atomic-recs-interface'\r\n    )?.engine;\r\n    if (recsEngine) {\r\n      this.recommendationsLoaded = true;\r\n      recsEngine.dispatch(\r\n        loadRecommendationActions(recsEngine).getRecommendations()\r\n      );\r\n    }\r\n  }\r\n\r\n  private async onClick() {\r\n    if (!this.recommendationsLoaded) {\r\n      this.getRecommendations();\r\n    }\r\n    this.isModalOpen ? this.close() : this.open();\r\n    this.render();\r\n  }\r\n\r\n  private renderIPXButton() {\r\n    return (\r\n      <Button\r\n        style=\"primary\"\r\n        part=\"ipx-button\"\r\n        class=\"my-2\"\r\n        onClick={() => this.onClick()}\r\n      >\r\n        <span part=\"button-icon\">\r\n          <atomic-icon\r\n            part=\"ipx-close-icon\"\r\n            icon={this.getIcon(this.closeIcon)}\r\n          ></atomic-icon>\r\n          <atomic-icon\r\n            part=\"ipx-open-icon\"\r\n            icon={this.getIcon(this.openIcon)}\r\n          ></atomic-icon>\r\n        </span>\r\n        <span part=\"button-text\">{this.label}</span>\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    const [displayedIcon, hiddenIcon] = this.isModalOpen\r\n      ? ['ipx-close-icon', 'ipx-open-icon']\r\n      : ['ipx-open-icon', 'ipx-close-icon'];\r\n    if (this.isModalOpen && !this.recommendationsLoaded) {\r\n      this.getRecommendations();\r\n    }\r\n\r\n    return (\r\n      <Fragment>\r\n        {\r\n          <style>\r\n            {`\r\n              [part=${displayedIcon}] {\r\n                transform: translateY(0rem);\r\n              }\r\n\r\n              [part=${hiddenIcon}] {\r\n                transform: translateY(3rem);\r\n              }\r\n                \r\n              .btn-open {\r\n                [part=${displayedIcon}] {\r\n                  transform: translateY(3rem);\r\n                }\r\n              \r\n                [part=${hiddenIcon}] {\r\n                  transform: translateY(0rem);\r\n                }\r\n              }`}\r\n          </style>\r\n        }\r\n        <div class=\"flex flex-col items-center\" part=\"container\">\r\n          {this.renderIPXButton()}\r\n        </div>\r\n      </Fragment>\r\n    );\r\n  }\r\n\r\n  private get ipxModal() {\r\n    return this.bindings.interfaceElement.querySelector('atomic-ipx-modal')!;\r\n  }\r\n\r\n  private open() {\r\n    this.isModalOpen = true;\r\n    this.host.classList.add('btn-open');\r\n    this.ipxModal.setAttribute('is-open', 'true');\r\n  }\r\n\r\n  private close() {\r\n    this.isModalOpen = false;\r\n    this.host.classList.remove('btn-open');\r\n    this.ipxModal.setAttribute('is-open', 'false');\r\n  }\r\n\r\n  private getIcon(icon: string) {\r\n    const initialDiv = document.createElement('div')!;\r\n    initialDiv.innerHTML = icon;\r\n    const iconElement = initialDiv.querySelector('svg');\r\n    if (!iconElement) {\r\n      return initialDiv.innerHTML;\r\n    }\r\n    // here, we grab the icon width and height to set a viewbox (which keeps the svg looking normal), then remove styles from the icon to let the icon stretch into the space it is given.\r\n    const iconWidth = this.getIconWidth(iconElement);\r\n    const iconHeight = this.getIconHeight(iconElement);\r\n    this.cleanupSVGStyles(iconElement);\r\n    if (iconWidth && iconHeight) {\r\n      iconElement.setAttribute('viewBox', `0 0 ${iconWidth} ${iconHeight}`);\r\n    }\r\n    return initialDiv.innerHTML;\r\n  }\r\n\r\n  private cleanupSVGStyles(iconElement: SVGSVGElement) {\r\n    iconElement.removeAttribute('style');\r\n    iconElement.removeAttribute('width');\r\n    iconElement.removeAttribute('height');\r\n  }\r\n\r\n  private getIconWidth(icon: SVGSVGElement) {\r\n    const width = icon.getAttribute('width') ?? '';\r\n    if (numberOrPixelValuePattern.test(width)) {\r\n      return width;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private getIconHeight(icon: SVGSVGElement) {\r\n    const height = icon.getAttribute('height') ?? '';\r\n    if (numberOrPixelValuePattern.test(height)) {\r\n      return height;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n"],"mappings":"gWAAA,MAAMA,EAAqB,y8xCAC3B,MAAAC,EAAeD,E,2WCUf,MAAME,EAA4B,IAAIC,OAAO,yB,MAUhCC,EAAe,M,yBAeIC,KAAAC,UAAYC,EAKZF,KAAAG,SAAWC,EAKIJ,KAAAK,YAAc,MAEnDL,KAAAM,sBAAwB,M,yDAZUJ,E,cAKDE,E,iBAKkB,K,CAInD,wBAAMG,G,MACZ,MAAMC,GAAaC,EAAAT,KAAKU,SAASC,iBAAiBC,cAChD,4BACD,MAAAH,SAAA,SAAAA,EAAEI,OACH,GAAIL,EAAY,CACdR,KAAKM,sBAAwB,KAC7BE,EAAWM,SACTC,EAA0BP,GAAYD,qB,EAKpC,aAAMS,GACZ,IAAKhB,KAAKM,sBAAuB,CAC/BN,KAAKO,oB,CAEPP,KAAKK,YAAcL,KAAKiB,QAAUjB,KAAKkB,OACvClB,KAAKmB,Q,CAGC,eAAAC,GACN,OACEC,EAACC,EAAM,CACLC,MAAM,UACNC,KAAK,aACLC,MAAM,OACNT,QAAS,IAAMhB,KAAKgB,WAEpBK,EAAA,QAAMG,KAAK,eACTH,EAAA,eACEG,KAAK,iBACLE,KAAM1B,KAAK2B,QAAQ3B,KAAKC,aAE1BoB,EAAA,eACEG,KAAK,gBACLE,KAAM1B,KAAK2B,QAAQ3B,KAAKG,aAG5BkB,EAAA,QAAMG,KAAK,eAAexB,KAAK4B,O,CAK9B,MAAAT,GACL,MAAOU,EAAeC,GAAc9B,KAAKK,YACrC,CAAC,iBAAkB,iBACnB,CAAC,gBAAiB,kBACtB,GAAIL,KAAKK,cAAgBL,KAAKM,sBAAuB,CACnDN,KAAKO,oB,CAGP,OACEc,EAACU,EAAQ,CAAAC,IAAA,4CAELX,EAAA,SAAAW,IAAA,4CACG,yBACSH,8FAIAC,2IAKED,kHAIAC,4FAMhBT,EAAA,OAAAW,IAAA,2CAAKP,MAAM,6BAA6BD,KAAK,aAC1CxB,KAAKoB,mB,CAMd,YAAYa,GACV,OAAOjC,KAAKU,SAASC,iBAAiBC,cAAc,mB,CAG9C,IAAAM,GACNlB,KAAKK,YAAc,KACnBL,KAAKkC,KAAKC,UAAUC,IAAI,YACxBpC,KAAKiC,SAASI,aAAa,UAAW,O,CAGhC,KAAApB,GACNjB,KAAKK,YAAc,MACnBL,KAAKkC,KAAKC,UAAUG,OAAO,YAC3BtC,KAAKiC,SAASI,aAAa,UAAW,Q,CAGhC,OAAAV,CAAQD,GACd,MAAMa,EAAaC,SAASC,cAAc,OAC1CF,EAAWG,UAAYhB,EACvB,MAAMiB,EAAcJ,EAAW3B,cAAc,OAC7C,IAAK+B,EAAa,CAChB,OAAOJ,EAAWG,S,CAGpB,MAAME,EAAY5C,KAAK6C,aAAaF,GACpC,MAAMG,EAAa9C,KAAK+C,cAAcJ,GACtC3C,KAAKgD,iBAAiBL,GACtB,GAAIC,GAAaE,EAAY,CAC3BH,EAAYN,aAAa,UAAW,OAAOO,KAAaE,I,CAE1D,OAAOP,EAAWG,S,CAGZ,gBAAAM,CAAiBL,GACvBA,EAAYM,gBAAgB,SAC5BN,EAAYM,gBAAgB,SAC5BN,EAAYM,gBAAgB,S,CAGtB,YAAAJ,CAAanB,G,MACnB,MAAMwB,GAAQzC,EAAAiB,EAAKyB,aAAa,YAAQ,MAAA1C,SAAA,EAAAA,EAAI,GAC5C,GAAIZ,EAA0BuD,KAAKF,GAAQ,CACzC,OAAOA,C,CAET,OAAO,I,CAGD,aAAAH,CAAcrB,G,MACpB,MAAM2B,GAAS5C,EAAAiB,EAAKyB,aAAa,aAAS,MAAA1C,SAAA,EAAAA,EAAI,GAC9C,GAAIZ,EAA0BuD,KAAKC,GAAS,CAC1C,OAAOA,C,CAET,OAAO,I,6BAlKoBC,EAAA,CAA5BC,K"}