{"file":"atomic-product-numeric-field-value.entry.esm.js","mappings":";;;;;;;;;;;;;;;;;;;;MAoBa,mBAAmB;;;QAcrB,cAAS,GAAoB,sBAAsB,CAAC;QAEpD,mBAAc,GAAkB,IAAI,CAAC;;;yBAFR,sBAAsB;8BAEnB,IAAI;;IAGtC,SAAS,CAAC,KAAmC;QAClD,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,KAAK,CAAC,eAAe,EAAE,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC;KAC/B;IAEO,UAAU;QAChB,MAAM,KAAK,GAAG,uBAAuB,CAAC,kBAAkB,CACtD,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,KAAK,CACX,CAAC;QACF,IAAI,KAAK,KAAK,IAAI,EAAE;YAClB,OAAO,IAAI,CAAC;SACb;QACD,MAAM,aAAa,GAAG,UAAU,CAAC,GAAG,KAAK,EAAE,CAAC,CAAC;QAC7C,IAAI,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE;YAC/B,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CACpB,oBAAoB,KAAK,iBAAiB,IAAI,CAAC,KAAK,gBAAgB,CACrE,CAAC;YACF,OAAO,IAAI,CAAC;SACb;QACD,OAAO,aAAa,CAAC;KACtB;IAEO,WAAW,CAAC,KAAa;QAC/B,IAAI;YACF,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAqB,CAAC,CAAC;SACxE;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,GAAG,KAAc,CAAC;YAC5B,OAAO,KAAK,CAAC,QAAQ,EAAE,CAAC;SACzB;KACF;IAEO,oBAAoB;QAC1B,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,KAAK,KAAK,IAAI,EAAE;YAClB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;SAC/C;KACF;IAED,mBAAmB;QACjB,IAAI,CAAC,oBAAoB,EAAE,CAAC;KAC7B;IAEM,MAAM;QACX,IAAI,IAAI,CAAC,cAAc,KAAK,IAAI,EAAE;YAChC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YACnB,OAAO;SACR;QACD,OAAO,IAAI,CAAC,cAAc,CAAC;KAC5B;;;AApE4B;IAA5B,kBAAkB,EAAE;qDAA4B;AACvB;IAAzB,cAAc,EAAE;oDAA2B;;;;","names":[],"sources":["src/components/commerce/product-template-components/atomic-product-numeric-field-value/atomic-product-numeric-field-value.tsx"],"sourcesContent":["import {Product, ProductTemplatesHelpers} from '@coveo/headless/commerce';\r\nimport {Component, Prop, Element, State, Listen} from '@stencil/core';\r\nimport {Bindings} from '../../../../components';\r\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\r\nimport {\r\n  defaultNumberFormatter,\r\n  NumberFormatter,\r\n} from '../../../common/formats/format-common';\r\nimport {ProductContext} from '../product-template-decorators';\r\n\r\n/**\r\n * @internal\r\n * The `atomic-product-numeric-field-value` component renders the value of a number product field.\r\n *\r\n * The number can be formatted by adding a `atomic-format-number`, `atomic-format-currency` or `atomic-format-unit` component into this component.\r\n */\r\n@Component({\r\n  tag: 'atomic-product-numeric-field-value',\r\n  shadow: false,\r\n})\r\nexport class AtomicProductNumber {\r\n  @InitializeBindings() public bindings!: Bindings;\r\n  @ProductContext() private product!: Product;\r\n\r\n  @Element() host!: HTMLElement;\r\n\r\n  @State() public error!: Error;\r\n\r\n  /**\r\n   * The field that the component should use.\r\n   * The component will try to find this field in the `Product.additionalFields` object unless it finds it in the `Product` object first.\r\n   */\r\n  @Prop({reflect: true}) field!: string;\r\n\r\n  @State() formatter: NumberFormatter = defaultNumberFormatter;\r\n\r\n  @State() valueToDisplay: string | null = null;\r\n\r\n  @Listen('atomic/numberFormat')\r\n  public setFormat(event: CustomEvent<NumberFormatter>) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.formatter = event.detail;\r\n  }\r\n\r\n  private parseValue() {\r\n    const value = ProductTemplatesHelpers.getProductProperty(\r\n      this.product,\r\n      this.field\r\n    );\r\n    if (value === null) {\r\n      return null;\r\n    }\r\n    const valueAsNumber = parseFloat(`${value}`);\r\n    if (Number.isNaN(valueAsNumber)) {\r\n      this.error = new Error(\r\n        `Could not parse \"${value}\" from field \"${this.field}\" as a number.`\r\n      );\r\n      return null;\r\n    }\r\n    return valueAsNumber;\r\n  }\r\n\r\n  private formatValue(value: number) {\r\n    try {\r\n      return this.formatter(value, this.bindings.i18n.languages as string[]);\r\n    } catch (error) {\r\n      this.error = error as Error;\r\n      return value.toString();\r\n    }\r\n  }\r\n\r\n  private updateValueToDisplay() {\r\n    const value = this.parseValue();\r\n    if (value !== null) {\r\n      this.valueToDisplay = this.formatValue(value);\r\n    }\r\n  }\r\n\r\n  componentWillRender() {\r\n    this.updateValueToDisplay();\r\n  }\r\n\r\n  public render() {\r\n    if (this.valueToDisplay === null) {\r\n      this.host.remove();\r\n      return;\r\n    }\r\n    return this.valueToDisplay;\r\n  }\r\n}\r\n"],"version":3}