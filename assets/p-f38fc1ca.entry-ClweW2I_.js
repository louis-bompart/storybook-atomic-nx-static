import{N as a,g as t,O as h}from"./preview-Cp9OdNlu.js";import{l as u,y as d}from"./p-b9bd83ee-BMwo3ZL5.js";import{s as l}from"./p-cfb3c589-B_FPW2aN.js";import{t as g,n as m,a as b,r as f}from"./p-484590fe-C8Zkfk8p.js";import{r as c}from"./p-2130c607-DsteMWb3.js";import{o as p}from"./p-c280cd05-7zHi8rD9.js";import{t as x,r as o}from"./p-0943c4bd-Erj32V3d.js";import{r as y}from"./p-f5723aee-KeNxIJx_.js";import{n as Q,i as S,a as I,l as L,c as C,s as E}from"./p-da093b91-CC76q7i8.js";import"./p-abea0bd2-55DIQVI1.js";import"./iframe-vvwA9ouH.js";import"../sb-preview/runtime.js";import"./chunk-GKNNPQCW-BkHQSocK.js";import"./p-8f5830b4-EwJYRc8T.js";import"./p-1580513b-3LX64KEr.js";import"./p-e9c4f463-BPmi-3c5.js";const P=class{constructor(e){a(this,e),this.error=void 0,this.icon=void 0,this.maxWithQuery=void 0,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}initialize(){const e=this.bindings.engine,{registerQuerySuggest:i,fetchQuerySuggestions:r}=u(e);return e.dispatch(i({id:this.bindings.id,count:this.bindings.numberOfQueries})),{position:Array.from(this.host.parentNode.children).indexOf(this.host),onInput:()=>e.dispatch(r({id:this.bindings.id})),renderItems:()=>this.renderItems()}}renderItems(){const i=this.bindings.searchBoxController.state.value!==""?this.maxWithQuery:this.maxWithoutQuery;return this.bindings.searchBoxController.state.suggestions.slice(0,i).map(r=>this.renderItem(r))}renderItem(e){const i=this.bindings.searchBoxController.state.value!=="";return{...g(e,this.bindings.i18n),content:t(f,null,t(b,{icon:this.icon||l,hasSuggestion:this.bindings.getSuggestions().length>1}),t(m,{suggestion:e,hasQuery:i})),onSelect:()=>{this.bindings.searchBoxController.selectSuggestion(e.rawValue)}}}render(){if(this.error)return t("atomic-component-error",{key:"82330d6802b3bb12488a9fba2f5ef07b4d7c8bde",element:this.host,error:this.error})}get host(){return h(this)}},V=class{constructor(e){a(this,e),this.maxWithQuery=3,this.warnUser=y(()=>this.bindings.engine.logger.warn("The recent queries feature is deactivated because analytics are disabled.")),this.error=void 0,this.icon=void 0,this.maxWithQuery=3,this.maxWithoutQuery=void 0}componentWillLoad(){try{c(e=>(this.bindings=e,this.initialize()),this.host)}catch(e){this.error=e}}renderIcon(){return this.icon||p}initialize(){return this.storage=new x,this.recentQueriesList=d(this.bindings.engine,{initialState:{queries:this.retrieveLocalStorage()},options:{maxLength:1e3,clearFilters:this.bindings.clearFilters}}),this.recentQueriesList.subscribe(()=>this.updateLocalStorage()),{position:Array.from(this.host.parentNode.children).indexOf(this.host),renderItems:()=>this.renderItems()}}retrieveLocalStorage(){return this.storage.getParsedJSON(o.RECENT_QUERIES,[])}updateLocalStorage(){return this.recentQueriesList.state.analyticsEnabled?this.storage.setJSON(o.RECENT_QUERIES,this.recentQueriesList.state.queries):this.disableFeature()}disableFeature(){this.warnUser(),this.storage.removeItem(o.RECENT_QUERIES)}renderItems(){if(!this.recentQueriesList.state.analyticsEnabled)return[];const e=this.bindings.searchBoxController.state.value,r=e!==""?this.maxWithQuery:this.maxWithoutQuery,n=this.recentQueriesList.state.queries.filter(s=>s!==e&&s.toLowerCase().startsWith(e.toLowerCase())).slice(0,r).map(s=>this.renderItem(s));return n.length&&n.unshift(this.renderClear()),n}renderClear(){return{...Q(this.bindings.i18n),content:t(S,{i18n:this.bindings.i18n}),onSelect:()=>{this.recentQueriesList.clear(),this.bindings.triggerSuggestions()}}}renderItem(e){const i=this.bindings.searchBoxController.state.value;return{...I(e,this.bindings.i18n),content:t(E,null,t(C,{icon:this.renderIcon()}),t(L,{query:i,value:e})),onSelect:()=>{if(this.bindings.isStandalone){this.bindings.searchBoxController.updateText(e),this.bindings.searchBoxController.submit();return}this.recentQueriesList.executeRecentQuery(this.recentQueriesList.state.queries.indexOf(e))}}}render(){if(this.error)return t("atomic-component-error",{key:"6d7ef697579c4eeac5b62254570d688e66c28518",element:this.host,error:this.error})}get host(){return h(this)}};export{P as atomic_commerce_search_box_query_suggestions,V as atomic_commerce_search_box_recent_queries};
